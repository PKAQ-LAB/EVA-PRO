(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Ot,J,N){"use strict";var le=N(67294),ye=N(83280),m=N(23185),ve=N(4322),j=N(24770),ce=N(89182),ue=function(ae,nt){var ke={};for(var st in ae)Object.prototype.hasOwnProperty.call(ae,st)&&nt.indexOf(st)<0&&(ke[st]=ae[st]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Gt=0,st=Object.getOwnPropertySymbols(ae);Gt<st.length;Gt++)nt.indexOf(st[Gt])<0&&Object.prototype.propertyIsEnumerable.call(ae,st[Gt])&&(ke[st[Gt]]=ae[st[Gt]]);return ke},ze=(0,le.forwardRef)(function(ae,nt){var ke=ae.chartRef,st=ae.style,Gt=st===void 0?{height:"inherit"}:st,sr=ae.className,Pt=ae.loading,er=ae.loadingTemplate,Lt=ae.errorTemplate,ht=ue(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),mt=(0,m.Z)(ye.TZ,ht),tr=mt.chart,q=mt.container;return(0,le.useEffect)(function(){(0,ve.J)(ke,tr.current)},[tr.current]),(0,le.useImperativeHandle)(nt,function(){return{getChart:function(){return tr.current}}}),le.createElement(j.Z,{errorTemplate:Lt},Pt&&le.createElement(ce.Z,{loadingTemplate:er,theme:ae.theme}),le.createElement("div",{className:sr,style:Gt,ref:q}))});J.Z=ze},93343:function(Ot,J,N){"use strict";var le=N(67294),ye=N(83280),m=N(23185),ve=N(4322),j=N(24770),ce=N(89182),ue=function(ae,nt){var ke={};for(var st in ae)Object.prototype.hasOwnProperty.call(ae,st)&&nt.indexOf(st)<0&&(ke[st]=ae[st]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Gt=0,st=Object.getOwnPropertySymbols(ae);Gt<st.length;Gt++)nt.indexOf(st[Gt])<0&&Object.prototype.propertyIsEnumerable.call(ae,st[Gt])&&(ke[st[Gt]]=ae[st[Gt]]);return ke},ze=(0,le.forwardRef)(function(ae,nt){var ke=ae.chartRef,st=ae.style,Gt=st===void 0?{height:"inherit"}:st,sr=ae.className,Pt=ae.loading,er=ae.loadingTemplate,Lt=ae.errorTemplate,ht=ue(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),mt=(0,m.Z)(ye.m,ht),tr=mt.chart,q=mt.container;return(0,le.useEffect)(function(){(0,ve.J)(ke,tr.current)},[tr.current]),(0,le.useImperativeHandle)(nt,function(){return{getChart:function(){return tr.current}}}),le.createElement(j.Z,{errorTemplate:Lt},Pt&&le.createElement(ce.Z,{loadingTemplate:er,theme:ae.theme}),le.createElement("div",{className:sr,style:Gt,ref:q}))});J.Z=ze},64335:function(Ot,J,N){"use strict";var le=N(67294),ye=(0,le.createContext)({});J.Z=ye},21349:function(Ot,J,N){"use strict";var le=N(84305),ye=N(75901),m=N(94184),ve=N.n(m),j=N(67294),ce=N(64335),ue=N(53645),ze=N.n(ue),ae=function(ke){var st=(0,j.useContext)(ce.Z),Gt=ke.children,sr=ke.contentWidth,Pt=ke.className,er=ke.style,Lt=(0,j.useContext)(ye.ZP.ConfigContext),ht=Lt.getPrefixCls,mt=ke.prefixCls||ht("pro"),tr=sr||st.contentWidth,q="".concat(mt,"-grid-content");return j.createElement("div",{className:ve()(q,Pt,{wide:tr==="Fixed"}),style:er},j.createElement("div",{className:"".concat(mt,"-grid-content-children")},Gt))};J.Z=ae},66213:function(Ot,J,N){"use strict";N.d(J,{Z:function(){return m}});var le=N(77608);function ye(ve,j){for(;!Object.prototype.hasOwnProperty.call(ve,j)&&(ve=(0,le.Z)(ve),ve!==null););return ve}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get.bind():m=function(j,ce,ue){var ze=ye(j,ce);if(!!ze){var ae=Object.getOwnPropertyDescriptor(ze,ce);return ae.get?ae.get.call(arguments.length<3?j:ue):ae.value}},m.apply(this,arguments)}},31795:function(Ot,J,N){var le=N(75752);Ot.exports.geometry=ye,Ot.exports.ring=ve;function ye(ce){var ue=0,ze;switch(ce.type){case"Polygon":return m(ce.coordinates);case"MultiPolygon":for(ze=0;ze<ce.coordinates.length;ze++)ue+=m(ce.coordinates[ze]);return ue;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ze=0;ze<ce.geometries.length;ze++)ue+=ye(ce.geometries[ze]);return ue}}function m(ce){var ue=0;if(ce&&ce.length>0){ue+=Math.abs(ve(ce[0]));for(var ze=1;ze<ce.length;ze++)ue-=Math.abs(ve(ce[ze]))}return ue}function ve(ce){var ue,ze,ae,nt,ke,st,Gt,sr=0,Pt=ce.length;if(Pt>2){for(Gt=0;Gt<Pt;Gt++)Gt===Pt-2?(nt=Pt-2,ke=Pt-1,st=0):Gt===Pt-1?(nt=Pt-1,ke=0,st=1):(nt=Gt,ke=Gt+1,st=Gt+2),ue=ce[nt],ze=ce[ke],ae=ce[st],sr+=(j(ae[0])-j(ue[0]))*Math.sin(j(ze[1]));sr=sr*le.RADIUS*le.RADIUS/2}return sr}function j(ce){return ce*Math.PI/180}},38163:function(Ot,J,N){var le=N(31795);Ot.exports=ye;function ye(ze,ae){switch(ze&&ze.type||null){case"FeatureCollection":return ze.features=ze.features.map(m(ye,ae)),ze;case"GeometryCollection":return ze.geometries=ze.geometries.map(m(ye,ae)),ze;case"Feature":return ze.geometry=ye(ze.geometry,ae),ze;case"Polygon":case"MultiPolygon":return ve(ze,ae);default:return ze}}function m(ze,ae){return function(nt){return ze(nt,ae)}}function ve(ze,ae){return ze.type==="Polygon"?ze.coordinates=j(ze.coordinates,ae):ze.type==="MultiPolygon"&&(ze.coordinates=ze.coordinates.map(m(j,ae))),ze}function j(ze,ae){ae=!!ae,ze[0]=ce(ze[0],ae);for(var nt=1;nt<ze.length;nt++)ze[nt]=ce(ze[nt],!ae);return ze}function ce(ze,ae){return ue(ze)===ae?ze:ze.reverse()}function ue(ze){return le.ring(ze)>=0}},70499:function(Ot){Ot.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Ot){Ot.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},15492:function(Ot,J,N){"use strict";N.r(J),N.d(J,{default:function(){return p4}});var le={};N.r(le),N.d(le,{add:function(){return yc},adjoint:function(){return Ni},clone:function(){return ca},copy:function(){return xo},create:function(){return mi},determinant:function(){return Se},equals:function(){return ql},exactEquals:function(){return xp},frob:function(){return Pu},fromQuat:function(){return xn},fromQuat2:function(){return Ur},fromRotation:function(){return Ae},fromRotationTranslation:function(){return Nr},fromRotationTranslationScale:function(){return fn},fromRotationTranslationScaleOrigin:function(){return En},fromScaling:function(){return je},fromTranslation:function(){return _e},fromValues:function(){return pl},fromXRotation:function(){return dt},fromYRotation:function(){return Tt},fromZRotation:function(){return dr},frustum:function(){return dn},getRotation:function(){return Cn},getScaling:function(){return Br},getTranslation:function(){return nn},identity:function(){return Ut},invert:function(){return cn},lookAt:function(){return dl},mul:function(){return ad},multiply:function(){return re},multiplyScalar:function(){return Mv},multiplyScalarAndAdd:function(){return Jo},ortho:function(){return Pl},orthoNO:function(){return aa},orthoZO:function(){return Is},perspective:function(){return va},perspectiveFromFieldOfView:function(){return ka},perspectiveNO:function(){return qn},perspectiveZO:function(){return ss},rotate:function(){return kt},rotateX:function(){return $e},rotateY:function(){return Ne},rotateZ:function(){return ot},scale:function(){return ft},set:function(){return Me},str:function(){return _p},sub:function(){return od},subtract:function(){return Df},targetTo:function(){return Mu},translate:function(){return Ve},transpose:function(){return wt}});var ye=N(58024),m=N(39144),ve=N(13062),j=N(71230),ce=N(89032),ue=N(15746),ze=N(95300),ae=N(7277),nt=N(25377),ke=N(67294),st=N(83280),Gt=N(23185),sr=N(4322),Pt=N(24770),er=N(89182),Lt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},ht=(0,ke.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=Lt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Gt.Z)(st.aC,x),A=C.chart,O=C.container;return(0,ke.useEffect)(function(){(0,sr.J)(r,A.current)},[A.current]),(0,ke.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),ke.createElement(Pt.Z,{errorTemplate:g},f&&ke.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),ke.createElement("div",{className:s,style:a,ref:O}))}),mt=ht,tr=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},q=(0,ke.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=tr(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Gt.Z)(st.kB,x),A=C.chart,O=C.container;return(0,ke.useEffect)(function(){(0,sr.J)(r,A.current)},[A.current]),(0,ke.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),ke.createElement(Pt.Z,{errorTemplate:g},f&&ke.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),ke.createElement("div",{className:s,style:a,ref:O}))}),Jt=q,_t=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},rt=(0,ke.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,f=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=_t(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Gt.Z)(st.Kj,x),A=C.chart,O=C.container;return(0,ke.useEffect)(function(){(0,sr.J)(r,A.current)},[A.current]),(0,ke.useImperativeHandle)(i,function(){return{getChart:function(){return A.current}}}),ke.createElement(Pt.Z,{errorTemplate:g},f&&ke.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),ke.createElement("div",{className:s,style:a,ref:O}))}),At=rt,tt=N(90829),$t=N(21349),br=N(92077),Fr=N.n(br),en=N(2824),Te=N(3182),Ke=N(69610),Fe=N(54941),Mt=N(81306),gt=N(19809),Zt=N(94043),qt=N.n(Zt),Er=(0,ke.createContext)({});function Kn(){return(0,ke.useContext)(Er)}var pn={},Wi={},Zn=function(i){return Wi[i]},Gn=function(i,r){Wi[i]=r},pi=function(i){return pn[i]},$n=function(i,r){pn[i]=r},ui={},Ji={},Ii=34,Ei=10,zi=13;function na(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Si(e,i){var r=na(e);return function(n,a){return i(r(n),a,e)}}function ya(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function wn(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function _i(e){return e<0?"-"+wn(-e,6):e>9999?"+"+wn(e,6):wn(e,4)}function ki(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":_i(e.getUTCFullYear(),4)+"-"+wn(e.getUTCMonth()+1,2)+"-"+wn(e.getUTCDate(),2)+(a?"T"+wn(i,2)+":"+wn(r,2)+":"+wn(n,2)+"."+wn(a,3)+"Z":n?"T"+wn(i,2)+":"+wn(r,2)+":"+wn(n,2)+"Z":r||i?"T"+wn(i,2)+":"+wn(r,2)+"Z":"")}function Xi(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(A,O){var D,V,Y=a(A,function(te,Ee){if(D)return D(te,Ee-1);V=te,D=O?Si(te,O):na(te)});return Y.columns=V||[],Y}function a(A,O){var D=[],V=A.length,Y=0,te=0,Ee,Ze=V<=0,Je=!1;A.charCodeAt(V-1)===Ei&&--V,A.charCodeAt(V-1)===zi&&--V;function lt(){if(Ze)return Ji;if(Je)return Je=!1,ui;var xt,Kt=Y,ur;if(A.charCodeAt(Kt)===Ii){for(;Y++<V&&A.charCodeAt(Y)!==Ii||A.charCodeAt(++Y)===Ii;);return(xt=Y)>=V?Ze=!0:(ur=A.charCodeAt(Y++))===Ei?Je=!0:ur===zi&&(Je=!0,A.charCodeAt(Y)===Ei&&++Y),A.slice(Kt+1,xt-1).replace(/""/g,'"')}for(;Y<V;){if((ur=A.charCodeAt(xt=Y++))===Ei)Je=!0;else if(ur===zi)Je=!0,A.charCodeAt(Y)===Ei&&++Y;else if(ur!==r)continue;return A.slice(Kt,xt)}return Ze=!0,A.slice(Kt,V)}for(;(Ee=lt())!==Ji;){for(var Et=[];Ee!==ui&&Ee!==Ji;)Et.push(Ee),Ee=lt();O&&(Et=O(Et,te++))==null||D.push(Et)}return D}function s(A,O){return A.map(function(D){return O.map(function(V){return C(D[V])}).join(e)})}function f(A,O){return O==null&&(O=ya(A)),[O.map(C).join(e)].concat(s(A,O)).join(`
`)}function v(A,O){return O==null&&(O=ya(A)),s(A,O).join(`
`)}function g(A){return A.map(x).join(`
`)}function x(A){return A.map(C).join(e)}function C(A){return A==null?"":A instanceof Date?ki(A):i.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var za=Xi(","),de=za.parse,Nn=za.parseRows,Ua=za.format,us=za.formatBody,jt=za.formatRows,ir=za.formatRow,Tr=za.formatValue,I=N(96156),nr=N(85061),Dn=N(38163),li=N.n(Dn);function Hn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function an(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ai(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var A=[parseFloat(g[r]),parseFloat(g[n])],O=[parseFloat(g[a]),parseFloat(g[s])];C=[A,O]}if(f){var D="Polygon";Array.isArray(f[0])||(D="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(D="LineString");var V={type:D,coordinates:(0,nr.Z)(g[f])};li()(V,!0),C=V.coordinates}var Y=an(an({},g),{},{_id:x,coordinates:C});v.push(Y)}),{dataArray:v}):{dataArray:[]}}var wi=[{lng1:100,lat1:30,lng2:130,lat2:30}],Wa={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function ls(e,i){var r=de(e);return Ai(r,i)}var fa=63710088e-1,wa={centimeters:fa*100,centimetres:fa*100,degrees:fa/111325,feet:fa*3.28084,inches:fa*39.37,kilometers:fa/1e3,kilometres:fa/1e3,meters:fa,metres:fa,miles:fa/1609.344,millimeters:fa*1e3,millimetres:fa*1e3,nauticalmiles:fa/1852,radians:1,yards:fa*1.0936},ba={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/fa,yards:1.0936133},G={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function ne(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return fe(i).geometry;case"Polygon":return He(i).geometry;case"MultiPoint":return Bt(i).geometry;case"MultiLineString":return vr(i).geometry;case"MultiPolygon":return zt(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$i(e[0])||!$i(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return $(n,i,r)}function Ie(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return ge(n,i)}),r)}function He(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return $(v,i,r)}function at(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return He(n,i)}),r)}function fe(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return $(n,i,r)}function Be(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return fe(n,i)}),r)}function yt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function vr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return $(n,i,r)}function Bt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return $(n,i,r)}function zt(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return $(n,i,r)}function gr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return $(n,i,r)}function bn(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function ln(e,i){i===void 0&&(i="kilometers");var r=wa[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Rt(e,i){i===void 0&&(i="kilometers");var r=wa[i];if(!r)throw new Error(i+" units is invalid");return e/r}function un(e,i){return Hr(Rt(e,i))}function jr(e){var i=e%360;return i<0&&(i+=360),i}function Hr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function ai(e){var i=e%360;return i*Math.PI/180}function rn(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ln(Rt(e,i),r)}function Ci(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=G[i];if(!n)throw new Error("invalid original units");var a=G[r];if(!a)throw new Error("invalid final units");return e/n*a}function $i(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function yi(e){return!!e&&e.constructor===Object}function Ti(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!$i(i))throw new Error("bbox must only contain numbers")})}function xi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ei(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Gi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ta(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ta(e[0]);throw new Error("coordinates must only contain numbers")}function ea(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Mi(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Ui(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Oa(e){return e.type==="Feature"?e.geometry:e}function au(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Ea(e,i,r){if(e!==null)for(var n,a,s,f,v,g,x,C=0,A=0,O,D=e.type,V=D==="FeatureCollection",Y=D==="Feature",te=V?e.features.length:1,Ee=0;Ee<te;Ee++){x=V?e.features[Ee].geometry:Y?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Ze=0;Ze<v;Ze++){var Je=0,lt=0;if(f=O?x.geometries[Ze]:x,f!==null){g=f.coordinates;var Et=f.type;switch(C=r&&(Et==="Polygon"||Et==="MultiPolygon")?1:0,Et){case null:break;case"Point":if(i(g,A,Ee,Je,lt)===!1)return!1;A++,Je++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],A,Ee,Je,lt)===!1)return!1;A++,Et==="MultiPoint"&&Je++}Et==="LineString"&&Je++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],A,Ee,Je,lt)===!1)return!1;A++}Et==="MultiLineString"&&Je++,Et==="Polygon"&&lt++}Et==="Polygon"&&Je++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(lt=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],A,Ee,Je,lt)===!1)return!1;A++}lt++}Je++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(Ea(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Sa(e,i,r,n){var a=r;return Ea(e,function(s,f,v,g,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,g,x)},n),a}function _s(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function cs(e,i,r){var n=r;return _s(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Qi(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Yu(e,i,r){var n=r;return Qi(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function co(e){var i=[];return Ea(e,function(r){i.push(r)}),i}function Ra(e,i){var r,n,a,s,f,v,g,x,C,A,O=0,D=e.type==="FeatureCollection",V=e.type==="Feature",Y=D?e.features.length:1;for(r=0;r<Y;r++){for(v=D?e.features[r].geometry:V?e.geometry:e,x=D?e.features[r].properties:V?e.properties:{},C=D?e.features[r].bbox:V?e.bbox:void 0,A=D?e.features[r].id:V?e.id:void 0,g=v?v.type==="GeometryCollection":!1,f=g?v.geometries.length:1,a=0;a<f;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,O,x,C,A)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,A)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function $a(e,i,r){var n=r;return Ra(e,function(a,s,f,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,g)}),n}function Yi(e,i){Ra(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i($(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],A={type:g,coordinates:C};if(i($(A,a),n,x)===!1)return!1}})}function Ho(e,i,r){var n=r;return Yi(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Wo(e,i){Yi(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,g=0,x=0,C=0;if(Ea(r,function(A,O,D,V,Y){if(v===void 0||n>g||V>x||Y>C){v=A,g=n,x=V,C=Y,s=0;return}var te=lineString([v,A],r.properties);if(i(te,n,a,Y,s)===!1)return!1;s++,v=A})===!1)return!1}}})}function qu(e,i,r){var n=r,a=!1;return Wo(e,function(s,f,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,g,x),a=!0}),n}function po(e,i){if(!e)throw new Error("geojson is required");Yi(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function Xo(e,i,r){var n=r;return po(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function ha(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function fo(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,f,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],f,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],f,i)}throw new Error("geojson is invalid")}function Yo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qa(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ou(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),li()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return Yi(e,function(s,f){var v=Gi(s),g=f,x=Qa(Qa({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function Ic(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function ks(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Q=N(28481),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function et(e){this.message=e}et.prototype=new Error,et.prototype.name="InvalidCharacterError";function Dt(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new et("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=be.indexOf(s);return r}function Dr(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=be.charAt(i>>18&63)+be.charAt(i>>12&63)+be.charAt(i>>6&63)+be.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ut=N(6610),St=N(5991),Ja=function(){function e(i,r){(0,ut.Z)(this,e),this.buffers=i,this.type=r}return(0,St.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),qi;typeof window=="undefined"?qi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:qi=window;var Za=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,qo=Za?my.getSystemInfoSync().pixelRatio:qi.devicePixelRatio,Yr=N(10379),Vr=N(46070),It=N(77608),ko=(0,St.Z)(function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),oe=N(63349);function Ys(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=su(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function su(e,i){if(!!e){if(typeof e=="string")return fs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fs(e,i)}}function fs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ta=new WeakMap,ho=function(){function e(){(0,ut.Z)(this,e),ta.set(this,{})}return(0,St.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ta.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),ta.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=ta.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=ta.get(this)[r.type];if(n){var a=Ys(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function ic(e){var i=Oc();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Oc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ku=function(e){(0,Yr.Z)(r,e);var i=ic(r);function r(){var n;return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,St.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(ho);function Rc(e){var i=Rl();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Rl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $u=function(e){(0,Yr.Z)(r,e);var i=Rc(r);function r(){var n;return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"className",void 0),(0,I.Z)((0,oe.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,St.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ku),uu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Qu,_,T,F;if(uu){var R=my.getSystemInfoSync();Qu=R.screenWidth,_=R.screenHeight,T=R.windowWidth,F=R.windowHeight}else{var K=qi.innerWidth,xe=qi.innerHeight;Qu=K,_=xe,T=K,F=xe}var qe={width:Qu,height:_,availWidth:T,availHeight:F,availLeft:0,availTop:0},pt=qe.availWidth,vt=qe.availHeight,cr={style:[]};function _r(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return cr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return cr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:pt+"px",height:vt+"px",margin:"0px",padding:"0px"})}function ci(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=pt,e.clientHeight=vt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Jn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=pt,e.offsetHeight=vt)}function Hi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=pt,e.scrollHeight=vt)}function sa(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ca(e){var i=Zi();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Co(){}var xs=function(e){(0,Yr.Z)(r,e);var i=Ca(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"className",void 0),(0,I.Z)((0,oe.Z)(n),"children",void 0),(0,I.Z)((0,oe.Z)(n),"focus",void 0),(0,I.Z)((0,oe.Z)(n),"blur",void 0),(0,I.Z)((0,oe.Z)(n),"insertBefore",void 0),(0,I.Z)((0,oe.Z)(n),"appendChild",void 0),(0,I.Z)((0,oe.Z)(n),"removeChild",void 0),(0,I.Z)((0,oe.Z)(n),"remove",void 0),(0,I.Z)((0,oe.Z)(n),"innerHTML",void 0),(0,I.Z)((0,oe.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Co,n.blur=Co,n.insertBefore=Co,n.appendChild=Co,n.removeChild=Co,n.remove=Co,n.innerHTML="",n.tagName=a.toUpperCase(),_r((0,oe.Z)(n),s),Pn((0,oe.Z)(n)),sa((0,oe.Z)(n)),ci((0,oe.Z)(n)),Jn((0,oe.Z)(n)),Hi((0,oe.Z)(n)),n}return(0,St.Z)(r)}($u);function gl(e){var i=af();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ju=function(e){(0,Yr.Z)(r,e);var i=gl(r);function r(n){return(0,ut.Z)(this,r),i.call(this,n)}return(0,St.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(xs);function Lc(e){var i=Ou();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yu=function(e){(0,Yr.Z)(r,e);var i=Lc(r);function r(){return(0,ut.Z)(this,r),i.call(this,"video")}return(0,St.Z)(r)}(Ju),vo={},ua={};function Eh(e,i){vo=e,vo.id=i,"tagName"in vo||(vo.tagName="CANVAS"),vo.type="canvas",Mixin.parentNode(vo),Mixin.style(vo),Mixin.classList(vo),Mixin.clientRegion(vo),Mixin.offsetRegion(vo),vo.focus=function(){},vo.blur=function(){}}function Sh(e,i){var r=1024,n=1024;ua={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in ua||(ua.tagName="CANVAS"),Mixin.parentNode(ua),Mixin.style(ua),Mixin.classList(ua),Mixin.clientRegion(ua),Mixin.offsetRegion(ua),ua.getContext=function(a){if(a==="2d")return e},ua.focus=function(){},ua.blur=function(){}}function ro(){return vo}function Xf(){return ua}var _u=(0,St.Z)(function e(){(0,ut.Z)(this,e);var i=ro(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),_r(r),sa(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ds={href:"",protocol:"",host:""};function kc(e){var i=yl();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _a=function(e){(0,Yr.Z)(r,e);var i=kc(r);function r(){return(0,ut.Z)(this,r),i.call(this,"body",0)}return(0,St.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(xs),Ll=function(e){(0,Yr.Z)(r,e);var i=kc(r);function r(){return(0,ut.Z)(this,r),i.call(this,"html",0)}return(0,St.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(xs),ac={},ts={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ds,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new _u:i==="video"?new yu:new xs(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){ac[i]||(ac[i]=[]),ac[i].push(r)},removeEventListener:function(i,r){var n=ac[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=ac[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new ko(i)}};ts.documentElement=new Ll,ts.head=new xs("head"),ts.body=new _a;var Yf=Object,Ch=N(90484),Ah=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Ch.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,St.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),of=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,_l,Do,Ru;if(of){var el=my.getSystemInfoSync();_l=el.system,Do=el.platform,Ru=el.language}else{var Fo={versions:function(){var e=qi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(qi.navigator.browserLanguage||qi.navigator.language).toLowerCase()};Fo.versions.android?Do="android":Fo.versions.trident?Do="IE":Fo.versions.presto?Do="Opera":Fo.versions.webKit?Do="webKit":Fo.versions.gecko?Do="Firefox":Fo.versions.mobile?Do="mobile":Fo.versions.ios?Do="ios":Fo.versions.iPhone?Do="iPhone":Fo.versions.iPad?Do="ipad":Fo.versions.webApp?Do="webApp":Fo.versions.weixin?Do="weixin":Fo.versions.qq&&(Do="qq"),_l=qi.navigator.userAgent,Ru=Fo.language}var kl=_l.toLowerCase().indexOf("android")!==-1,tl=kl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",qs="Mozilla/5.0 (".concat(tl,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Ru),sf={platform:Do,language:Ru,appVersion:"5.0 (".concat(tl,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:qs},uf={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},lf=0,rl=0;function oc(e){var i=Date.now(),r=Math.max(lf+23,i);return rl=setTimeout(function(){e(lf=r)},r-i),rl}function Dc(e){var i=ro();return i.requestAnimationFrame?i.requestAnimationFrame(e):oc(e)}function cf(e){var i=ro();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Fc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ut.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,St.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=wh(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function wh(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return Dr(i)}var Bc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},xl={};function ff(e){var i=hf();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lu=new Map,pf=new Map,qf=new Map,Th={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Dl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function sp(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Dl.call(this,"readystatechange",i)}var rs=function(e){(0,Yr.Z)(r,e);var i=ff(r);function r(){var n;return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"onabort",void 0),(0,I.Z)((0,oe.Z)(n),"onerror",void 0),(0,I.Z)((0,oe.Z)(n),"onload",void 0),(0,I.Z)((0,oe.Z)(n),"onloadstart",void 0),(0,I.Z)((0,oe.Z)(n),"onprogress",void 0),(0,I.Z)((0,oe.Z)(n),"ontimeout",void 0),(0,I.Z)((0,oe.Z)(n),"onloadend",void 0),(0,I.Z)((0,oe.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,oe.Z)(n),"readyState",void 0),(0,I.Z)((0,oe.Z)(n),"response",void 0),(0,I.Z)((0,oe.Z)(n),"responseText",void 0),(0,I.Z)((0,oe.Z)(n),"_responseType",void 0),(0,I.Z)((0,oe.Z)(n),"responseXML",void 0),(0,I.Z)((0,oe.Z)(n),"status",void 0),(0,I.Z)((0,oe.Z)(n),"statusText",void 0),(0,I.Z)((0,oe.Z)(n),"upload",void 0),(0,I.Z)((0,oe.Z)(n),"withCredentials",void 0),(0,I.Z)((0,oe.Z)(n),"timeout",void 0),(0,I.Z)((0,oe.Z)(n),"_url",void 0),(0,I.Z)((0,oe.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Lu.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,St.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=qf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=pf.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return pf.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=Lu.get("requestHeader");f[a]=s,Lu.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(ho);(0,I.Z)(rs,"UNSEND",void 0),(0,I.Z)(rs,"OPENED",void 0),(0,I.Z)(rs,"HEADERS_RECEIVED",void 0),(0,I.Z)(rs,"LOADING",void 0),(0,I.Z)(rs,"DONE",void 0),rs.UNSEND=0,rs.OPENED=1,rs.HEADERS_RECEIVED=2,rs.LOADING=3,rs.DONE=4;function ja(e){var i=sc();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fl=function(e){(0,Yr.Z)(r,e);var i=ja(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,oe.Z)(a),"touches",void 0),(0,I.Z)((0,oe.Z)(a),"targetTouches",void 0),(0,I.Z)((0,oe.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=ro(),a.currentTarget=ro(),a}return(0,St.Z)(r)}(ko);function lu(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Li(e){return function(i){var r=new Fl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return lu(n)}),r.touches.forEach(function(n){return lu(n)}),r.targetTouches.forEach(function(n){return lu(n)}),ts.dispatchEvent(r)}}function Ma(e){return function(i){i.type=e,ts.dispatchEvent(i)}}var Fs=Li("touchstart"),df=Li("touchmove"),bl=Li("touchend"),vf=Ma("mapCameaParams");function up(e){var i=lp();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function lp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nc=function(e){(0,Yr.Z)(r,e);var i=up(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,oe.Z)(a),"buttons",void 0),(0,I.Z)((0,oe.Z)(a),"which",void 0),(0,I.Z)((0,oe.Z)(a),"pointerId",void 0),(0,I.Z)((0,oe.Z)(a),"bubbles",void 0),(0,I.Z)((0,oe.Z)(a),"button",void 0),(0,I.Z)((0,oe.Z)(a),"width",void 0),(0,I.Z)((0,oe.Z)(a),"height",void 0),(0,I.Z)((0,oe.Z)(a),"pressure",void 0),(0,I.Z)((0,oe.Z)(a),"isPrimary",void 0),(0,I.Z)((0,oe.Z)(a),"pointerType",void 0),(0,I.Z)((0,oe.Z)(a),"altKey",void 0),(0,I.Z)((0,oe.Z)(a),"ctrlKey",void 0),(0,I.Z)((0,oe.Z)(a),"metaKey",void 0),(0,I.Z)((0,oe.Z)(a),"shiftKey",void 0),a.target=ro(),a.currentTarget=ro(),a}return(0,St.Z)(r)}(ko),uc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],nl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Ao="touch";function lc(e,i,r){for(var n=new Nc(e),a=0;a<uc.length;a++){var s=uc[a];n[s]=i[s]||nl[a]}return n.type=e,n.target=ro(),n.currentTarget=ro(),n.buttons=cc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=mn(i),n.pointerType=Ao,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function cc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Xa=null;function mn(e){return Xa===e.identifier}function eo(e){Xa===null&&(Xa=e.identifier)}function il(e){Xa===e.identifier&&(Xa=null)}function al(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?eo(a):(e==="pointerup"||e==="pointercancel")&&il(a);var s=lc(e,a,i);ts.dispatchEvent(s)}}}var xu=al("pointerdown"),Bs=al("pointermove"),Kf=al("pointerup");function qr(e){var i=mf();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function mf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $f=function(e){(0,Yr.Z)(r,e);var i=qr(r);function r(n){return(0,ut.Z)(this,r),i.call(this,n)}return(0,St.Z)(r)}(ko);function ku(e){return function(i){i.type=e,ts.dispatchEvent(i)}}var Fa=ku("mousedown"),Ns=ku("mousemove"),gf=ku("mouseup"),Du=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ws=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),mo=Du||ws,Mh={atob:Dt,btoa:Dr,devicePixelRatio:qo,Blob:Ja,document:ts,Element:$u,Event:ko,EventTarget:ho,HTMLCanvasElement:Yf,HTMLElement:xs,HTMLMediaElement:Ju,HTMLVideoElement:yu,Image:_u,ImageData:Ah,navigator:sf,Node:Ku,requestAnimationFrame:Dc,cancelAnimationFrame:cf,screen:qe,XMLHttpRequest:rs,performance:uf,URL:Fc,WebGLRenderingContext:Bc,WebGL2RenderingContext:xl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ts.addEventListener(i,r,n)},removeEventListener:function(i,r,n){ts.removeEventListener(i,r)},dispatchEvent:function(i){ts.dispatchEvent(i)},innerWidth:qe.availWidth,innerHeight:qe.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},pa=mo?Mh:qi,Qf=mo?rs:qi.XMLHttpRequest,Ph=mo?Ds:qi.location;function Ks(e){var i=e;return typeof e=="string"&&(i=pa.document.getElementById(e)),i}function Ts(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Pi(e){return Ts(e).split(/\s+/)}function bu(e){var i,r,n=pa==null||(i=pa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function la(e,i,r){var n=pa.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function no(e){var i=e.parentNode;i&&i.removeChild(e)}function zs(e,i){if(e.classList!==void 0)for(var r=Pi(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Us(e,i)){var s=Zs(e);hs(e,(s?s+" ":"")+i)}}function cu(e,i){e.classList!==void 0?e.classList.remove(i):hs(e,Ts((" "+Zs(e)+" ").replace(" "+i+" "," ")))}function Us(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Zs(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function hs(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Zs(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function In(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var An=bu(["transform","WebkitTransform"]);function fc(e,i){e.style[An]=i}function ps(){if(typeof Event=="function")pa.dispatchEvent(new Event("resize"));else{var e=pa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,pa,0),pa.dispatchEvent(e)}}function Eu(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ko(){var e,i=pa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,Q.Z)(s,2),v=f[0],g=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var xa=Ko()<1?1:pa.devicePixelRatio;function yf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function zc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function ia(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function La(e){if(e.length===0)throw new Error("mean requires at least one data point");return ia(e)/e.length}function Jf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var ol={min:zc,max:yf,mean:La,sum:ia,mode:Jf};function $s(e,i){return e.map(function(r){return r[i]})}function Su(e,i){return ol[e](i)}var wo=N(14665);function sl(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Cu=N(51814);function El(e,i,r){return(0,Cu.Z)()?El=Reflect.construct.bind():El=function(a,s,f){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return f&&(0,wo.Z)(x,f.prototype),x},El.apply(null,arguments)}function ul(e){var i=typeof Map=="function"?new Map:void 0;return ul=function(n){if(n===null||!sl(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return El(n,arguments,(0,It.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,wo.Z)(a,n)},ul(e)}function hc(e){var i=_f();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function _f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sl=function(e){(0,Yr.Z)(r,e);var i=hc(r);function r(n,a,s){var f;return(0,ut.Z)(this,r),f=i.call(this,n),(0,I.Z)((0,oe.Z)(f),"status",void 0),(0,I.Z)((0,oe.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,St.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(ul(Error));function Cl(e){var i=new Qf;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Ih=function(i,r){var n=Cl(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Sl("".concat(n.statusText),n.status,i.url)):r(new Sl(n.statusText,n.status,i.url))},n.send(),n},Al=function(i,r){var n=Cl(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Sl(n.statusText,n.status,i.url))},n.send(),n};function Bl(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var xf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Fu=function(i,r){return Al(i,function(n,a){if(n)r(n);else if(a){var s=new pa.Image;s.crossOrigin="anonymous";var f=pa.URL||pa.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src),s.onload=null},s.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var v=new pa.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):xf}})},bs=2*Math.PI*6378137/2;function bf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;pc(i,n)}),i}function pc(e,i){return Array.isArray(i[0])?i.forEach(function(r){pc(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Oh(e,i){return Nl(e,i)}function Nl(e,i){return Array.isArray(e[0])?e.map(function(r){return Nl(r,i)}):i(e)}function l(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=E(e,i);var n=e[0],a=e[1],s=n*bs/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*bs/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function h(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/bs*180,s=n/bs*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function c(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function d(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function E(e,i){if(i===!1)return e;var r=c(e[0]),n=d(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function w(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function M(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],g=f[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function L(e,i,r){var n=ai(i[1]-e[1]),a=ai(i[0]-e[0]),s=ai(e[1]),f=ai(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return ln(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function U(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function X(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function se(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function he(e){return[[e[0],e[1]],[e[2],e[3]]]}function pe(e){var i=Le(e,[0,0]);return[e[0]/i,e[1]/i]}function Le(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Oe(e,i){return e[0]*i[0]+e[1]*i[1]}function We(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function we(e,i){return Math.acos(Oe(e,i)/(We(e)*We(i)))*180/Math.PI}function Xe(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function it(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],g=Le(f,v);n+=g;var x=[f[0]-v[0],f[1]-v[1]],C=Xe(r,x);if(s>0){var A=a[s-1].rotation;A-C>360-A+C&&(C=C+360)}a.push({start:f,end:v,dis:g,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var bt=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ut.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,St.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Ht(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Wt=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ut.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,St.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Qt=N(2650);function mr(e){return typeof e=="string"?!!Qt.ZP(e):!1}function lr(e){var i=Qt.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Mr(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function tn(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ln(e){var i=pa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(f-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),mo)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var kn;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(kn||(kn={}));var Fn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oi(e,i,r){var n=e.classList;for(var a in Fn)Fn.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function wr(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Yn={BACK:1029,FRONT:1028};function ti(e){switch(e){case"GAODE1.x":return Yn.BACK;case"GAODE2.x":return Yn.BACK;case"MAPBOX":return Yn.FRONT;case"SIMPLE":return Yn.FRONT;case"GLOBEL":return Yn.BACK;case"L7MAP":return Yn.FRONT;default:return Yn.FRONT}}function ri(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Wn(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(r+n)%e.length;e=e[s]}return e.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-n-1).toString())}var oi;(function(e){e.Overlap="overlap",e.Replace="replace"})(oi||(oi={}));var On;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(On||(On={}));var Sn=N(92137),go=N(87757),Xn=N.n(go);function Bo(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],v=[r,s],g=[a,s],x=[a,n];return He([[f,x,g,v,f]],i.properties,{bbox:e,id:i.id})}var To=0,Va=1,Ga=2;function Ms(e){e.forEach(function(i){i.properties.state=To}),e.forEach(function(i){i.isCurrent&&!Au(i)&&$o(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&Ga)})}function ds(e){e.forEach(function(r){r.properties.state=To}),e.forEach(function(r){r.isCurrent&&Au(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&Ga),r.children.length&&(r.isVisible||r.properties.state&Va)?r.children.forEach(function(n){n.properties.state=Va}):r.isCurrent&&$o(r)})}function Au(e){for(;e;){if(e.isLoaded)return e.properties.state|=Ga,!0;e=e.parent}return!1}function $o(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=Ga:$o(i)})}var Ps,fu=256,zl=[-Infinity,-Infinity,Infinity,Infinity],Ul=5,Bu=(Ps={},(0,I.Z)(Ps,oi.Overlap,Ms),(0,I.Z)(Ps,oi.Replace,ds),Ps),Zl=function(){};function jl(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,a]}function Qs(e,i,r){var n=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,r),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}var Vl=function(i,r,n){var a=Qs(i,r,n),s=(0,Q.Z)(a,2),f=s[0],v=s[1],g=Qs(i+1,r+1,n),x=(0,Q.Z)(g,2),C=x[0],A=x[1];return[f,A,C,v]};function wu(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,a=n===void 0?Infinity:n,s=e.minZoom,f=s===void 0?0:s,v=e.zoomOffset,g=v===void 0?0:v,x=e.extent,C=x===void 0?zl:x,A=Math.ceil(i)+g;A<f?A=f:A>a&&(A=a);for(var O=(0,Q.Z)(r,4),D=O[0],V=O[1],Y=O[2],te=O[3],Ee=[Math.max(D,C[0]),Math.max(V,C[1]),Math.min(Y,C[2]),Math.min(te,C[3])],Ze=[],Je=jl(Ee[0],Ee[1],A),lt=(0,Q.Z)(Je,2),Et=lt[0],xt=lt[1],Kt=jl(Ee[2],Ee[3],A),ur=(0,Q.Z)(Kt,2),Ir=ur[0],Xr=ur[1],yr=Et;yr<=Ir;yr++)for(var sn=Xr;sn<=xt;sn++)Ze.push({x:yr,y:sn,z:A});return Ze}var yo=function(i,r,n){var a=Math.pow(2,n),s=a-1,f=a,v=i,g=r;return v<0?v=v+f:v>s&&(v=v%f),{warpX:v,warpY:g}},Nu=function(){function e(i){(0,ut.Z)(this,e),(0,I.Z)(this,"x",void 0),(0,I.Z)(this,"y",void 0),(0,I.Z)(this,"z",void 0),(0,I.Z)(this,"tileSize",256),(0,I.Z)(this,"isVisible",!1),(0,I.Z)(this,"isCurrent",!1),(0,I.Z)(this,"layer",null),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"parent",null),(0,I.Z)(this,"children",[]),(0,I.Z)(this,"data",null),(0,I.Z)(this,"properties",{}),(0,I.Z)(this,"loadStatus",void 0),(0,I.Z)(this,"abortController",void 0),(0,I.Z)(this,"loadDataId",0);var r=i.x,n=i.y,a=i.z,s=i.tileSize;this.x=r,this.y=n,this.z=a,this.tileSize=s}return(0,St.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===On.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===On.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===On.Cancelled}},{key:"isDone",get:function(){return[On.Loaded,On.Cancelled,On.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Vl(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,Q.Z)(this.bounds,4),n=r[0],a=r[1],s=r[2],f=r[3],v=[(s-n)/2,(f-a)/2],g=Bo(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return g}},{key:"key",get:function(){var r="".concat(this.x,",").concat(this.y,",").concat(this.z);return r}},{key:"loadData",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a){var s,f,v,g,x,C,A,O,D,V,Y,te,Ee,Ze,Je,lt;return Xn().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:return s=a.getData,f=a.onLoad,v=a.onError,this.loadDataId++,g=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=On.Loading,x=null,xt.prev=7,A=this.x,O=this.y,D=this.z,V=this.bounds,Y=this.tileSize,te=yo(A,O,D),Ee=te.warpX,Ze=te.warpY,Je=this.abortController.signal,lt={x:Ee,y:Ze,z:D,bounds:V,tileSize:Y,signal:Je},xt.next=14,s(lt);case 14:x=xt.sent,xt.next=20;break;case 17:xt.prev=17,xt.t0=xt.catch(7),C=xt.t0;case 20:if(g===this.loadDataId){xt.next=22;break}return xt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){xt.next=24;break}return xt.abrupt("return");case 24:if(!(C||!x)){xt.next=28;break}return this.loadStatus=On.Failure,v(C,this),xt.abrupt("return");case 28:this.loadStatus=On.Loaded,this.data=x,f(this);case 31:case"end":return xt.stop()}},n,this,[[7,17]])}));function r(n){return i.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=On.Cancelled,this.abortController.abort())}}]),e}(),Qo=N(26729),zu=N.n(Qo);function Di(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=js(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function js(e,i){if(!!e){if(typeof e=="string")return ns(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ns(e,i)}}function ns(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Uu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Uu(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Uc(e){var i=Ef();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Js=function(e){(0,Yr.Z)(r,e);var i=Uc(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this),(0,I.Z)((0,oe.Z)(a),"currentTiles",[]),(0,I.Z)((0,oe.Z)(a),"options",void 0),(0,I.Z)((0,oe.Z)(a),"cacheTiles",new Map),(0,I.Z)((0,oe.Z)(a),"lastViewStates",void 0),(0,I.Z)((0,oe.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,I.Z)((0,oe.Z)(a),"onTileError",function(s,f){a.emit("tile-error",{error:s,tile:f}),a.updateTileVisible()}),(0,I.Z)((0,oe.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:zl,getTileData:Zl,updateStrategy:oi.Overlap},a.updateOptions(n),a}return(0,St.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,f){return s.z-f.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),f=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=Gl(Gl(Gl({},this.options),a),{},{minZoom:s,maxZoom:f})}},{key:"update",value:function(a,s){var f=this;if(!(this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===s.toString())){this.lastViewStates={zoom:a,latLonBounds:s};var v=!1,g=this.getTileIndices(a,s);this.currentTiles=g.map(function(x){var C=x.x,A=x.y,O=x.z,D=f.getTile(C,A,O);return D||(D=f.createTile(C,A,O),v=!0,D)}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var a=Di(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var f=(0,Q.Z)(s.value,2),v=f[0],g=f[1];this.currentTiles.includes(g)||(this.cacheTiles.delete(v),this.onTileUnload(g)),this.onTileUnload(g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(x){a.e(x)}finally{a.f()}}},{key:"destroy",value:function(){var a=Di(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.isLoading&&f.abortLoad()}}catch(v){a.e(v)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,f=Di(this.cacheTiles.values()),v;try{for(f.s();!(v=f.n()).done;){var g=v.value;s.set(g.key,g.isVisible),g.isCurrent=!1,g.isVisible=!1}}catch(V){f.e(V)}finally{f.f()}var x=Di(this.currentTiles),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.isCurrent=!0,A.isVisible=!0}}catch(V){x.e(V)}finally{x.f()}var O=Array.from(this.cacheTiles.values());typeof a=="function"?a(O):Bu[a](O);var D=Array.from(this.cacheTiles.values()).some(function(V){return V.isVisible!==s.get(V.key)});D&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var f=this.options,v=f.tileSize,g=f.extent,x=f.zoomOffset,C=Math.floor(this.options.maxZoom),A=Math.ceil(this.options.minZoom),O=wu({maxZoom:C,minZoom:A,zoomOffset:x,tileSize:v,zoom:a,latLonBounds:s,extent:g});return O}},{key:"getTileId",value:function(a,s,f){var v="".concat(a,",").concat(s,",").concat(f);return v}},{key:"getTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=this.cacheTiles.get(v);return g}},{key:"createTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=new Nu({x:a,y:s,z:f,tileSize:this.options.tileSize});return this.cacheTiles.set(v,g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),g}},{key:"resizeCacheTiles",value:function(){var a=Ul*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var f=Di(this.cacheTiles),v;try{for(f.s();!(v=f.n()).done;){var g=(0,Q.Z)(v.value,2),x=g[0],C=g[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(x),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(A){f.e(A)}finally{f.f()}}}},{key:"rebuildTileTree",value:function(){var a=Di(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.parent=null,f.children.length=0}}catch(A){a.e(A)}finally{a.f()}var v=Di(this.cacheTiles.values()),g;try{for(v.s();!(g=v.n()).done;){var x=g.value,C=this.getNearestAncestor(x.x,x.y,x.z);x.parent=C,C!=null&&C.children&&C.children.push(x)}}catch(A){v.e(A)}finally{v.f()}}},{key:"getNearestAncestor",value:function(a,s,f){for(;f>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),f=f-1;var v=this.getTile(a,s,f);if(v)return v}return null}}]),r}(zu());function Hl(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){e instanceof HTMLImageElement?f([e]):hu(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function hu(e,i){var r=e,n=[];if(typeof r=="string")Fu({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){Fu({url:f},function(v,g){s++,n.push(g),s===a&&i(n)})})}return Hl}function wl(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}function dc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var No={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Zc=function(){var e=(0,Sn.Z)(Xn().mark(function i(r,n){var a;return Xn().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=Wn(r,n),f.abrupt("return",new Promise(function(v,g){Fu({url:a},function(x,C){x?g(x):v(C)})}));case 2:case"end":return f.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function eh(e,i){var r=function(s){return Zc(e,s)},n=eu(eu(eu({},No),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n}}var Rh=N(30236),th=N.n(Rh),cp=N(47037),Tu=N.n(cp),vc=N(23560),Zu=N.n(vc),Lh=N(50361),jc=N.n(Lh),ll=N(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Sf(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(C){try{x(n.next(C))}catch(A){f(A)}}function g(C){try{x(n.throw(C))}catch(A){f(A)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function qp(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function kd(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Cf(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(kd(arguments[i]));return e}function zo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function is(e,i){return i={exports:{}},e(i,i.exports),i.exports}var kh=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});zo(kh);var fp=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});zo(fp);var mc=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof ll=="object"&&typeof ll.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=ll.nextTick:f=a,i.default=s(f)});zo(mc);var wv=mc.fallback,rh=mc.wrap,Tv=mc.hasSetImmediate,Uo=mc.hasNextTick,nh=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(fp),n=a(mc);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,ju.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var A=x.pop(),O=g.apply(this,x);return f(O,A)}:(0,r.default)(function(x,C){var A;try{A=g.apply(this,x)}catch(O){return C(O)}if(A&&typeof A.then=="function")return f(A,C);C(null,A)})}function f(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(A){(0,n.default)(function(O){throw O},A)}}e.exports=i.default});zo(nh);var ju=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(nh);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function f(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});zo(ju);var hp=ju.isAsyncIterable,pp=ju.isAsyncGenerator,Dh=ju.isAsync,Wl=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(A){for(var O=[],D=arguments.length-1;D-- >0;)O[D]=arguments[D+1];if(A)return C(A);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});zo(Wl);var Vc=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(kh),n=s(ju),a=s(Wl);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,g){var x=(0,r.default)(v)?[]:{};f(v,function(C,A,O){(0,n.default)(C)(function(D){for(var V,Y=[],te=arguments.length-1;te-- >0;)Y[te]=arguments[te+1];Y.length<2&&(V=Y,Y=V[0]),x[A]=Y,O(D)})},function(C){return g(C,x)})},3),e.exports=i.default});zo(Vc);var cl=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});zo(cl);var Gc=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});zo(Gc);var Af=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(kh),n=a(Gc);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,A=x.length;return function(){return++C<A?{value:x[C],key:C}:null}}function f(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],A=-1,O=C.length;return function(){var V=C[++A];return A<O?{value:x[V],key:V}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?f(C):v(x)}e.exports=i.default});zo(Af);var Hc=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});zo(Hc);var fl=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});zo(fl);var ih=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(fl);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,g){var x=!1,C=!1,A=!1,O=0,D=0;function V(){O>=f||A||x||(A=!0,s.next().then(function(Ee){var Ze=Ee.value,Je=Ee.done;if(!(C||x)){if(A=!1,Je){x=!0,O<=0&&g(null);return}O++,v(Ze,D,Y),D++,V()}}).catch(te))}function Y(Ee,Ze){if(O-=1,!C){if(Ee)return te(Ee);if(Ee===!1){x=!0,C=!0;return}if(Ze===r.default||x&&O<=0)return x=!0,g(null);V()}}function te(Ee){C||(A=!1,x=!0,g(Ee))}V()}e.exports=i.default});zo(ih);var wf=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(cl),n=v(Af),a=v(Hc),s=v(ih),f=v(fl);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,A){if(A=(0,r.default)(A),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return A(null);if((0,ju.isAsyncGenerator)(x))return(0,s.default)(x,g,C,A);if((0,ju.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,A);var O=(0,n.default)(x),D=!1,V=!1,Y=0,te=!1;function Ee(Je,lt){if(!V)if(Y-=1,Je)D=!0,A(Je);else if(Je===!1)D=!0,V=!0;else{if(lt===f.default||D&&Y<=0)return D=!0,A(null);te||Ze()}}function Ze(){for(te=!0;Y<g&&!D;){var Je=O();if(Je===null){D=!0,Y<=0&&A(null);return}Y+=1,C(Je.value,Je.key,(0,a.default)(Ee))}te=!1}Ze()}},e.exports=i.default});zo(wf);var Tf=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(wf),n=s(ju),a=s(Wl);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(f,4),e.exports=i.default});zo(Tf);var Wc=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Tf),n=a(Wl);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,g){return(0,r.default)(f,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});zo(Wc);var Mf=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Vc),n=a(Wc);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),Vs=zo(Mf),pu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Vs(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Cf(n.args)),a(null,i)})},e}(),Pf=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(kh),n=x(fl),a=x(Tf),s=x(cl),f=x(Hc),v=x(ju),g=x(Wl);function x(D){return D&&D.__esModule?D:{default:D}}function C(D,V,Y){Y=(0,s.default)(Y);var te=0,Ee=0,Ze=D.length,Je=!1;Ze===0&&Y(null);function lt(Et,xt){Et===!1&&(Je=!0),Je!==!0&&(Et?Y(Et):(++Ee===Ze||xt===n.default)&&Y(null))}for(;te<Ze;te++)V(D[te],te,(0,f.default)(lt))}function A(D,V,Y){return(0,a.default)(D,Infinity,V,Y)}function O(D,V,Y){var te=(0,r.default)(D)?C:A;return te(D,(0,v.default)(V),Y)}i.default=(0,g.default)(O,3),e.exports=i.default});zo(Pf);var ah=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Pf),n=a(Vc);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),oh=zo(ah),Fh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return oh(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Sf(n,void 0,void 0,function(){return qp(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Tl=is(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(cl),n=f(Hc),a=f(ju),s=f(Wl);function f(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function A(D){var V=(0,a.default)(g[C++]);V.apply(void 0,D.concat([(0,n.default)(O)]))}function O(D){for(var V=[],Y=arguments.length-1;Y-- >0;)V[Y]=arguments[Y+1];if(D!==!1){if(D||C===g.length)return x.apply(void 0,[D].concat(V));A(V)}}A([])}i.default=(0,s.default)(v),e.exports=i.default}),Xc=zo(Tl),Kp=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Xc(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),If=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Vs(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),$p=N(69848),Qp=N.n($p);function Jp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function du(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dp(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Bh(C),e}var A=new(Qp())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:du({},D)}}),A.load(O.features),A}function Bh(e){return e.map(function(i,r){return du({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Of(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function hl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function vp(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Dd(e){if(e.length===0)throw new Error("mean requires at least one data point");return vp(e)/e.length}var Ml={min:hl,max:Of,mean:Dd,sum:vp};function Rf(e,i){return e.map(function(r){return r[i]*1})}function gc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ed(e){var i=mp();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function mp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Nh(e,i){if(Array.isArray(i))return i}var gp=function(e){(0,Yr.Z)(r,e);var i=ed(r);function r(n,a){var s;return(0,ut.Z)(this,r),s=i.call(this),(0,I.Z)((0,oe.Z)(s),"data",void 0),(0,I.Z)((0,oe.Z)(s),"extent",void 0),(0,I.Z)((0,oe.Z)(s),"hooks",{init:new pu}),(0,I.Z)((0,oe.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,oe.Z)(s),"transforms",[]),(0,I.Z)((0,oe.Z)(s),"cluster",!1),(0,I.Z)((0,oe.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,oe.Z)(s),"tileset",void 0),(0,I.Z)((0,oe.Z)(s),"mapService",void 0),(0,I.Z)((0,oe.Z)(s),"invalidExtent",!1),(0,I.Z)((0,oe.Z)(s),"dataArrayChanged",!1),(0,I.Z)((0,oe.Z)(s),"originData",void 0),(0,I.Z)((0,oe.Z)(s),"rawData",void 0),(0,I.Z)((0,oe.Z)(s),"cfg",{}),(0,I.Z)((0,oe.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,St.Z)(r,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,g=v===void 0?"sum":v,x=f.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(A){A.id||(A.properties.point_count=1)}),(x||Zu()(g))&&(C=C.map(function(A){var O=A.id;if(O){var D=s.clusterIndex.getLeaves(O,Infinity),V=D.map(function(Ee){return Ee.properties}),Y;if(Tu()(g)&&x){var te=Rf(V,x);Y=Ml[g](te)}Zu()(g)&&(Y=g(V)),A.properties.stat=Y}else A.properties.point_count=1;return A})),this.data=Zn("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=jc()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?Vu(Vu({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=th()(this.cfg,a,Nh);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Vu(Vu({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",f=Zn(s);this.data=f(this.originData,a),this.extent=bf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new Js(Vu({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,g=pi(v)(a.data,f);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=dp(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=X(he(this.extent),a)),s[0].concat(s[1])}}]),r}(Qo.EventEmitter);function da(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Xl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mo(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Mo(e,i){if(!!e){if(typeof e=="string")return Gs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gs(e,i)}}function Gs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var zh=6378e3;function td(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*zh)*(256<<20)/2,f=Fd(r,a),v=f.gridHash,g=f.gridOffset,x=zd(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Fd(e,i){var r=Infinity,n=-Infinity,a,s=Xl(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Je){s.e(Je)}finally{s.f()}var g=(r+n)/2,x=Bd(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},A=Xl(e),O;try{for(A.s();!(O=A.n()).done;){var D=O.value,V=D.coordinates[1],Y=D.coordinates[0];if(Number.isFinite(V)&&Number.isFinite(Y)){var te=Math.floor((V+90)/x.yOffset),Ee=Math.floor((Y+180)/x.xOffset),Ze="".concat(te,"-").concat(Ee);C[Ze]=C[Ze]||{count:0,points:[]},C[Ze].count+=1,C[Ze].points.push(D)}}}catch(Je){A.e(Je)}finally{A.f()}return{gridHash:C,gridOffset:x}}function Bd(e,i){var r=Nd(e),n=yp(i,e);return{yOffset:r,xOffset:n}}function Nd(e){return e/zh*(180/Math.PI)}function yp(e,i){return i/zh*(180/Math.PI)/Math.cos(e*Math.PI/180)}function zd(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),g=parseInt(f[1],10),x={};if(r.field&&r.method){var C=$s(e[a].points,r.field);x[r.method]=ol[r.method](C)}return Object.assign(x,{_id:s,coordinates:w([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Lf=Math.PI/3,sh=[0,Lf,2*Lf,3*Lf,4*Lf,5*Lf];function rd(e){return e[0]}function nd(e){return e[1]}function uh(){var e=0,i=0,r=1,n=1,a=rd,s=nd,f,v,g;function x(A){var O={},D=[],V,Y=A.length;for(V=0;V<Y;++V)if(!(isNaN(Ee=+a.call(null,te=A[V],V,A))||isNaN(Ze=+s.call(null,te,V,A)))){var te,Ee,Ze,Je=Math.round(Ze=Ze/g),lt=Math.round(Ee=Ee/v-(Je&1)/2),Et=Ze-Je;if(Math.abs(Et)*3>1){var xt=Ee-lt,Kt=lt+(Ee<lt?-1:1)/2,ur=Je+(Ze<Je?-1:1),Ir=Ee-Kt,Xr=Ze-ur;xt*xt+Et*Et>Ir*Ir+Xr*Xr&&(lt=Kt+(Je&1?1:-1)/2,Je=ur)}var yr=lt+"-"+Je,sn=O[yr];sn?sn.push(te):(D.push(sn=O[yr]=[te]),sn.x=(lt+(Je&1)/2)*v,sn.y=Je*g)}return D}function C(A){var O=0,D=0;return sh.map(function(V){var Y=Math.sin(V)*A,te=-Math.cos(V)*A,Ee=Y-O,Ze=te-D;return O=Y,D=te,[Ee,Ze]})}return x.hexagon=function(A){return"m"+C(A==null?f:+A).join("l")+"z"},x.centers=function(){for(var A=[],O=Math.round(i/g),D=Math.round(e/v),V=O*g;V<n+f;V+=g,++O)for(var Y=D*v+(O&1)*v/2;Y<r+v/2;Y+=v)A.push([Y,V]);return A},x.mesh=function(){var A=C(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+A}).join("")},x.x=function(A){return arguments.length?(a=A,x):a},x.y=function(A){return arguments.length?(s=A,x):s},x.radius=function(A){return arguments.length?(f=+A,v=f*2*Math.sin(Lf),g=f*1.5,x):f},x.size=function(A){return arguments.length?(e=i=0,r=+A[0],n=+A[1],x):[r-e,n-i]},x.extent=function(A){return arguments.length?(e=+A[0][0],i=+A[0][1],r=+A[1][0],n=+A[1][1],x):[[e,i],[r,n]]},x.radius(1)}function Aa(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Aa(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Aa(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Yl=6378e3;function kf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Yl)*(256<<20)/2,g=r.map(function(O){var D=w(O.coordinates),V=(0,Q.Z)(D,2),Y=V[0],te=V[1];return Uh(Uh({},O),{},{coordinates:[Y,te]})}),x=uh().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(g),A={dataArray:C.map(function(O,D){var V;if(i.field&&f){var Y=$s(O,i.field);O[f]=ol[f](Y)}return V={},(0,I.Z)(V,i.method,O[f]),(0,I.Z)(V,"count",O.length),(0,I.Z)(V,"rawData",O),(0,I.Z)(V,"coordinates",[O.x,O.y]),(0,I.Z)(V,"_id",D),V}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return A}function Zh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function id(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return id(id({},f),s[v])}),e}function me(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Gn("rasterTile",eh),Gn("geojson",ou),Gn("image",Hl),Gn("csv",ls),Gn("json",Ai),Gn("raster",wl),$n("cluster",dp),$n("filter",da),$n("join",B),$n("map",me),$n("grid",td),$n("hexagon",kf);var Ue=wi,Nt=Wa,or=gp,Ft=N(28660),Ye=N(86700),pr=N(84879),De={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Sr=N(31745),Or=N.n(Sr);function Rr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rr(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Pr(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Pr(e,i){if(!!e){if(typeof e=="string")return ct(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ct(e,i)}}function ct(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Vt=30;function Cr(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,A=C===void 0?0:C,O=0,D=x;Array.from(i).forEach(function(Y,te){if(!v[Y]){var Ee=r(Y,te);D+Vt>s&&(D=0,O++),v[Y]={x:D,y:A+O*Vt,width:Vt,height:Vt,advance:Ee},D+=Vt}});var V=n+a*2;return{mapping:v,xOffset:D,yOffset:A+O*V,canvasHeight:Lr(A+(O+1)*V)}}function zr(e,i,r){var n=0,a=0,s=0,f=[],v={},g=xr(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var A=C.size;n+A+i>r&&(hr(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:C,xOffset:n}),n=n+A+i,s=Math.max(s,A)}}}catch(D){g.e(D)}finally{g.f()}f.length>0&&hr(v,f,a);var O=Lr(s+a+i);return{mapping:v,canvasHeight:O}}function hr(e,i,r){var n=xr(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=Zr(Zr({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(g){n.e(g)}finally{n.f()}}function Lr(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Kr,Bn;function rr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ar(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ar(e,i){if(!!e){if(typeof e=="string")return _n(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _n(e,i)}}function _n(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Gr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ar(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gr(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var $r=as(),Jr="sans-serif",di="normal",ni=24,Wr=3,on=.25,Qn=8,fi=1024,Fi=1,Ya=1,io=3,Bi=null;function as(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Ba(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Zo(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var _o=(Kr=(0,Ye.b2)(),Kr(Bn=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new bt(io))}return(0,St.Z)(e,[{key:"scale",get:function(){return Ya}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Jr,fontWeight:di,characterSet:$r,fontSize:ni,buffer:Wr,sdf:!0,cutoff:on,radius:Qn,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Ar(Ar({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,A=s.radius,O=s.cutoff,D=s.iconfont,V=a&&a.data;V||(V=pa.document.createElement("canvas"),V.width=fi);var Y=V.getContext("2d");Ba(Y,f,g,v);var te=Cr(Ar({getFontWidth:function(As){return Y.measureText(As).width},fontHeight:g*Ya,buffer:x,characterSet:n,maxCanvasWidth:fi},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ee=te.mapping,Ze=te.canvasHeight,Je=te.xOffset,lt=te.yOffset,Et=Y.getImageData(0,0,V.width,V.height);if(V.height=Ze,Y.putImageData(Et,0,0),Ba(Y,f,g,v),C){var xt=new(Or())(g,x,A,O,f,v),Kt=Y.getImageData(0,0,xt.size,xt.size),ur=rr(n),Ir;try{for(ur.s();!(Ir=ur.n()).done;){var Xr=Ir.value;if(D){var yr=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),sn=xt.draw(yr);Zo(sn,Kt)}else Zo(xt.draw(Xr),Kt);Y.putImageData(Kt,Ee[Xr].x,Ee[Xr].y)}}catch(So){ur.e(So)}finally{ur.f()}}else{var Rn=rr(n),Un;try{for(Rn.s();!(Un=Rn.n()).done;){var Da=Un.value;Y.fillText(Da,Ee[Da].x,Ee[Da].y+g*Fi)}}catch(So){Rn.e(So)}finally{Rn.f()}}return{xOffset:Je,yOffset:lt,mapping:Ee,data:V,width:V.width,height:V.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||Bn),jo,Po;function vs(e){var i=ao();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function ao(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vi=3,Io=1024,ji=64,os=(jo=(0,Ye.b2)(),jo(Po=function(e){(0,Yr.Z)(r,e);var i=vs(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"canvasHeight",128),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"canvas",void 0),(0,I.Z)((0,oe.Z)(n),"iconData",void 0),(0,I.Z)((0,oe.Z)(n),"iconMap",void 0),(0,I.Z)((0,oe.Z)(n),"ctx",void 0),(0,I.Z)((0,oe.Z)(n),"loadingImageCount",0),n}return(0,St.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=pa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:ji}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=f.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,g=f.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:ji}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var A=v.iconData.find(function(O){return O.id===a});A&&(A.image=x,A.width=x.width,A.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=Io,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,g=f.y,x=f.image,C=f.width,A=C===void 0?64:C,O=f.height,D=O===void 0?64:O,V=Math.max(A,D),Y=V/ji,te=D/Y,Ee=A/Y;x&&a.ctx.drawImage(x,v+(ji-Ee)/2,g+(ji-te)/2,Ee,te)})}},{key:"updateIconMap",value:function(){var a=zr(this.iconData,vi,Io),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){f(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Qo.EventEmitter))||Po),hn=N(49685);function mi(){var e=new hn.WT(16);return hn.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ca(e){var i=new hn.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function xo(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function pl(e,i,r,n,a,s,f,v,g,x,C,A,O,D,V,Y){var te=new hn.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=f,te[7]=v,te[8]=g,te[9]=x,te[10]=C,te[11]=A,te[12]=O,te[13]=D,te[14]=V,te[15]=Y,te}function Me(e,i,r,n,a,s,f,v,g,x,C,A,O,D,V,Y,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=A,e[11]=O,e[12]=D,e[13]=V,e[14]=Y,e[15]=te,e}function Ut(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wt(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function cn(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],A=i[9],O=i[10],D=i[11],V=i[12],Y=i[13],te=i[14],Ee=i[15],Ze=r*v-n*f,Je=r*g-a*f,lt=r*x-s*f,Et=n*g-a*v,xt=n*x-s*v,Kt=a*x-s*g,ur=C*Y-A*V,Ir=C*te-O*V,Xr=C*Ee-D*V,yr=A*te-O*Y,sn=A*Ee-D*Y,Rn=O*Ee-D*te,Un=Ze*Rn-Je*sn+lt*yr+Et*Xr-xt*Ir+Kt*ur;return Un?(Un=1/Un,e[0]=(v*Rn-g*sn+x*yr)*Un,e[1]=(a*sn-n*Rn-s*yr)*Un,e[2]=(Y*Kt-te*xt+Ee*Et)*Un,e[3]=(O*xt-A*Kt-D*Et)*Un,e[4]=(g*Xr-f*Rn-x*Ir)*Un,e[5]=(r*Rn-a*Xr+s*Ir)*Un,e[6]=(te*lt-V*Kt-Ee*Je)*Un,e[7]=(C*Kt-O*lt+D*Je)*Un,e[8]=(f*sn-v*Xr+x*ur)*Un,e[9]=(n*Xr-r*sn-s*ur)*Un,e[10]=(V*xt-Y*lt+Ee*Ze)*Un,e[11]=(A*lt-C*xt-D*Ze)*Un,e[12]=(v*Ir-f*yr-g*ur)*Un,e[13]=(r*yr-n*Ir+a*ur)*Un,e[14]=(Y*Je-V*Et-te*Ze)*Un,e[15]=(C*Et-A*Je+O*Ze)*Un,e):null}function Ni(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],A=i[9],O=i[10],D=i[11],V=i[12],Y=i[13],te=i[14],Ee=i[15];return e[0]=v*(O*Ee-D*te)-A*(g*Ee-x*te)+Y*(g*D-x*O),e[1]=-(n*(O*Ee-D*te)-A*(a*Ee-s*te)+Y*(a*D-s*O)),e[2]=n*(g*Ee-x*te)-v*(a*Ee-s*te)+Y*(a*x-s*g),e[3]=-(n*(g*D-x*O)-v*(a*D-s*O)+A*(a*x-s*g)),e[4]=-(f*(O*Ee-D*te)-C*(g*Ee-x*te)+V*(g*D-x*O)),e[5]=r*(O*Ee-D*te)-C*(a*Ee-s*te)+V*(a*D-s*O),e[6]=-(r*(g*Ee-x*te)-f*(a*Ee-s*te)+V*(a*x-s*g)),e[7]=r*(g*D-x*O)-f*(a*D-s*O)+C*(a*x-s*g),e[8]=f*(A*Ee-D*Y)-C*(v*Ee-x*Y)+V*(v*D-x*A),e[9]=-(r*(A*Ee-D*Y)-C*(n*Ee-s*Y)+V*(n*D-s*A)),e[10]=r*(v*Ee-x*Y)-f*(n*Ee-s*Y)+V*(n*x-s*v),e[11]=-(r*(v*D-x*A)-f*(n*D-s*A)+C*(n*x-s*v)),e[12]=-(f*(A*te-O*Y)-C*(v*te-g*Y)+V*(v*O-g*A)),e[13]=r*(A*te-O*Y)-C*(n*te-a*Y)+V*(n*O-a*A),e[14]=-(r*(v*te-g*Y)-f*(n*te-a*Y)+V*(n*g-a*v)),e[15]=r*(v*O-g*A)-f*(n*O-a*A)+C*(n*g-a*v),e}function Se(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],g=e[7],x=e[8],C=e[9],A=e[10],O=e[11],D=e[12],V=e[13],Y=e[14],te=e[15],Ee=i*f-r*s,Ze=i*v-n*s,Je=i*g-a*s,lt=r*v-n*f,Et=r*g-a*f,xt=n*g-a*v,Kt=x*V-C*D,ur=x*Y-A*D,Ir=x*te-O*D,Xr=C*Y-A*V,yr=C*te-O*V,sn=A*te-O*Y;return Ee*sn-Ze*yr+Je*Xr+lt*Ir-Et*ur+xt*Kt}function re(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],A=i[8],O=i[9],D=i[10],V=i[11],Y=i[12],te=i[13],Ee=i[14],Ze=i[15],Je=r[0],lt=r[1],Et=r[2],xt=r[3];return e[0]=Je*n+lt*v+Et*A+xt*Y,e[1]=Je*a+lt*g+Et*O+xt*te,e[2]=Je*s+lt*x+Et*D+xt*Ee,e[3]=Je*f+lt*C+Et*V+xt*Ze,Je=r[4],lt=r[5],Et=r[6],xt=r[7],e[4]=Je*n+lt*v+Et*A+xt*Y,e[5]=Je*a+lt*g+Et*O+xt*te,e[6]=Je*s+lt*x+Et*D+xt*Ee,e[7]=Je*f+lt*C+Et*V+xt*Ze,Je=r[8],lt=r[9],Et=r[10],xt=r[11],e[8]=Je*n+lt*v+Et*A+xt*Y,e[9]=Je*a+lt*g+Et*O+xt*te,e[10]=Je*s+lt*x+Et*D+xt*Ee,e[11]=Je*f+lt*C+Et*V+xt*Ze,Je=r[12],lt=r[13],Et=r[14],xt=r[15],e[12]=Je*n+lt*v+Et*A+xt*Y,e[13]=Je*a+lt*g+Et*O+xt*te,e[14]=Je*s+lt*x+Et*D+xt*Ee,e[15]=Je*f+lt*C+Et*V+xt*Ze,e}function Ve(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,g,x,C,A,O,D,V,Y,te,Ee;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],g=i[2],x=i[3],C=i[4],A=i[5],O=i[6],D=i[7],V=i[8],Y=i[9],te=i[10],Ee=i[11],e[0]=f,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=A,e[6]=O,e[7]=D,e[8]=V,e[9]=Y,e[10]=te,e[11]=Ee,e[12]=f*n+C*a+V*s+i[12],e[13]=v*n+A*a+Y*s+i[13],e[14]=g*n+O*a+te*s+i[14],e[15]=x*n+D*a+Ee*s+i[15]),e}function ft(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function kt(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),g,x,C,A,O,D,V,Y,te,Ee,Ze,Je,lt,Et,xt,Kt,ur,Ir,Xr,yr,sn,Rn,Un,Da;return v<hn.Ib?null:(v=1/v,a*=v,s*=v,f*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,A=i[0],O=i[1],D=i[2],V=i[3],Y=i[4],te=i[5],Ee=i[6],Ze=i[7],Je=i[8],lt=i[9],Et=i[10],xt=i[11],Kt=a*a*C+x,ur=s*a*C+f*g,Ir=f*a*C-s*g,Xr=a*s*C-f*g,yr=s*s*C+x,sn=f*s*C+a*g,Rn=a*f*C+s*g,Un=s*f*C-a*g,Da=f*f*C+x,e[0]=A*Kt+Y*ur+Je*Ir,e[1]=O*Kt+te*ur+lt*Ir,e[2]=D*Kt+Ee*ur+Et*Ir,e[3]=V*Kt+Ze*ur+xt*Ir,e[4]=A*Xr+Y*yr+Je*sn,e[5]=O*Xr+te*yr+lt*sn,e[6]=D*Xr+Ee*yr+Et*sn,e[7]=V*Xr+Ze*yr+xt*sn,e[8]=A*Rn+Y*Un+Je*Da,e[9]=O*Rn+te*Un+lt*Da,e[10]=D*Rn+Ee*Un+Et*Da,e[11]=V*Rn+Ze*Un+xt*Da,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function $e(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],g=i[7],x=i[8],C=i[9],A=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+C*n,e[6]=v*a+A*n,e[7]=g*a+O*n,e[8]=x*a-s*n,e[9]=C*a-f*n,e[10]=A*a-v*n,e[11]=O*a-g*n,e}function Ne(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[8],C=i[9],A=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-C*n,e[2]=v*a-A*n,e[3]=g*a-O*n,e[8]=s*n+x*a,e[9]=f*n+C*a,e[10]=v*n+A*a,e[11]=g*n+O*a,e}function ot(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[4],C=i[5],A=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+C*n,e[2]=v*a+A*n,e[3]=g*a+O*n,e[4]=x*a-s*n,e[5]=C*a-f*n,e[6]=A*a-v*n,e[7]=O*a-g*n,e}function _e(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function je(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ae(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,g,x;return f<hn.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function dt(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tt(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nr(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,g=a+a,x=s+s,C=n*v,A=n*g,O=n*x,D=a*g,V=a*x,Y=s*x,te=f*v,Ee=f*g,Ze=f*x;return e[0]=1-(D+Y),e[1]=A+Ze,e[2]=O-Ee,e[3]=0,e[4]=A-Ze,e[5]=1-(C+Y),e[6]=V+te,e[7]=0,e[8]=O+Ee,e[9]=V-te,e[10]=1-(C+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ur(e,i){var r=new hn.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],A=n*n+a*a+s*s+f*f;return A>0?(r[0]=(v*f+C*n+g*s-x*a)*2/A,r[1]=(g*f+C*a+x*n-v*s)*2/A,r[2]=(x*f+C*s+v*a-g*n)*2/A):(r[0]=(v*f+C*n+g*s-x*a)*2,r[1]=(g*f+C*a+x*n-v*s)*2,r[2]=(x*f+C*s+v*a-g*n)*2),Nr(e,i,r),e}function nn(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Br(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(g,x,C),e}function Cn(e,i){var r=new hn.WT(3);Br(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,A=i[6]*s,O=i[8]*n,D=i[9]*a,V=i[10]*s,Y=f+C+V,te=0;return Y>0?(te=Math.sqrt(Y+1)*2,e[3]=.25*te,e[0]=(A-D)/te,e[1]=(O-g)/te,e[2]=(v-x)/te):f>C&&f>V?(te=Math.sqrt(1+f-C-V)*2,e[3]=(A-D)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(O+g)/te):C>V?(te=Math.sqrt(1+C-f-V)*2,e[3]=(O-g)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(A+D)/te):(te=Math.sqrt(1+V-f-C)*2,e[3]=(v-x)/te,e[0]=(O+g)/te,e[1]=(A+D)/te,e[2]=.25*te),e}function fn(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],g=a+a,x=s+s,C=f+f,A=a*g,O=a*x,D=a*C,V=s*x,Y=s*C,te=f*C,Ee=v*g,Ze=v*x,Je=v*C,lt=n[0],Et=n[1],xt=n[2];return e[0]=(1-(V+te))*lt,e[1]=(O+Je)*lt,e[2]=(D-Ze)*lt,e[3]=0,e[4]=(O-Je)*Et,e[5]=(1-(A+te))*Et,e[6]=(Y+Ee)*Et,e[7]=0,e[8]=(D+Ze)*xt,e[9]=(Y-Ee)*xt,e[10]=(1-(A+V))*xt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function En(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],g=i[3],x=s+s,C=f+f,A=v+v,O=s*x,D=s*C,V=s*A,Y=f*C,te=f*A,Ee=v*A,Ze=g*x,Je=g*C,lt=g*A,Et=n[0],xt=n[1],Kt=n[2],ur=a[0],Ir=a[1],Xr=a[2],yr=(1-(Y+Ee))*Et,sn=(D+lt)*Et,Rn=(V-Je)*Et,Un=(D-lt)*xt,Da=(1-(O+Ee))*xt,So=(te+Ze)*xt,As=(V+Je)*Kt,iu=(te-Ze)*Kt,Ls=(1-(O+Y))*Kt;return e[0]=yr,e[1]=sn,e[2]=Rn,e[3]=0,e[4]=Un,e[5]=Da,e[6]=So,e[7]=0,e[8]=As,e[9]=iu,e[10]=Ls,e[11]=0,e[12]=r[0]+ur-(yr*ur+Un*Ir+As*Xr),e[13]=r[1]+Ir-(sn*ur+Da*Ir+iu*Xr),e[14]=r[2]+Xr-(Rn*ur+So*Ir+Ls*Xr),e[15]=1,e}function xn(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,g=a+a,x=r*f,C=n*f,A=n*v,O=a*f,D=a*v,V=a*g,Y=s*f,te=s*v,Ee=s*g;return e[0]=1-A-V,e[1]=C+Ee,e[2]=O-te,e[3]=0,e[4]=C-Ee,e[5]=1-x-V,e[6]=D+Y,e[7]=0,e[8]=O+te,e[9]=D-Y,e[10]=1-x-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dn(e,i,r,n,a,s,f){var v=1/(r-i),g=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function qn(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var va=qn;function ss(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function ka(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(f+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function aa(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(f+s)*x,e[15]=1,e}var Pl=aa;function Is(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function dl(e,i,r,n){var a,s,f,v,g,x,C,A,O,D,V=i[0],Y=i[1],te=i[2],Ee=n[0],Ze=n[1],Je=n[2],lt=r[0],Et=r[1],xt=r[2];return Math.abs(V-lt)<hn.Ib&&Math.abs(Y-Et)<hn.Ib&&Math.abs(te-xt)<hn.Ib?Ut(e):(C=V-lt,A=Y-Et,O=te-xt,D=1/Math.hypot(C,A,O),C*=D,A*=D,O*=D,a=Ze*O-Je*A,s=Je*C-Ee*O,f=Ee*A-Ze*C,D=Math.hypot(a,s,f),D?(D=1/D,a*=D,s*=D,f*=D):(a=0,s=0,f=0),v=A*f-O*s,g=O*a-C*f,x=C*s-A*a,D=Math.hypot(v,g,x),D?(D=1/D,v*=D,g*=D,x*=D):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=A,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*V+s*Y+f*te),e[13]=-(v*V+g*Y+x*te),e[14]=-(C*V+A*Y+O*te),e[15]=1,e)}function Mu(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],A=s-r[1],O=f-r[2],D=C*C+A*A+O*O;D>0&&(D=1/Math.sqrt(D),C*=D,A*=D,O*=D);var V=g*O-x*A,Y=x*C-v*O,te=v*A-g*C;return D=V*V+Y*Y+te*te,D>0&&(D=1/Math.sqrt(D),V*=D,Y*=D,te*=D),e[0]=V,e[1]=Y,e[2]=te,e[3]=0,e[4]=A*te-O*Y,e[5]=O*V-C*te,e[6]=C*Y-A*V,e[7]=0,e[8]=C,e[9]=A,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function _p(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Pu(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function yc(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Df(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Mv(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Jo(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function xp(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function ql(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],g=e[6],x=e[7],C=e[8],A=e[9],O=e[10],D=e[11],V=e[12],Y=e[13],te=e[14],Ee=e[15],Ze=i[0],Je=i[1],lt=i[2],Et=i[3],xt=i[4],Kt=i[5],ur=i[6],Ir=i[7],Xr=i[8],yr=i[9],sn=i[10],Rn=i[11],Un=i[12],Da=i[13],So=i[14],As=i[15];return Math.abs(r-Ze)<=hn.Ib*Math.max(1,Math.abs(r),Math.abs(Ze))&&Math.abs(n-Je)<=hn.Ib*Math.max(1,Math.abs(n),Math.abs(Je))&&Math.abs(a-lt)<=hn.Ib*Math.max(1,Math.abs(a),Math.abs(lt))&&Math.abs(s-Et)<=hn.Ib*Math.max(1,Math.abs(s),Math.abs(Et))&&Math.abs(f-xt)<=hn.Ib*Math.max(1,Math.abs(f),Math.abs(xt))&&Math.abs(v-Kt)<=hn.Ib*Math.max(1,Math.abs(v),Math.abs(Kt))&&Math.abs(g-ur)<=hn.Ib*Math.max(1,Math.abs(g),Math.abs(ur))&&Math.abs(x-Ir)<=hn.Ib*Math.max(1,Math.abs(x),Math.abs(Ir))&&Math.abs(C-Xr)<=hn.Ib*Math.max(1,Math.abs(C),Math.abs(Xr))&&Math.abs(A-yr)<=hn.Ib*Math.max(1,Math.abs(A),Math.abs(yr))&&Math.abs(O-sn)<=hn.Ib*Math.max(1,Math.abs(O),Math.abs(sn))&&Math.abs(D-Rn)<=hn.Ib*Math.max(1,Math.abs(D),Math.abs(Rn))&&Math.abs(V-Un)<=hn.Ib*Math.max(1,Math.abs(V),Math.abs(Un))&&Math.abs(Y-Da)<=hn.Ib*Math.max(1,Math.abs(Y),Math.abs(Da))&&Math.abs(te-So)<=hn.Ib*Math.max(1,Math.abs(te),Math.abs(So))&&Math.abs(Ee-As)<=hn.Ib*Math.max(1,Math.abs(Ee),Math.abs(As))}var ad=re,od=Df,sd,lh,Yc=(sd=(0,Ye.b2)(),sd(lh=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,St.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=mi(),cn(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Q.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=_e(mi(),[r,n,0]);this.jitteredProjectionMatrix=re(mi(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=re(mi(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||lh),Ud,Zd;function k0(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ms(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ms(e,i){if(!!e){if(typeof e=="string")return qc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qc(e,i)}}function qc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Pv=(Ud=(0,Ye.b2)(),Ud(Zd=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,St.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(De.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(De.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=k0(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=la("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(g){return n+g}).join(" ");r[f.join("")]=la("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&no(this.controlCorners[r]);this.controlContainer&&no(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Zd),t,o,u=(t=(0,Ye.b2)(),t(o=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,St.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(De.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||o),p,y,b=(p=(0,Ye.b2)(),p(y=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,St.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(De.IMapService)}}]),e}())||y),S=N(82492),P=N.n(S),k={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},z=k,Z,H;function ee(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ie(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ee(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Pe={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Re={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Qe=(Z=(0,Ye.b2)(),Z(H=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,St.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return z[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=ie(ie({},Pe),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=ie({},P()({},this.sceneConfigCache[r],Re,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||H);function Ce(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Ge(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Ct(){var e=new hn.WT(4);return hn.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Xt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Yt(e,i,r,n){var a=new hn.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function fr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function kr(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Qr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function zn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function vn(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function jn(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function gn(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Ri(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function ii(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Mn(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Vi(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function bi(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function ra(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function Vn(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function ma(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function oo(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Oo(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function bo(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function so(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Ro(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function gs(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function ys(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],A=i[1],O=i[2],D=i[3];return e[0]=A*x-O*g+D*v,e[1]=-(C*x)+O*f-D*s,e[2]=C*g-A*f+D*a,e[3]=-(C*v)+A*s-O*a,e}function tu(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function Es(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function Ss(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function Vo(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,A=x*a+g*n-f*s,O=x*s+f*a-v*n,D=-f*n-v*a-g*s;return e[0]=C*x+D*-f+A*-g-O*-v,e[1]=A*x+D*-v+O*-f-C*-g,e[2]=O*x+D*-g+C*-v-A*-f,e[3]=i[3],e}function Cs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ki(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Na(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Pa(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var oa=null,vu=null,Hs=null,to=null,es=null,Ws=null,ga=null,Kc=function(){var e=Ct();return function(i,r,n,a,s,f){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),mu=Math.PI/180,_c=512,Eo=4003e4;function Kl(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},A=_c*s,O=Math.cos(r*mu),D=A/360,V=D/O,Y=A/Eo/O;if(C.pixelsPerMeter=[Y,-Y,Y],C.metersPerPixel=[1/Y,-1/Y,1/Y],C.pixelsPerDegree=[D,-V,Y],C.degreesPerPixel=[1/D,-1/V,1/Y],v){var te=mu*Math.tan(r*mu)/O,Ee=D*te/2,Ze=A/Eo*te,Je=Ze/V*Y;C.pixelsPerDegree2=[0,-Ee,Ze],C.pixelsPerMeter2=[Je,0,Je],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Os;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Os||(Os={}));var Il={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ff,ch,xc,Bf,bp,jh=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Ep=(Ff=(0,Ye.b2)(),ch=(0,Ye.f3)(De.ICameraService),Ff(xc=(Bf=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),Ce(this,"cameraService",bp,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,St.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Kl({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Os.LNGLAT||this.coordinateSystem===Os.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Os.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Os.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=Kl({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,g=f.pixelsPerDegree,x=f.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),O=re([],A,C),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Ss([],[D[0],D[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=re([],A,C),O=re([],O,jh),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),bp=Ge(Bf.prototype,"cameraService",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bf))||xc),ud=N(20396),Nf=N.n(ud),Lo;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Lo||(Lo={}));var Vh,fh,$c,zf,Sp;function ld(e){var i=Cp();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ap={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},cd=(Vh=(0,Ye.b2)(),fh=(0,Ye.f3)(De.IMapService),Vh($c=(zf=function(e){(0,Yr.Z)(r,e);var i=ld(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"indragging",!1),Ce((0,oe.Z)(n),"mapService",Sp,(0,oe.Z)(n)),(0,I.Z)((0,oe.Z)(n),"hammertime",void 0),(0,I.Z)((0,oe.Z)(n),"lastClickTime",0),(0,I.Z)((0,oe.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,oe.Z)(n),"clickTimer",void 0),(0,I.Z)((0,oe.Z)(n),"$containter",void 0),(0,I.Z)((0,oe.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=Ap[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Lo.Drag,g)}),(0,I.Z)((0,oe.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(Lo.Hover,g)}),(0,I.Z)((0,oe.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,I.Z)((0,oe.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,A=x,O=v.type,D=n.mapService.getMapContainer();if(D)if(mo)C=C-D.left-0,A=A-D.top-0;else{var V=D.getBoundingClientRect(),Y=V.top,te=V.left;C=C-te-D.clientLeft,A=A-Y-D.clientTop}var Ee=n.mapService.containerToLngLat([C,A]);if(O==="click"){if(!mo&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,A,Ee);return}if(O==="touch"){n.isDoubleTap(C,A,Ee);return}O!=="click"&&O!=="dblclick"&&n.emit(Lo.Hover,{x:C,y:A,lngLat:Ee,type:O,target:v})}),n}return(0,St.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Lo.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(Lo.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(Lo.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(Lo.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(mo)pa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Nf()).Manager(a);s.add(new(Nf()).Tap({event:"dblclick",taps:2})),s.add(new(Nf()).Tap({event:"click"})),s.add(new(Nf()).Pan({threshold:0,pointers:0})),s.add(new(Nf()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(mo)pa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,g;f==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),A=C.top,O=C.left;v-=O,g-=A}var D=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(Lo.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(Lo.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(zu()),Sp=Ge(zf.prototype,"mapService",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf))||$c),wp=0;function Tp(e){if(mo)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(wp++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Mp(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var W;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(W||(W={}));var hh,Pp,ph,Gh,Uf,Hh,dh,Qc,jd,fd,Vd,hd,Iv;function Wh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var $l=(hh=(0,Ye.b2)(),Pp=(0,Ye.f3)(De.IMapService),ph=(0,Ye.f3)(De.IRendererService),Gh=(0,Ye.f3)(De.IGlobalConfigService),Uf=(0,Ye.f3)(De.IInteractionService),Hh=(0,Ye.f3)(De.ILayerService),hh(dh=(Qc=function(){function e(){var i=this;(0,ut.Z)(this,e),Ce(this,"mapService",jd,this),Ce(this,"rendererService",fd,this),Ce(this,"configService",Vd,this),Ce(this,"interactionService",hd,this),Ce(this,"layerService",Iv,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickedLayers",[]),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,A=i.rendererService,O=A.getViewportSize,D=A.readPixels,V=A.getContainer,Y=i.getContainerSize(V()),te=Y.width,Ee=Y.height;te*=xa,Ee*=xa;var Ze=r.getLayerConfig(),Je=Ze.enableHighlight,lt=Ze.enableSelect,Et=s*xa,xt=f*xa;if(Et>te-1*xa||Et<0||xt>Ee-1*xa||xt<0)return!1;var Kt;if(Kt=D({x:Math.floor(Et/i.pickBufferScale),y:Math.floor((Ee-(f+1)*xa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Kt[0]!==0||Kt[1]!==0||Kt[2]!==0){var ur=Mr(Kt),Ir=r.getSource().getFeatureById(ur);ur!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var Xr={x:s,y:f,type:g,lngLat:v,featureId:ur,feature:Ir,target:x};Ir&&(C=!0,r.setCurrentPickId(ur),i.pickedLayers=[r],i.triggerHoverOnLayer(r,Xr))}else{var yr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,uo(uo({},yr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,yr),r.setCurrentPickId(null),i.pickedLayers=[]}if(Je&&i.highlightPickedFeature(r,Kt),lt&&g==="click"&&((a=Kt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var sn=Mr(Kt);r.getCurrentSelectedId()===null||sn!==r.getCurrentSelectedId()?(i.selectFeature(r,Kt),r.setCurrentSelectedId(sn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,St.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=xa,C*=xa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(Lo.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a,s,f){var v=this,g,x,C,A;return Xn().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,A=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var V=v.pickBox(a,s);f(V)});case 3:case"end":return D.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(yr){var sn=yr<0?0:yr;return Math.floor(sn*xa/a.pickBufferScale)}),f=(0,Q.Z)(s,4),v=f[0],g=f[1],x=f[2],C=f[3],A=this.rendererService,O=A.getViewportSize,D=A.readPixels,V=A.getContainer,Y=this.getContainerSize(V()),te=Y.width,Ee=Y.height;if(te*=xa,Ee*=xa,v>(te-1)*xa/this.pickBufferScale||x<0||g>(Ee-1)*xa/this.pickBufferScale||C<0)return[];var Ze,Je=Math.min(te/this.pickBufferScale,x)-v,lt=Math.min(Ee/this.pickBufferScale,C)-g;Ze=D({x:v,y:Math.floor(Ee/this.pickBufferScale-(C+1)),width:Je,height:lt,data:new Uint8Array(Je*lt*4),framebuffer:this.pickingFBO});for(var Et=[],xt={},Kt=0;Kt<Ze.length/4;Kt=Kt+1){var ur=Ze.slice(Kt*4,Kt*4+4),Ir=Mr(ur);if(Ir!==-1&&!xt[Ir]){var Xr=r.getSource().getFeatureById(Ir);Et.push(uo(uo({},Xr),{},{pickedFeatureIdx:Ir})),xt[Ir]=!0}}return Et}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/xa,height:r.height/xa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a){var s;return Xn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||["contextmenu","click","mouseup"].includes(a.type))){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=xa,s*=xa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a){var s=this,f,v,g,x,C;return Xn().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=f.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(V){return V.needPick(a.type)}).reverse().some(function(V){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),V.hooks.beforePickingEncode.call(),V.masks.length>0&&V.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),V.renderModels(!0),V.hooks.afterPickingEncode.call(),s.pickedLayers.map(function(te){s.selectFeature(te,new Uint8Array([0,0,0,0]))});var Y=s.pickFromPickingFBO(V,a);return s.layerService.pickedLayerId=Y?+V.id:-1,Y&&!V.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Mp(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),jd=Ge(Qc.prototype,"mapService",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd=Ge(Qc.prototype,"rendererService",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=Ge(Qc.prototype,"configService",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hd=Ge(Qc.prototype,"interactionService",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=Ge(Qc.prototype,"layerService",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qc))||dh),D0=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ut.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,St.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Jc,pd,Gd,Ip,Ql,Zf,Xh,Op,Rp;function Hd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ov(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Ov(e,i){if(!!e){if(typeof e=="string")return Yh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yh(e,i)}}function Yh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Rv=(Jc=(0,Ye.b2)(),pd=(0,Ye.f3)(De.IRendererService),Gd=(0,Ye.f3)(De.IMapService),Ip=(0,Ye.f3)(De.IGlobalConfigService),Jc(Ql=(Zf=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"pickedLayerId",-1),(0,I.Z)(this,"clock",new D0),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),Ce(this,"renderService",Xh,this),Ce(this,"mapService",Op,this),Ce(this,"configService",Rp,this)}return(0,St.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(){var a,s,f;return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Hd(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,f.renderMultiPass();case 15:g.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=lr(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=pa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){pa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Xh=Ge(Zf.prototype,"renderService",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=Ge(Zf.prototype,"mapService",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=Ge(Zf.prototype,"configService",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zf))||Ql),vh=N(81253),Lv=N(14293),bc=N.n(Lv),kv=function(){function e(i){var r=this;(0,ut.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=g(s);return x})}),this.setProps(i)}return(0,St.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,nr.Z)(r));if(!bc()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Gu=["buffer","update","name"],dd=["buffer","update","name"],qh,Jl,Dv,Wd,ef,mh;function gh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lp(e){return new Promise(function(i){return setTimeout(i,e)})}var Fv=(qh={},(0,I.Z)(qh,W.FLOAT,4),(0,I.Z)(qh,W.UNSIGNED_BYTE,1),(0,I.Z)(qh,W.UNSIGNED_SHORT,2),qh),Bv=(Jl=(0,Ye.b2)(),Dv=(0,Ye.f3)(De.IRendererService),Jl(Wd=(ef=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),Ce(this,"rendererService",mh,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,St.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new kv(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(tf(tf({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(lt){return lt.name===r});if(f&&f.descriptor){var v=f.descriptor,g=v.update,x=v.buffer,C=v.size,A=C===void 0?0:C,O=Fv[x.type||W.FLOAT];if(g){var D=this.featureLayout,V=D.elements,Y=D.sizePerElement,te=V.slice(a,s);if(!te.length)return;var Ee=te[0].offset,Ze=Ee*A*O,Je=te.map(function(lt,Et){for(var xt=lt.featureIdx,Kt=lt.vertices,ur=lt.normals,Ir=Kt.length/Y,Xr=[],yr=0;yr<Ir;yr++){var sn=ur?ur.slice(yr*3,yr*3+3):[];Xr.push.apply(Xr,(0,nr.Z)(g(n[xt],xt,Kt.slice(yr*Y,yr*Y+Y),Et,sn)))}return Xr}).reduce(function(lt,Et){return lt.push.apply(lt,(0,nr.Z)(Et)),lt},[]);f.vertexAttribute.updateBuffer({data:Je,offset:Ze})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Ze){return Ze.resetDescriptor(),Ze.descriptor}),v=0,g=[],x=[],C=[],A=3;r.forEach(function(Ze,Je){var lt=s.triangulation(Ze,a),Et=lt.indices,xt=lt.vertices,Kt=lt.normals,ur=lt.size,Ir=lt.indexes;Et.forEach(function(Rn){x.push(Rn+v)}),A=ur;var Xr=xt.length/ur;s.featureLayout.sizePerElement=A,s.featureLayout.elements.push({featureIdx:Je,vertices:xt,normals:Kt,offset:v}),v+=Xr;for(var yr=function(Un){var Da=(Kt==null?void 0:Kt.slice(Un*3,Un*3+3))||[],So=xt.slice(Un*ur,Un*ur+ur),As=0;Ir&&Ir[Un]!==void 0&&(As=Ir[Un]),f.forEach(function(iu,Ls){if(iu&&iu.update){var Pc;(Pc=iu.buffer.data).push.apply(Pc,(0,nr.Z)(iu.update(Ze,Je,So,Un,Da,As)))}})},sn=0;sn<Xr;sn++)yr(sn)});var O=this.rendererService,D=O.createAttribute,V=O.createBuffer,Y=O.createElements,te={};f.forEach(function(Ze,Je){if(Ze){var lt=Ze.buffer,Et=Ze.update,xt=Ze.name,Kt=(0,vh.Z)(Ze,Gu),ur=D(tf({buffer:V(lt)},Kt));te[Ze.name||""]=ur,s.attributes[Je].vertexAttribute=ur}});var Ee=Y({data:x,type:W.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Ee},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(D){return D.resetDescriptor(),D.descriptor}),f=0,v=[],g=3;r.forEach(function(D,V){var Y=a.triangulation(D),te=Y.indices,Ee=Y.vertices,Ze=Y.normals,Je=Y.size,lt=Y.indexes;te.forEach(function(ur){v.push(ur+f)}),g=Je;var Et=Ee.length/Je;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:V,vertices:Ee,normals:Ze,offset:f}),f+=Et;for(var xt=function(Ir){var Xr=(Ze==null?void 0:Ze.slice(Ir*3,Ir*3+3))||[],yr=Ee.slice(Ir*Je,Ir*Je+Je),sn=0;lt&&lt[Ir]!==void 0&&(sn=lt[Ir]),s.forEach(function(Rn,Un){if(Rn&&Rn.update){var Da;(Da=Rn.buffer.data).push.apply(Da,(0,nr.Z)(Rn.update(D,V,yr,Ir,Xr,sn)))}})},Kt=0;Kt<Et;Kt++)xt(Kt)});var x=this.rendererService,C=x.createAttribute,A=x.createBuffer,O={};return s.forEach(function(D,V){if(D){var Y=D.buffer,te=D.update,Ee=D.name,Ze=(0,vh.Z)(D,dd),Je=C(tf({buffer:A(Y)},Ze));O[D.name||""]=Je,a.attributes[V].vertexAttribute=Je}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),mh=Ge(ef.prototype,"rendererService",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ef))||Wd),Xd=N(67709),Nv=N.n(Xd),vd,md,Ec,Yd,gd,yd,qd,_d,Kd,$d,xd,Qd,Kh,Jd,kp,zv,ev,ru,Uv,Zv,jv,Vv,Gv,Hv,Wv,ec,Dp,tv,$h,rv,Cm,Am,wm;function Cb(e){var i=Ab();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wb=(vd=(0,Ye.b2)(),md=(0,Ye.f3)(De.SceneID),Ec=(0,Ye.f3)(De.IIconService),Yd=(0,Ye.f3)(De.IFontService),gd=(0,Ye.f3)(De.IControlService),yd=(0,Ye.f3)(De.IGlobalConfigService),qd=(0,Ye.f3)(De.IMapService),_d=(0,Ye.f3)(De.ICoordinateSystemService),Kd=(0,Ye.f3)(De.IRendererService),$d=(0,Ye.f3)(De.ILayerService),xd=(0,Ye.f3)(De.ICameraService),Qd=(0,Ye.f3)(De.IInteractionService),Kh=(0,Ye.f3)(De.IPickingService),Jd=(0,Ye.f3)(De.IShaderModuleService),kp=(0,Ye.f3)(De.IMarkerService),zv=(0,Ye.f3)(De.IPopupService),vd(ev=(ru=function(e){(0,Yr.Z)(r,e);var i=Cb(r);function r(){var n;return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"destroyed",!1),(0,I.Z)((0,oe.Z)(n),"loaded",!1),(0,I.Z)((0,oe.Z)(n),"loadFont",!1),(0,I.Z)((0,oe.Z)(n),"fontFamily",""),Ce((0,oe.Z)(n),"id",Uv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"iconService",Zv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"fontService",jv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"controlService",Vv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"configService",Gv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"map",Hv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"coordinateSystemService",Wv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"rendererService",ec,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"layerService",Dp,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"cameraService",tv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"interactionService",$h,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"pickingService",rv,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"shaderModuleService",Cm,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"markerService",Am,(0,oe.Z)(n)),Ce((0,oe.Z)(n),"popupService",wm,(0,oe.Z)(n)),(0,I.Z)((0,oe.Z)(n),"inited",!1),(0,I.Z)((0,oe.Z)(n),"initPromise",void 0),(0,I.Z)((0,oe.Z)(n),"rendering",!1),(0,I.Z)((0,oe.Z)(n),"$container",void 0),(0,I.Z)((0,oe.Z)(n),"canvas",void 0),(0,I.Z)((0,oe.Z)(n),"markerContainer",void 0),(0,I.Z)((0,oe.Z)(n),"hooks",void 0),(0,I.Z)((0,oe.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ps(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,oe.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Fh},n}return(0,St.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Sn.Z)(Xn().mark(function f(){return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(Lo.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,Sn.Z)(Xn().mark(function f(){var v,g;return Xn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Tp(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=la("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Nv()(s.$container,s.handleWindowResized),pa.matchMedia&&((g=pa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Sn.Z)(Xn().mark(function f(){return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(Lo.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,Sn.Z)(Xn().mark(function f(){var v;return Xn().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,Sn.Z)(Xn().mark(function s(){return Xn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=la("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Xd.unbind)(this.$container,this.handleWindowResized),pa.matchMedia){var v;(v=pa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=xa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=g*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*g})}},{key:"setCanvas",value:function(){var a,s,f=xa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=g*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Qo.EventEmitter),Uv=Ge(ru.prototype,"id",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zv=Ge(ru.prototype,"iconService",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jv=Ge(ru.prototype,"fontService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv=Ge(ru.prototype,"controlService",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=Ge(ru.prototype,"configService",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hv=Ge(ru.prototype,"map",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=Ge(ru.prototype,"coordinateSystemService",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=Ge(ru.prototype,"rendererService",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Ge(ru.prototype,"layerService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=Ge(ru.prototype,"cameraService",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$h=Ge(ru.prototype,"interactionService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=Ge(ru.prototype,"pickingService",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=Ge(ru.prototype,"shaderModuleService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=Ge(ru.prototype,"markerService",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=Ge(ru.prototype,"popupService",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ru))||ev),Tb=N(44908),Tm=N.n(Tb);function Mb(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Pb=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Mm(e){var i={};return e=e.replace(Pb,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Mb(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var Pm,Im;function Om(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Om(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Om(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Rm="#define PI 3.14159265359",Ib=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Ob=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Rb=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Lb=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,kb=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Db=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Fb=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Bb=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Nb=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,zb=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Ub=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Zb=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,jb=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Vb=/precision\s+(high|low|medium)p\s+float/,Gb=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Hb=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Wb=(Pm=(0,Ye.b2)(),Pm(Im=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,St.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Rm,fs:Rm}),this.registerModule("decode",{vs:Ib,fs:""}),this.registerModule("projection",{vs:Fb,fs:""}),this.registerModule("project",{vs:Db,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Bb}),this.registerModule("lighting",{vs:Rb,fs:""}),this.registerModule("light",{vs:Ob,fs:""}),this.registerModule("picking",{vs:kb,fs:Lb}),this.registerModule("styleMapping",{vs:Nb,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:jb,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:zb,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Ub,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Zb,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=Mm(a),g=v.content,x=v.uniforms,C=Mm(s),A=C.content,O=C.uniforms;this.rawContentCache[r]={fs:A,uniforms:nv(nv(nv({},x),O),f),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,g=f.includeList,x=this.processModule(s,[],"fs"),C=x.content,A=x.includeList,O=C,D=Tm()(g.concat(A).concat(r)).reduce(function(V,Y){return nv(nv({},V),n.rawContentCache[Y].uniforms)},{});return Vb.test(C)||(O=Gb+C),this.moduleCache[r]={fs:O.trim(),uniforms:D,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(Hb,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var A=s.rawContentCache[C][a];n.push(C);var O=s.processModule(A,n,a),D=O.content;return D});return{content:f,includeList:n}}}]),e}())||Im),Xv=N(66213),Qh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Qh||(Qh={}));var Lm,km,Yv=(Lm=(0,Ye.b2)(),Lm(km=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,St.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Qh.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(De.IRendererService),this.cameraService=r.getContainer().get(De.ICameraService),this.mapService=r.getContainer().get(De.IMapService),this.interactionService=r.getContainer().get(De.IInteractionService),this.layerService=r.getContainer().get(De.ILayerService),this.shaderModuleService=r.getContainer().get(De.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||km),Dm,Fm;function Xb(e){var i=Yb();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qb=(Dm=(0,Ye.b2)(),Dm(Fm=function(e){(0,Yr.Z)(r,e);var i=Xb(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Xv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Yv))||Fm),Bm,Nm,zm,F0,Um;function Kb(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$b(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function $b(e,i){if(!!e){if(typeof e=="string")return Zm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zm(e,i)}}function Zm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Qb=(Bm=(0,Ye.b2)(),Nm=(0,Ye.f3)(De.IPostProcessor),Bm(zm=(F0=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"passes",[]),Ce(this,"postProcessor",Um,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,St.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(){var a,s,f;return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=Kb(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return f=s.value,g.next=7,f.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Qh.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Um=Ge(F0.prototype,"postProcessor",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0))||zm),jm,Vm;function Gm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jb(e){var i=e2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t2=(jm=(0,Ye.b2)(),jm(Vm=function(e){(0,Yr.Z)(r,e);var i=Jb(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,oe.Z)(n),"layer",void 0),(0,I.Z)((0,oe.Z)(n),"width",0),(0,I.Z)((0,oe.Z)(n),"height",0),(0,I.Z)((0,oe.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,oe.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,A=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(A))){var O=n.rendererService,D=O.getViewportSize,V=O.readPixels,Y=O.useFramebuffer,te=D(),Ee=te.width,Ze=te.height,Je=n.layer.getLayerConfig(),lt=Je.enableHighlight,Et=Je.enableSelect,xt=g*xa,Kt=x*xa;if(!(xt>Ee||xt<0||Kt>Ze||Kt<0)){var ur;Y(n.pickingFBO,function(){var Ir;if(ur=V({x:Math.round(xt),y:Math.round(Ze-(x+1)*xa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ur[0]!==0||ur[1]!==0||ur[2]!==0){var Xr=Mr(ur),yr=n.layer.getSource().getFeatureById(Xr),sn={x:g,y:x,type:A,lngLat:C,featureId:Xr,feature:yr};yr&&(n.layer.setCurrentPickId(Xr),n.triggerHoverOnLayer(sn))}else{var Rn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Hm(Hm({},Rn),{},{type:"unpick"})),n.triggerHoverOnLayer(Rn),n.layer.setCurrentPickId(null)}lt&&n.highlightPickedFeature(ur),Et&&A==="click"&&((Ir=ur)===null||Ir===void 0?void 0:Ir.toString())!==[0,0,0,0].toString()&&n.selectFeature(ur)})}}}),n}return(0,St.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Xv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,g=f.createFramebuffer,x=f.getViewportSize,C=x(),A=C.width,O=C.height;this.pickingFBO=g({color:v({width:A,height:O,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(Lo.Hover,this.pickFromPickingFBO),this.interactionService.on(Lo.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Lo.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=v(),A=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==O)&&(this.pickingFBO.resize({width:A,height:O}),this.width=A,this.height=O),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,Q.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,Q.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=tn(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=tn(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(Yv))||Vm),r2=N(11700),n2=N.n(r2),i2=N(68929),a2=N.n(i2),Wm,Xm,Ym,B0,qm;function Km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function iv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Km(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var o2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yh=(Wm=(0,Ye.b2)(),Xm=(0,Ye.f3)(De.IShaderModuleService),Wm(Ym=(B0=function(){function e(){(0,ut.Z)(this,e),Ce(this,"shaderModuleService",qm,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",o2),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,St.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Qh.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(De.IRendererService),this.shaderModuleService=r.getContainer().get(De.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,A=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:iv(iv({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,g=f.getViewportSize,x=f.clear,C=g(),A=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var D=iv({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[A,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(D.u_BloomFinal=1,D.u_Texture2=n),a.model.draw({uniforms:D})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=iv(iv({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){bc()(r[a])||(n["u_".concat(n2()(a2()(a)))]=r[a])}),n}}]),e}(),qm=Ge(B0.prototype,"shaderModuleService",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0))||Ym),$m,Qm;function Jm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s2(e){var i=u2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,c2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,f2=($m=(0,Ye.b2)(),$m(Qm=function(e){(0,Yr.Z)(r,e);var i=s2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:c2,fs:l2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:eg(eg({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return bc()(a.bloomRadius)||(s.u_radius=a.bloomRadius),bc()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),bc()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(yh))||Qm),tg,rg;function ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ng(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h2(e){var i=p2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,v2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,m2=(tg=(0,Ye.b2)(),tg(rg=function(e){(0,Yr.Z)(r,e);var i=h2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:v2,fs:d2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:ig(ig({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return bc()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(yh))||rg),ag,og;function sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g2(e){var i=y2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,x2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,b2=(ag=(0,Ye.b2)(),ag(og=function(e){(0,Yr.Z)(r,e);var i=g2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:x2,fs:_2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:ug(ug({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return bc()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(yh))||og),lg,cg;function fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E2(e){var i=S2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,A2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,w2=(lg=(0,Ye.b2)(),lg(cg=function(e){(0,Yr.Z)(r,e);var i=E2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:A2,fs:C2});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:hg(hg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(yh))||cg),pg,dg;function T2(e){var i=M2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function M2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,I2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,O2=(pg=(0,Ye.b2)(),pg(dg=function(e){(0,Yr.Z)(r,e);var i=T2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:I2,fs:P2}),this.shaderModuleService.getModule("copy-pass")}}]),r}(yh))||dg),vg,mg;function gg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R2(e){var i=L2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,D2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,F2=(vg=(0,Ye.b2)(),vg(mg=function(e){(0,Yr.Z)(r,e);var i=R2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:D2,fs:k2});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:yg(yg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(yh))||mg),_g,xg;function bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B2(e){var i=N2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function N2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,U2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Z2=(_g=(0,Ye.b2)(),_g(xg=function(e){(0,Yr.Z)(r,e);var i=B2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:U2,fs:z2});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Eg(Eg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(yh))||xg),Sg,Cg;function j2(e){var i=V2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,H2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,W2=(Sg=(0,Ye.b2)(),Sg(Cg=function(e){(0,Yr.Z)(r,e);var i=j2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:H2,fs:G2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(yh))||Cg),Ag,wg;function X2(e){var i=Y2();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,K2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,$2=(Ag=(0,Ye.b2)(),Ag(wg=function(e){(0,Yr.Z)(r,e);var i=X2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:q2,fs:K2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(yh))||wg),Tg,Mg,Pg,Ig,bd,Og,Q2=(Tg=(0,Ye.b2)(),Mg=(0,Ye.f3)(De.IRendererService),Pg=(0,Ye.zY)(),Tg(Ig=(bd=function(){function e(){(0,ut.Z)(this,e),Ce(this,"rendererService",Og,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,St.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Sn.Z)(Xn().mark(function f(){return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a,s){var f,v;return Xn().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a){var s,f;return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,f);case 7:g.next=12;break;case 9:return g.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Og=Ge(bd.prototype,"rendererService",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge(bd.prototype,"init",[Pg],Object.getOwnPropertyDescriptor(bd.prototype,"init"),bd.prototype),bd))||Ig),Rg,Lg;function J2(e){var i=eE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tE=(Rg=(0,Ye.b2)(),Rg(Lg=function(e){(0,Yr.Z)(r,e);var i=J2(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Xv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();f(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Yv))||Lg),kg,Dg,Fg,N0,Bg;function Ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ng(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rE(e){var i=nE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function nE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iE=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Ug=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,aE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Zg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var oE=1,sE=(kg=(0,Ye.b2)(),Dg=(0,Ye.f3)(De.IShaderModuleService),kg(Fg=(N0=function(e){(0,Yr.Z)(r,e);var i=rE(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),Ce((0,oe.Z)(n),"shaderModuleService",Bg,(0,oe.Z)(n)),(0,I.Z)((0,oe.Z)(n),"haltonSequence",[]),(0,I.Z)((0,oe.Z)(n),"accumulatingId",0),(0,I.Z)((0,oe.Z)(n),"frame",0),(0,I.Z)((0,oe.Z)(n),"timer",void 0),(0,I.Z)((0,oe.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,oe.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,oe.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,oe.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,oe.Z)(n),"blendModel",void 0),(0,I.Z)((0,oe.Z)(n),"outputModel",void 0),(0,I.Z)((0,oe.Z)(n),"copyModel",void 0),n}return(0,St.Z)(r,[{key:"getType",value:function(){return Qh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Xv.Z)((0,It.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,g=f.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([Zg(x,2),Zg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",iE),this.outputModel=this.createTriangleModel("copy-pass",Ug,{blend:{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:W.ONE,dstAlpha:W.ONE_MINUS_SRC_ALPHA},equation:{rgb:W.FUNC_ADD,alpha:W.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Ug)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),A=C.width,O=C.height;this.sampleRenderTarget.resize({width:A,height:O}),this.prevRenderTarget.resize({width:A,height:O}),this.outputRenderTarget.resize({width:A,height:O}),this.copyRenderTarget.resize({width:A,height:O}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();x(D,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var V=function Y(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),pa.requestAnimationFrame(function(){Y(te)}))};this.accumulatingId=oE++,this.timer=pa.setTimeout(function(){V(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),A=C.width,O=C.height,D=a.getLayerConfig(),V=D.jitterScale,Y=V===void 0?1:V,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/A*Y,(te[1]*2-1)/O*Y),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ee=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ee.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ze=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ze,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,pa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:aE,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,A=this.rendererService,O=A.createAttribute,D=A.createBuffer,V=A.createModel;return V(zg({vs:g,fs:x,attributes:{a_Position:O({buffer:D({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:zg({},C),depth:{enable:!1},count:3},f))}}]),r}(Yv),Bg=Ge(N0.prototype,"shaderModuleService",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||Fg),av=new Ye.W2;av.bind(De.IGlobalConfigService).to(Qe).inSingletonScope(),(0,Ye.GW)((0,Ye.b2)(),Qo.EventEmitter),av.bind(De.IEventEmitter).to(Qo.EventEmitter);var jg=(0,pr.Z)(av,!1),z0=function(i){var r=jg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},x4=function(i){var r=jg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},tc=av,uE=0;function lE(){var e=new Ye.W2;return e.parent=av,e.bind(De.SceneID).toConstantValue("".concat(uE++)),e.bind(De.IShaderModuleService).to(Wb).inSingletonScope(),e.bind(De.ILayerService).to(Rv).inSingletonScope(),e.bind(De.ISceneService).to(wb).inSingletonScope(),e.bind(De.ICameraService).to(Yc).inSingletonScope(),e.bind(De.ICoordinateSystemService).to(Ep).inSingletonScope(),e.bind(De.IInteractionService).to(cd).inSingletonScope(),e.bind(De.IPickingService).to($l).inSingletonScope(),e.bind(De.IControlService).to(Pv).inSingletonScope(),e.bind(De.IMarkerService).to(u).inSingletonScope(),e.bind(De.IIconService).to(os).inSingletonScope(),e.bind(De.IFontService).to(_o).inSingletonScope(),e.bind(De.IPopupService).to(b).inSingletonScope(),e.bind(De.INormalPass).to(qb).whenTargetNamed("clear"),e.bind(De.INormalPass).to(t2).whenTargetNamed("pixelPicking"),e.bind(De.INormalPass).to(tE).whenTargetNamed("render"),e.bind(De.INormalPass).to(sE).whenTargetNamed("taa"),e.bind(De.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(De.INormalPass,r)}}),e.bind(De.IPostProcessingPass).to(O2).whenTargetNamed("copy"),e.bind(De.IPostProcessingPass).to(f2).whenTargetNamed("bloom"),e.bind(De.IPostProcessingPass).to(m2).whenTargetNamed("blurH"),e.bind(De.IPostProcessingPass).to(b2).whenTargetNamed("blurV"),e.bind(De.IPostProcessingPass).to(W2).whenTargetNamed("noise"),e.bind(De.IPostProcessingPass).to($2).whenTargetNamed("sepia"),e.bind(De.IPostProcessingPass).to(w2).whenTargetNamed("colorHalftone"),e.bind(De.IPostProcessingPass).to(F2).whenTargetNamed("hexagonalPixelate"),e.bind(De.IPostProcessingPass).to(Z2).whenTargetNamed("ink"),e.bind(De.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(De.IPostProcessingPass,r);return n.setName(r),n}}),e}function ov(e){var i=new Ye.W2;return i.parent=e,i.bind(De.IStyleAttributeService).to(Bv).inSingletonScope(),i.bind(De.IMultiPassRenderer).to(Qb).inSingletonScope(),i.bind(De.IPostProcessor).to(Q2).inSingletonScope(),i}var b4=N(74691),cE=null;function E4(e){return cE.indexOf(e)}var fE=2,S4=4,hE=64,C4=128,pE=256,dE=512,A4=8192,w4=16384,T4=32768,vE=null,Vg=131072,M4=262144,mE=524288,P4=1048576,gE=2097152,I4=4194304,yE=8388608,_E=16777216,xE=null;function qv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function O4(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],A=[],O=[],D=[qv(i[0],i[1]),qv(i[2],i[3])],V=[qv(v[0],v[1]),qv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Y){var te=_slicedToArray(Y,2),Ee=te[0],Ze=te[1];C.push([].concat(D,[(Ee+1)*yE+(Ze+1)*gE+getShapeIndex(s)*Vg+r,(n+512)*mE+(a+512)*hE])),A.push([].concat(V,[g,x])),O.push([f,0,0,0])}),{packedBuffer:C,packedBuffer2:A,packedBuffer3:O}}function R4(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*xE+r*_E+n*Vg+r*vE+n*dE+r*pE+n*fE+r}var Sc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Sc||(Sc={}));var nu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(nu||(nu={}));var Jh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Jh||(Jh={}));var Tn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Tn||(Tn={}));var bE=["mapload","mapchange","mapAfterFrameChange"],Fp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},U0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],ep;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(ep||(ep={}));function Gg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EE(e){var i=SE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function SE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CE=0,Kv=function(e){(0,Yr.Z)(r,e);var i=EE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this),(0,I.Z)((0,oe.Z)(a),"controlOption",void 0),(0,I.Z)((0,oe.Z)(a),"container",void 0),(0,I.Z)((0,oe.Z)(a),"sceneContainer",void 0),(0,I.Z)((0,oe.Z)(a),"mapsService",void 0),(0,I.Z)((0,oe.Z)(a),"renderService",void 0),(0,I.Z)((0,oe.Z)(a),"layerService",void 0),(0,I.Z)((0,oe.Z)(a),"controlService",void 0),(0,I.Z)((0,oe.Z)(a),"isShow",void 0),a.controlOption=Hg(Hg({},a.getDefault()),n||{}),a}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{position:ep.TOPRIGHT,name:"".concat(CE++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ep.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(De.IMapService),this.renderService=a.get(De.IRendererService),this.layerService=a.get(De.ILayerService),this.controlService=a.get(De.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return zs(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;zs(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;cu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;no(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Qo.EventEmitter);function AE(e){var i=wE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L4=function(e){(0,Yr.Z)(r,e);var i=AE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,oe.Z)(a),"layerControlInputs",void 0),(0,I.Z)((0,oe.Z)(a),"layers",void 0),(0,I.Z)((0,oe.Z)(a),"lastZIndex",void 0),(0,I.Z)((0,oe.Z)(a),"handlingClick",void 0),(0,I.Z)((0,oe.Z)(a),"layersLink",void 0),(0,I.Z)((0,oe.Z)(a),"baseLayersList",void 0),(0,I.Z)((0,oe.Z)(a),"separator",void 0),(0,I.Z)((0,oe.Z)(a),"overlaysList",void 0),(0,I.Z)((0,oe.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),Ht(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,oe.Z)(a)),a}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:ep.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;zs(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(zs(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):cu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return cu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=la("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=la("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=la("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",f||this.expand(),this.baseLayersList=la("div",a+"-base",v),this.separator=la("div",a+"-separator",v),this.overlaysList=la("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,A){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,A){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;In(this.baseLayersList),In(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,g=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),C=f.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(A,O){return x(A.layer,O.layer,A.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var A=a.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||g.push(f);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Kv);function TE(e){var i=ME();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function ME(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PE=function(e){(0,Yr.Z)(r,e);var i=TE(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{position:ep.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=la("div",a),f=la("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Kv);function IE(e){var i=OE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function OE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k4=function(e){(0,Yr.Z)(r,e);var i=IE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,oe.Z)(a),"mScale",void 0),(0,I.Z)((0,oe.Z)(a),"iScale",void 0),Ht(["update"],(0,oe.Z)(a)),a}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{position:ep.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=la("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),g=a.containerToLngLat([s,f]),x=L([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,g;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,g=f.imperial;v&&(this.mScale=la("div",a,s)),g&&(this.iScale=la("div",a,s))}}]),r}(Kv);function RE(e){var i=LE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D4=function(e){(0,Yr.Z)(r,e);var i=RE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,oe.Z)(a),"disabled",void 0),(0,I.Z)((0,oe.Z)(a),"zoomInButton",void 0),(0,I.Z)((0,oe.Z)(a),"zoomOutButton",void 0),Ht(["updateDisabled","zoomIn","zoomOut"],(0,oe.Z)(a)),a}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{position:ep.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=la("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,g){var x=la("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";cu(this.zoomInButton,s),cu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&zs(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&zs(this.zoomInButton,s)}}]),r}(Kv);function Wg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kE(e){var i=DE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function DE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yg=function(e){(0,Yr.Z)(r,e);var i=kE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this),(0,I.Z)((0,oe.Z)(a),"markerOption",void 0),(0,I.Z)((0,oe.Z)(a),"defaultMarker",void 0),(0,I.Z)((0,oe.Z)(a),"popup",void 0),(0,I.Z)((0,oe.Z)(a),"mapsService",void 0),(0,I.Z)((0,oe.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,oe.Z)(a),"lngLat",void 0),(0,I.Z)((0,oe.Z)(a),"scene",void 0),(0,I.Z)((0,oe.Z)(a),"added",!1),(0,I.Z)((0,oe.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Xg(Xg({},a.getDefault()),n),Ht(["update","onMove","onUp","addDragHandler","onMapClick"],(0,oe.Z)(a)),a.init(),a}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:kn.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(De.IMapService),this.sceneSerive=a.get(De.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&no(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&no(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),fc(s,"".concat(Fn[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),A=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),D=0,V=0;if(O&&(D=O.scrollWidth,V=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(A.x>D){var Y=this.mapsService.lngLatToContainer([g-360,x]);A.x=Y.x}if(A.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);A.x=te.x}}(A.x>D||A.x<0||A.y>V||A.y<0)&&(s.style.display="none"),s.style.left=A.x+f[0]+"px",s.style.top=A.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,g=f.anchor;if(!s){this.defaultMarker=!0,s=la("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}zs(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var O,D,V=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[A]);s&&(s.style[A]=V)}),s.addEventListener("click",function(A){a.onMapClick(A)}),s.addEventListener("click",this.eventHandle),Oi(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Qo.EventEmitter);function qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FE(e){var i=BE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function BE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F4=function(e){(0,Yr.Z)(r,e);var i=FE(r);function r(n){var a,s;return(0,ut.Z)(this,r),s=i.call(this),(0,I.Z)((0,oe.Z)(s),"markers",[]),(0,I.Z)((0,oe.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,oe.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,oe.Z)(s),"points",[]),(0,I.Z)((0,oe.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,oe.Z)(s),"mapsService",void 0),(0,I.Z)((0,oe.Z)(s),"scene",void 0),(0,I.Z)((0,oe.Z)(s),"zoom",void 0),(0,I.Z)((0,oe.Z)(s),"bbox",void 0),s.markerLayerOption=P()(s.getDefault(),n),Ht(["update"],(0,oe.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,St.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(De.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=X(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,g=f.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:Kg(Kg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,g=a.maxZoom;this.clusterIndex=new(Qp())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,A=f.markerLayerOption.clusterOption,O=A.field,D=A.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var V,Y=f.getLeaves((V=x.properties)===null||V===void 0?void 0:V.cluster_id);if(x.properties.clusterData=Y,O&&D){var te=Y==null?void 0:Y.map(function(Et){var xt=(0,I.Z)({},O,Et.properties[O]);return xt}),Ee=$s(te,O),Ze=Su(D,Ee),Je="point_"+D;x.properties[Je]=Ze.toFixed(2)}}var lt=f.clusterMarker(x);f.clusterMarkers.push(lt),lt.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,g=v===void 0?this.generateElement.bind(this):v,x=new Yg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!se(this.bbox,s))&&(this.bbox=X(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=la("div","l7-marker-cluster"),f=la("div","",s),v=la("span","",f),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var A=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=A,s}}]),r}(Qo.EventEmitter);function $g(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$g(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$g(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NE(e){var i=zE();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jg=function(e){(0,Yr.Z)(r,e);var i=NE(r);function r(n){var a;return(0,ut.Z)(this,r),a=i.call(this),(0,I.Z)((0,oe.Z)(a),"popupOption",void 0),(0,I.Z)((0,oe.Z)(a),"mapsService",void 0),(0,I.Z)((0,oe.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,oe.Z)(a),"lngLat",void 0),(0,I.Z)((0,oe.Z)(a),"content",void 0),(0,I.Z)((0,oe.Z)(a),"closeButton",void 0),(0,I.Z)((0,oe.Z)(a),"timeoutInstance",void 0),(0,I.Z)((0,oe.Z)(a),"container",void 0),(0,I.Z)((0,oe.Z)(a),"tip",void 0),(0,I.Z)((0,oe.Z)(a),"scene",void 0),a.popupOption=Qg(Qg({},a.getdefault()),n),Ht(["update","onClickClose","remove"],(0,oe.Z)(a)),a}return(0,St.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(De.IMapService),this.sceneSerive=a.get(De.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&no(this.content),this.content=la("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=la("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:kn.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,g=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),fc(this.container,"".concat(Fn[x])),Oi(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Qo.EventEmitter);function UE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}UE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var ZE=N(52353),jE=N.n(ZE),VE=N(13218),Hu=N.n(VE),tp,ey=(tp={},(0,I.Z)(tp,Sc.additive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(tp,Sc.none,{enable:!1}),(0,I.Z)(tp,Sc.normal,{enable:!0,func:{srcRGB:W.SRC_ALPHA,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(tp,Sc.subtractive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:W.ZERO,dstAlpha:W.ONE_MINUS_SRC_COLOR},equation:{rgb:W.FUNC_SUBTRACT,alpha:W.FUNC_SUBTRACT}}),(0,I.Z)(tp,Sc.max,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MAX_EXT}}),(0,I.Z)(tp,Sc.min,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MIN_EXT}}),tp),GE=N(81763),Wu=N.n(GE),B4=1024;function vl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function HE(e,i){e.opacity&&$v("opacity",i,e.opacity),e.strokeWidth&&$v("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&$v("strokeOpacity",i,e.strokeOpacity),e.stroke&&WE("stroke",i,e.stroke),e.offsets&&ty("offsets",i,e.offsets),e.textOffset&&ty("textOffset",i,e.textOffset),e.thetaOffset&&$v("thetaOffset",i,e.thetaOffset)}function $v(e,i,r){Tu()(r)?vl(e,i,r,function(n){return n}):Wu()(r)?vl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?Tu()(r[0])&&Zu()(r[1])||Tu()(r[0])&&Array.isArray(r[1])&&Wu()(r[1][0])&&Wu()(r[1][1])?vl(e,i,r[0],r[1]):vl(e,i,[1],void 0):vl(e,i,[1],void 0)}function ty(e,i,r){Tu()(r)?vl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&Tu()(r[0])&&Zu()(r[1])?vl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&Wu()(r[0])&&Wu()(r[1])?vl(e,i,r,void 0):vl(e,i,[0,0],void 0)}function WE(e,i,r){Tu()(r)?vl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(Tu()(r[0])&&Zu()(r[1])||Tu()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?vl(e,i,r[0],r[1]):vl(e,i,"#fff",void 0)}var Rs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Rs||(Rs={}));function XE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=pe(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function YE(e,i){var r=this;e.length>0&&i.version===Rs["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Rs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function qE(e,i){e.length>0&&i.version===Rs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=KE(r.coordinates,i),r.simpleCoordinate=!0)})}function KE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function $E(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!mr(f[0])?[r]:f}function QE(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var A={id:C._id,coordinates:C.coordinates};if(e.filter(function(V){return V.scale!==void 0}).forEach(function(V){var Y=$E(V,C,a);V.needRemapping=!1,V.name==="color"&&(Y=Y.map(function(te){return lr(te)})),A[V.name]=Array.isArray(Y)&&Y.length===1?Y[0]:Y,V.name==="shape"&&(A.shape=r.getIconFontKey(A[V.name]))}),A.shape==="line"&&g.enable){var O=A.coordinates,D=XE(O[0],O[1]);A.coordinates.splice(1,0,D,D)}return A});return YE(x,n),qE(x,n),x}function JE(e,i,r,n,a,s){var f=new or(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=f.data.dataArray,C=x,A=QE(g,C,i,r,v,e);return f.destroy(),A}function ry(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function ny(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),ry(i).forEach(function(g){var x=(0,Q.Z)(g,2),C=x[0],A=x[1];a.add(r(C),A)}),a.add(r("copy")),a}var eS=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function tS(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}eS.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var rS=["passes"],nS=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],iy,Z0,ay;function iS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function aS(e,i){if(!!e){if(typeof e=="string")return oy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oy(e,i)}}function oy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function sy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oS(e){var i=sS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function sS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uy=0,rp=(iy=z0(De.IGlobalConfigService),Z0=function(e){(0,Yr.Z)(r,e);var i=oS(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ut.Z)(this,r),n=i.call(this),(0,I.Z)((0,oe.Z)(n),"id","".concat(uy++)),(0,I.Z)((0,oe.Z)(n),"name","".concat(uy)),(0,I.Z)((0,oe.Z)(n),"type",void 0),(0,I.Z)((0,oe.Z)(n),"visible",!0),(0,I.Z)((0,oe.Z)(n),"zIndex",0),(0,I.Z)((0,oe.Z)(n),"minZoom",void 0),(0,I.Z)((0,oe.Z)(n),"maxZoom",void 0),(0,I.Z)((0,oe.Z)(n),"inited",!1),(0,I.Z)((0,oe.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,oe.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,oe.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,oe.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,oe.Z)(n),"rendering",void 0),(0,I.Z)((0,oe.Z)(n),"clusterZoom",0),(0,I.Z)((0,oe.Z)(n),"layerType",void 0),(0,I.Z)((0,oe.Z)(n),"isLayerGroup",!1),(0,I.Z)((0,oe.Z)(n),"triangulation",void 0),(0,I.Z)((0,oe.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,oe.Z)(n),"hooks",{init:new If,afterInit:new If,beforeRender:new If,beforeRenderData:new Kp,afterRender:new pu,beforePickingEncode:new pu,afterPickingEncode:new pu,beforeHighlight:new pu(["pickedColor"]),afterHighlight:new pu,beforeSelect:new pu(["pickedColor"]),afterSelect:new pu,beforeDestroy:new pu,afterDestroy:new pu}),(0,I.Z)((0,oe.Z)(n),"models",[]),(0,I.Z)((0,oe.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,oe.Z)(n),"plugins",void 0),(0,I.Z)((0,oe.Z)(n),"sourceOption",void 0),(0,I.Z)((0,oe.Z)(n),"layerModel",void 0),(0,I.Z)((0,oe.Z)(n),"shapeOption",void 0),(0,I.Z)((0,oe.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,oe.Z)(n),"layerChildren",[]),(0,I.Z)((0,oe.Z)(n),"masks",[]),Ce((0,oe.Z)(n),"configService",ay,(0,oe.Z)(n)),(0,I.Z)((0,oe.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,oe.Z)(n),"cameraService",void 0),(0,I.Z)((0,oe.Z)(n),"coordinateService",void 0),(0,I.Z)((0,oe.Z)(n),"iconService",void 0),(0,I.Z)((0,oe.Z)(n),"fontService",void 0),(0,I.Z)((0,oe.Z)(n),"pickingService",void 0),(0,I.Z)((0,oe.Z)(n),"rendererService",void 0),(0,I.Z)((0,oe.Z)(n),"layerService",void 0),(0,I.Z)((0,oe.Z)(n),"interactionService",void 0),(0,I.Z)((0,oe.Z)(n),"mapService",void 0),(0,I.Z)((0,oe.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,oe.Z)(n),"layerSource",void 0),(0,I.Z)((0,oe.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,oe.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,oe.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,oe.Z)(n),"container",void 0),(0,I.Z)((0,oe.Z)(n),"encodedData",void 0),(0,I.Z)((0,oe.Z)(n),"configSchema",void 0),(0,I.Z)((0,oe.Z)(n),"currentPickId",null),(0,I.Z)((0,oe.Z)(n),"rawConfig",void 0),(0,I.Z)((0,oe.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,oe.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,oe.Z)(n),"scaleOptions",{}),(0,I.Z)((0,oe.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,oe.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,oe.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,oe.Z)(n),"isDestroied",!1),(0,I.Z)((0,oe.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,St.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Xu(Xu({},this.needUpdateConfig),a);else{var s=this.container.get(De.SceneID);HE(a,this),this.configService.setLayerConfig(s,this.id,Xu(Xu(Xu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(De.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(De.IIconService),this.fontService=this.container.get(De.IFontService),this.rendererService=this.container.get(De.IRendererService),this.layerService=this.container.get(De.ILayerService),this.interactionService=this.container.get(De.IInteractionService),this.pickingService=this.container.get(De.IPickingService),this.mapService=this.container.get(De.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,g=f.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(De.ICameraService),this.coordinateService=this.container.get(De.ICoordinateSystemService),this.shaderModuleService=this.container.get(De.IShaderModuleService),this.postProcessingPassFactory=this.container.get(De.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(De.IFactoryNormalPass),this.styleAttributeService=this.container.get(De.IStyleAttributeService),this.multiPassRenderer=this.container.get(De.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var D=O.attributeName,V=O.attributeField,Y=O.attributeValues,te=O.updateOptions;a.styleAttributeService.updateStyleAttribute(D,{scale:Xu({field:V},a.splitValuesAndCallbackInAttribute(Y,a.getLayerConfig()[D]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(De.ILayerPlugin);var x=iS(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?JE(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Xu(Xu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,A=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),tS(this,C,A),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return Hu()(a)?(s.enable=!0,s=Xu(Xu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new or(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,g=(0,vh.Z)(a,rS);return v&&ry(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Xu(Xu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Hu()(a)?this.scaleOptions=Xu(Xu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Sn.Z)(Xn().mark(function s(){return Xn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Hu()(a)?!0:a,Hu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(Hu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Hu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Hu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Hu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Hu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(tn(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Hu()(a)?!0:a,Hu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(Hu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Hu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Hu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Hu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Hu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(tn(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!f&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,g=v===void 0?[]:v;this.multiPassRenderer=ny(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,A=x.height;this.multiPassRenderer.resize(C,A)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,I.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,I.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!jE()(x)}).map(function(x){return(0,I.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,vh.Z)(a,nS);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var A=this.shaderModuleService.getModule(s),O=A.vs,D=A.fs,V=A.uniforms,Y=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),Ee=te.attributes,Ze=te.elements;return Y(Xu({attributes:Ee,uniforms:V,fs:D,vs:O,elements:Ze,blend:ey[Sc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Sn.Z)(Xn().mark(function s(f){return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,f.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Xu({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:Zu()(a)?void 0:a||s,callback:Zu()(a)?a:void 0}}}]),r}(Qo.EventEmitter),ay=Ge(Z0.prototype,"configService",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z0),uS=N(18446),Ed=N.n(uS),ly,j0,cy;function lS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function cS(e,i){if(!!e){if(typeof e=="string")return fy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fy(e,i)}}function fy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var lo=(ly=z0(De.IGlobalConfigService),j0=function(){function e(i){(0,ut.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),Ce(this,"configService",cy,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(De.IRendererService),this.shaderModuleService=i.getContainer().get(De.IShaderModuleService),this.styleAttributeService=i.getContainer().get(De.IStyleAttributeService),this.mapService=i.getContainer().get(De.IMapService),this.iconService=i.getContainer().get(De.IIconService),this.fontService=i.getContainer().get(De.IFontService),this.cameraService=i.getContainer().get(De.ICameraService),this.layerService=i.getContainer().get(De.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:W.NEAREST,min:W.NEAREST,width:1,height:1}))}return(0,St.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Ed()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),Ed()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Ed()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Ed()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Ed()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Ed()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Wu()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Wu()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Wu()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Wu()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Tu()(r)?!!(0,Qt.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=lr(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&Wu()(r[0])&&Wu()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=lS(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,nr.Z)(lr(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(Wu()(C)?C:1):this.patchMod(r,x)}}catch(A){s.e(A)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var A=g.length;A<v;A++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return ey[Sc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),cy=Ge(j0.prototype,"configService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0),fS=N(9187),jf=N.n(fS),hy=100,N4=36,z4=40;function py(e){return e/180*Math.acos(-1)}function dy(e){var i=py(e[0])+Math.PI/2,r=py(e[1]),n=hy+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function U4(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,g=2*v,x=[],C=[],A=[],O=[],D=[],V=[],Y=0;Y<=v;Y++){for(var te=Y/v,Ee=te*Math.PI,Ze=0;Ze<=g;Ze++){var Je=Ze/g,lt=Je*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ee),mat4.identity(r),mat4.rotateY(r,r,lt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),A.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),V.push([Je,1-te]),O.push(Je,1-te)}if(Y>0)for(var Et=A.length,xt=Et-2*(g+1);xt+g+2<Et;xt++)x.push([xt,xt+1,xt+g+1]),C.push(xt,xt+1,xt+g+1),x.push([xt+g+1,xt+1,xt+g+2]),C.push(xt+g+1,xt+1,xt+g+2)}return{cells:x,positions:A,uvs:V,positionsArr:O,indicesArr:C,normalArr:D}}var gi=N(31437),Qv=gi.Ue(),Z4=gi.Ue(),Xs=gi.Ue(),np=gi.Ue(),Sd=gi.Ue();function V0(e,i,r,n,a){gi.IH(e,r,n),gi.Fv(e,e),i=gi.al(-e[1],e[0]);var s=gi.al(-r[1],r[0]);return[a/gi.AK(i,s),i]}function ip(e,i){return gi.t8(e,-i[1],i[0])}function Cd(e,i,r){return gi.lu(e,i,r),gi.Fv(e,e),e}function G0(e,i){return e[0]===i[0]&&e[1]===i[1]}function j4(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var vy=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ut.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",gi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),(0,I.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,St.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,A=r[v-1];A.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var V=n[v],Y=v<r.length-1?[].concat((0,nr.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.segment_gaode2(a,f,A,D,Y,O,V,te);f+=Ee}if(this.dash)for(var Ze=0;Ze<a.positions.length/6;Ze++)a.positions[Ze*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,A=r[v-1];A.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var V=n[v],Y=v<r.length-1?[].concat((0,nr.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.simpleSegment(a,f,A,D,Y,O,V,te);f+=Ee}if(this.dash)for(var Ze=0;Ze<a.positions.length/6;Ze++)a.positions[Ze*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,g,x){var C=0,A=r.indices,O=r.positions,D=r.normals,V=this.cap==="square",Y=this.join==="bevel",te=w([g[0],g[1]]),Ee=w([v[0],v[1]]);Cd(Xs,s,a);var Ze=0;if(this.dash&&(Ze=this.lineSegmentDistance(te,Ee),this.totalDistance+=Ze),this.normal||(this.normal=gi.Ue(),ip(this.normal,Xs)),!this.started)if(this.started=!0,V){var Je=gi.Ue(),lt=gi.Ue();gi.IH(Je,this.normal,Xs),gi.IH(lt,this.normal,Xs),D.push(lt[0],lt[1],0),D.push(Je[0],Je[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ze,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ze,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,a,this.normal,this.thickness,this.totalDistance-Ze);if(A.push(n+0,n+1,n+2),f){G0(s,f)&&gi.IH(f,s,gi.Fv(f,gi.$X(f,s,a))),Cd(np,f,s);var Kt=V0(Sd,gi.Ue(),Xs,np,this.thickness),ur=(0,Q.Z)(Kt,2),Ir=ur[0],Xr=ur[1],yr=gi.AK(Sd,this.normal)<0?-1:1,sn=Y;if(!sn&&this.join==="miter"){var Rn=Ir;Rn>this.miterLimit&&(sn=!0)}sn?(D.push(this.normal[0],this.normal[1],0),D.push(Xr[0],Xr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,nr.Z)(this.lastFlip!==-yr?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),ip(Qv,np),gi.JG(this.normal,Qv),D.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,D,s,Xr,Ir,this.totalDistance),A.push.apply(A,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),yr=-1,gi.JG(this.normal,Xr),C+=2),this.lastFlip=yr}else{if(ip(this.normal,Xs),V){var Et=gi.Ue(),xt=gi.Ue();gi.lu(xt,Xs,this.normal),gi.IH(Et,Xs,this.normal),D.push(xt[0],xt[1],0),D.push(Et[0],Et[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,s,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,A=w([s[0],s[1]]),O=w([a[0],a[1]]);Cd(Xs,A,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(A,O),this.totalDistance+=D),this.normal||(this.normal=gi.Ue(),ip(this.normal,Xs)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-D)),g.push(n+0,n+1,n+2),!f)ip(this.normal,Xs),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var V=w([f[0],f[1]]);G0(A,V)&&gi.IH(V,A,gi.Fv(V,gi.$X(V,A,O))),Cd(np,V,A);var Y=V0(Sd,gi.Ue(),Xs,np,this.thickness),te=(0,Q.Z)(Y,2),Ee=te[0],Ze=te[1],Je=gi.AK(Sd,this.normal)<0?-1:1;this.extrusions(x,C,s,Ze,Ee,this.totalDistance),g.push.apply(g,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Je=-1,gi.JG(this.normal,Ze),v+=2,this.lastFlip=Je}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,A=this.cap==="square",O=this.join==="bevel",D=w([s[0],s[1]]),V=w([a[0],a[1]]);Cd(Xs,D,V);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(D,V),this.totalDistance+=Y),this.normal||(this.normal=gi.Ue(),ip(this.normal,Xs)),!this.started)if(this.started=!0,A){var te=gi.Ue(),Ee=gi.Ue();gi.IH(te,this.normal,Xs),gi.IH(Ee,this.normal,Xs),C.push(Ee[0],Ee[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-Y);if(g.push(n+0,n+1,n+2),f){var lt=w([f[0],f[1]]);G0(D,lt)&&gi.IH(lt,D,gi.Fv(lt,gi.$X(lt,D,V))),Cd(np,lt,D);var Et=V0(Sd,gi.Ue(),Xs,np,this.thickness),xt=(0,Q.Z)(Et,2),Kt=xt[0],ur=xt[1],Ir=gi.AK(Sd,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var yr=Kt;yr>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(ur[0],ur[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,nr.Z)(this.lastFlip!==-Ir?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),ip(Qv,np),gi.JG(this.normal,Qv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,ur,Kt,this.totalDistance),g.push.apply(g,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ir=-1,gi.JG(this.normal,ur),v+=2),this.lastFlip=Ir}else{if(ip(this.normal,Xs),A){var Ze=gi.Ue(),Je=gi.Ue();gi.lu(Je,Xs,this.normal),gi.IH(Ze,Xs,this.normal),C.push(Je[0],Je[1],0),C.push(Ze[0],Ze[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,nr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Bp(e){if(Wu()(e[0]))return e;if(Wu()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Wu()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function hS(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,f+=C,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ha=N(77160);function pS(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=jf().flatten(e),s=a.vertices,f=a.dimensions,v=[],g=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=jf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,nr.Z)(C));for(var A=function(V){var Y=a.vertices.slice(V*f,(V+1)*f),te=a.vertices.slice((V+1)*f,(V+2)*f);te.length===0&&(te=a.vertices.slice(0,f));var Ee=v.length/3;v.push(Y[0],Y[1],1,te[0],te[1],1,Y[0],Y[1],0,te[0],te[1],0),g.push.apply(g,(0,nr.Z)([0,2,1,2,3,1].map(function(Ze){return Ze+Ee})))},O=0;O<n;O++)A(O);return{positions:v,index:g}}function dS(e){var i=jf().flatten(e),r=jf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function gy(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=jf().flatten(e),f=s.vertices,v=s.dimensions,g=[],x=[],C=[],A=0;A<f.length/v;A++)v===2?g.push(f[A*2],f[A*2+1],1,-1,-1):g.push(f[A*3],f[A*3+1],1,-1,-1),C.push(0,0,1);var O=jf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,nr.Z)(O));for(var D=function(te){var Ee=s.vertices.slice(te*v,(te+1)*v),Ze=s.vertices.slice((te+1)*v,(te+2)*v);Ze.length===0&&(Ze=s.vertices.slice(0,v));var Je=g.length/5;g.push(Ee[0],Ee[1],1,0,0,Ze[0],Ze[1],1,.1,0,Ee[0],Ee[1],0,0,.8,Ze[0],Ze[1],0,.1,.8);var lt=vS([Ze[0],Ze[1],1],[Ee[0],Ee[1],0],[Ee[0],Ee[1],1],i);C.push.apply(C,(0,nr.Z)(lt).concat((0,nr.Z)(lt),(0,nr.Z)(lt),(0,nr.Z)(lt))),x.push.apply(x,(0,nr.Z)([1,2,0,3,2,1].map(function(Et){return Et+Je})))},V=0;V<a;V++)D(V);return{positions:g,index:x,normals:C}}function vS(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ha.create(),s=Ha.create(),f=Ha.create();n&&(e=l(e),i=l(i),r=l(r));var v=Ha.fromValues.apply(Ha,(0,nr.Z)(e)),g=Ha.fromValues.apply(Ha,(0,nr.Z)(i)),x=Ha.fromValues.apply(Ha,(0,nr.Z)(r));Ha.sub(a,x,g),Ha.sub(s,v,g),Ha.cross(f,a,s);var C=Ha.create();return Ha.normalize(C,f),C}var Cc,Np;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Np||(Np={}));var zp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(zp||(zp={}));function sv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),g=Math.cos(f+Math.PI/4);return[v,g,0]});return s}function yy(){return sv(30)}function _y(){return sv(4)}function xy(){return sv(3)}function by(){return sv(6,1)}function Ey(){return sv(5)}var Ad=(Cc={},(0,I.Z)(Cc,zp.CIRCLE,yy),(0,I.Z)(Cc,zp.HEXAGON,by),(0,I.Z)(Cc,zp.TRIANGLE,xy),(0,I.Z)(Cc,zp.SQUARE,_y),(0,I.Z)(Cc,zp.PENTAGON,Ey),(0,I.Z)(Cc,Np.CYLINDER,yy),(0,I.Z)(Cc,Np.HEXAGONCOLUMN,by),(0,I.Z)(Cc,Np.TRIANGLECOLUMN,xy),(0,I.Z)(Cc,Np.SQUARECOLUMN,_y),(0,I.Z)(Cc,Np.PENTAGONCOLUMN,Ey),Cc),Jv={};function Up(e){var i=Bp(e.coordinates);return{vertices:[].concat((0,nr.Z)(i),(0,nr.Z)(i),(0,nr.Z)(i),(0,nr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Sy(e){var i=Bp(e.coordinates),r=dy(i);return{vertices:[].concat((0,nr.Z)(r),(0,nr.Z)(r),(0,nr.Z)(r),(0,nr.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Cy(e){var i=e.shape,r=_S(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Ay(e){var i=Bp(e.coordinates);return{vertices:(0,nr.Z)(i),indices:[0],size:i.length}}function uv(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new vy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var A=a.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function mS(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new vy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var A=a.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,size:6}}function e0(e){var i=e.coordinates,r=jf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:jf()(n,s,a),vertices:n,size:a}}function gS(e){var i=e.coordinates,r=jf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:jf()(n,s,a),vertices:yS(n),size:a+4}}function yS(e){for(var i=[],r=hS(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,nr.Z)(n),[a]))}return i}function wy(e){var i=e.coordinates,r=gy(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Ty(e){var i=e.shape,r=bS(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function My(e){var i=e.coordinates,r=[].concat((0,nr.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,nr.Z)(i[1]),[0,1,0],(0,nr.Z)(i[0]),[0,0,1],(0,nr.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function t0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,nr.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function Py(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=r0(-1,1),a=r0(1,1),s=r0(-1,-1),f=r0(1,-1),v=[].concat((0,nr.Z)(i),(0,nr.Z)(n),(0,nr.Z)(i),(0,nr.Z)(s),(0,nr.Z)(i),(0,nr.Z)(f),(0,nr.Z)(i),(0,nr.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function _S(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Jv&&Jv[e])return Jv[e];var r=Ad[e]?Ad[e]():Ad.cylinder(),n=gy([r],i);return Jv[e]=n,n}function V4(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),A=0,O=i.length;A<O;A+=3){s=i[A+0]*3,f=i[A+1]*3,v=i[A+2]*3;var D=[e[s],e[s+1]],V=[e[f],e[f+1]],Y=[e[v],e[v+1]];n&&(D=lngLatToMeters(D),V=lngLatToMeters(V),Y=lngLatToMeters(Y));var te=D,Ee=_slicedToArray(te,2),Ze=Ee[0],Je=Ee[1],lt=vec3.fromValues(Ze,Je,e[s+2]),Et=V,xt=_slicedToArray(Et,2),Kt=xt[0],ur=xt[1],Ir=vec3.fromValues(Kt,ur,e[f+2]),Xr=Y,yr=_slicedToArray(Xr,2),sn=yr[0],Rn=yr[1],Un=vec3.fromValues(sn,Rn,e[v+2]);vec3.sub(g,Un,Ir),vec3.sub(x,lt,Ir),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[f]+=g[0],a[f+1]+=g[1],a[f+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return xS(a),a}function xS(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function G4(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function bS(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Ad[e]?Ad[e]():Ad.circle(),n=i.indexOf(e)===-1?dS([r]):pS([r]);return n}function r0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function H4(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function W4(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function ES(e){var i=SS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function SS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CS=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,AS=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,wS=function(e){(0,Yr.Z)(r,e);var i=ES(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:Wu()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:AS,fragmentShader:CS,triangulation:e0,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:W.ALWAYS,ref:1,mask:255},opFront:{fail:W.REPLACE,zfail:W.REPLACE,zpass:W.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(lo),TS={fill:wS},MS=TS;function PS(e){var i=IS();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OS=function(e){(0,Yr.Z)(r,e);var i=PS(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","MaskLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new MS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(rp),RS=N(88307),LS=N.n(RS),kS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,St.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),_h,lv,xh,Ac,cv,ap,fv,n0,Vf,Zp,Iu,Gf,Hf,i0,DS=(_h={},(0,I.Z)(_h,W.POINTS,"points"),(0,I.Z)(_h,W.LINES,"lines"),(0,I.Z)(_h,W.LINE_LOOP,"line loop"),(0,I.Z)(_h,W.LINE_STRIP,"line strip"),(0,I.Z)(_h,W.TRIANGLES,"triangles"),(0,I.Z)(_h,W.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(_h,W.TRIANGLE_STRIP,"triangle strip"),_h),Iy=(lv={},(0,I.Z)(lv,W.STATIC_DRAW,"static"),(0,I.Z)(lv,W.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(lv,W.STREAM_DRAW,"stream"),lv),H0=(xh={},(0,I.Z)(xh,W.BYTE,"int8"),(0,I.Z)(xh,W.UNSIGNED_INT,"int16"),(0,I.Z)(xh,W.INT,"int32"),(0,I.Z)(xh,W.UNSIGNED_BYTE,"uint8"),(0,I.Z)(xh,W.UNSIGNED_SHORT,"uint16"),(0,I.Z)(xh,W.UNSIGNED_INT,"uint32"),(0,I.Z)(xh,W.FLOAT,"float"),xh),FS=(Ac={},(0,I.Z)(Ac,W.ALPHA,"alpha"),(0,I.Z)(Ac,W.LUMINANCE,"luminance"),(0,I.Z)(Ac,W.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(Ac,W.RGB,"rgb"),(0,I.Z)(Ac,W.RGBA,"rgba"),(0,I.Z)(Ac,W.RGBA4,"rgba4"),(0,I.Z)(Ac,W.RGB5_A1,"rgb5 a1"),(0,I.Z)(Ac,W.RGB565,"rgb565"),(0,I.Z)(Ac,W.DEPTH_COMPONENT,"depth"),(0,I.Z)(Ac,W.DEPTH_STENCIL,"depth stencil"),Ac),BS=(cv={},(0,I.Z)(cv,W.DONT_CARE,"dont care"),(0,I.Z)(cv,W.NICEST,"nice"),(0,I.Z)(cv,W.FASTEST,"fast"),cv),Oy=(ap={},(0,I.Z)(ap,W.NEAREST,"nearest"),(0,I.Z)(ap,W.LINEAR,"linear"),(0,I.Z)(ap,W.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(ap,W.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(ap,W.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(ap,W.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ap),Ry=(fv={},(0,I.Z)(fv,W.REPEAT,"repeat"),(0,I.Z)(fv,W.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(fv,W.MIRRORED_REPEAT,"mirror"),fv),NS=(n0={},(0,I.Z)(n0,W.NONE,"none"),(0,I.Z)(n0,W.BROWSER_DEFAULT_WEBGL,"browser"),n0),zS=(Vf={},(0,I.Z)(Vf,W.NEVER,"never"),(0,I.Z)(Vf,W.ALWAYS,"always"),(0,I.Z)(Vf,W.LESS,"less"),(0,I.Z)(Vf,W.LEQUAL,"lequal"),(0,I.Z)(Vf,W.GREATER,"greater"),(0,I.Z)(Vf,W.GEQUAL,"gequal"),(0,I.Z)(Vf,W.EQUAL,"equal"),(0,I.Z)(Vf,W.NOTEQUAL,"notequal"),Vf),Ly=(Zp={},(0,I.Z)(Zp,W.FUNC_ADD,"add"),(0,I.Z)(Zp,W.MIN_EXT,"min"),(0,I.Z)(Zp,W.MAX_EXT,"max"),(0,I.Z)(Zp,W.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Zp,W.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Zp),a0=(Iu={},(0,I.Z)(Iu,W.ZERO,"zero"),(0,I.Z)(Iu,W.ONE,"one"),(0,I.Z)(Iu,W.SRC_COLOR,"src color"),(0,I.Z)(Iu,W.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Iu,W.SRC_ALPHA,"src alpha"),(0,I.Z)(Iu,W.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Iu,W.DST_COLOR,"dst color"),(0,I.Z)(Iu,W.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Iu,W.DST_ALPHA,"dst alpha"),(0,I.Z)(Iu,W.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Iu,W.CONSTANT_COLOR,"constant color"),(0,I.Z)(Iu,W.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Iu,W.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Iu,W.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Iu,W.SRC_ALPHA_SATURATE,"src alpha saturate"),Iu),US=(Gf={},(0,I.Z)(Gf,W.NEVER,"never"),(0,I.Z)(Gf,W.ALWAYS,"always"),(0,I.Z)(Gf,W.LESS,"less"),(0,I.Z)(Gf,W.LEQUAL,"lequal"),(0,I.Z)(Gf,W.GREATER,"greater"),(0,I.Z)(Gf,W.GEQUAL,"gequal"),(0,I.Z)(Gf,W.EQUAL,"equal"),(0,I.Z)(Gf,W.NOTEQUAL,"notequal"),Gf),wd=(Hf={},(0,I.Z)(Hf,W.ZERO,"zero"),(0,I.Z)(Hf,W.KEEP,"keep"),(0,I.Z)(Hf,W.REPLACE,"replace"),(0,I.Z)(Hf,W.INVERT,"invert"),(0,I.Z)(Hf,W.INCR,"increment"),(0,I.Z)(Hf,W.DECR,"decrement"),(0,I.Z)(Hf,W.INCR_WRAP,"increment wrap"),(0,I.Z)(Hf,W.DECR_WRAP,"decrement wrap"),Hf),ZS=(i0={},(0,I.Z)(i0,W.FRONT,"front"),(0,I.Z)(i0,W.BACK,"back"),i0),jS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Iy[a||W.STATIC_DRAW],type:H0[s||W.UNSIGNED_BYTE]})}return(0,St.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),VS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:Iy[a||W.STATIC_DRAW],type:H0[s||W.UNSIGNED_BYTE],count:f})}return(0,St.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),GS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,St.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),HS=N(36719),WS=N.n(HS),XS=N(68630),YS=N.n(XS);function ky(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ky(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ky(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,A=r.blend,O=r.stencil,D=r.cull,V=r.instances,Y={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function(Je){Y[Je]=i.prop(Je)}));var te={};Object.keys(s).forEach(function(Je){te[Je]=s[Je].get()});var Ee={attributes:te,frag:a,uniforms:Y,vert:n,blend:{},primitive:DS[v===void 0?W.TRIANGLES:v]};V&&(Ee.instances=V),g&&(Ee.count=g),x&&(Ee.elements=x.get()),this.initDepthDrawParams({depth:C},Ee),this.initBlendDrawParams({blend:A},Ee),this.initStencilDrawParams({stencil:O},Ee),this.initCullDrawParams({cull:D},Ee),this.drawCommand=i(Ee);var Ze=jc()(Ee);Ze.blend=wc(wc({},Ze.blend),{},{enable:!1}),this.drawPickCommand=i(Ze),this.drawParams=Ee}return(0,St.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=jc()(this.drawParams);s.blend=wc(wc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=jc()(this.drawParams);a.blend=wc(wc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=wc(wc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=wc(wc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,Ch.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:zS[a.func||W.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:a0[f&&f.srcRGB||W.SRC_ALPHA],srcAlpha:a0[f&&f.srcAlpha||W.SRC_ALPHA],dstRGB:a0[f&&f.dstRGB||W.ONE_MINUS_SRC_ALPHA],dstAlpha:a0[f&&f.dstAlpha||W.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ly[v&&v.rgb||W.FUNC_ADD],alpha:Ly[v&&v.alpha||W.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,g=a.func,x=g===void 0?{cmp:W.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,A=C===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:C,O=a.opBack,D=O===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:O;n.stencil={enable:!!s,mask:v,func:wc(wc({},x),{},{cmp:US[x.cmp]}),opFront:{fail:wd[A.fail],zfail:wd[A.zfail],zpass:wd[A.zpass]},opBack:{fail:wd[D.fail],zfail:wd[D.zfail],zpass:wd[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?W.BACK:f;n.cull={enable:!!s,face:ZS[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||WS()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}YS()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),KS=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?W.UNSIGNED_BYTE:a,f=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,A=C===void 0?W.RGBA:C,O=r.mipmap,D=O===void 0?!1:O,V=r.wrapS,Y=V===void 0?W.CLAMP_TO_EDGE:V,te=r.wrapT,Ee=te===void 0?W.CLAMP_TO_EDGE:te,Ze=r.aniso,Je=Ze===void 0?0:Ze,lt=r.alignment,Et=lt===void 0?1:lt,xt=r.premultiplyAlpha,Kt=xt===void 0?!1:xt,ur=r.mag,Ir=ur===void 0?W.NEAREST:ur,Xr=r.min,yr=Xr===void 0?W.NEAREST:Xr,sn=r.colorSpace,Rn=sn===void 0?W.BROWSER_DEFAULT_WEBGL:sn,Un=r.x,Da=Un===void 0?0:Un,So=r.y,As=So===void 0?0:So,iu=r.copy,Ls=iu===void 0?!1:iu;this.width=f,this.height=v;var Pc={width:f,height:v,type:H0[s],format:FS[A],wrapS:Ry[Y],wrapT:Ry[Ee],mag:Oy[Ir],min:Oy[yr],alignment:Et,flipY:x,colorSpace:NS[Rn],premultiplyAlpha:Kt,aniso:Je,x:Da,y:As,copy:Ls};n&&(Pc.data=n),typeof D=="number"?Pc.mipmap=BS[D]:typeof D=="boolean"&&(Pc.mipmap=D),this.texture=i.texture(Pc)}return(0,St.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Dy,Fy,$S=(Dy=(0,Ye.b2)(),Dy(Fy=function(){function e(){var i=this;(0,ut.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new qS(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new kS(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new jS(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new VS(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new KS(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new GS(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,g={x:a,y:s,width:f,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(mo)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,St.Z)(e,[{key:"init",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(a,s){var f=this;return Xn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){LS()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,D){(O||!D)&&C(O),x(D)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Fy);function By(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ny(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?By(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):By(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var QS=function(){function e(i){(0,ut.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=lE();this.container=f,n.setContainer(f,r,a,s),f.bind(De.IRendererService).to($S).inSingletonScope(),this.sceneService=f.get(De.ISceneService),this.mapService=f.get(De.IMapService),this.iconService=f.get(De.IIconService),this.fontService=f.get(De.IFontService),this.controlService=f.get(De.IControlService),this.layerService=f.get(De.ILayerService),this.markerService=f.get(De.IMarkerService),this.interactionService=f.get(De.IInteractionService),this.popupService=f.get(De.IPopupService),mo?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,St.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=ov(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&f){var A=new OS().source(f).shape("fill").color(g).style({opacity:C});this.addMask(A,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=ov(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,Q.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){mo?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){U0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){U0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){U0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||Ny(Ny({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(De.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ks(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new PE({position:a}))}}]),e}();function JS(e){var i=eC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,rC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,nC=function(e){(0,Yr.Z)(r,e);var i=JS(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"cityCenter",void 0),(0,I.Z)((0,oe.Z)(n),"cityMinSize",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,A=a.windowColor,O=A===void 0?"rgb(30,60,89)":A,D=a.time,V=D===void 0?0:D,Y=a.sweep,te=Y===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Y;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:lr(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:f,u_baseColor:lr(g),u_brightColor:lr(C),u_windowColor:lr(O),u_time:this.layer.getLayerAnimateTime()||V}}},{key:"calCityGeo",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+f)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var A=v-s,O=g-f;this.cityCenter=[(v+s)/2,(g+f)/2],this.cityMinSize=Math.sqrt(Math.pow(A,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:rC,fragmentShader:tC,triangulation:wy,cull:{enable:!0,face:W.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(lo);function iC(e){var i=aC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=function(e){(0,Yr.Z)(r,e);var i=iC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","PolygonLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new nC(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(rp);function sC(e){var i=uC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lC=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,cC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,fC=function(e){(0,Yr.Z)(r,e);var i=sC(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:lC,fragmentShader:cC,triangulation:Ty,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(lo);function hC(e){var i=pC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,vC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,mC=function(e){(0,Yr.Z)(r,e);var i=hC(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:dC,fragmentShader:vC,triangulation:Cy,depth:{enable:!0},blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(lo);function gC(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,g=i/2,x=0;x<f;x++)for(var C=x-g,A=0;A<s;A++){var O=A-v;n.push(O/v,-C/g,0),a.push(A/e),a.push(1-x/i)}for(var D=0;D<i;D++)for(var V=0;V<e;V++){var Y=V+s*D,te=V+s*(D+1),Ee=V+1+s*(D+1),Ze=V+1+s*D;r.push(Y,te,Ze),r.push(te,Ee,Ze)}return{vertices:n,indices:r,uvs:a}}var zy,Uy;function Zy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yC(e){var i=_C();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,bC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,EC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,SC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,CC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,AC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Vy=(zy=(0,Ye.b2)(),zy(Uy=function(e){(0,Yr.Z)(r,e);var i=yC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"colorTexture",void 0),(0,I.Z)((0,oe.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,oe.Z)(n),"intensityModel",void 0),(0,I.Z)((0,oe.Z)(n),"colorModel",void 0),(0,I.Z)((0,oe.Z)(n),"shapeType",void 0),n}return(0,St.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,A=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(A==null||(a=A.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=g(),V=D.width,Y=D.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(V/4),height:Math.floor(Y/4),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Tn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Py,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:AC,fragmentShader:CC,triangulation:Py,depth:{enable:!1},cull:{enable:!0,face:ti(this.mapService.version)},blend:{enable:!0,func:{srcRGB:W.ONE,srcAlpha:1,dstRGB:W.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:SC,fs:EC});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,A=x.fs,O=x.uniforms,D=this.rendererService,V=D.createAttribute,Y=D.createElements,te=D.createBuffer,Ee=D.createModel;return Ee({vs:C,fs:A,attributes:{a_Position:V({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:W.FLOAT}),size:3}),a_Uv:V({buffer:te({data:[0,1,1,1,0,0,1,0],type:W.FLOAT}),size:2})},uniforms:jy({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Y({data:[0,2,1,2,3,1],type:W.UNSIGNED_INT,count:6}),stencil:wr(f,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=mi();cn(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,nr.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),A=C.width,O=C.height,D=gC(A/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:bC,fs:xC});var V=this.shaderModuleService.getModule("heatmap3dColor"),Y=V.vs,te=V.fs,Ee=V.uniforms,Ze=this.rendererService,Je=Ze.createAttribute,lt=Ze.createElements,Et=Ze.createBuffer,xt=Ze.createModel;return xt({vs:Y,fs:te,attributes:{a_Position:Je({buffer:Et({data:D.vertices,type:W.FLOAT}),size:3}),a_Uv:Je({buffer:Et({data:D.uvs,type:W.FLOAT}),size:2})},primitive:W.TRIANGLES,uniforms:jy({},Ee),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:W.SRC_ALPHA,srcAlpha:1,dstRGB:W.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:lt({data:D.indices,type:W.UNSIGNED_INT,count:D.indices.length}),stencil:wr(f,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=Ln(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}}]),r}(lo))||Uy);function wC(e){var i=TC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,IC=function(e){(0,Yr.Z)(r,e);var i=wC(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:PC,fragmentShader:MC,triangulation:Ty,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(lo),OC={heatmap:Vy,heatmap3d:Vy,grid:fC,grid3d:mC,hexagon:IC},RC=OC;function LC(e){var i=kC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=function(e){(0,Yr.Z)(r,e);var i=LC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","HeatMapLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new RC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(rp);function FC(e){var i=BC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,zC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,UC=function(e){(0,Yr.Z)(r,e);var i=FC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),A=this.rendererService.createTexture2D;if(this.texture=A({height:0,width:0}),mo){var O=this.layerService.sceneService.getSceneConfig().canvas,D=O.createImage();D.crossOrigin="anonymous",D.src=C.data.originData,D.onload=function(){a.texture=A({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(V){a.texture=A({data:V[0],width:V[0].width,height:V[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:zC,fragmentShader:NC,triangulation:My,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:wr(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}}]),r}(lo),ZC={image:UC},jC=ZC;function VC(e){var i=GC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gy=function(e){(0,Yr.Z)(r,e);var i=VC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","ImageLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new jC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(rp);function HC(e){var i=WC();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,YC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,qC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,KC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,$C=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,QC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,JC={solid:0,dash:1},eA=function(e){(0,Yr.Z)(r,e);var i=HC(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,V=D===void 0?[10,5]:D,Y=a.forward,te=Y===void 0?!0:Y,Ee=a.lineTexture,Ze=Ee===void 0?!1:Ee,Je=a.iconStep,lt=Je===void 0?100:Je,Et=a.segmentNumber,xt=Et===void 0?30:Et,Kt=a.thetaOffset,ur=Kt===void 0?.314:Kt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,thetaOffset:ur})){this.judgeStyleAttributes({opacity:f,thetaOffset:ur});var Ir=this.layer.getEncodedData(),Xr=this.calDataFrame(this.cellLength,Ir,this.cellProperties),yr=Xr.data,sn=Xr.width,Rn=Xr.height;this.rowCount=Rn,this.dataTexture=this.cellLength>0&&yr.length>0?this.createTexture2D({flipY:!0,data:yr,format:W.LUMINANCE,type:W.FLOAT,width:sn,height:Rn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}V.length===2&&V.push(0,0);var Un=0,Da=[0,0,0,0],So=[0,0,0,0];return v&&g&&(Da=lr(v),So=lr(g),Un=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Number(ur),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:xt,u_line_type:JC[O||"solid"],u_dash_array:V,u_blur:.9,u_lineDir:te?1:-1,u_texture:this.texture,u_line_texture:Ze?1:0,u_icon_step:lt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Un,u_sourceColor:Da,u_targetColor:So}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:XC,vert:YC,type:"dash"}:s&&f?{frag:$C,vert:QC,type:"linear"}:{frag:qC,vert:KC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,A=this.getShaders(),O=A.frag,D=A.vert,V=A.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+V,vertexShader:D,fragmentShader:O,triangulation:t0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:wr(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo);function tA(e){var i=rA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,iA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,aA=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,oA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,sA={solid:0,dash:1},uA=function(e){(0,Yr.Z)(r,e);var i=tA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,V=D===void 0?[10,5]:D,Y=a.lineTexture,te=Y===void 0?!1:Y,Ee=a.iconStep,Ze=Ee===void 0?100:Ee,Je=a.segmentNumber,lt=Je===void 0?30:Je,Et=a.globalArcHeight,xt=Et===void 0?10:Et;V.length===2&&V.push(0,0);var Kt=0,ur=[0,0,0,0],Ir=[0,0,0,0];if(v&&g&&(ur=lr(v),Ir=lr(g),Kt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Xr=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xr,this.cellProperties),sn=yr.data,Rn=yr.width,Un=yr.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&sn.length>0?this.createTexture2D({flipY:!0,data:sn,format:W.LUMINANCE,type:W.FLOAT,width:Rn,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:hy,u_global_height:xt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:lt,u_line_type:sA[O]||0,u_dash_array:V,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ze,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Kt,u_sourceColor:ur,u_targetColor:Ir}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:aA,vert:oA,type:"linear"}:{frag:nA,vert:iA,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,A=this.getShaders(),O=A.frag,D=A.vert,V=A.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+V,vertexShader:D,fragmentShader:O,triangulation:t0,blend:this.getBlend(),segmentNumber:f,stencil:wr(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo);function lA(e){var i=cA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fA=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,hA=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,pA=function(e){(0,Yr.Z)(r,e);var i=lA(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.forward,C=x===void 0?!0:x,A=a.segmentNumber,O=A===void 0?30:A,D=a.thetaOffset,V=D===void 0?.314:D,Y=0,te=[0,0,0,0],Ee=[0,0,0,0];return v&&g&&(te=lr(v),Ee=lr(g),Y=1),{u_thetaOffset:V,u_opacity:Number(f),segmentNumber:O,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:Y,u_sourceColor:te,u_targetColor:Ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:hA,fragmentShader:fA,triangulation:t0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,f,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(lo);function dA(e){var i=vA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,gA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,yA={solid:0,dash:1},_A=function(e){(0,Yr.Z)(r,e);var i=dA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,V=D===void 0?[10,5]:D,Y=a.lineTexture,te=Y===void 0?!1:Y,Ee=a.iconStep,Ze=Ee===void 0?100:Ee,Je=a.segmentNumber,lt=Je===void 0?30:Je;V.length===2&&V.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Et=0,xt=[0,0,0,0],Kt=[0,0,0,0];if(v&&g&&(xt=lr(v),Kt=lr(g),Et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var ur=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,ur,this.cellProperties),Xr=Ir.data,yr=Ir.width,sn=Ir.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:W.LUMINANCE,type:W.FLOAT,width:yr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:lt,u_line_type:yA[O]||0,u_dash_array:V,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ze,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Et,u_sourceColor:xt,u_targetColor:Kt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:gA,fragmentShader:mA,triangulation:t0,depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo);function xA(e){var i=bA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function bA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EA=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,SA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,CA=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Hy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,AA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,wA={solid:0,dash:1},Wy=function(e){(0,Yr.Z)(r,e);var i=xA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.lineType,O=A===void 0?"solid":A,D=a.dashArray,V=D===void 0?[10,5,0,0]:D,Y=a.lineTexture,te=Y===void 0?!1:Y,Ee=a.iconStep,Ze=Ee===void 0?100:Ee,Je=a.vertexHeightScale,lt=Je===void 0?20:Je,Et=a.borderWidth,xt=Et===void 0?0:Et,Kt=a.borderColor,ur=Kt===void 0?"#ccc":Kt,Ir=a.raisingHeight,Xr=Ir===void 0?0:Ir,yr=a.heightfixed,sn=yr===void 0?!1:yr,Rn=a.arrow,Un=Rn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Rn;V.length===2&&V.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Da=0,So=[0,0,0,0],As=[0,0,0,0];if(v&&g&&(So=lr(v),As=lr(g),Da=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var iu=this.layer.getEncodedData(),Ls=this.calDataFrame(this.cellLength,iu,this.cellProperties),Pc=Ls.data,Sm=Ls.width,L0=Ls.height;this.rowCount=L0,this.dataTexture=this.cellLength>0&&Pc.length>0?this.createTexture2D({flipY:!0,data:Pc,format:W.LUMINANCE,type:W.FLOAT,width:Sm,height:L0}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_line_type:wA[O],u_dash_array:V,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ze,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:xt,u_borderColor:lr(ur),u_linearColor:Da,u_sourceColor:So,u_targetColor:As,u_heightfixed:Number(sn),u_vertexScale:lt,u_raisingHeight:Number(Xr),u_arrow:Number(Un.enable),u_arrowHeight:Un.arrowHeight||3,u_arrowWidth:Un.arrowWidth||2,u_tailWidth:Un.tailWidth===void 0?1:Un.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,A=this.getShaders(),O=A.frag,D=A.vert,V=A.type;return this.layer.triangulation=uv,[this.layer.buildLayerModel({moduleName:"line_"+V,vertexShader:D,fragmentShader:O,triangulation:uv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:wr(f,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:EA,vert:SA,type:"dash"}:s&&f?{frag:AA,vert:Hy,type:"linear"}:{frag:CA,vert:Hy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x,C,A){return A===void 0?[g[3],10]:[g[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo);function TA(e){var i=MA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PA=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,IA=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OA=function(e){(0,Yr.Z)(r,e);var i=TA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"colorTexture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=Ln(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.vertexHeightScale,g=v===void 0?20:v,x=a.raisingHeight,C=x===void 0?0:x,A=a.heightfixed,O=A===void 0?!1:A;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var D=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,D,this.cellProperties),Y=V.data,te=V.width,Ee=V.height;this.rowCount=Ee,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:W.LUMINANCE,type:W.FLOAT,width:te,height:Ee}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:g,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,A=this.getShaders(),O=A.frag,D=A.vert,V=A.type;return this.layer.triangulation=uv,[this.layer.buildLayerModel({moduleName:"line_"+V,vertexShader:D,fragmentShader:O,triangulation:uv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:wr(f,g)})]}},{key:"getShaders",value:function(){return{frag:PA,vert:IA,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(lo);function RA(e){var i=LA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,DA=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Xy=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,FA=function(e){(0,Yr.Z)(r,e);var i=RA(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.vertexHeightScale,C=x===void 0?20:x,A=0,O=[0,0,0,0],D=[0,0,0,0];if(v&&g&&(O=lr(v),D=lr(g),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var V=this.layer.getEncodedData(),Y=this.calDataFrame(this.cellLength,V,this.cellProperties),te=Y.data,Ee=Y.width,Ze=Y.height;this.rowCount=Ze,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:W.LUMINANCE,type:W.FLOAT,width:Ee,height:Ze}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_linearColor:A,u_sourceColor:O,u_targetColor:D,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:kA,vert:Xy,type:"simple_linear"}:{frag:DA,vert:Xy,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:mS,primitive:W.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Tn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(lo);function BA(e){var i=NA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,UA=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ZA=function(e){(0,Yr.Z)(r,e);var i=BA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,A=a.heightfixed,O=A===void 0?!1:A,D=a.lineTexture,V=D===void 0?!1:D,Y=a.iconStep,te=Y===void 0?100:Y,Ee=a.iconStepCount,Ze=Ee===void 0?1:Ee;this.rendererService.getDirty()&&this.texture.bind();var Je=0,lt=[0,0,0,0],Et=[0,0,0,0];if(v&&g&&(lt=lr(v),Et=lr(g),Je=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var xt=this.layer.getEncodedData(),Kt=this.calDataFrame(this.cellLength,xt,this.cellProperties),ur=Kt.data,Ir=Kt.width,Xr=Kt.height;this.rowCount=Xr,this.dataTexture=this.cellLength>0&&ur.length>0?this.createTexture2D({flipY:!0,data:ur,format:W.LUMINANCE,type:W.FLOAT,width:Ir,height:Xr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:V?1:0,u_iconStepCount:Ze,u_icon_step:te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Je,u_sourceColor:lt,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:UA,fragmentShader:zA,triangulation:uv,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Tn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,A=C===void 0?1:C;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.texture,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo),jA={arc:eA,arcmini:pA,arc3d:uA,greatcircle:_A,wall:ZA,line:Wy,simple:FA,linearline:OA},VA=jA;function GA(e){var i=HA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function HA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yy=function(e){(0,Yr.Z)(r,e);var i=GA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","LineLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new VA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(rp);function WA(e){var i=XA();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,qA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,qy=function(e){(0,Yr.Z)(r,e);var i=WA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"raiseCount",0),(0,I.Z)((0,oe.Z)(n),"raiserepeat",0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,A=a.pickLight,O=A===void 0?!1:A,D=a.heightfixed,V=D===void 0?!1:D,Y=a.opacityLinear,te=Y===void 0?{enable:!1,dir:"up"}:Y,Ee=a.lightEnable,Ze=Ee===void 0?!0:Ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var Je=this.layer.getEncodedData(),lt=this.calDataFrame(this.cellLength,Je,this.cellProperties),Et=lt.data,xt=lt.width,Kt=lt.height;this.rowCount=Kt,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:W.LUMINANCE,type:W.FLOAT,width:xt,height:Kt}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var ur=0,Ir=[0,0,0,0],Xr=[0,0,0,0];if(x&&C&&(Ir=lr(x),Xr=lr(C),ur=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var yr=f.speed,sn=yr===void 0?.01:yr,Rn=f.repeat,Un=Rn===void 0?!1:Rn;this.raiseCount+=sn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(V),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(g),u_linearColor:ur,u_sourceColor:Ir,u_targetColor:Xr,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Ze)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:qA,fragmentShader:YA,triangulation:Cy,blend:this.getBlend(),cull:{enable:!0,face:ti(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x){var C=f.size;if(C){var A=[];return Array.isArray(C)&&(A=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(A=[C,C,C]),A}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v){var g=Bp(f.coordinates);return a?dy([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(lo);function KA(e){var i=$A();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ky=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,$y=function(e){(0,Yr.Z)(r,e);var i=KA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"meter2coord",1),(0,I.Z)((0,oe.Z)(n),"isMeter",!1),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,A=a.stroke,O=A===void 0?"rgba(0,0,0,0)":A,D=a.offsets,V=D===void 0?[0,0]:D,Y=a.blend,te=a.blur,Ee=te===void 0?0:te,Ze=a.raisingHeight,Je=Ze===void 0?0:Ze;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:V})){this.judgeStyleAttributes({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:V});var lt=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,lt,this.cellProperties),xt=Et.data,Kt=Et.width,ur=Et.height;this.rowCount=ur,this.dataTexture=this.cellLength>0&&xt.length>0?this.createTexture2D({flipY:!0,data:xt,format:W.LUMINANCE,type:W.FLOAT,width:Kt,height:ur}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Je),u_isMeter:Number(this.isMeter),u_blur:Ee,u_additive:Y==="additive"?1:0,u_globel:this.mapService.version===Rs.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_stroke_opacity:Number(g),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(V)?V:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),Y=V.toLngLat();this.meter2coord=x[0]-Y.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,A=this.getShaders(C),O=A.frag,D=A.vert,V=A.type,Y=this.mapService.version==="GLOBEL";return this.layer.triangulation=Y?Sy:Up,[this.layer.buildLayerModel({moduleName:"pointfill_"+V,vertexShader:D,fragmentShader:O,triangulation:Y?Sy:Up,depth:{enable:Y},blend:this.getBlend(),stencil:wr(f,g),cull:{enable:!0,face:ti(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:Ky,vert:W0,type:"wave"};default:return{frag:Ky,vert:W0,type:"wave"}}else return{frag:QA,vert:W0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(v,g,x,C){var A;if(s){var O=(0,Q.Z)(x,3),D=O[0],V=O[1],Y=O[2],te=Ha.fromValues(0,0,1),Ee=Ha.fromValues(D,0,Y),Ze=D>=0?Ha.angle(te,Ee):Math.PI*2-Ha.angle(te,Ee),Je=Math.PI*2-Math.asin(V/100),lt=mi();Ne(lt,lt,Ze),$e(lt,lt,Je);var Et=Ha.fromValues(1,1,0);Ha.transformMat4(Et,Et,lt),Ha.normalize(Et,Et);var xt=Ha.fromValues(-1,1,0);Ha.transformMat4(xt,xt,lt),Ha.normalize(xt,xt);var Kt=Ha.fromValues(-1,-1,0);Ha.transformMat4(Kt,Kt,lt),Ha.normalize(Kt,Kt);var ur=Ha.fromValues(1,-1,0);Ha.transformMat4(ur,ur,lt),Ha.normalize(ur,ur),A=[].concat((0,nr.Z)(Et),(0,nr.Z)(xt),(0,nr.Z)(Kt),(0,nr.Z)(ur))}else A=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ir=C%4*3;return[A[Ir],A[Ir+1],A[Ir+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(v,g,x,C){var A=v.size,O=A===void 0?5:A;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(v,g,x,C){var A=v.shape,O=A===void 0?2:A,D=a.layer.getLayerConfig().shape2d,V=D.indexOf(O);return[V]}}})}}]),r}(lo);function JA(e){var i=ew();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,rw=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,nw=function(e){(0,Yr.Z)(r,e);var i=JA(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"meter2coord",1),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"isMeter",!1),(0,I.Z)((0,oe.Z)(n),"radian",0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=x!==void 0?C*Math.PI*x/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,V=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:V,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),Y=V.toLngLat();this.meter2coord=x[0]-Y.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:Up,depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g),cull:{enable:!0,face:ti(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:tw,vert:rw,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Tn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.rotate,A=C===void 0?0:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.shape,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=x%4*3;return[C[A],C[A+1],C[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]*a.meter2coord]:[A*a.meter2coord]}}})}}]),r}(lo);function iw(e){var i=aw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,sw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,uw=function(e){(0,Yr.Z)(r,e);var i=iw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:sw,fragmentShader:ow,triangulation:Ay,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.fontService.mapping,A=f.shape,O=a.fontService.getGlyph(A),D=C[O],V=D.x,Y=D.y;return[V,Y]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),A=[];C.forEach(function(O){var D=O.shape,V=D===void 0?"":D;V=V.toString();var Y=a.fontService.getGlyph(V);A.indexOf(Y)===-1&&A.push(Y)}),this.fontService.setFontOptions({characterSet:A,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(lo);function lw(e){var i=cw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,hw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Qy=function(e){(0,Yr.Z)(r,e);var i=lw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:hw,fragmentShader:fw,triangulation:Ay,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),A=f.shape,O=C[A]||{x:0,y:0},D=O.x,V=O.y;return[D,V]}}})}}]),r}(lo);function pw(e){var i=dw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vw=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,mw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Jy(e){var i=e.coordinates;return{vertices:(0,nr.Z)(i),indices:[0],size:i.length}}var e_=function(e){(0,Yr.Z)(r,e);var i=pw(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Jy,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:mw,fragmentShader:vw,triangulation:Jy,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Sc.additive}}}]),r}(lo);function gw(e){var i=yw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _w=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,xw=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,bw=function(e){(0,Yr.Z)(r,e);var i=gw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"meter2coord",1),(0,I.Z)((0,oe.Z)(n),"isMeter",!1),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.speed,A=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),V=D.data,Y=D.width,te=D.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:W.LUMINANCE,type:W.FLOAT,width:Y,height:te}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:A,u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Up)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Rs.L7MAP&&v!==Rs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===Rs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*A.meterInMercatorCoordinateUnits(),V=new window.mapboxgl.MercatorCoordinate(A.x-D,A.y,A.z),Y=V.toLngLat();this.meter2coord=x[0]-Y.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:Up,depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g),cull:{enable:!0,face:ti(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:_w,vert:xw,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var A=x%4*3;return[C[A],C[A+1],C[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,A=C===void 0?5:C;return Array.isArray(A)?[A[0]*a.meter2coord]:[A*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(f,v,g,x){var C=f.shape,A=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,D=O.indexOf(A);return[D]}}})}}]),r}(lo);function Ew(e){var i=Sw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cw=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,Aw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function t_(e){var i=e.coordinates;return{vertices:(0,nr.Z)(i),indices:[0],size:i.length}}var ww=function(e){(0,Yr.Z)(r,e);var i=Ew(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,A=C===void 0?1:C,O=a.strokeWidth,D=O===void 0?0:O,V=a.stroke,Y=V===void 0?"#fff":V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var te=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,te,this.cellProperties),Ze=Ee.data,Je=Ee.width,lt=Ee.height;this.rowCount=lt,this.dataTexture=this.cellLength>0&&Ze.length>0?this.createTexture2D({flipY:!0,data:Ze,format:W.LUMINANCE,type:W.FLOAT,width:Je,height:lt}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:Number(A),u_stroke_width:Number(D),u_stroke_color:this.getStrokeColor(Y)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=t_,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:Aw,fragmentShader:Cw,triangulation:t_,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Sc.additive}}}]),r}(lo);function Tw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Mw(e,i){if(!!e){if(typeof e=="string")return r_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return r_(e,i)}}function r_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Pw=function(){function e(i,r,n){(0,ut.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,St.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),f?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,f,v,g,x){var C=g.seenUids,A=this.boxCells[f];if(A!==null){var O=this.bboxes,D=Tw(A),V;try{for(D.s();!(V=D.n()).done;){var Y=V.value;if(!C.box[Y]){C.box[Y]=!0;var te=Y*4;if(r<=O[te+2]&&n<=O[te+3]&&a>=O[te+0]&&s>=O[te+1]&&(!x||x(this.boxKeys[Y]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Y],x1:O[te],y1:O[te+1],x2:O[te+2],y2:O[te+3]})}}}}catch(Ee){D.e(Ee)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,g,x){for(var C=this.convertToXCellCoord(r),A=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),V=C;V<=O;V++)for(var Y=A;Y<=D;Y++){var te=this.xCellCount*Y+V;if(f.call(this,r,n,a,s,te,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),Iw=Pw,Ow=function(){function e(i,r){(0,ut.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new Iw(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,St.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Yt(n,a,0,1),f=Ct(),v=pl.apply(le,(0,nr.Z)(r));return Ss(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function n_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Rw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Rw(e,i){if(!!e){if(typeof e=="string")return i_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i_(e,i)}}function i_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function a_(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function o_(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function s_(e,i,r,n,a,s,f){var v=(i-r)*a,g=(-n*f+.5)*s,x=n_(e),C;try{for(x.s();!(C=x.n()).done;){var A=C.value;A.x+=v,A.y+=g}}catch(O){x.e(O)}finally{x.f()}}function Lw(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,A=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=A.length;r.forEach(function(Ze){if(Ze.split("").forEach(function(lt){var Et=i[lt],xt=0;Et&&(A.push({glyph:lt,x:g,y:x+xt,vertical:!1,scale:1,metrics:Et}),g+=Et.advance+f)}),A.length!==D){var Je=g-f;C=Math.max(Je,C),o_(A,i,D,A.length-1,O)}g=0,x-=n+5});var V=a_(a),Y=V.horizontalAlign,te=V.verticalAlign;s_(A,O,Y,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-Y*C,e.right=e.left+C}function kw(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,A=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=A.length;r.forEach(function(Ze){var Je=i[Ze],lt=0;if(Je&&(A.push({glyph:Ze,x:Je.advance/2,y:x+lt,vertical:!1,scale:1,metrics:Je}),g+=Je.advance+f),A.length!==D){var Et=g-f;C=Math.max(Et,C),o_(A,i,D,A.length-1,O)}g=0,x-=n+5});var V=a_(a),Y=V.horizontalAlign,te=V.verticalAlign;s_(A,O,Y,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-Y*C,e.right=e.left+C}function Dw(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:g.length,text:e};return v?kw(C,i,g,r,n,a,s):Lw(C,i,g,r,n,a,s),x.length?C:!1}function Fw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=n_(a),v;try{for(f.s();!(v=f.n()).done;){var g=v.value,x=g.metrics,C=4,A=x.advance*g.scale/2,O=r?[g.x+A,g.y]:[0,0],D=r?[0,0]:[g.x+A+i[0],g.y+i[1]],V=(0-C)*g.scale-A+D[0],Y=(0-C)*g.scale+D[1],te=V+x.width*g.scale,Ee=Y+x.height*g.scale,Ze={x:V,y:Y},Je={x:te,y:Y},lt={x:V,y:Ee},Et={x:te,y:Ee};s.push({tl:Ze,tr:Je,bl:lt,br:Et,tex:x,glyphOffset:O})}}catch(xt){f.e(xt)}finally{f.f()}return s}function Bw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Nw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Nw(e,i){if(!!e){if(typeof e=="string")return u_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u_(e,i)}}function u_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function zw(e){var i=Uw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,c_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function f_(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,nr.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,nr.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,nr.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,nr.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var h_=function(e){(0,Yr.Z)(r,e);var i=zw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,oe.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"currentZoom",-1),(0,I.Z)((0,oe.Z)(n),"extent",void 0),(0,I.Z)((0,oe.Z)(n),"textureHeight",0),(0,I.Z)((0,oe.Z)(n),"textCount",0),(0,I.Z)((0,oe.Z)(n),"preTextStyle",{}),(0,I.Z)((0,oe.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,A=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:c_,fragmentShader:l_,triangulation:f_.bind((0,oe.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:wr(x,A)})]}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,A=a.textAnchor,O=A===void 0?"center":A,D=a.textAllowOverlap,V=D===void 0?!1:D,Y=a.halo,te=Y===void 0?.5:Y,Ee=a.gamma,Ze=Ee===void 0?2:Ee,Je=a.raisingHeight,lt=Je===void 0?0:Je,Et=this.fontService,xt=Et.canvas,Kt=Et.mapping;if(Object.keys(Kt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Kt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:V},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:f,strokeWidth:C,stroke:g});var ur=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,ur,this.cellProperties),Xr=Ir.data,yr=Ir.width,sn=Ir.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:W.LUMINANCE,type:W.FLOAT,width:yr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(lt),u_opacity:Number(f),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Ze,u_sdf_map_size:[xt.width,xt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=se(this.extent,g);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Tn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Tn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Tn.Attribute,descriptor:{name:"a_tex",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return X(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(A){var O=A.shape,D=O===void 0?"":O;D=D.toString();var V=Bw(D),Y;try{for(V.s();!(Y=V.n()).done;){var te=Y.value;C.indexOf(te)===-1&&C.push(te)}}catch(Ee){V.e(Ee)}finally{V.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(A){var O=A.shape,D=O===void 0?"":O;D="".concat(D),C.indexOf(D)===-1&&C.push(D)}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,A=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(D){var V=D.shape,Y=V===void 0?"":V,te=D.id,Ee=D.size,Ze=Ee===void 0?1:Ee,Je=D.textOffset,lt=Je===void 0?[0,0]:Je,Et=Dw(Y.toString(),f,Ze,A,"left",x,lt,a),xt=Fw(Et,lt,!1);return D.shaping=Et,D.glyphQuads=xt,D.centroid=Bp(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Bp(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[te]={shaping:Et,glyphQuads:xt,centroid:Bp(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),A=C.width,O=C.height,D=new Ow(A,O),V=this.glyphInfo.filter(function(Y){var te=Y.shaping,Ee=Y.id,Ze=Ee===void 0?0:Ee,Je=Y.version==="GAODE2.x"?Y.originCentroid:Y.centroid,lt=Y.size,Et=lt/24,xt=a.mapService.lngLatToContainer(Je),Kt=D.placeCollisionBox({x1:te.left*Et-v[0],x2:te.right*Et+v[0],y1:te.top*Et-v[1],y2:te.bottom*Et+v[1],anchorPointX:xt.x,anchorPointY:xt.y}),ur=Kt.box;return ur&&ur.length?(D.insertCollisionBox(ur,Ze),!0):!1});V.forEach(function(Y){a.glyphInfoMap[Y.id]=Y})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:c_,fragmentShader:l_,triangulation:f_.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g)})]}}]),r}(lo),Zw={fillImage:nw,fill:$y,radar:bw,image:Qy,normal:e_,simplePoint:ww,extrude:qy,text:h_,icon:uw},jw=Zw;function Vw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Gw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Gw(e,i){if(!!e){if(typeof e=="string")return p_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p_(e,i)}}function p_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Hw(e){var i=Ww();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d_=function(e){(0,Yr.Z)(r,e);var i=Hw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","PointLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new jw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var A=Vw(f),O;try{for(A.s();!(O=A.n()).done;){var D=O.value;if(typeof D=="string"&&C.hasOwnProperty(D))return"image"}}catch(V){A.e(V)}finally{A.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,g=f.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var A=C.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":A==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(A))!==-1?"fill":(g==null?void 0:g.indexOf(A))!==-1?"extrude":x.hasOwnProperty(A)?"image":this.fontService.getGlyph(A)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(rp);function Xw(e){var i=Yw();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Kw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,$w=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Qw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Jw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,eT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,tT=function(e){(0,Yr.Z)(r,e);var i=Xw(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,A=a.topsurface,O=A===void 0?!0:A,D=a.sidesurface,V=D===void 0?!0:D,Y=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Ee=this.layer.getEncodedData(),Ze=this.calDataFrame(this.cellLength,Ee,this.cellProperties),Je=Ze.data,lt=Ze.width,Et=Ze.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&Je.length>0?this.createTexture2D({flipY:!0,data:Je,format:W.LUMINANCE,type:W.FLOAT,width:lt,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var xt=0,Kt=[1,1,1,1],ur=[1,1,1,1];return Y&&te&&(Kt=lr(Y),ur=lr(te),xt=1),{u_topsurface:Number(O),u_sidesurface:Number(V),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:Number(f),u_linearColor:xt,u_sourceColor:Kt,u_targetColor:ur,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,A=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:A,fragmentShader:C,triangulation:wy,stencil:wr(f,g),cull:{enable:!0,face:W.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:$w,vert:Qw,type:"polygonExtrudeTexture"}:s?{frag:Jw,vert:eT,type:"polygonExtrudePickLight"}:{frag:qw,vert:Kw,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Tn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(D,V,Y,te,Ee){var Ze=Y[0],Je=Y[1];return[(Ze-f)/C,(Je-v)/A,Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(D,V,Y,te,Ee){return Ee}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(D,V,Y,te){var Ee=D.size,Ze=Ee===void 0?10:Ee;return Array.isArray(Ze)?[Ze[0]]:[Ze]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var g=new Image;g.crossOrigin="",g.src=f,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(lo);function rT(e){var i=nT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function nT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,oT=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,sT=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,uT=function(e){(0,Yr.Z)(r,e);var i=rT(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,V=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:V,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:g,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,f=a.vert,v=a.triangulation,g=a.type,x=this.layer.getLayerConfig(),C=x.mask,A=C===void 0?!1:C,O=x.maskInside,D=O===void 0?!0:O;return this.layer.triangulation=v,[this.layer.buildLayerModel({moduleName:g,vertexShader:f,fragmentShader:s,triangulation:v,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:W.BACK},stencil:wr(A,D)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Tn.Attribute,descriptor:{name:"a_linear",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(g,x,C,A,O){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1}:s;return f.enable?{frag:aT,vert:oT,type:"polygon_linear",triangulation:gS}:{frag:iT,vert:sT,type:"polygon_fill",triangulation:e0}}}]),r}(lo);function lT(e){var i=cT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function cT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fT=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,hT=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,pT=function(e){(0,Yr.Z)(r,e);var i=lT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture1",void 0),(0,I.Z)((0,oe.Z)(n),"texture2",void 0),(0,I.Z)((0,oe.Z)(n),"texture3",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),D=O.data,V=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:W.LUMINANCE,type:W.FLOAT,width:V,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:lr(g),u_watercolor2:lr(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:hT,fragmentShader:fT,triangulation:e0,depth:{enable:!1},stencil:wr(f,g)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Tn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(D,V,Y,te,Ee){var Ze=(0,Q.Z)(Y,2),Je=Ze[0],lt=Ze[1];return[(Je-f)/C,(lt-v)/A]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,A=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(D){var V=new Image;V.crossOrigin="",V.src=D,A.push(V),V.onload=function(){C++,C===3&&x(A)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR})}}}]),r}(lo);function dT(e){var i=vT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mT=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,gT=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,yT=function(e){(0,Yr.Z)(r,e);var i=dT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),A=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:W.LUMINANCE,type:W.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:gT,fragmentShader:mT,triangulation:e0,depth:{enable:!1},stencil:wr(f,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,A=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Tn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(D,V,Y,te,Ee){var Ze=(0,Q.Z)(Y,2),Je=Ze[0],lt=Ze[1];return[(Je-f)/C,(lt-v)/A]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=f):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(lo),_T={fill:uT,line:Wy,extrude:tT,text:h_,point_fill:$y,point_image:Qy,point_normal:e_,point_extrude:qy,water:yT,ocean:pT},xT=_T;function bT(e){var i=ET();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v_=function(e){(0,Yr.Z)(r,e);var i=bT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","PolygonLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new xT[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(A){return A.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(f==null?void 0:f.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(rp);function ST(e){var i=CT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function CT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AT=function(e){(0,Yr.Z)(r,e);var i=ST(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"isLayerGroup",!0),n}return(0,St.Z)(r,[{key:"addChild",value:function(a){this.layerChildren.push(a)}},{key:"removeChild",value:function(a){var s=this.layerChildren.indexOf(a);s>-1&&this.layerChildren.splice(s,1),a.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach(function(a){a.destroy()}),this.layerChildren=[]}},{key:"hasChild",value:function(a){return this.layerChildren.includes(a)}}]),r}(rp);function wT(e){var i=TT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function TT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MT=function(e){(0,Yr.Z)(r,e);var i=wT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"initedTileset",!1),(0,I.Z)((0,oe.Z)(n),"tilesetManager",void 0),(0,I.Z)((0,oe.Z)(n),"showGrid",!1),(0,I.Z)((0,oe.Z)(n),"subGridLayer",void 0),(0,I.Z)((0,oe.Z)(n),"subTextLayer",void 0),(0,I.Z)((0,oe.Z)(n),"lastViewStates",void 0),(0,I.Z)((0,oe.Z)(n),"timer",void 0),(0,I.Z)((0,oe.Z)(n),"renderSubLayers",function(){if(!!n.tilesetManager){var v=n.layer;n.tilesetManager.tiles.filter(function(g){return g.isLoaded}).map(function(g){return g.layer?g.layer.updateLayerConfig({visible:g.isVisible}):(g.layer=n.creatSubLayer(g),v.addChild(g.layer)),g.layer}),n.showGrid&&(v.hasChild(n.subGridLayer)||v.addChild(n.subGridLayer),v.hasChild(n.subTextLayer)||v.addChild(n.subTextLayer)),n.layerService.renderLayers(),n.tilesetManager.isLoaded&&v.emit("tiles-loaded",n.tilesetManager.currentTiles)}}),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a,s=this.layer.getSource();this.tilesetManager=s.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var f=this.getCurrentView(),v=f.latLonBounds,g=f.zoom;return(a=this.tilesetManager)===null||a===void 0||a.update(g,v),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(!!this.tilesetManager){var a=this.tilesetManager.currentTiles.map(function(f){return f.bboxPolygon}),s={type:"FeatureCollection",features:a};if(this.subGridLayer){this.subGridLayer.setData(s),this.subTextLayer.setData(s);return}this.subGridLayer=new Yy({autoFit:!1}).source(s).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new d_({autoFit:!1}).source(s).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer(ov(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer(ov(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(s){}),this.tilesetManager.on("tile-unload",function(s){a.destroySubLayer(s)}),this.tilesetManager.on("tile-error",function(s,f){}),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",function(s){var f=a.getCurrentView(),v=f.latLonBounds,g=f.zoom;if(a.mapService.version==="GAODE1.x"){var x=a.layer.getLayerConfig(),C=x.visible;g<3&&C?(a.layer.updateLayerConfig({visible:!1}),a.layerService.updateLayerRenderList()):g>=3&&!C&&(a.layer.updateLayerConfig({visible:!0}),a.layerService.updateLayerRenderList())}a.lastViewStates&&a.lastViewStates.zoom===g&&a.lastViewStates.latLonBounds.toString()===v.toString()||(a.lastViewStates={zoom:g,latLonBounds:v},a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){var A;(A=a.tilesetManager)===null||A===void 0||A.update(g,v),a.showGrid&&a.renderSubGridLayer()},250))}))}},{key:"creatSubLayer",value:function(a){var s=this.layer.getLayerConfig(),f=s.opacity,v=f===void 0?1:f,g=s.zIndex,x=g===void 0?0:g,C=new Gy({visible:a.isVisible,zIndex:x}).source(a.data,{parser:{type:"image",extent:a.bounds}}).style({opacity:v}),A=ov(this.layer.sceneContainer);return C.setContainer(A,this.layer.sceneContainer),C.init(),C}},{key:"destroySubLayer",value:function(a){if(a.layer){var s=this.layer;s.removeChild(a.layer)}}},{key:"getCurrentView",value:function(){var a=this.mapService.getBounds(),s=[a[0][0],a[0][1],a[1][0],a[1][1]],f=this.mapService.getZoom();return{latLonBounds:s,zoom:f}}}]),r}(lo);function PT(e){var i=IT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function IT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,RT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,m_=function(e){(0,Yr.Z)(r,e);var i=PT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"texture",void 0),(0,I.Z)((0,oe.Z)(n),"colorTexture",void 0),n}return(0,St.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,A=a.noDataValue,O=A===void 0?-9999999:A,D=a.domain,V=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:V,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,A=x.data.dataArray[0];this.texture=C({data:A.data,width:A.width,height:A.height,format:W.LUMINANCE,type:W.FLOAT});var O=this.layer.getLayerConfig(),D=O.rampColors,V=Ln(D);return this.colorTexture=C({data:V.data,width:V.width,height:V.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:RT,fragmentShader:OT,triangulation:My,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:wr(f,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=Ln(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(lo),LT={raster:m_,raster3d:m_,rasterTile:MT},kT=LT;function DT(e){var i=FT();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BT=function(e){(0,Yr.Z)(r,e);var i=DT(r);function r(){var n;(0,ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,oe.Z)(n),"type","RasterLayer"),n}return(0,St.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new kT[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(AT),g_,y_,__,x_,b_,hv,E_,S_,C_;function A_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function NT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?A_(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var zT=(g_=(0,Ye.b2)(),y_=(0,Ye.f3)(De.IGlobalConfigService),__=(0,Ye.f3)(De.IMapService),x_=(0,Ye.f3)(De.IFontService),g_(b_=(hv=function(){function e(){(0,ut.Z)(this,e),Ce(this,"configService",E_,this),Ce(this,"mapService",S_,this),Ce(this,"fontService",C_,this)}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),A=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(A=x.filter(function(O){return a.applyAttributeMapping(g,O,f)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,A,void 0,f,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,A,r.getEncodedData(),f,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(A){return a.applyAttributeMapping(g,A,f)[0]})),r.setEncodedData(this.mapping(v,C,void 0,f,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=pe(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,g=f==null?void 0:f.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,A=n.map(function(O,D){var V=a?a[D]:{},Y=NT({id:O._id,coordinates:O.coordinates},V);if(r.filter(function(Ze){return Ze.scale!==void 0}).forEach(function(Ze){var Je=v.applyAttributeMapping(Ze,O,s);Ze.needRemapping=!1,Ze.name==="color"&&(Je=Je.map(function(lt){return lr(lt)})),Y[Ze.name]=Array.isArray(Je)&&Je.length===1?Je[0]:Je,Ze.name==="shape"&&(Y.shape=v.fontService.getIconFontKey(Y[Ze.name]))}),Y.shape==="line"&&C.enable){var te=Y.coordinates,Ee=v.getArrowPoints(te[0],te[1]);Y.coordinates.splice(1,0,Ee,Ee)}return Y});return this.adjustData2Amap2Coordinates(A),this.adjustData2SimpleCoordinates(A),A}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=jc()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Rs["GAODE2.x"],a.originCoordinates=jc()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Rs.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var C,A=x.field;(n.hasOwnProperty(A)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[A])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!mr(g[0])?[a]:g}}]),e}(),E_=Ge(hv.prototype,"configService",[y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S_=Ge(hv.prototype,"mapService",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=Ge(hv.prototype,"fontService",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv))||b_),w_,T_,UT=(w_=(0,Ye.b2)(),w_(T_=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,St.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(De.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Ue,options:Nt},f=s.data,v=s.options;r.setSource(new or(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,A=r.dataState.dataSourceNeedUpdate;return a&&(A||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||T_);function X0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function M_(e){return e.length===1&&(e=ZT(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function ZT(e){return function(i,r){return X0(e(i),r)}}var P_=M_(X0),jT=P_.right,X4=P_.left,o0=jT;function VT(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var I_=Array.prototype,Y4=I_.slice,q4=I_.map,Y0=Math.sqrt(50),q0=Math.sqrt(10),K0=Math.sqrt(2);function O_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=s0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function s0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Y0?10:s>=q0?5:s>=K0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Y0?10:s>=q0?5:s>=K0?2:1)}function $0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Y0?a*=10:s>=q0?a*=5:s>=K0&&(a*=2),i<e?-a:a}function K4(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,g=new Array(f);for(s=0;s<f;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],A=x[1],O=r(g,C,A);Array.isArray(O)||(O=tickStep(C,A,O),O=range(Math.ceil(C/O)*O,A,O));for(var D=O.length;O[0]<=C;)O.shift(),--D;for(;O[D-1]>A;)O.pop(),--D;var V=new Array(D+1),Y;for(s=0;s<=D;++s)Y=V[s]=[],Y.x0=s>0?O[s-1]:C,Y.x1=s<D?O[s]:A;for(s=0;s<f;++s)v=g[s],C<=v&&v<=A&&V[bisect(O,v,0,D)].push(a[s]);return V}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function $4(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function GT(e){return e===null?NaN:+e}function HT(e,i,r){if(r==null&&(r=GT),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var Tc="$";function u0(){}u0.prototype=R_.prototype={constructor:u0,has:function(e){return Tc+e in this},get:function(e){return this[Tc+e]},set:function(e,i){return this[Tc+e]=i,this},remove:function(e){var i=Tc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Tc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Tc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Tc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Tc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Tc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Tc)return!1;return!0},each:function(e){for(var i in this)i[0]===Tc&&e(this[i],i.slice(1),this)}};function R_(e,i){var r=new u0;if(e instanceof u0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var Q0=R_;function Q4(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var A=-1,O=v.length,D=e[g++],V,Y,te=map(),Ee,Ze=x();++A<O;)(Ee=te.get(V=D(Y=v[A])+""))?Ee.push(Y):te.set(V,[Y]);return te.each(function(Je,lt){C(Ze,lt,s(Je,g,x,C))}),Ze}function f(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(A,O){x.push({key:O,values:f(A,g)})})),C!=null?x.sort(function(A,O){return C(A.key,O.key)}):x}return a={object:function(v){return s(v,0,WT,XT)},map:function(v){return s(v,0,L_,k_)},entries:function(v){return f(s(v,0,L_,k_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function WT(){return{}}function XT(e,i,r){e[i]=r}function L_(){return map()}function k_(e,i,r){e.set(i,r)}function l0(){}var jp=Q0.prototype;l0.prototype=YT.prototype={constructor:l0,has:jp.has,add:function(e){return e+="",this[Tc+e]=e,this},remove:jp.remove,clear:jp.clear,values:jp.keys,size:jp.size,empty:jp.empty,each:jp.each};function YT(e,i){var r=new l0;if(e instanceof l0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var J4=null,D_=Array.prototype,c0=D_.map,Vp=D_.slice;function op(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function eI(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var F_={name:"implicit"};function f0(){var e=Q0(),i=[],r=[],n=F_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==F_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Q0();for(var f=-1,v=s.length,g,x;++f<v;)e.has(x=(g=s[f])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Vp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return f0(i,r).unknown(n)},op.apply(a,arguments),a}function B_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var A=i().length,O=n[1]<n[0],D=n[O-0],V=n[1-O];a=(V-D)/Math.max(1,A-v+g*2),f&&(a=Math.floor(a)),D+=(V-D-a*(A-v))*x,s=a*(1-v),f&&(D=Math.round(D),s=Math.round(s));var Y=sequence(A).map(function(te){return D+a*te});return r(O?Y.reverse():Y)}return e.domain=function(A){return arguments.length?(i(A),C()):i()},e.range=function(A){return arguments.length?(n=[+A[0],+A[1]],C()):n.slice()},e.rangeRound=function(A){return n=[+A[0],+A[1]],f=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(A){return arguments.length?(f=!!A,C()):f},e.padding=function(A){return arguments.length?(v=Math.min(1,g=+A),C()):v},e.paddingInner=function(A){return arguments.length?(v=Math.min(1,A),C()):v},e.paddingOuter=function(A){return arguments.length?(g=+A,C()):g},e.align=function(A){return arguments.length?(x=Math.max(0,Math.min(1,A)),C()):x},e.copy=function(){return B_(i(),n).round(f).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function N_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return N_(i())},e}function tI(){return N_(B_.apply(null,arguments).paddingInner(1))}var qT=N(26257),KT=N(73626);function $T(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function QT(e){return function(){return e}}function J0(e){return+e}var z_=[0,1];function Mc(e){return e}function em(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:QT(isNaN(i)?NaN:.5)}function U_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function JT(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=em(a,n),s=r(f,s)):(n=em(n,a),s=r(s,f)),function(v){return s(n(v))}}function e5(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=em(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var g=o0(e,v,1,n)-1;return s[g](a[g](v))}}function h0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function tm(){var e=z_,i=z_,r=qT.Z,n,a,s,f=Mc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?e5:JT,g=x=null,A}function A(O){return isNaN(O=+O)?s:(g||(g=v(e.map(n),i,r)))(n(f(O)))}return A.invert=function(O){return f(a((x||(x=v(i,e.map(n),KT.Z)))(O)))},A.domain=function(O){return arguments.length?(e=c0.call(O,J0),f===Mc||(f=U_(e)),C()):e.slice()},A.range=function(O){return arguments.length?(i=Vp.call(O),C()):i.slice()},A.rangeRound=function(O){return i=Vp.call(O),r=$T,C()},A.clamp=function(O){return arguments.length?(f=O?U_(e):Mc,A):f!==Mc},A.interpolate=function(O){return arguments.length?(r=O,C()):r},A.unknown=function(O){return arguments.length?(s=O,A):s},function(O,D){return n=O,a=D,C()}}function Z_(e,i){return tm()(e,i)}var t5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function p0(e){if(!(i=t5.exec(e)))throw new Error("invalid format: "+e);var i;return new rm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}p0.prototype=rm.prototype;function rm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}rm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function r5(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function d0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Td(e){return e=d0(Math.abs(e)),e?e[1]:NaN}function n5(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Td(i)/3)))*3-Td(Math.abs(e)))}function i5(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function a5(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function o5(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var j_;function s5(e,i){var r=d0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(j_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+d0(e,Math.max(0,i+s-1))[0]}function V_(e,i){var r=d0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var G_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:r5,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return V_(e*100,i)},r:V_,s:s5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function H_(e){return e}var W_=Array.prototype.map,X_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function u5(e){var i=e.grouping===void 0||e.thousands===void 0?H_:i5(W_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?H_:a5(W_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(A){A=p0(A);var O=A.fill,D=A.align,V=A.sign,Y=A.symbol,te=A.zero,Ee=A.width,Ze=A.comma,Je=A.precision,lt=A.trim,Et=A.type;Et==="n"?(Ze=!0,Et="g"):G_[Et]||(Je===void 0&&(Je=12),lt=!0,Et="g"),(te||O==="0"&&D==="=")&&(te=!0,O="0",D="=");var xt=Y==="$"?r:Y==="#"&&/[boxX]/.test(Et)?"0"+Et.toLowerCase():"",Kt=Y==="$"?n:/[%p]/.test(Et)?f:"",ur=G_[Et],Ir=/[defgprs%]/.test(Et);Je=Je===void 0?6:/[gprs]/.test(Et)?Math.max(1,Math.min(21,Je)):Math.max(0,Math.min(20,Je));function Xr(yr){var sn=xt,Rn=Kt,Un,Da,So;if(Et==="c")Rn=ur(yr)+Rn,yr="";else{yr=+yr;var As=yr<0||1/yr<0;if(yr=isNaN(yr)?g:ur(Math.abs(yr),Je),lt&&(yr=o5(yr)),As&&+yr==0&&V!=="+"&&(As=!1),sn=(As?V==="("?V:v:V==="-"||V==="("?"":V)+sn,Rn=(Et==="s"?X_[8+j_/3]:"")+Rn+(As&&V==="("?")":""),Ir){for(Un=-1,Da=yr.length;++Un<Da;)if(So=yr.charCodeAt(Un),48>So||So>57){Rn=(So===46?a+yr.slice(Un+1):yr.slice(Un))+Rn,yr=yr.slice(0,Un);break}}}Ze&&!te&&(yr=i(yr,Infinity));var iu=sn.length+yr.length+Rn.length,Ls=iu<Ee?new Array(Ee-iu+1).join(O):"";switch(Ze&&te&&(yr=i(Ls+yr,Ls.length?Ee-Rn.length:Infinity),Ls=""),D){case"<":yr=sn+yr+Rn+Ls;break;case"=":yr=sn+Ls+yr+Rn;break;case"^":yr=Ls.slice(0,iu=Ls.length>>1)+sn+yr+Rn+Ls.slice(iu);break;default:yr=Ls+sn+yr+Rn;break}return s(yr)}return Xr.toString=function(){return A+""},Xr}function C(A,O){var D=x((A=p0(A),A.type="f",A)),V=Math.max(-8,Math.min(8,Math.floor(Td(O)/3)))*3,Y=Math.pow(10,-V),te=X_[8+V/3];return function(Ee){return D(Y*Ee)+te}}return{format:x,formatPrefix:C}}var v0,nm,Y_;l5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function l5(e){return v0=u5(e),nm=v0.format,Y_=v0.formatPrefix,v0}function c5(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Td(i)-Td(e))+1}function f5(e){return Math.max(0,-Td(Math.abs(e)))}function h5(e,i,r,n){var a=$0(e,i,r),s;switch(n=p0(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=n5(a,f))&&(n.precision=s),Y_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=c5(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=f5(a))&&(n.precision=s-(n.type==="%")*2);break}}return nm(n)}function m0(e){var i=e.domain;return e.ticks=function(r){var n=i();return O_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return h5(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],g;return v<f&&(g=f,f=v,v=g,g=a,a=s,s=g),g=s0(f,v,r),g>0?(f=Math.floor(f/g)*g,v=Math.ceil(v/g)*g,g=s0(f,v,r)):g<0&&(f=Math.ceil(f*g)/g,v=Math.floor(v*g)/g,g=s0(f,v,r)),g>0?(n[a]=Math.floor(f/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(f*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function q_(){var e=Z_(Mc,Mc);return e.copy=function(){return h0(e,q_())},op.apply(e,arguments),m0(e)}function K_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=c0.call(n,J0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return K_(e).unknown(i)},e=arguments.length?c0.call(e,J0):[0,1],m0(r)}function $_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function Q_(e){return Math.log(e)}function J_(e){return Math.exp(e)}function p5(e){return-Math.log(-e)}function d5(e){return-Math.exp(-e)}function v5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function m5(e){return e===10?v5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function g5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function e1(e){return function(i){return-e(-i)}}function y5(e){var i=e(Q_,J_),r=i.domain,n=10,a,s;function f(){return a=g5(n),s=m5(n),r()[0]<0?(a=e1(a),s=e1(s),e(p5,d5)):e(Q_,J_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],A;(A=C<x)&&(O=x,x=C,C=O);var O=a(x),D=a(C),V,Y,te,Ee=v==null?10:+v,Ze=[];if(!(n%1)&&D-O<Ee){if(O=Math.round(O)-1,D=Math.round(D)+1,x>0){for(;O<D;++O)for(Y=1,V=s(O);Y<n;++Y)if(te=V*Y,!(te<x)){if(te>C)break;Ze.push(te)}}else for(;O<D;++O)for(Y=n-1,V=s(O);Y>=1;--Y)if(te=V*Y,!(te<x)){if(te>C)break;Ze.push(te)}}else Ze=O_(O,D,Math.min(D-O,Ee)).map(s);return A?Ze.reverse():Ze},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=nm(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var A=C/s(Math.round(a(C)));return A*n<n-.5&&(A*=n),A<=x?g(C):""}},i.nice=function(){return r($_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function t1(){var e=y5(tm()).domain([1,10]);return e.copy=function(){return h0(e,t1()).base(e.base())},op.apply(e,arguments),e}function r1(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function n1(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function _5(e){var i=1,r=e(r1(i),n1(i));return r.constant=function(n){return arguments.length?e(r1(i=+n),n1(i)):i},linearish(r)}function x5(){var e=_5(transformer());return e.copy=function(){return copy(e,x5()).constant(e.constant())},initRange.apply(e,arguments)}function i1(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function b5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function E5(e){return e<0?-e*e:e*e}function S5(e){var i=e(Mc,Mc),r=1;function n(){return r===1?e(Mc,Mc):r===.5?e(b5,E5):e(i1(r),i1(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},m0(i)}function im(){var e=S5(tm());return e.copy=function(){return h0(e,im()).exponent(e.exponent())},op.apply(e,arguments),e}function rI(){return im.apply(null,arguments).exponent(.5)}function a1(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=HT(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[o0(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,g=f.length,x;v<g;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(X0),a()},s.range=function(f){return arguments.length?(i=Vp.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return a1().domain(e).range(i).unknown(n)},op.apply(s,arguments)}function o1(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(g){return g<=g?a[o0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return f}return f.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},f.range=function(g){return arguments.length?(r=(a=Vp.call(g)).length-1,v()):a.slice()},f.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(g){return arguments.length&&(s=g),f},f.thresholds=function(){return n.slice()},f.copy=function(){return o1().domain([e,i]).range(a).unknown(s)},op.apply(m0(f),arguments)}function s1(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[o0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Vp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Vp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return s1().domain(e).range(i).unknown(r)},op.apply(a,arguments)}var am=new Date,om=new Date;function ml(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return g},a.filter=function(s){return ml(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return am.setTime(+s),om.setTime(+f),e(am),e(om),Math.floor(r(am,om))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var sm=ml(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});sm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ml(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Md=sm,nI=sm.range,u1=ml(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),C5=u1,iI=u1.range,g0=1e3,pv=6e4,l1=36e5,c1=864e5,f1=6048e5;function Gp(e){return ml(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*pv)/f1})}var um=Gp(0),y0=Gp(1),A5=Gp(2),w5=Gp(3),Pd=Gp(4),T5=Gp(5),M5=Gp(6),aI=um.range,oI=y0.range,sI=A5.range,uI=w5.range,lI=Pd.range,cI=T5.range,fI=M5.range,h1=ml(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*pv)/c1},function(e){return e.getDate()-1}),lm=h1,hI=h1.range,p1=ml(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*g0-e.getMinutes()*pv)},function(e,i){e.setTime(+e+i*l1)},function(e,i){return(i-e)/l1},function(e){return e.getHours()}),P5=p1,pI=p1.range,d1=ml(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*g0)},function(e,i){e.setTime(+e+i*pv)},function(e,i){return(i-e)/pv},function(e){return e.getMinutes()}),I5=d1,dI=d1.range,v1=ml(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*g0)},function(e,i){return(i-e)/g0},function(e){return e.getUTCSeconds()}),O5=v1,vI=v1.range,_0=ml(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});_0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ml(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):_0};var R5=_0,mI=_0.range;function Hp(e){return ml(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/f1})}var m1=Hp(0),x0=Hp(1),L5=Hp(2),k5=Hp(3),Id=Hp(4),D5=Hp(5),F5=Hp(6),gI=m1.range,yI=x0.range,_I=L5.range,xI=k5.range,bI=Id.range,EI=D5.range,SI=F5.range,g1=ml(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/c1},function(e){return e.getUTCDate()-1}),y1=g1,CI=g1.range,cm=ml(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});cm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ml(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var dv=cm,AI=cm.range;function fm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function hm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function B5(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,g=e.shortMonths,x=mv(a),C=gv(a),A=mv(s),O=gv(s),D=mv(f),V=gv(f),Y=mv(v),te=gv(v),Ee=mv(g),Ze=gv(g),Je={a:As,A:iu,b:Ls,B:Pc,c:null,d:C1,e:C1,f:oM,g:mM,G:yM,H:nM,I:iM,j:aM,L:A1,m:sM,M:uM,p:Sm,q:L0,Q:O1,s:R1,S:lM,u:cM,U:fM,V:hM,w:pM,W:dM,x:null,X:null,y:vM,Y:gM,Z:_M,"%":I1},lt={a:d4,A:v4,b:m4,B:g4,c:null,d:T1,e:T1,f:SM,g:LM,G:DM,H:xM,I:bM,j:EM,L:M1,m:CM,M:AM,p:y4,q:_4,Q:O1,s:R1,S:wM,u:TM,U:MM,V:PM,w:IM,W:OM,x:null,X:null,y:RM,Y:kM,Z:FM,"%":I1},Et={a:Xr,A:yr,b:sn,B:Rn,c:Un,d:E1,e:E1,f:J5,g:b1,G:x1,H:S1,I:S1,j:q5,L:Q5,m:Y5,M:K5,p:Ir,q:X5,Q:tM,s:rM,S:$5,u:j5,U:V5,V:G5,w:Z5,W:H5,x:Da,X:So,y:b1,Y:x1,Z:W5,"%":eM};Je.x=xt(r,Je),Je.X=xt(n,Je),Je.c=xt(i,Je),lt.x=xt(r,lt),lt.X=xt(n,lt),lt.c=xt(i,lt);function xt(si,Ia){return function(Ka){var yn=[],Ol=-1,Go=0,rc=si.length,nc,Yp,Sb;for(Ka instanceof Date||(Ka=new Date(+Ka));++Ol<rc;)si.charCodeAt(Ol)===37&&(yn.push(si.slice(Go,Ol)),(Yp=_1[nc=si.charAt(++Ol)])!=null?nc=si.charAt(++Ol):Yp=nc==="e"?" ":"0",(Sb=Ia[nc])&&(nc=Sb(Ka,Yp)),yn.push(nc),Go=Ol+1);return yn.push(si.slice(Go,Ol)),yn.join("")}}function Kt(si,Ia){return function(Ka){var yn=vv(1900,void 0,1),Ol=ur(yn,si,Ka+="",0),Go,rc;if(Ol!=Ka.length)return null;if("Q"in yn)return new Date(yn.Q);if("s"in yn)return new Date(yn.s*1e3+("L"in yn?yn.L:0));if(Ia&&!("Z"in yn)&&(yn.Z=0),"p"in yn&&(yn.H=yn.H%12+yn.p*12),yn.m===void 0&&(yn.m="q"in yn?yn.q:0),"V"in yn){if(yn.V<1||yn.V>53)return null;"w"in yn||(yn.w=1),"Z"in yn?(Go=hm(vv(yn.y,0,1)),rc=Go.getUTCDay(),Go=rc>4||rc===0?x0.ceil(Go):x0(Go),Go=y1.offset(Go,(yn.V-1)*7),yn.y=Go.getUTCFullYear(),yn.m=Go.getUTCMonth(),yn.d=Go.getUTCDate()+(yn.w+6)%7):(Go=fm(vv(yn.y,0,1)),rc=Go.getDay(),Go=rc>4||rc===0?y0.ceil(Go):y0(Go),Go=lm.offset(Go,(yn.V-1)*7),yn.y=Go.getFullYear(),yn.m=Go.getMonth(),yn.d=Go.getDate()+(yn.w+6)%7)}else("W"in yn||"U"in yn)&&("w"in yn||(yn.w="u"in yn?yn.u%7:"W"in yn?1:0),rc="Z"in yn?hm(vv(yn.y,0,1)).getUTCDay():fm(vv(yn.y,0,1)).getDay(),yn.m=0,yn.d="W"in yn?(yn.w+6)%7+yn.W*7-(rc+5)%7:yn.w+yn.U*7-(rc+6)%7);return"Z"in yn?(yn.H+=yn.Z/100|0,yn.M+=yn.Z%100,hm(yn)):fm(yn)}}function ur(si,Ia,Ka,yn){for(var Ol=0,Go=Ia.length,rc=Ka.length,nc,Yp;Ol<Go;){if(yn>=rc)return-1;if(nc=Ia.charCodeAt(Ol++),nc===37){if(nc=Ia.charAt(Ol++),Yp=Et[nc in _1?Ia.charAt(Ol++):nc],!Yp||(yn=Yp(si,Ka,yn))<0)return-1}else if(nc!=Ka.charCodeAt(yn++))return-1}return yn}function Ir(si,Ia,Ka){var yn=x.exec(Ia.slice(Ka));return yn?(si.p=C[yn[0].toLowerCase()],Ka+yn[0].length):-1}function Xr(si,Ia,Ka){var yn=D.exec(Ia.slice(Ka));return yn?(si.w=V[yn[0].toLowerCase()],Ka+yn[0].length):-1}function yr(si,Ia,Ka){var yn=A.exec(Ia.slice(Ka));return yn?(si.w=O[yn[0].toLowerCase()],Ka+yn[0].length):-1}function sn(si,Ia,Ka){var yn=Ee.exec(Ia.slice(Ka));return yn?(si.m=Ze[yn[0].toLowerCase()],Ka+yn[0].length):-1}function Rn(si,Ia,Ka){var yn=Y.exec(Ia.slice(Ka));return yn?(si.m=te[yn[0].toLowerCase()],Ka+yn[0].length):-1}function Un(si,Ia,Ka){return ur(si,i,Ia,Ka)}function Da(si,Ia,Ka){return ur(si,r,Ia,Ka)}function So(si,Ia,Ka){return ur(si,n,Ia,Ka)}function As(si){return f[si.getDay()]}function iu(si){return s[si.getDay()]}function Ls(si){return g[si.getMonth()]}function Pc(si){return v[si.getMonth()]}function Sm(si){return a[+(si.getHours()>=12)]}function L0(si){return 1+~~(si.getMonth()/3)}function d4(si){return f[si.getUTCDay()]}function v4(si){return s[si.getUTCDay()]}function m4(si){return g[si.getUTCMonth()]}function g4(si){return v[si.getUTCMonth()]}function y4(si){return a[+(si.getUTCHours()>=12)]}function _4(si){return 1+~~(si.getUTCMonth()/3)}return{format:function(si){var Ia=xt(si+="",Je);return Ia.toString=function(){return si},Ia},parse:function(si){var Ia=Kt(si+="",!1);return Ia.toString=function(){return si},Ia},utcFormat:function(si){var Ia=xt(si+="",lt);return Ia.toString=function(){return si},Ia},utcParse:function(si){var Ia=Kt(si+="",!0);return Ia.toString=function(){return si},Ia}}}var _1={"-":"",_:" ","0":"0"},gu=/^\s*\d+/,N5=/^%/,z5=/[\\^$*+?|[\]().{}]/g;function qa(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function U5(e){return e.replace(z5,"\\$&")}function mv(e){return new RegExp("^(?:"+e.map(U5).join("|")+")","i")}function gv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function Z5(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function j5(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function V5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function G5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function H5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function x1(e,i,r){var n=gu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function b1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function W5(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function X5(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Y5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function E1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function q5(e,i,r){var n=gu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function S1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function K5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function $5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function Q5(e,i,r){var n=gu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function J5(e,i,r){var n=gu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function eM(e,i,r){var n=N5.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function tM(e,i,r){var n=gu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function rM(e,i,r){var n=gu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function C1(e,i){return qa(e.getDate(),i,2)}function nM(e,i){return qa(e.getHours(),i,2)}function iM(e,i){return qa(e.getHours()%12||12,i,2)}function aM(e,i){return qa(1+lm.count(Md(e),e),i,3)}function A1(e,i){return qa(e.getMilliseconds(),i,3)}function oM(e,i){return A1(e,i)+"000"}function sM(e,i){return qa(e.getMonth()+1,i,2)}function uM(e,i){return qa(e.getMinutes(),i,2)}function lM(e,i){return qa(e.getSeconds(),i,2)}function cM(e){var i=e.getDay();return i===0?7:i}function fM(e,i){return qa(um.count(Md(e)-1,e),i,2)}function w1(e){var i=e.getDay();return i>=4||i===0?Pd(e):Pd.ceil(e)}function hM(e,i){return e=w1(e),qa(Pd.count(Md(e),e)+(Md(e).getDay()===4),i,2)}function pM(e){return e.getDay()}function dM(e,i){return qa(y0.count(Md(e)-1,e),i,2)}function vM(e,i){return qa(e.getFullYear()%100,i,2)}function mM(e,i){return e=w1(e),qa(e.getFullYear()%100,i,2)}function gM(e,i){return qa(e.getFullYear()%1e4,i,4)}function yM(e,i){var r=e.getDay();return e=r>=4||r===0?Pd(e):Pd.ceil(e),qa(e.getFullYear()%1e4,i,4)}function _M(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+qa(i/60|0,"0",2)+qa(i%60,"0",2)}function T1(e,i){return qa(e.getUTCDate(),i,2)}function xM(e,i){return qa(e.getUTCHours(),i,2)}function bM(e,i){return qa(e.getUTCHours()%12||12,i,2)}function EM(e,i){return qa(1+y1.count(dv(e),e),i,3)}function M1(e,i){return qa(e.getUTCMilliseconds(),i,3)}function SM(e,i){return M1(e,i)+"000"}function CM(e,i){return qa(e.getUTCMonth()+1,i,2)}function AM(e,i){return qa(e.getUTCMinutes(),i,2)}function wM(e,i){return qa(e.getUTCSeconds(),i,2)}function TM(e){var i=e.getUTCDay();return i===0?7:i}function MM(e,i){return qa(m1.count(dv(e)-1,e),i,2)}function P1(e){var i=e.getUTCDay();return i>=4||i===0?Id(e):Id.ceil(e)}function PM(e,i){return e=P1(e),qa(Id.count(dv(e),e)+(dv(e).getUTCDay()===4),i,2)}function IM(e){return e.getUTCDay()}function OM(e,i){return qa(x0.count(dv(e)-1,e),i,2)}function RM(e,i){return qa(e.getUTCFullYear()%100,i,2)}function LM(e,i){return e=P1(e),qa(e.getUTCFullYear()%100,i,2)}function kM(e,i){return qa(e.getUTCFullYear()%1e4,i,4)}function DM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Id(e):Id.ceil(e),qa(e.getUTCFullYear()%1e4,i,4)}function FM(){return"+0000"}function I1(){return"%"}function O1(e){return+e}function R1(e){return Math.floor(+e/1e3)}var Od,L1,BM,NM,zM;UM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function UM(e){return Od=B5(e),L1=Od.format,BM=Od.parse,NM=Od.utcFormat,zM=Od.utcParse,Od}var yv=1e3,_v=yv*60,xv=_v*60,bv=xv*24,ZM=bv*7,k1=bv*30,pm=bv*365;function jM(e){return new Date(e)}function VM(e){return e instanceof Date?+e:+new Date(+e)}function D1(e,i,r,n,a,s,f,v,g){var x=Z_(Mc,Mc),C=x.invert,A=x.domain,O=g(".%L"),D=g(":%S"),V=g("%I:%M"),Y=g("%I %p"),te=g("%a %d"),Ee=g("%b %d"),Ze=g("%B"),Je=g("%Y"),lt=[[f,1,yv],[f,5,5*yv],[f,15,15*yv],[f,30,30*yv],[s,1,_v],[s,5,5*_v],[s,15,15*_v],[s,30,30*_v],[a,1,xv],[a,3,3*xv],[a,6,6*xv],[a,12,12*xv],[n,1,bv],[n,2,2*bv],[r,1,ZM],[i,1,k1],[i,3,3*k1],[e,1,pm]];function Et(Kt){return(f(Kt)<Kt?O:s(Kt)<Kt?D:a(Kt)<Kt?V:n(Kt)<Kt?Y:i(Kt)<Kt?r(Kt)<Kt?te:Ee:e(Kt)<Kt?Ze:Je)(Kt)}function xt(Kt,ur,Ir,Xr){if(Kt==null&&(Kt=10),typeof Kt=="number"){var yr=Math.abs(Ir-ur)/Kt,sn=M_(function(Rn){return Rn[2]}).right(lt,yr);sn===lt.length?(Xr=$0(ur/pm,Ir/pm,Kt),Kt=e):sn?(sn=lt[yr/lt[sn-1][2]<lt[sn][2]/yr?sn-1:sn],Xr=sn[1],Kt=sn[0]):(Xr=Math.max($0(ur,Ir,Kt),1),Kt=v)}return Xr==null?Kt:Kt.every(Xr)}return x.invert=function(Kt){return new Date(C(Kt))},x.domain=function(Kt){return arguments.length?A(c0.call(Kt,VM)):A().map(jM)},x.ticks=function(Kt,ur){var Ir=A(),Xr=Ir[0],yr=Ir[Ir.length-1],sn=yr<Xr,Rn;return sn&&(Rn=Xr,Xr=yr,yr=Rn),Rn=xt(Kt,Xr,yr,ur),Rn=Rn?Rn.range(Xr,yr+1):[],sn?Rn.reverse():Rn},x.tickFormat=function(Kt,ur){return ur==null?Et:g(ur)},x.nice=function(Kt,ur){var Ir=A();return(Kt=xt(Kt,Ir[0],Ir[Ir.length-1],ur))?A($_(Ir,Kt)):x},x.copy=function(){return h0(x,D1(e,i,r,n,a,s,f,v,g))},x}function GM(){return op.apply(D1(Md,C5,um,lm,P5,I5,O5,R5,L1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function wI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function b0(){var e=0,i=1,r,n,a,s,f=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:f(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(f=C,x):f},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function E0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function HM(){var e=linearish(b0()(identity));return e.copy=function(){return E0(e,HM())},initInterpolator.apply(e,arguments)}function WM(){var e=loggish(b0()).domain([1,10]);return e.copy=function(){return E0(e,WM()).base(e.base())},initInterpolator.apply(e,arguments)}function XM(){var e=symlogish(b0());return e.copy=function(){return E0(e,XM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function F1(){var e=powish(b0());return e.copy=function(){return E0(e,F1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function TI(){return F1.apply(null,arguments).exponent(.5)}function YM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return YM(i).domain(e)},initInterpolator.apply(r,arguments)}function S0(){var e=0,i=.5,r=1,n,a,s,f,v,g=identity,x,C=!1,A;function O(D){return isNaN(D=+D)?A:(D=.5+((D=+x(D))-a)*(D<a?f:v),g(C?Math.max(0,Math.min(1,D)):D))}return O.domain=function(D){return arguments.length?(n=x(e=+D[0]),a=x(i=+D[1]),s=x(r=+D[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(D){return arguments.length?(C=!!D,O):C},O.interpolator=function(D){return arguments.length?(g=D,O):g},O.unknown=function(D){return arguments.length?(A=D,O):A},function(D){return x=D,n=D(e),a=D(i),s=D(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function qM(){var e=linearish(S0()(identity));return e.copy=function(){return copy(e,qM())},initInterpolator.apply(e,arguments)}function KM(){var e=loggish(S0()).domain([.1,1,10]);return e.copy=function(){return copy(e,KM()).base(e.base())},initInterpolator.apply(e,arguments)}function $M(){var e=symlogish(S0());return e.copy=function(){return copy(e,$M()).constant(e.constant())},initInterpolator.apply(e,arguments)}function B1(){var e=powish(S0());return e.copy=function(){return copy(e,B1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function MI(){return B1.apply(null,arguments).exponent(.5)}var rf,N1,z1,U1,dm,Z1,QM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,JM=(rf={},(0,I.Z)(rf,nu.LINEAR,q_),(0,I.Z)(rf,nu.POWER,im),(0,I.Z)(rf,nu.LOG,t1),(0,I.Z)(rf,nu.IDENTITY,K_),(0,I.Z)(rf,nu.TIME,GM),(0,I.Z)(rf,nu.QUANTILE,a1),(0,I.Z)(rf,nu.QUANTIZE,o1),(0,I.Z)(rf,nu.THRESHOLD,s1),(0,I.Z)(rf,nu.CAT,f0),rf),e3=(N1=(0,Ye.b2)(),z1=(0,Ye.f3)(De.IGlobalConfigService),N1(U1=(dm=function(){function e(){(0,ut.Z)(this,e),Ce(this,"configService",Z1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=f.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var g=[];f.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===Jh.VARIABLE})?(f.type=Jh.VARIABLE,g.forEach(function(x){if(!f.callback){var C;if(f.values&&f.values!=="text"){var A;if(((A=x.option)===null||A===void 0?void 0:A.type)==="linear"&&f.values.length>2){var O=x.scale.ticks(f.values.length);v==="color"&&x.scale.domain(O)}x.scale.range(f.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(f.type=Jh.CONSTANT,f.defaultValues=g.map(function(x,C){return x.scale(f.names[C])})),f.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,f=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Tu()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,g=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Jh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=f0([r]),x.type=Jh.CONSTANT),x;var C=(v=s.find(function(D){return!bc()(D[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||bc()(C)&&!g)x.scale=f0([r]),x.type=Jh.CONSTANT;else{var A=g&&g.type||this.getDefaultType(C);a==="text"&&(A=nu.CAT);var O=this.createDefaultScaleConfig(A,r,s);Object.assign(O,g),x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=nu.LINEAR;return typeof r=="string"&&(n=QM.test(r)?nu.TIME:nu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},f=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==nu.CAT&&r!==nu.QUANTILE?s.domain=VT(f):r===nu.CAT?s.domain=Tm()(f):r===nu.QUANTILE&&(s.domain=f),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=JM[n]();return a&&s.domain(a),s}}]),e}(),Z1=Ge(dm.prototype,"configService",[z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm))||U1),j1,V1,G1,H1,C0,W1,X1;function Y1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function t3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Y1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var r3=(j1=(0,Ye.b2)(),V1=(0,Ye.f3)(De.ICameraService),G1=(0,Ye.f3)(De.IRendererService),j1(H1=(C0=function(){function e(){(0,ut.Z)(this,e),Ce(this,"cameraService",W1,this),Ce(this,"rendererService",X1,this)}return(0,St.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(t3({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),W1=Ge(C0.prototype,"cameraService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=Ge(C0.prototype,"rendererService",[G1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0))||H1),q1,K1,n3=(q1=(0,Ye.b2)(),q1(K1=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||K1),$1,Q1,i3=($1=(0,Ye.b2)(),$1(Q1=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||Q1),J1,ex,a3=["type"];function tx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ev(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var rx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},o3={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},s3={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},u3={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},PI=null;function l3(e){var i={u_DirectionalLights:new Array(3).fill(Ev({},s3)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Ev({},u3)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[o3]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,vh.Z)(r,a3),v=rx[s].lights,g=rx[s].num,x=i[g];i[v][x]=Ev(Ev({},i[v][x]),f),i[g]++}),i}var c3=(J1=(0,Ye.b2)(),J1(ex=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(Ev({},l3()))})})}}]),e}())||ex),nx,ix,ax,vm,ox,f3=(nx=(0,Ye.b2)(),ix=(0,Ye.f3)(De.IGlobalConfigService),nx(ax=(vm=function(){function e(){(0,ut.Z)(this,e),Ce(this,"configService",ox,this),(0,I.Z)(this,"enabled",void 0)}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,A=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=ny(r,A,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),ox=Ge(vm.prototype,"configService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm))||ax),sx,ux,A0={NONE:0,ENCODE:1,HIGHLIGHT:2},h3=(sx=(0,Ye.b2)(),sx(ux=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:Tn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:W.FLOAT},size:3,update:function(g,x){var C=g.id;return f?tn(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:A0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:A0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,A=typeof g=="string"?lr(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Mr(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:A0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:A.map(function(D){return D*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,A=typeof g=="string"?lr(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Mr(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:A0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:A.map(function(D){return D*255}),u_activeMix:C,u_CurrentSelectedId:f,u_SelectColor:A.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||ux),lx,cx,p3=(lx=(0,Ye.b2)(),lx(cx=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Tn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:W.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:Tn.Attribute,descriptor:{name:"filter",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Tn.Attribute,descriptor:{name:"a_Color",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:Tn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||cx),fx,hx,px,dx,vx,mx,Rd,gx,yx,_x,xx,d3=(fx=(0,Ye.b2)(),hx=(0,Ye.f3)(De.ICameraService),px=(0,Ye.f3)(De.ICoordinateSystemService),dx=(0,Ye.f3)(De.IRendererService),vx=(0,Ye.f3)(De.IMapService),fx(mx=(Rd=function(){function e(){(0,ut.Z)(this,e),Ce(this,"cameraService",gx,this),Ce(this,"coordinateSystemService",yx,this),Ce(this,"rendererService",_x,this),Ce(this,"mapService",xx,this)}return(0,St.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var A;C.addUniforms((A={},(0,I.Z)(A,Fp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(A,Fp.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(A,Fp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(A,Fp.Zoom,n.cameraService.getZoom()),(0,I.Z)(A,Fp.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(A,Fp.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(A,Fp.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(A,Il.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(A,Il.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(A,Il.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(A,Il.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(A,Il.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(A,Il.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(A,Il.Mvp,s),(0,I.Z)(A,"u_SceneCenterMKT",f),(0,I.Z)(A,"u_ViewportSize",[g,x]),(0,I.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(A,"u_DevicePixelRatio",pa.devicePixelRatio),(0,I.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(A,"u_shaderPick",Number(r.getShaderPickStat())),A))})})}}]),e}(),gx=Ge(Rd.prototype,"cameraService",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=Ge(Rd.prototype,"coordinateSystemService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=Ge(Rd.prototype,"rendererService",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Ge(Rd.prototype,"mapService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd))||mx),bx,Ex,v3=(bx=(0,Ye.b2)(),bx(Ex=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||Ex),Sx,Cx,m3=(Sx=(0,Ye.b2)(),Sx(Cx=function(){function e(){(0,ut.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||Cx);tc.bind(De.ILayerPlugin).to(UT).inRequestScope(),tc.bind(De.ILayerPlugin).to(p3).inRequestScope(),tc.bind(De.ILayerPlugin).to(e3).inRequestScope(),tc.bind(De.ILayerPlugin).to(zT).inRequestScope(),tc.bind(De.ILayerPlugin).to(i3).inRequestScope(),tc.bind(De.ILayerPlugin).to(m3).inRequestScope(),tc.bind(De.ILayerPlugin).to(v3).inRequestScope(),tc.bind(De.ILayerPlugin).to(f3).inRequestScope(),tc.bind(De.ILayerPlugin).to(d3).inRequestScope(),tc.bind(De.ILayerPlugin).to(r3).inRequestScope(),tc.bind(De.ILayerPlugin).to(c3).inRequestScope(),tc.bind(De.ILayerPlugin).to(h3).inRequestScope(),tc.bind(De.ILayerPlugin).to(n3).inRequestScope();var II="2.8.36";function Ax(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function OI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ax(Object(r),!0).forEach(function(n){g3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ax(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function RI(e,i){return b3(e)||x3(e,i)||_3(e,i)||y3()}function y3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _3(e,i){if(!!e){if(typeof e=="string")return Tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tx(e,i)}}function Tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function x3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function b3(e){if(Array.isArray(e))return e}var LI=null,kI=null,Mx,mm,Px;function Ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ox(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ix(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var E3=(Mx=z0(De.IGlobalConfigService),mm=function(){function e(i){(0,ut.Z)(this,e),Ce(this,"configService",Px,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,St.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(De.MapConfig).toConstantValue(Ox(Ox({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(De.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Px=Ge(mm.prototype,"configService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm),S3=N(6158),Sv=N.n(S3);function Cv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function w0(e,i){var r=Ss([],i,e);return bi(r,r,1/r[3]),r}function DI(e,i){var r=e%i;return r<0?i+r:r}function FI(e,i,r){return r*i+(1-r)*e}function Wp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var nf=Math.PI,Rx=nf/4,bh=nf/180,Lx=180/nf,gm=512,ym=4003e4,C3=1.5;function kx(e){return Math.pow(2,e)}function A3(e){return Math.log2(e)}function T0(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];Wp(Number.isFinite(n)&&Number.isFinite(i)),Wp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=gm;var s=n*bh,f=a*bh,v=i*(s+nf)/(2*nf),g=i*(nf-Math.log(Math.tan(Rx+f*.5)))/(2*nf);return[v,g]}function _m(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];i*=gm;var s=n/i*(2*nf)-nf,f=2*(Math.atan(Math.exp(nf-a/i*(2*nf)))-Rx);return[s*Lx,f*Lx]}function BI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*bh);return A3(ym*r)-9}function Dx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:kx(n),Wp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=gm*a,x=Math.cos(i*bh),C=g/360,A=C/x,O=g/ym/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-A,O],v.degreesPerPixel=[1/C,-1/A,1/O],f){var D=bh*Math.tan(i*bh)/x,V=C*D/2,Y=g/ym*D,te=Y/A*O;v.pixelsPerDegree2=[0,-V,Y],v.pixelsPerMeter2=[te,0,te]}return v}function NI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],g=f[1],x=f[2],C=1,A=Dx({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=A.pixelsPerMeter,D=A.pixelsPerMeter2,V=T0(e,C);V[0]+=v*(O[0]+D[0]*g),V[1]+=g*(O[1]+D[1]*g);var Y=_m(V,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[Y[0],Y[1],te]:Y}function w3(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=Cv();return Ve(x,x,[0,0,-a]),ft(x,x,[1,1,1/i]),$e(x,x,-r*bh),ot(x,x,n*bh),g&&ft(x,x,[1,-1,1]),f&&Ve(x,x,Ha.negate([],f)),x}function T3(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?C3:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,A=f*bh,O=Math.atan(.5/a),D=Math.sin(O)*a/Math.sin(Math.PI/2-A-O),V=Math.cos(Math.PI/2-A)*D+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:V*C}}function M3(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=T3({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),g=v.fov,x=v.aspect,C=v.near,A=v.far,O=va([],g,x,C,A);return O}function P3(e,i){var r=(0,Q.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Wp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),w0(i,[n,a,f,1])}function Fx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Q.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Wp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=w0(i,[a,s,f,1]);return v}var g=w0(i,[a,s,0,1]),x=w0(i,[a,s,1,1]),C=g[2],A=x[2],O=C===A?0:((r||0)-C)/(A-C);return gi.t7([],g,x,O)}var Bx=Cv(),I3=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?Bx:a,f=i.projectionMatrix,v=f===void 0?Bx:f;(0,ut.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=Cv();re(g,g,this.projectionMatrix),re(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=Cv();ft(x,x,[this.width/2,-this.height/2,1]),Ve(x,x,[1,-1,0]),re(x,x,this.viewProjectionMatrix);var C=cn(Cv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,St.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ql(r.projectionMatrix,this.projectionMatrix)&&ql(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=P3(f,this.pixelProjectionMatrix),g=(0,Q.Z)(v,2),x=g[0],C=g[1],A=s?C:this.height-C;return r.length===2?[x,A]:[x,A,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,Q.Z)(r,3),g=v[0],x=v[1],C=v[2],A=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,D=Fx([g,A,C],this.pixelUnprojectionMatrix,O),V=this.unprojectPosition(D),Y=(0,Q.Z)(V,3),te=Y[0],Ee=Y[1],Ze=Y[2];return Number.isFinite(C)?[te,Ee,Ze]:Number.isFinite(f)?[te,Ee,f]:[te,Ee]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,Q.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,Q.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function O3(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,g=e.padding,x=g===void 0?0:g,C=e.offset,A=C===void 0?[0,0]:C,O=(0,Q.Z)(n,2),D=(0,Q.Z)(O[0],2),V=D[0],Y=D[1],te=(0,Q.Z)(O[1],2),Ee=te[0],Ze=te[1];if(Number.isFinite(x)){var Je=x;x={top:Je,bottom:Je,left:Je,right:Je}}else Wp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var lt=new Nx({width:i,height:r,longitude:0,latitude:0,zoom:0}),Et=lt.project([V,Ze]),xt=lt.project([Ee,Y]),Kt=[Math.max(Math.abs(xt[0]-Et[0]),s),Math.max(Math.abs(xt[1]-Et[1]),s)],ur=[i-x.left-x.right-Math.abs(A[0])*2,r-x.top-x.bottom-Math.abs(A[1])*2];Wp(ur[0]>0&&ur[1]>0);var Ir=ur[0]/Kt[0],Xr=ur[1]/Kt[1],yr=(x.right-x.left)/2/Ir,sn=(x.bottom-x.top)/2/Xr,Rn=[(xt[0]+Et[0])/2+yr,(xt[1]+Et[1])/2+sn],Un=lt.unproject(Rn),Da=lt.zoom+Math.log2(Math.abs(Math.min(Ir,Xr)));return{longitude:Un[0],latitude:Un[1],zoom:Math.min(Da,v)}}var Nx=function(e){(0,Yr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,g=n.longitude,x=g===void 0?0:g,C=n.zoom,A=C===void 0?0:C,O=n.pitch,D=O===void 0?0:O,V=n.bearing,Y=V===void 0?0:V,te=n.altitude,Ee=te===void 0?1.5:te,Ze=n.nearZMultiplier,Je=n.farZMultiplier;(0,ut.Z)(this,i),a=a||1,s=s||1;var lt=kx(A);Ee=Math.max(.75,Ee);var Et=T0([x,v],lt);Et[2]=0;var xt=M3({width:a,height:s,pitch:D,bearing:Y,altitude:Ee,nearZMultiplier:Ze||1/s,farZMultiplier:Je||1.01}),Kt=w3({height:s,center:Et,pitch:D,bearing:Y,altitude:Ee,flipY:!0});return r=(0,Vr.Z)(this,(0,It.Z)(i).call(this,{width:a,height:s,viewMatrix:Kt,projectionMatrix:xt})),r.latitude=v,r.longitude=x,r.zoom=A,r.pitch=D,r.bearing=Y,r.altitude=Ee,r.scale=lt,r.center=Et,r.pixelsPerMeter=Dx((0,oe.Z)((0,oe.Z)(r))).pixelsPerMeter[2],Object.freeze((0,oe.Z)((0,oe.Z)(r))),r}return(0,St.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return T0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return _m(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=Fx(s,this.pixelUnprojectionMatrix),v=T0(a,this.scale),g=gi.IH([],v,gi.tk([],f)),x=gi.IH([],this.center,g);return _m(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=O3(Object.assign({width:s,height:f,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:f,longitude:g,latitude:x,zoom:C})}}]),i}(I3),R3=function(){function e(){(0,ut.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,St.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new Nx({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),L3=function(){function e(i){(0,ut.Z)(this,e),(0,I.Z)(this,"size",1e4),this.size=i||1e4}return(0,St.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),zx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},k3=["id","attributionControl","style","token","rotation","mapInstance"],Ux,Zx,jx,Vx,Gx,Hx,Ld,Wx,Xx,Yx,qx;function Kx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function D3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}F3(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Sv();var $x={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},B3=0,N3=12,Qx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",z3=(Ux=(0,Ye.b2)(),Zx=(0,Ye.f3)(De.MapConfig),jx=(0,Ye.f3)(De.IGlobalConfigService),Vx=(0,Ye.f3)(De.ICoordinateSystemService),Gx=(0,Ye.f3)(De.IEventEmitter),Ux(Hx=(Ld=function(){function e(){var i=this;(0,ut.Z)(this,e),(0,I.Z)(this,"version",Rs.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"simpleMapCoord",new L3),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ce(this,"config",Wx,this),Ce(this,"configService",Xx,this),Ce(this,"coordinateSystemService",Yx,this),Ce(this,"eventEmitter",qx,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?N3:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(Os.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Os.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,St.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=la("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){bE.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on($x[r]||r,n)}},{key:"off",value:function(r,n){this.map.off($x[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:f,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=mi();return Ve(x,x,Ha.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),ft(x,x,Ha.fromValues(g*s[0],-g*s[1],g*s[2])),$e(x,x,a[0]),Ne(x,x,a[1]),ot(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,Sn.Z)(Xn().mark(function n(){var a,s,f,v,g,x,C,A,O,D,V,Y,te;return Xn().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,A=a.token,O=A===void 0?Qx:A,D=a.rotation,V=D===void 0?0:D,Y=a.mapInstance,te=(0,vh.Z)(a,k3),this.viewport=new R3,!Y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Qx&&C!=="blank"&&!window.mapboxgl.accessToken&&!Y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),Y?(this.map=Y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(D3({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:V},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ze.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(Sv()).LngLat(r[0],r[1]),s=new(Sv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=Sv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=Sv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,A=g.x,O=g.y,D=Math.sqrt(Math.pow(x-A,2)+Math.pow(C-O,2))*4194304*2;return D/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+B3++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:zx[r]?zx[r]:r}}]),e}(),Wx=Ge(Ld.prototype,"config",[Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xx=Ge(Ld.prototype,"configService",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yx=Ge(Ld.prototype,"coordinateSystemService",[Vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qx=Ge(Ld.prototype,"eventEmitter",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||Hx);function U3(e){var i=Z3();return function(){var n=(0,It.Z)(e),a;if(i){var s=(0,It.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Vr.Z)(this,a)}}function Z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}j3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var V3=function(e){(0,Yr.Z)(r,e);var i=U3(r);function r(){return(0,ut.Z)(this,r),i.apply(this,arguments)}return(0,St.Z)(r,[{key:"getServiceConstructor",value:function(){return z3}}]),r}(E3);function Jx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eb(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jx(Object(r),!0).forEach(function(n){G3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function H3(e,i){return q3(e)||Y3(e,i)||X3(e,i)||W3()}function W3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X3(e,i){if(!!e){if(typeof e=="string")return tb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tb(e,i)}}function tb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Y3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function q3(e){if(Array.isArray(e))return e}var K3=ke.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,ke.createRef)(),v=(0,ke.useState)(),g=H3(v,2),x=g[0],C=g[1];return(0,ke.useEffect)(function(){var A=new QS(eb(eb({id:f.current},a),{},{map:new V3(n)}));return A.on("loaded",function(){C(A),s&&s(A)}),function(){A.destroy()}},[]),(0,ke.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ke.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,ke.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ke.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,ke.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),ke.createElement(Er.Provider,{value:x},(0,ke.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),$3=K3;function rb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rb(Object(r),!0).forEach(function(n){Q3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Q3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UI(e,i){return rP(e)||tP(e,i)||eP(e,i)||J3()}function J3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eP(e,i){if(!!e){if(typeof e=="string")return nb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nb(e,i)}}function nb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function tP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function rP(e){if(Array.isArray(e))return e}var ZI=null,jI=null;function ib(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ib(Object(r),!0).forEach(function(n){nP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ib(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function GI(e,i){return sP(e)||oP(e,i)||aP(e,i)||iP()}function iP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aP(e,i){if(!!e){if(typeof e=="string")return ab(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ab(e,i)}}function ab(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function sP(e){if(Array.isArray(e))return e}var HI=null,WI=null;function XI(e,i){return fP(e)||cP(e,i)||lP(e,i)||uP()}function uP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lP(e,i){if(!!e){if(typeof e=="string")return ob(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ob(e,i)}}function ob(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function cP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function fP(e){if(Array.isArray(e))return e}var YI=null,qI=null;function sb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sb(Object(r),!0).forEach(function(n){hP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $I(e,i){if(e==null)return{};var r=pP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function pP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var QI=null,ub=N(73935);function lb(e,i){return gP(e)||mP(e,i)||vP(e,i)||dP()}function dP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vP(e,i){if(!!e){if(typeof e=="string")return cb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cb(e,i)}}function cb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function gP(e){if(Array.isArray(e))return e}var fb=ke.useEffect,hb=ke.useState,yP=/\B([A-Z])/g,_P=function(i){return i.replace(yP,"-$1").toLowerCase()};function JI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=hb(),f=lb(s,2),v=f[0],g=f[1],x=useSceneValue(),C=hb(function(){return document.createElement("div")}),A=lb(C,1),O=A[0];return fb(function(){var D=new Control({position:a});return D.onAdd=function(){if(i&&(O.className=i),r){var V=Object.keys(r).map(function(Y){return"".concat(_P(Y),":").concat(r[Y])}).join(";");O.style.cssText=V}return O},D.onRemove=function(){},g(D),x.addControl(D),function(){x.removeControl(D)}},[]),fb(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var pb=(0,ke.createContext)({});function eO(){return useContext(pb)}var Wf=N(96486),tO=ke.useEffect,xP=ke.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Wf.isEqual),rO=ke.useEffect,bP=ke.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Wf.isEqual),nO=ke.useEffect,EP=ke.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Wf.isEqual),SP=ke.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Wf.isEqual),CP=ke.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Wf.isEqual),iO=ke.useEffect,AP=ke.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Wf.isEqual),wP=ke.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Wf.isEqual),TP=ke.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Wf.isEqual),MP=["data"];function PP(e,i){if(e==null)return{};var r=IP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function IP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var OP=ke.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=PP(n,MP);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Wf.isEqual),aO=ke.useEffect,RP=ke.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Wf.isEqual);function LP(e,i){return BP(e)||FP(e,i)||DP(e,i)||kP()}function kP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DP(e,i){if(!!e){if(typeof e=="string")return db(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return db(e,i)}}function db(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function FP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function BP(e){if(Array.isArray(e))return e}var Av=ke.useEffect,NP=ke.useState;function vb(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,A=i.animate,O=i.options,D=i.onLayerLoaded,V=Kn(),Y=NP(function(){var Ze;switch(e){case"polygonLayer":Ze=new v_(O);break;case"lineLayer":Ze=new Yy(O);break;case"pointLayer":Ze=new d_(O);break;case"heatmapLayer":Ze=new DC(O);break;case"rasterLayer":Ze=new BT(O);break;case"imageLayer":Ze=new Gy(O);break;case"citybuildingLayer":Ze=new oC(O);break;default:Ze=new v_(O)}return Ze.on("inited",function(){D&&D(Ze,V)}),Ze}),te=LP(Y,1),Ee=te[0];return Av(function(){return V.addLayer(Ee),function(){V.removeLayer(Ee)}},[]),Av(function(){Ee.inited&&O&&Ee.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Av(function(){Ee.inited&&(O==null?void 0:O.zIndex)&&Ee.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Av(function(){Ee.inited&&(O==null?void 0:O.blend)&&Ee.setBlend(O.blend)},[O==null?void 0:O.blend]),Av(function(){V.render()}),ke.createElement(pb.Provider,{value:Ee},ke.createElement(OP,{layer:Ee,source:r}),v&&ke.createElement(CP,{layer:Ee,scale:v}),n&&ke.createElement(EP,{layer:Ee,color:n}),f&&ke.createElement(TP,{layer:Ee,size:f}),a&&ke.createElement(wP,{layer:Ee,shape:a}),s&&ke.createElement(RP,{layer:Ee,style:s}),g&&ke.createElement(xP,{layer:Ee,active:g}),x&&ke.createElement(AP,{layer:Ee,select:x}),C&&ke.createElement(SP,{layer:Ee,filter:C}),A&&ke.createElement(bP,{layer:Ee,animate:A}),i.children)}var oO=null,sO=null,mb=ke.memo(function(i){return vb("pointLayer",i)}),zP=ke.memo(function(i){return vb("heatmapLayer",i)}),uO=null,lO=null,cO=null,fO=ke.useEffect,hO=null,pO=null;function M0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M0=function(r){return typeof r}:M0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},M0(e)}function gb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gb(Object(r),!0).forEach(function(n){UP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function ZP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function yb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jP(e,i,r){return i&&yb(e.prototype,i),r&&yb(e,r),e}function VP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&xm(e,i)}function xm(e,i){return xm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},xm(e,i)}function GP(e){var i=XP();return function(){var n=I0(e),a;if(i){var s=I0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return HP(this,a)}}function HP(e,i){if(i&&(M0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WP(e)}function WP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function I0(e){return I0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},I0(e)}var dO=function(e){VP(r,e);var i=GP(r);function r(n){var a;return ZP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return jP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new Jg(P0(P0({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&C.setLnglat(f),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,f,v,g,x,C,A=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],D=A.toString()!==O.toString();if(D){var V;this.popup.remove(),this.popup=new Jg(P0(P0({},this.props.option),{},{stopPropagation:(V=this.props.option)===null||V===void 0?void 0:V.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ke.createElement(Er.Consumer,{},function(s){return s&&(a.scene=s),(0,ub.createPortal)(a.props.children,a.el)})}}]),r}(ke.PureComponent);function O0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O0=function(r){return typeof r}:O0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},O0(e)}function YP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _b(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qP(e,i,r){return i&&_b(e.prototype,i),r&&_b(e,r),e}function KP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&bm(e,i)}function bm(e,i){return bm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},bm(e,i)}function $P(e){var i=e4();return function(){var n=R0(e),a;if(i){var s=R0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return QP(this,a)}}function QP(e,i){if(i&&(O0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JP(e)}function JP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function e4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function R0(e){return R0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},R0(e)}var vO=function(e){KP(r,e);var i=$P(r);function r(n){var a;return YP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return qP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,g=a.onMarkerLoaded,x=new Yg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ke.createElement(Er.Consumer,{},function(s){return s&&(a.scene=s),(0,ub.createPortal)(a.props.children,a.el)})}}]),r}(ke.PureComponent),mO=ke.useEffect,gO=null,yO=null,_O=ke.useEffect,xO=null,t4=N(83832),hi=N(85893),r4=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],n4=function(e){(0,Mt.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ke.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,Fe.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Te.Z)(qt().mark(function s(){var f,v,g,x;return qt().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(O){return O.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(O){return O.json()})]);case 2:f=A.sent,v=(0,en.Z)(f,2),g=v[0],x=v[1],this.setState({data:g,grid:x,loading:!0});case 7:case"end":return A.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,f=a.grid,v=a.loading;return v===!1?(0,hi.jsx)(t4.Z,{}):(0,hi.jsxs)($3,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[f&&(0,hi.jsx)(zP,{source:{data:f,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,hi.jsx)(mb,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:r4},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,hi.jsx)(mb,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(ke.Component),xb=N(86582),i4=N(93343),a4=N(70499),Xp=N.n(a4);function o4(e){return e*1<10?"0".concat(e):e}function bb(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(o4(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var s4=function(e){(0,Mt.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ke.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:bb()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:bb()},function(){n.loopData()})},1e3)})},n}return(0,Fe.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,hi.jsxs)("div",{className:Xp().activeChart,children:[(0,hi.jsx)(ae.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,hi.jsx)("div",{style:{marginTop:32},children:(0,hi.jsx)(i4.Z,{autoFit:!0,data:s.map(function(f){return f.y}),height:84})}),s&&(0,hi.jsxs)("div",{children:[(0,hi.jsxs)("div",{className:Xp().activeChartGrid,children:[(0,hi.jsxs)("p",{children:[(0,xb.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,hi.jsxs)("p",{children:[(0,xb.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,hi.jsx)("div",{className:Xp().dashedLine,children:(0,hi.jsx)("div",{className:Xp().line})}),(0,hi.jsx)("div",{className:Xp().dashedLine,children:(0,hi.jsx)("div",{className:Xp().line})})]}),s&&(0,hi.jsxs)("div",{className:Xp().activeChartLegend,children:[(0,hi.jsx)("span",{children:"00:00"}),(0,hi.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,hi.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(ke.Component);function u4(){return Em.apply(this,arguments)}function Em(){return Em=(0,Te.Z)(qt().mark(function e(){return qt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,nt.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),Em.apply(this,arguments)}var l4=N(19134),Eb=N.n(l4),c4=ae.Z.Countdown,f4=Date.now()+1e3*60*60*24*2+1e3*30,h4=function(){var i=(0,nt.QT)(u4),r=i.loading,n=i.data,a=(n==null?void 0:n.list)||[];return(0,hi.jsx)($t.Z,{children:(0,hi.jsxs)(hi.Fragment,{children:[(0,hi.jsxs)(j.Z,{gutter:24,children:[(0,hi.jsx)(ue.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsxs)(m.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,hi.jsxs)(j.Z,{children:[(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(ae.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Fr()(124543233).format("0,0")})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(ae.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(c4,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:f4,format:"HH:mm:ss:SSS"})}),(0,hi.jsx)(ue.Z,{md:6,sm:12,xs:24,children:(0,hi.jsx)(ae.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Fr()(234).format("0,0")})})]}),(0,hi.jsx)("div",{className:Eb().mapChart,children:(0,hi.jsx)(n4,{})})]})}),(0,hi.jsxs)(ue.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,hi.jsx)(m.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,hi.jsx)(s4,{})}),(0,hi.jsx)(m.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,hi.jsx)(mt,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(f){return Number(f)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,hi.jsxs)(j.Z,{gutter:24,children:[(0,hi.jsx)(ue.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(m.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Eb().pieCard,children:(0,hi.jsxs)(j.Z,{style:{padding:"16px 0"},children:[(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(tt.Z,{autoFit:!0,height:128,percent:.28})}),(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(tt.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,hi.jsx)(ue.Z,{span:8,children:(0,hi.jsx)(tt.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,hi.jsx)(ue.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(m.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,hi.jsx)(Jt,{data:a,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,hi.jsx)(ue.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,hi.jsx)(m.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,hi.jsx)(At,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},p4=h4},9187:function(Ot){"use strict";Ot.exports=J,Ot.exports.default=J;function J(Te,Ke,Fe){Fe=Fe||2;var Mt=Ke&&Ke.length,gt=Mt?Ke[0]*Fe:Te.length,Zt=N(Te,0,gt,Fe,!0),qt=[];if(!Zt||Zt.next===Zt.prev)return qt;var Er,Kn,pn,Wi,Zn,Gn,pi;if(Mt&&(Zt=ue(Te,Ke,Zt,Fe)),Te.length>80*Fe){Er=pn=Te[0],Kn=Wi=Te[1];for(var $n=Fe;$n<gt;$n+=Fe)Zn=Te[$n],Gn=Te[$n+1],Zn<Er&&(Er=Zn),Gn<Kn&&(Kn=Gn),Zn>pn&&(pn=Zn),Gn>Wi&&(Wi=Gn);pi=Math.max(pn-Er,Wi-Kn),pi=pi!==0?1/pi:0}return ye(Zt,qt,Fe,Er,Kn,pi),qt}function N(Te,Ke,Fe,Mt,gt){var Zt,qt;if(gt===en(Te,Ke,Fe,Mt)>0)for(Zt=Ke;Zt<Fe;Zt+=Mt)qt=$t(Zt,Te[Zt],Te[Zt+1],qt);else for(Zt=Fe-Mt;Zt>=Ke;Zt-=Mt)qt=$t(Zt,Te[Zt],Te[Zt+1],qt);return qt&&mt(qt,qt.next)&&(br(qt),qt=qt.next),qt}function le(Te,Ke){if(!Te)return Te;Ke||(Ke=Te);var Fe=Te,Mt;do if(Mt=!1,!Fe.steiner&&(mt(Fe,Fe.next)||ht(Fe.prev,Fe,Fe.next)===0)){if(br(Fe),Fe=Ke=Fe.prev,Fe===Fe.next)break;Mt=!0}else Fe=Fe.next;while(Mt||Fe!==Ke);return Ke}function ye(Te,Ke,Fe,Mt,gt,Zt,qt){if(!!Te){!qt&&Zt&&st(Te,Mt,gt,Zt);for(var Er=Te,Kn,pn;Te.prev!==Te.next;){if(Kn=Te.prev,pn=Te.next,Zt?ve(Te,Mt,gt,Zt):m(Te)){Ke.push(Kn.i/Fe),Ke.push(Te.i/Fe),Ke.push(pn.i/Fe),br(Te),Te=pn.next,Er=pn.next;continue}if(Te=pn,Te===Er){qt?qt===1?(Te=j(le(Te),Ke,Fe),ye(Te,Ke,Fe,Mt,gt,Zt,2)):qt===2&&ce(Te,Ke,Fe,Mt,gt,Zt):ye(le(Te),Ke,Fe,Mt,gt,Zt,1);break}}}}function m(Te){var Ke=Te.prev,Fe=Te,Mt=Te.next;if(ht(Ke,Fe,Mt)>=0)return!1;for(var gt=Te.next.next;gt!==Te.prev;){if(er(Ke.x,Ke.y,Fe.x,Fe.y,Mt.x,Mt.y,gt.x,gt.y)&&ht(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function ve(Te,Ke,Fe,Mt){var gt=Te.prev,Zt=Te,qt=Te.next;if(ht(gt,Zt,qt)>=0)return!1;for(var Er=gt.x<Zt.x?gt.x<qt.x?gt.x:qt.x:Zt.x<qt.x?Zt.x:qt.x,Kn=gt.y<Zt.y?gt.y<qt.y?gt.y:qt.y:Zt.y<qt.y?Zt.y:qt.y,pn=gt.x>Zt.x?gt.x>qt.x?gt.x:qt.x:Zt.x>qt.x?Zt.x:qt.x,Wi=gt.y>Zt.y?gt.y>qt.y?gt.y:qt.y:Zt.y>qt.y?Zt.y:qt.y,Zn=sr(Er,Kn,Ke,Fe,Mt),Gn=sr(pn,Wi,Ke,Fe,Mt),pi=Te.prevZ,$n=Te.nextZ;pi&&pi.z>=Zn&&$n&&$n.z<=Gn;){if(pi!==Te.prev&&pi!==Te.next&&er(gt.x,gt.y,Zt.x,Zt.y,qt.x,qt.y,pi.x,pi.y)&&ht(pi.prev,pi,pi.next)>=0||(pi=pi.prevZ,$n!==Te.prev&&$n!==Te.next&&er(gt.x,gt.y,Zt.x,Zt.y,qt.x,qt.y,$n.x,$n.y)&&ht($n.prev,$n,$n.next)>=0))return!1;$n=$n.nextZ}for(;pi&&pi.z>=Zn;){if(pi!==Te.prev&&pi!==Te.next&&er(gt.x,gt.y,Zt.x,Zt.y,qt.x,qt.y,pi.x,pi.y)&&ht(pi.prev,pi,pi.next)>=0)return!1;pi=pi.prevZ}for(;$n&&$n.z<=Gn;){if($n!==Te.prev&&$n!==Te.next&&er(gt.x,gt.y,Zt.x,Zt.y,qt.x,qt.y,$n.x,$n.y)&&ht($n.prev,$n,$n.next)>=0)return!1;$n=$n.nextZ}return!0}function j(Te,Ke,Fe){var Mt=Te;do{var gt=Mt.prev,Zt=Mt.next.next;!mt(gt,Zt)&&tr(gt,Mt,Mt.next,Zt)&&rt(gt,Zt)&&rt(Zt,gt)&&(Ke.push(gt.i/Fe),Ke.push(Mt.i/Fe),Ke.push(Zt.i/Fe),br(Mt),br(Mt.next),Mt=Te=Zt),Mt=Mt.next}while(Mt!==Te);return le(Mt)}function ce(Te,Ke,Fe,Mt,gt,Zt){var qt=Te;do{for(var Er=qt.next.next;Er!==qt.prev;){if(qt.i!==Er.i&&Lt(qt,Er)){var Kn=tt(qt,Er);qt=le(qt,qt.next),Kn=le(Kn,Kn.next),ye(qt,Ke,Fe,Mt,gt,Zt),ye(Kn,Ke,Fe,Mt,gt,Zt);return}Er=Er.next}qt=qt.next}while(qt!==Te)}function ue(Te,Ke,Fe,Mt){var gt=[],Zt,qt,Er,Kn,pn;for(Zt=0,qt=Ke.length;Zt<qt;Zt++)Er=Ke[Zt]*Mt,Kn=Zt<qt-1?Ke[Zt+1]*Mt:Te.length,pn=N(Te,Er,Kn,Mt,!1),pn===pn.next&&(pn.steiner=!0),gt.push(Pt(pn));for(gt.sort(ze),Zt=0;Zt<gt.length;Zt++)Fe=ae(gt[Zt],Fe),Fe=le(Fe,Fe.next);return Fe}function ze(Te,Ke){return Te.x-Ke.x}function ae(Te,Ke){var Fe=nt(Te,Ke);if(!Fe)return Ke;var Mt=tt(Fe,Te),gt=le(Fe,Fe.next);return le(Mt,Mt.next),Ke===Fe?gt:Ke}function nt(Te,Ke){var Fe=Ke,Mt=Te.x,gt=Te.y,Zt=-Infinity,qt;do{if(gt<=Fe.y&&gt>=Fe.next.y&&Fe.next.y!==Fe.y){var Er=Fe.x+(gt-Fe.y)*(Fe.next.x-Fe.x)/(Fe.next.y-Fe.y);if(Er<=Mt&&Er>Zt){if(Zt=Er,Er===Mt){if(gt===Fe.y)return Fe;if(gt===Fe.next.y)return Fe.next}qt=Fe.x<Fe.next.x?Fe:Fe.next}}Fe=Fe.next}while(Fe!==Ke);if(!qt)return null;if(Mt===Zt)return qt;var Kn=qt,pn=qt.x,Wi=qt.y,Zn=Infinity,Gn;Fe=qt;do Mt>=Fe.x&&Fe.x>=pn&&Mt!==Fe.x&&er(gt<Wi?Mt:Zt,gt,pn,Wi,gt<Wi?Zt:Mt,gt,Fe.x,Fe.y)&&(Gn=Math.abs(gt-Fe.y)/(Mt-Fe.x),rt(Fe,Te)&&(Gn<Zn||Gn===Zn&&(Fe.x>qt.x||Fe.x===qt.x&&ke(qt,Fe)))&&(qt=Fe,Zn=Gn)),Fe=Fe.next;while(Fe!==Kn);return qt}function ke(Te,Ke){return ht(Te.prev,Te,Ke.prev)<0&&ht(Ke.next,Te,Te.next)<0}function st(Te,Ke,Fe,Mt){var gt=Te;do gt.z===null&&(gt.z=sr(gt.x,gt.y,Ke,Fe,Mt)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==Te);gt.prevZ.nextZ=null,gt.prevZ=null,Gt(gt)}function Gt(Te){var Ke,Fe,Mt,gt,Zt,qt,Er,Kn,pn=1;do{for(Fe=Te,Te=null,Zt=null,qt=0;Fe;){for(qt++,Mt=Fe,Er=0,Ke=0;Ke<pn&&(Er++,Mt=Mt.nextZ,!!Mt);Ke++);for(Kn=pn;Er>0||Kn>0&&Mt;)Er!==0&&(Kn===0||!Mt||Fe.z<=Mt.z)?(gt=Fe,Fe=Fe.nextZ,Er--):(gt=Mt,Mt=Mt.nextZ,Kn--),Zt?Zt.nextZ=gt:Te=gt,gt.prevZ=Zt,Zt=gt;Fe=Mt}Zt.nextZ=null,pn*=2}while(qt>1);return Te}function sr(Te,Ke,Fe,Mt,gt){return Te=32767*(Te-Fe)*gt,Ke=32767*(Ke-Mt)*gt,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,Ke=(Ke|Ke<<8)&16711935,Ke=(Ke|Ke<<4)&252645135,Ke=(Ke|Ke<<2)&858993459,Ke=(Ke|Ke<<1)&1431655765,Te|Ke<<1}function Pt(Te){var Ke=Te,Fe=Te;do(Ke.x<Fe.x||Ke.x===Fe.x&&Ke.y<Fe.y)&&(Fe=Ke),Ke=Ke.next;while(Ke!==Te);return Fe}function er(Te,Ke,Fe,Mt,gt,Zt,qt,Er){return(gt-qt)*(Ke-Er)-(Te-qt)*(Zt-Er)>=0&&(Te-qt)*(Mt-Er)-(Fe-qt)*(Ke-Er)>=0&&(Fe-qt)*(Zt-Er)-(gt-qt)*(Mt-Er)>=0}function Lt(Te,Ke){return Te.next.i!==Ke.i&&Te.prev.i!==Ke.i&&!_t(Te,Ke)&&(rt(Te,Ke)&&rt(Ke,Te)&&At(Te,Ke)&&(ht(Te.prev,Te,Ke.prev)||ht(Te,Ke.prev,Ke))||mt(Te,Ke)&&ht(Te.prev,Te,Te.next)>0&&ht(Ke.prev,Ke,Ke.next)>0)}function ht(Te,Ke,Fe){return(Ke.y-Te.y)*(Fe.x-Ke.x)-(Ke.x-Te.x)*(Fe.y-Ke.y)}function mt(Te,Ke){return Te.x===Ke.x&&Te.y===Ke.y}function tr(Te,Ke,Fe,Mt){var gt=Jt(ht(Te,Ke,Fe)),Zt=Jt(ht(Te,Ke,Mt)),qt=Jt(ht(Fe,Mt,Te)),Er=Jt(ht(Fe,Mt,Ke));return!!(gt!==Zt&&qt!==Er||gt===0&&q(Te,Fe,Ke)||Zt===0&&q(Te,Mt,Ke)||qt===0&&q(Fe,Te,Mt)||Er===0&&q(Fe,Ke,Mt))}function q(Te,Ke,Fe){return Ke.x<=Math.max(Te.x,Fe.x)&&Ke.x>=Math.min(Te.x,Fe.x)&&Ke.y<=Math.max(Te.y,Fe.y)&&Ke.y>=Math.min(Te.y,Fe.y)}function Jt(Te){return Te>0?1:Te<0?-1:0}function _t(Te,Ke){var Fe=Te;do{if(Fe.i!==Te.i&&Fe.next.i!==Te.i&&Fe.i!==Ke.i&&Fe.next.i!==Ke.i&&tr(Fe,Fe.next,Te,Ke))return!0;Fe=Fe.next}while(Fe!==Te);return!1}function rt(Te,Ke){return ht(Te.prev,Te,Te.next)<0?ht(Te,Ke,Te.next)>=0&&ht(Te,Te.prev,Ke)>=0:ht(Te,Ke,Te.prev)<0||ht(Te,Te.next,Ke)<0}function At(Te,Ke){var Fe=Te,Mt=!1,gt=(Te.x+Ke.x)/2,Zt=(Te.y+Ke.y)/2;do Fe.y>Zt!=Fe.next.y>Zt&&Fe.next.y!==Fe.y&&gt<(Fe.next.x-Fe.x)*(Zt-Fe.y)/(Fe.next.y-Fe.y)+Fe.x&&(Mt=!Mt),Fe=Fe.next;while(Fe!==Te);return Mt}function tt(Te,Ke){var Fe=new Fr(Te.i,Te.x,Te.y),Mt=new Fr(Ke.i,Ke.x,Ke.y),gt=Te.next,Zt=Ke.prev;return Te.next=Ke,Ke.prev=Te,Fe.next=gt,gt.prev=Fe,Mt.next=Fe,Fe.prev=Mt,Zt.next=Mt,Mt.prev=Zt,Mt}function $t(Te,Ke,Fe,Mt){var gt=new Fr(Te,Ke,Fe);return Mt?(gt.next=Mt.next,gt.prev=Mt,Mt.next.prev=gt,Mt.next=gt):(gt.prev=gt,gt.next=gt),gt}function br(Te){Te.next.prev=Te.prev,Te.prev.next=Te.next,Te.prevZ&&(Te.prevZ.nextZ=Te.nextZ),Te.nextZ&&(Te.nextZ.prevZ=Te.prevZ)}function Fr(Te,Ke,Fe){this.i=Te,this.x=Ke,this.y=Fe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}J.deviation=function(Te,Ke,Fe,Mt){var gt=Ke&&Ke.length,Zt=gt?Ke[0]*Fe:Te.length,qt=Math.abs(en(Te,0,Zt,Fe));if(gt)for(var Er=0,Kn=Ke.length;Er<Kn;Er++){var pn=Ke[Er]*Fe,Wi=Er<Kn-1?Ke[Er+1]*Fe:Te.length;qt-=Math.abs(en(Te,pn,Wi,Fe))}var Zn=0;for(Er=0;Er<Mt.length;Er+=3){var Gn=Mt[Er]*Fe,pi=Mt[Er+1]*Fe,$n=Mt[Er+2]*Fe;Zn+=Math.abs((Te[Gn]-Te[$n])*(Te[pi+1]-Te[Gn+1])-(Te[Gn]-Te[pi])*(Te[$n+1]-Te[Gn+1]))}return qt===0&&Zn===0?0:Math.abs((Zn-qt)/qt)};function en(Te,Ke,Fe,Mt){for(var gt=0,Zt=Ke,qt=Fe-Mt;Zt<Fe;Zt+=Mt)gt+=(Te[qt]-Te[Zt])*(Te[Zt+1]+Te[qt+1]),qt=Zt;return gt}J.flatten=function(Te){for(var Ke=Te[0][0].length,Fe={vertices:[],holes:[],dimensions:Ke},Mt=0,gt=0;gt<Te.length;gt++){for(var Zt=0;Zt<Te[gt].length;Zt++)for(var qt=0;qt<Ke;qt++)Fe.vertices.push(Te[gt][Zt][qt]);gt>0&&(Mt+=Te[gt-1].length,Fe.holes.push(Mt))}return Fe}},67709:function(Ot){function J(le){var ye=le.target||le.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var m=ye.__resizeTrigger__,ve=m&&m.__resizeListeners__;ve&&ve.forEach(function(j){j.call(m,le)})})}var N=function(ye,m){var ve=this,j=ve.document,ce,ue=j.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ze(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",J)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],ue)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",J);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var ae=ye.__resizeTrigger__=j.createElement("object");ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ae.setAttribute("class","resize-sensor"),ae.setAttribute("tabindex","-1"),ae.setAttribute("title",""),ae.__resizeElement__=ye,ae.onload=ze,ae.type="text/html",ce&&ye.appendChild(ae),ae.data="about:blank",ce||ye.appendChild(ae)}ye.__resizeListeners__.push(m)};Ot.exports=typeof window=="undefined"?N:N.bind(window),Ot.exports.unbind=function(le,ye){var m=document.attachEvent,ve=le.__resizeListeners__||[];if(ye){var j=ve.indexOf(ye);j!==-1&&ve.splice(j,1)}else ve=le.__resizeListeners__=[];if(!ve.length){if(m)le.detachEvent("onresize",J);else if(le.__resizeTrigger__){var ce=le.__resizeTrigger__.contentDocument,ue=ce&&ce.defaultView;ue&&(ue.removeEventListener("resize",J),delete ue.__resizeTrigger__),le.__resizeTrigger__=!le.removeChild(le.__resizeTrigger__)}delete le.__resizeListeners__}}},26729:function(Ot){"use strict";var J=Object.prototype.hasOwnProperty,N="~";function le(){}Object.create&&(le.prototype=Object.create(null),new le().__proto__||(N=!1));function ye(ce,ue,ze){this.fn=ce,this.context=ue,this.once=ze||!1}function m(ce,ue,ze,ae,nt){if(typeof ze!="function")throw new TypeError("The listener must be a function");var ke=new ye(ze,ae||ce,nt),st=N?N+ue:ue;return ce._events[st]?ce._events[st].fn?ce._events[st]=[ce._events[st],ke]:ce._events[st].push(ke):(ce._events[st]=ke,ce._eventsCount++),ce}function ve(ce,ue){--ce._eventsCount==0?ce._events=new le:delete ce._events[ue]}function j(){this._events=new le,this._eventsCount=0}j.prototype.eventNames=function(){var ue=[],ze,ae;if(this._eventsCount===0)return ue;for(ae in ze=this._events)J.call(ze,ae)&&ue.push(N?ae.slice(1):ae);return Object.getOwnPropertySymbols?ue.concat(Object.getOwnPropertySymbols(ze)):ue},j.prototype.listeners=function(ue){var ze=N?N+ue:ue,ae=this._events[ze];if(!ae)return[];if(ae.fn)return[ae.fn];for(var nt=0,ke=ae.length,st=new Array(ke);nt<ke;nt++)st[nt]=ae[nt].fn;return st},j.prototype.listenerCount=function(ue){var ze=N?N+ue:ue,ae=this._events[ze];return ae?ae.fn?1:ae.length:0},j.prototype.emit=function(ue,ze,ae,nt,ke,st){var Gt=N?N+ue:ue;if(!this._events[Gt])return!1;var sr=this._events[Gt],Pt=arguments.length,er,Lt;if(sr.fn){switch(sr.once&&this.removeListener(ue,sr.fn,void 0,!0),Pt){case 1:return sr.fn.call(sr.context),!0;case 2:return sr.fn.call(sr.context,ze),!0;case 3:return sr.fn.call(sr.context,ze,ae),!0;case 4:return sr.fn.call(sr.context,ze,ae,nt),!0;case 5:return sr.fn.call(sr.context,ze,ae,nt,ke),!0;case 6:return sr.fn.call(sr.context,ze,ae,nt,ke,st),!0}for(Lt=1,er=new Array(Pt-1);Lt<Pt;Lt++)er[Lt-1]=arguments[Lt];sr.fn.apply(sr.context,er)}else{var ht=sr.length,mt;for(Lt=0;Lt<ht;Lt++)switch(sr[Lt].once&&this.removeListener(ue,sr[Lt].fn,void 0,!0),Pt){case 1:sr[Lt].fn.call(sr[Lt].context);break;case 2:sr[Lt].fn.call(sr[Lt].context,ze);break;case 3:sr[Lt].fn.call(sr[Lt].context,ze,ae);break;case 4:sr[Lt].fn.call(sr[Lt].context,ze,ae,nt);break;default:if(!er)for(mt=1,er=new Array(Pt-1);mt<Pt;mt++)er[mt-1]=arguments[mt];sr[Lt].fn.apply(sr[Lt].context,er)}}return!0},j.prototype.on=function(ue,ze,ae){return m(this,ue,ze,ae,!1)},j.prototype.once=function(ue,ze,ae){return m(this,ue,ze,ae,!0)},j.prototype.removeListener=function(ue,ze,ae,nt){var ke=N?N+ue:ue;if(!this._events[ke])return this;if(!ze)return ve(this,ke),this;var st=this._events[ke];if(st.fn)st.fn===ze&&(!nt||st.once)&&(!ae||st.context===ae)&&ve(this,ke);else{for(var Gt=0,sr=[],Pt=st.length;Gt<Pt;Gt++)(st[Gt].fn!==ze||nt&&!st[Gt].once||ae&&st[Gt].context!==ae)&&sr.push(st[Gt]);sr.length?this._events[ke]=sr.length===1?sr[0]:sr:ve(this,ke)}return this},j.prototype.removeAllListeners=function(ue){var ze;return ue?(ze=N?N+ue:ue,this._events[ze]&&ve(this,ze)):(this._events=new le,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=N,j.EventEmitter=j,Ot.exports=j},7375:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function le(ce,ue,ze,ae){function nt(){return ae&&!Reflect.hasMetadata(N,this,ue)&&Reflect.defineMetadata(N,ze(),this,ue),Reflect.hasMetadata(N,this,ue)?Reflect.getMetadata(N,this,ue):ze()}function ke(st){Reflect.defineMetadata(N,st,this,ue)}Object.defineProperty(ce,ue,{configurable:!0,enumerable:!0,get:nt,set:ke})}function ye(ce,ue){return function(ze){return function(ae,nt){var ke=function(){return ce.get(ze)};le(ae,nt,ke,ue)}}}J.makePropertyInjectDecorator=ye;function m(ce,ue){return function(ze,ae){return function(nt,ke){var st=function(){return ce.getNamed(ze,ae)};le(nt,ke,st,ue)}}}J.makePropertyInjectNamedDecorator=m;function ve(ce,ue){return function(ze,ae,nt){return function(ke,st){var Gt=function(){return ce.getTagged(ze,ae,nt)};le(ke,st,Gt,ue)}}}J.makePropertyInjectTaggedDecorator=ve;function j(ce,ue){return function(ze){return function(ae,nt){var ke=function(){return ce.getAll(ze)};le(ae,nt,ke,ue)}}}J.makePropertyMultiInjectDecorator=j},84879:function(Ot,J,N){"use strict";var le;le={value:!0};var ye=N(7375);function m(ve,j){j===void 0&&(j=!0);var ce=ye.makePropertyInjectDecorator(ve,j),ue=ye.makePropertyInjectNamedDecorator(ve,j),ze=ye.makePropertyInjectTaggedDecorator(ve,j),ae=ye.makePropertyMultiInjectDecorator(ve,j);return{lazyInject:ce,lazyInjectNamed:ue,lazyInjectTagged:ze,lazyMultiInject:ae}}J.Z=m},99934:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagProperty=J.tagParameter=J.decorate=void 0;var le=N(16674),ye=N(6867);function m(ae,nt,ke,st){var Gt=ye.TAGGED;j(Gt,ae,nt,st,ke)}J.tagParameter=m;function ve(ae,nt,ke){var st=ye.TAGGED_PROP;j(st,ae.constructor,nt,ke)}J.tagProperty=ve;function j(ae,nt,ke,st,Gt){var sr={},Pt=typeof Gt=="number",er=Gt!==void 0&&Pt?Gt.toString():ke;if(Pt&&ke!==void 0)throw new Error(le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ae,nt)&&(sr=Reflect.getMetadata(ae,nt));var Lt=sr[er];if(!Array.isArray(Lt))Lt=[];else for(var ht=0,mt=Lt;ht<mt.length;ht++){var tr=mt[ht];if(tr.key===st.key)throw new Error(le.DUPLICATED_METADATA+" "+tr.key.toString())}Lt.push(st),sr[er]=Lt,Reflect.defineMetadata(ae,sr,nt)}function ce(ae,nt){Reflect.decorate(ae,nt)}function ue(ae,nt){return function(ke,st){nt(ke,st,ae)}}function ze(ae,nt,ke){typeof ke=="number"?ce([ue(ke,ae)],nt):typeof ke=="string"?Reflect.decorate([ae],nt,ke):ce([ae],nt)}J.decorate=ze},5744:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.inject=J.LazyServiceIdentifer=void 0;var le=N(16674),ye=N(6867),m=N(47738),ve=N(99934),j=function(){function ue(ze){this._cb=ze}return ue.prototype.unwrap=function(){return this._cb()},ue}();J.LazyServiceIdentifer=j;function ce(ue){return function(ze,ae,nt){if(ue===void 0)throw new Error(le.UNDEFINED_INJECT_ANNOTATION(ze.name));var ke=new m.Metadata(ye.INJECT_TAG,ue);typeof nt=="number"?ve.tagParameter(ze,ae,nt,ke):ve.tagProperty(ze,ae,ke)}}J.inject=ce},64315:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.injectable=void 0;var le=N(16674),ye=N(6867);function m(){return function(ve){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,ve))throw new Error(le.DUPLICATED_INJECTABLE_DECORATOR);var j=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,ve)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,j,ve),ve}}J.injectable=m},71693:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiInject=void 0;var le=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(ce,ue,ze){var ae=new ye.Metadata(le.MULTI_INJECT_TAG,j);typeof ze=="number"?m.tagParameter(ce,ue,ze,ae):m.tagProperty(ce,ue,ae)}}J.multiInject=ve},38085:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.named=void 0;var le=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(ce,ue,ze){var ae=new ye.Metadata(le.NAMED_TAG,j);typeof ze=="number"?m.tagParameter(ce,ue,ze,ae):m.tagProperty(ce,ue,ae)}}J.named=ve},6515:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.optional=void 0;var le=N(6867),ye=N(47738),m=N(99934);function ve(){return function(j,ce,ue){var ze=new ye.Metadata(le.OPTIONAL_TAG,!0);typeof ue=="number"?m.tagParameter(j,ce,ue,ze):m.tagProperty(j,ce,ze)}}J.optional=ve},7014:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.postConstruct=void 0;var le=N(16674),ye=N(6867),m=N(47738);function ve(){return function(j,ce,ue){var ze=new m.Metadata(ye.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,j.constructor))throw new Error(le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,ze,j.constructor)}}J.postConstruct=ve},32052:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagged=void 0;var le=N(47738),ye=N(99934);function m(ve,j){return function(ce,ue,ze){var ae=new le.Metadata(ve,j);typeof ze=="number"?ye.tagParameter(ce,ue,ze,ae):ye.tagProperty(ce,ue,ae)}}J.tagged=m},55638:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.targetName=void 0;var le=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(ce,ue,ze){var ae=new ye.Metadata(le.NAME_TAG,j);m.tagParameter(ce,ue,ze,ae)}}J.targetName=ve},86757:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.unmanaged=void 0;var le=N(6867),ye=N(47738),m=N(99934);function ve(){return function(j,ce,ue){var ze=new ye.Metadata(le.UNMANAGED_TAG,!0);m.tagParameter(j,ce,ue,ze)}}J.unmanaged=ve},44290:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Binding=void 0;var le=N(28421),ye=N(37791),m=function(){function ve(j,ce){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=j,this.scope=ce,this.type=le.BindingTypeEnum.Invalid,this.constraint=function(ue){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ve.prototype.clone=function(){var j=new ve(this.serviceIdentifier,this.scope);return j.activated=j.scope===le.BindingScopeEnum.Singleton?this.activated:!1,j.implementationType=this.implementationType,j.dynamicValue=this.dynamicValue,j.scope=this.scope,j.type=this.type,j.factory=this.factory,j.provider=this.provider,j.constraint=this.constraint,j.onActivation=this.onActivation,j.cache=this.cache,j},ve}();J.Binding=m},23184:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};J.BindingCount=N},16674:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.STACK_OVERFLOW=J.CIRCULAR_DEPENDENCY_IN_FACTORY=J.POST_CONSTRUCT_ERROR=J.MULTIPLE_POST_CONSTRUCT_METHODS=J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=J.ARGUMENTS_LENGTH_MISMATCH=J.INVALID_DECORATOR_OPERATION=J.INVALID_TO_SELF_VALUE=J.INVALID_FUNCTION_BINDING=J.INVALID_MIDDLEWARE_RETURN=J.NO_MORE_SNAPSHOTS_AVAILABLE=J.INVALID_BINDING_TYPE=J.NOT_IMPLEMENTED=J.CIRCULAR_DEPENDENCY=J.UNDEFINED_INJECT_ANNOTATION=J.MISSING_INJECT_ANNOTATION=J.MISSING_INJECTABLE_ANNOTATION=J.NOT_REGISTERED=J.CANNOT_UNBIND=J.AMBIGUOUS_MATCH=J.KEY_NOT_FOUND=J.NULL_ARGUMENT=J.DUPLICATED_METADATA=J.DUPLICATED_INJECTABLE_DECORATOR=void 0,J.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",J.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",J.NULL_ARGUMENT="NULL argument",J.KEY_NOT_FOUND="Key Not Found",J.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",J.CANNOT_UNBIND="Could not unbind serviceIdentifier:",J.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",J.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",J.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(ve){return"@inject called with undefined this could mean that the class "+ve+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};J.UNDEFINED_INJECT_ANNOTATION=N,J.CIRCULAR_DEPENDENCY="Circular dependency found:",J.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",J.INVALID_BINDING_TYPE="Invalid binding type:",J.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",J.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",J.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",J.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",J.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var le=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"The number of constructor arguments in the derived class "+(ve[0]+" must be >= than the number of constructor arguments of its base class.")};J.ARGUMENTS_LENGTH_MISMATCH=le,J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",J.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"@postConstruct error in class "+ve[0]+": "+ve[1]};J.POST_CONSTRUCT_ERROR=ye;var m=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"It looks like there is a circular dependency "+("in one of the '"+ve[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ve[1]+"'.")};J.CIRCULAR_DEPENDENCY_IN_FACTORY=m,J.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.TargetTypeEnum=J.BindingTypeEnum=J.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};J.BindingScopeEnum=N;var le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};J.BindingTypeEnum=le;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};J.TargetTypeEnum=ye},6867:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0,J.NAMED_TAG="named",J.NAME_TAG="name",J.UNMANAGED_TAG="unmanaged",J.OPTIONAL_TAG="optional",J.INJECT_TAG="inject",J.MULTI_INJECT_TAG="multi_inject",J.TAGGED="inversify:tagged",J.TAGGED_PROP="inversify:tagged_props",J.PARAM_TYPES="inversify:paramtypes",J.DESIGN_PARAM_TYPES="design:paramtypes",J.POST_CONSTRUCT="post_construct";function N(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=N()},51389:function(Ot,J,N){"use strict";var le=this&&this.__awaiter||function(Lt,ht,mt,tr){function q(Jt){return Jt instanceof mt?Jt:new mt(function(_t){_t(Jt)})}return new(mt||(mt=Promise))(function(Jt,_t){function rt($t){try{tt(tr.next($t))}catch(br){_t(br)}}function At($t){try{tt(tr.throw($t))}catch(br){_t(br)}}function tt($t){$t.done?Jt($t.value):q($t.value).then(rt,At)}tt((tr=tr.apply(Lt,ht||[])).next())})},ye=this&&this.__generator||function(Lt,ht){var mt={label:0,sent:function(){if(Jt[0]&1)throw Jt[1];return Jt[1]},trys:[],ops:[]},tr,q,Jt,_t;return _t={next:rt(0),throw:rt(1),return:rt(2)},typeof Symbol=="function"&&(_t[Symbol.iterator]=function(){return this}),_t;function rt(tt){return function($t){return At([tt,$t])}}function At(tt){if(tr)throw new TypeError("Generator is already executing.");for(;mt;)try{if(tr=1,q&&(Jt=tt[0]&2?q.return:tt[0]?q.throw||((Jt=q.return)&&Jt.call(q),0):q.next)&&!(Jt=Jt.call(q,tt[1])).done)return Jt;switch(q=0,Jt&&(tt=[tt[0]&2,Jt.value]),tt[0]){case 0:case 1:Jt=tt;break;case 4:return mt.label++,{value:tt[1],done:!1};case 5:mt.label++,q=tt[1],tt=[0];continue;case 7:tt=mt.ops.pop(),mt.trys.pop();continue;default:if(Jt=mt.trys,!(Jt=Jt.length>0&&Jt[Jt.length-1])&&(tt[0]===6||tt[0]===2)){mt=0;continue}if(tt[0]===3&&(!Jt||tt[1]>Jt[0]&&tt[1]<Jt[3])){mt.label=tt[1];break}if(tt[0]===6&&mt.label<Jt[1]){mt.label=Jt[1],Jt=tt;break}if(Jt&&mt.label<Jt[2]){mt.label=Jt[2],mt.ops.push(tt);break}Jt[2]&&mt.ops.pop(),mt.trys.pop();continue}tt=ht.call(Lt,mt)}catch($t){tt=[6,$t],q=0}finally{tr=Jt=0}if(tt[0]&5)throw tt[1];return{value:tt[0]?tt[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Lt,ht){for(var mt=0,tr=ht.length,q=Lt.length;mt<tr;mt++,q++)Lt[q]=ht[mt];return Lt};Object.defineProperty(J,"__esModule",{value:!0}),J.Container=void 0;var ve=N(44290),j=N(16674),ce=N(28421),ue=N(6867),ze=N(51377),ae=N(86311),nt=N(31927),ke=N(15451),st=N(37791),Gt=N(55800),sr=N(85700),Pt=N(80175),er=function(){function Lt(ht){this._appliedMiddleware=[];var mt=ht||{};if(typeof mt!="object")throw new Error(""+j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(mt.defaultScope===void 0)mt.defaultScope=ce.BindingScopeEnum.Transient;else if(mt.defaultScope!==ce.BindingScopeEnum.Singleton&&mt.defaultScope!==ce.BindingScopeEnum.Transient&&mt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(mt.autoBindInjectable===void 0)mt.autoBindInjectable=!1;else if(typeof mt.autoBindInjectable!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(mt.skipBaseClassChecks===void 0)mt.skipBaseClassChecks=!1;else if(typeof mt.skipBaseClassChecks!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:mt.autoBindInjectable,defaultScope:mt.defaultScope,skipBaseClassChecks:mt.skipBaseClassChecks},this.id=st.id(),this._bindingDictionary=new Pt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ze.MetadataReader}return Lt.merge=function(ht,mt){for(var tr=[],q=2;q<arguments.length;q++)tr[q-2]=arguments[q];var Jt=new Lt,_t=m([ht,mt],tr).map(function(tt){return ae.getBindingDictionary(tt)}),rt=ae.getBindingDictionary(Jt);function At(tt,$t){tt.traverse(function(br,Fr){Fr.forEach(function(en){$t.add(en.serviceIdentifier,en.clone())})})}return _t.forEach(function(tt){At(tt,rt)}),Jt},Lt.prototype.load=function(){for(var ht=[],mt=0;mt<arguments.length;mt++)ht[mt]=arguments[mt];for(var tr=this._getContainerModuleHelpersFactory(),q=0,Jt=ht;q<Jt.length;q++){var _t=Jt[q],rt=tr(_t.id);_t.registry(rt.bindFunction,rt.unbindFunction,rt.isboundFunction,rt.rebindFunction)}},Lt.prototype.loadAsync=function(){for(var ht=[],mt=0;mt<arguments.length;mt++)ht[mt]=arguments[mt];return le(this,void 0,void 0,function(){var tr,q,Jt,_t,rt;return ye(this,function(At){switch(At.label){case 0:tr=this._getContainerModuleHelpersFactory(),q=0,Jt=ht,At.label=1;case 1:return q<Jt.length?(_t=Jt[q],rt=tr(_t.id),[4,_t.registry(rt.bindFunction,rt.unbindFunction,rt.isboundFunction,rt.rebindFunction)]):[3,4];case 2:At.sent(),At.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},Lt.prototype.unload=function(){for(var ht=this,mt=[],tr=0;tr<arguments.length;tr++)mt[tr]=arguments[tr];var q=function(Jt){return function(_t){return _t.moduleId===Jt}};mt.forEach(function(Jt){var _t=q(Jt.id);ht._bindingDictionary.removeByCondition(_t)})},Lt.prototype.bind=function(ht){var mt=this.options.defaultScope||ce.BindingScopeEnum.Transient,tr=new ve.Binding(ht,mt);return this._bindingDictionary.add(ht,tr),new ke.BindingToSyntax(tr)},Lt.prototype.rebind=function(ht){return this.unbind(ht),this.bind(ht)},Lt.prototype.unbind=function(ht){try{this._bindingDictionary.remove(ht)}catch(mt){throw new Error(j.CANNOT_UNBIND+" "+Gt.getServiceIdentifierAsString(ht))}},Lt.prototype.unbindAll=function(){this._bindingDictionary=new Pt.Lookup},Lt.prototype.isBound=function(ht){var mt=this._bindingDictionary.hasKey(ht);return!mt&&this.parent&&(mt=this.parent.isBound(ht)),mt},Lt.prototype.isBoundNamed=function(ht,mt){return this.isBoundTagged(ht,ue.NAMED_TAG,mt)},Lt.prototype.isBoundTagged=function(ht,mt,tr){var q=!1;if(this._bindingDictionary.hasKey(ht)){var Jt=this._bindingDictionary.get(ht),_t=ae.createMockRequest(this,ht,mt,tr);q=Jt.some(function(rt){return rt.constraint(_t)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(ht,mt,tr)),q},Lt.prototype.snapshot=function(){this._snapshots.push(sr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Lt.prototype.restore=function(){var ht=this._snapshots.pop();if(ht===void 0)throw new Error(j.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ht.bindings,this._middleware=ht.middleware},Lt.prototype.createChild=function(ht){var mt=new Lt(ht||this.options);return mt.parent=this,mt},Lt.prototype.applyMiddleware=function(){for(var ht=[],mt=0;mt<arguments.length;mt++)ht[mt]=arguments[mt];this._appliedMiddleware=this._appliedMiddleware.concat(ht);var tr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ht.reduce(function(q,Jt){return Jt(q)},tr)},Lt.prototype.applyCustomMetadataReader=function(ht){this._metadataReader=ht},Lt.prototype.get=function(ht){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ht)},Lt.prototype.getTagged=function(ht,mt,tr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ht,mt,tr)},Lt.prototype.getNamed=function(ht,mt){return this.getTagged(ht,ue.NAMED_TAG,mt)},Lt.prototype.getAll=function(ht){return this._get(!0,!0,ce.TargetTypeEnum.Variable,ht)},Lt.prototype.getAllTagged=function(ht,mt,tr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,ht,mt,tr)},Lt.prototype.getAllNamed=function(ht,mt){return this.getAllTagged(ht,ue.NAMED_TAG,mt)},Lt.prototype.resolve=function(ht){var mt=this.createChild();return mt.bind(ht).toSelf(),this._appliedMiddleware.forEach(function(tr){mt.applyMiddleware(tr)}),mt.get(ht)},Lt.prototype._getContainerModuleHelpersFactory=function(){var ht=this,mt=function(rt,At){rt._binding.moduleId=At},tr=function(rt){return function(At){var tt=ht.bind.bind(ht),$t=tt(At);return mt($t,rt),$t}},q=function(rt){return function(At){var tt=ht.unbind.bind(ht);tt(At)}},Jt=function(rt){return function(At){var tt=ht.isBound.bind(ht);return tt(At)}},_t=function(rt){return function(At){var tt=ht.rebind.bind(ht),$t=tt(At);return mt($t,rt),$t}};return function(rt){return{bindFunction:tr(rt),isboundFunction:Jt(rt),rebindFunction:_t(rt),unbindFunction:q(rt)}}},Lt.prototype._get=function(ht,mt,tr,q,Jt,_t){var rt=null,At={avoidConstraints:ht,contextInterceptor:function(tt){return tt},isMultiInject:mt,key:Jt,serviceIdentifier:q,targetType:tr,value:_t};if(this._middleware){if(rt=this._middleware(At),rt==null)throw new Error(j.INVALID_MIDDLEWARE_RETURN)}else rt=this._planAndResolve()(At);return rt},Lt.prototype._planAndResolve=function(){var ht=this;return function(mt){var tr=ae.plan(ht._metadataReader,ht,mt.isMultiInject,mt.targetType,mt.serviceIdentifier,mt.key,mt.value,mt.avoidConstraints);tr=mt.contextInterceptor(tr);var q=nt.resolve(tr);return q}},Lt}();J.Container=er},33244:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.AsyncContainerModule=J.ContainerModule=void 0;var le=N(37791),ye=function(){function ve(j){this.id=le.id(),this.registry=j}return ve}();J.ContainerModule=ye;var m=function(){function ve(j){this.id=le.id(),this.registry=j}return ve}();J.AsyncContainerModule=m},85700:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.ContainerSnapshot=void 0;var N=function(){function le(){}return le.of=function(ye,m){var ve=new le;return ve.bindings=ye,ve.middleware=m,ve},le}();J.ContainerSnapshot=N},80175:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Lookup=void 0;var le=N(16674),ye=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(ve,j){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(j==null)throw new Error(le.NULL_ARGUMENT);var ce=this._map.get(ve);ce!==void 0?(ce.push(j),this._map.set(ve,ce)):this._map.set(ve,[j])},m.prototype.get=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);var j=this._map.get(ve);if(j!==void 0)return j;throw new Error(le.KEY_NOT_FOUND)},m.prototype.remove=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);if(!this._map.delete(ve))throw new Error(le.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(ve){var j=this;this._map.forEach(function(ce,ue){var ze=ce.filter(function(ae){return!ve(ae)});ze.length>0?j._map.set(ue,ze):j._map.delete(ue)})},m.prototype.hasKey=function(ve){if(ve==null)throw new Error(le.NULL_ARGUMENT);return this._map.has(ve)},m.prototype.clone=function(){var ve=new m;return this._map.forEach(function(j,ce){j.forEach(function(ue){return ve.add(ce,ue.clone())})}),ve},m.prototype.traverse=function(ve){this._map.forEach(function(j,ce){ve(ce,j)})},m}();J.Lookup=ye},86700:function(Ot,J,N){"use strict";var le;le={value:!0},le=le=le=le=le=le=J.GW=le=le=J.zY=le=le=le=le=le=J.f3=le=le=J.b2=le=le=le=le=le=J.W2=le=void 0;var ye=N(6867);le=ye;var m=N(51389);Object.defineProperty(J,"W2",{enumerable:!0,get:function(){return m.Container}});var ve=N(28421);le={enumerable:!0,get:function(){return ve.BindingScopeEnum}},le={enumerable:!0,get:function(){return ve.BindingTypeEnum}},le={enumerable:!0,get:function(){return ve.TargetTypeEnum}};var j=N(33244);le={enumerable:!0,get:function(){return j.AsyncContainerModule}},le={enumerable:!0,get:function(){return j.ContainerModule}};var ce=N(64315);Object.defineProperty(J,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ue=N(32052);le={enumerable:!0,get:function(){return ue.tagged}};var ze=N(38085);le={enumerable:!0,get:function(){return ze.named}};var ae=N(5744);Object.defineProperty(J,"f3",{enumerable:!0,get:function(){return ae.inject}}),le={enumerable:!0,get:function(){return ae.LazyServiceIdentifer}};var nt=N(6515);le={enumerable:!0,get:function(){return nt.optional}};var ke=N(86757);le={enumerable:!0,get:function(){return ke.unmanaged}};var st=N(71693);le={enumerable:!0,get:function(){return st.multiInject}};var Gt=N(55638);le={enumerable:!0,get:function(){return Gt.targetName}};var sr=N(7014);Object.defineProperty(J,"zY",{enumerable:!0,get:function(){return sr.postConstruct}});var Pt=N(51377);le={enumerable:!0,get:function(){return Pt.MetadataReader}};var er=N(37791);le={enumerable:!0,get:function(){return er.id}};var Lt=N(99934);Object.defineProperty(J,"GW",{enumerable:!0,get:function(){return Lt.decorate}});var ht=N(80758);le={enumerable:!0,get:function(){return ht.traverseAncerstors}},le={enumerable:!0,get:function(){return ht.taggedConstraint}},le={enumerable:!0,get:function(){return ht.namedConstraint}},le={enumerable:!0,get:function(){return ht.typeConstraint}};var mt=N(55800);le={enumerable:!0,get:function(){return mt.getServiceIdentifierAsString}};var tr=N(70600);le={enumerable:!0,get:function(){return tr.multiBindToService}}},95228:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Context=void 0;var le=N(37791),ye=function(){function m(ve){this.id=le.id(),this.container=ve}return m.prototype.addPlan=function(ve){this.plan=ve},m.prototype.setCurrentRequest=function(ve){this.currentRequest=ve},m}();J.Context=ye},47738:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Metadata=void 0;var le=N(6867),ye=function(){function m(ve,j){this.key=ve,this.value=j}return m.prototype.toString=function(){return this.key===le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();J.Metadata=ye},51377:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.MetadataReader=void 0;var le=N(6867),ye=function(){function m(){}return m.prototype.getConstructorMetadata=function(ve){var j=Reflect.getMetadata(le.PARAM_TYPES,ve),ce=Reflect.getMetadata(le.TAGGED,ve);return{compilerGeneratedMetadata:j,userGeneratedMetadata:ce||{}}},m.prototype.getPropertiesMetadata=function(ve){var j=Reflect.getMetadata(le.TAGGED_PROP,ve)||[];return j},m}();J.MetadataReader=ye},55314:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Plan=void 0;var N=function(){function le(ye,m){this.parentContext=ye,this.rootRequest=m}return le}();J.Plan=N},86311:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.getBindingDictionary=J.createMockRequest=J.plan=void 0;var le=N(23184),ye=N(16674),m=N(28421),ve=N(6867),j=N(85265),ce=N(55800),ue=N(95228),ze=N(47738),ae=N(55314),nt=N(6e3),ke=N(6748),st=N(18924);function Gt(q){return q._bindingDictionary}J.getBindingDictionary=Gt;function sr(q,Jt,_t,rt,At,tt){var $t=q?ve.MULTI_INJECT_TAG:ve.INJECT_TAG,br=new ze.Metadata($t,_t),Fr=new st.Target(Jt,rt,_t,br);if(At!==void 0){var en=new ze.Metadata(At,tt);Fr.metadata.push(en)}return Fr}function Pt(q,Jt,_t,rt,At){var tt=ht(_t.container,At.serviceIdentifier),$t=[];return tt.length===le.BindingCount.NoBindingsAvailable&&_t.container.options.autoBindInjectable&&typeof At.serviceIdentifier=="function"&&q.getConstructorMetadata(At.serviceIdentifier).compilerGeneratedMetadata&&(_t.container.bind(At.serviceIdentifier).toSelf(),tt=ht(_t.container,At.serviceIdentifier)),Jt?$t=tt:$t=tt.filter(function(br){var Fr=new ke.Request(br.serviceIdentifier,_t,rt,br,At);return br.constraint(Fr)}),er(At.serviceIdentifier,$t,At,_t.container),$t}function er(q,Jt,_t,rt){switch(Jt.length){case le.BindingCount.NoBindingsAvailable:if(_t.isOptional())return Jt;var At=ce.getServiceIdentifierAsString(q),tt=ye.NOT_REGISTERED;throw tt+=ce.listMetadataForTarget(At,_t),tt+=ce.listRegisteredBindingsForServiceIdentifier(rt,At,ht),new Error(tt);case le.BindingCount.OnlyOneBindingAvailable:if(!_t.isArray())return Jt;case le.BindingCount.MultipleBindingsAvailable:default:if(_t.isArray())return Jt;var At=ce.getServiceIdentifierAsString(q),tt=ye.AMBIGUOUS_MATCH+" "+At;throw tt+=ce.listRegisteredBindingsForServiceIdentifier(rt,At,ht),new Error(tt)}}function Lt(q,Jt,_t,rt,At,tt){var $t,br;if(At===null){$t=Pt(q,Jt,rt,null,tt),br=new ke.Request(_t,rt,null,$t,tt);var Fr=new ae.Plan(rt,br);rt.addPlan(Fr)}else $t=Pt(q,Jt,rt,At,tt),br=At.addChildRequest(tt.serviceIdentifier,$t,tt);$t.forEach(function(en){var Te=null;if(tt.isArray())Te=br.addChildRequest(en.serviceIdentifier,en,tt);else{if(en.cache)return;Te=br}if(en.type===m.BindingTypeEnum.Instance&&en.implementationType!==null){var Ke=nt.getDependencies(q,en.implementationType);if(!rt.container.options.skipBaseClassChecks){var Fe=nt.getBaseClassDependencyCount(q,en.implementationType);if(Ke.length<Fe){var Mt=ye.ARGUMENTS_LENGTH_MISMATCH(nt.getFunctionName(en.implementationType));throw new Error(Mt)}}Ke.forEach(function(gt){Lt(q,!1,gt.serviceIdentifier,rt,Te,gt)})}})}function ht(q,Jt){var _t=[],rt=Gt(q);return rt.hasKey(Jt)?_t=rt.get(Jt):q.parent!==null&&(_t=ht(q.parent,Jt)),_t}function mt(q,Jt,_t,rt,At,tt,$t,br){br===void 0&&(br=!1);var Fr=new ue.Context(Jt),en=sr(_t,rt,At,"",tt,$t);try{return Lt(q,br,At,Fr,null,en),Fr}catch(Te){throw j.isStackOverflowExeption(Te)&&Fr.plan&&ce.circularDependencyToException(Fr.plan.rootRequest),Te}}J.plan=mt;function tr(q,Jt,_t,rt){var At=new st.Target(m.TargetTypeEnum.Variable,"",Jt,new ze.Metadata(_t,rt)),tt=new ue.Context(q),$t=new ke.Request(Jt,tt,null,[],At);return $t}J.createMockRequest=tr},88460:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.QueryableString=void 0;var N=function(){function le(ye){this.str=ye}return le.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},le.prototype.endsWith=function(ye){var m="",ve=ye.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},ve)},le.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},le.prototype.equals=function(ye){return this.str===ye},le.prototype.value=function(){return this.str},le}();J.QueryableString=N},6e3:function(Ot,J,N){"use strict";var le=this&&this.__spreadArray||function(Pt,er){for(var Lt=0,ht=er.length,mt=Pt.length;Lt<ht;Lt++,mt++)Pt[mt]=er[Lt];return Pt};Object.defineProperty(J,"__esModule",{value:!0}),J.getFunctionName=J.getBaseClassDependencyCount=J.getDependencies=void 0;var ye=N(5744),m=N(16674),ve=N(28421),j=N(6867),ce=N(55800);Object.defineProperty(J,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ue=N(18924);function ze(Pt,er){var Lt=ce.getFunctionName(er),ht=ae(Pt,Lt,er,!1);return ht}J.getDependencies=ze;function ae(Pt,er,Lt,ht){var mt=Pt.getConstructorMetadata(Lt),tr=mt.compilerGeneratedMetadata;if(tr===void 0){var q=m.MISSING_INJECTABLE_ANNOTATION+" "+er+".";throw new Error(q)}var Jt=mt.userGeneratedMetadata,_t=Object.keys(Jt),rt=Lt.length===0&&_t.length>0,At=_t.length>Lt.length,tt=rt||At?_t.length:Lt.length,$t=ke(ht,er,tr,Jt,tt),br=st(Pt,Lt),Fr=le(le([],$t),br);return Fr}function nt(Pt,er,Lt,ht,mt){var tr=mt[Pt.toString()]||[],q=sr(tr),Jt=q.unmanaged!==!0,_t=ht[Pt],rt=q.inject||q.multiInject;if(_t=rt||_t,_t instanceof ye.LazyServiceIdentifer&&(_t=_t.unwrap()),Jt){var At=_t===Object,tt=_t===Function,$t=_t===void 0,br=At||tt||$t;if(!er&&br){var Fr=m.MISSING_INJECT_ANNOTATION+" argument "+Pt+" in class "+Lt+".";throw new Error(Fr)}var en=new ue.Target(ve.TargetTypeEnum.ConstructorArgument,q.targetName,_t);return en.metadata=tr,en}return null}function ke(Pt,er,Lt,ht,mt){for(var tr=[],q=0;q<mt;q++){var Jt=q,_t=nt(Jt,Pt,er,Lt,ht);_t!==null&&tr.push(_t)}return tr}function st(Pt,er){for(var Lt=Pt.getPropertiesMetadata(er),ht=[],mt=Object.keys(Lt),tr=0,q=mt;tr<q.length;tr++){var Jt=q[tr],_t=Lt[Jt],rt=sr(Lt[Jt]),At=rt.targetName||Jt,tt=rt.inject||rt.multiInject,$t=new ue.Target(ve.TargetTypeEnum.ClassProperty,At,tt);$t.metadata=_t,ht.push($t)}var br=Object.getPrototypeOf(er.prototype).constructor;if(br!==Object){var Fr=st(Pt,br);ht=le(le([],ht),Fr)}return ht}function Gt(Pt,er){var Lt=Object.getPrototypeOf(er.prototype).constructor;if(Lt!==Object){var ht=ce.getFunctionName(Lt),mt=ae(Pt,ht,Lt,!0),tr=mt.map(function(_t){return _t.metadata.filter(function(rt){return rt.key===j.UNMANAGED_TAG})}),q=[].concat.apply([],tr).length,Jt=mt.length-q;return Jt>0?Jt:Gt(Pt,Lt)}else return 0}J.getBaseClassDependencyCount=Gt;function sr(Pt){var er={};return Pt.forEach(function(Lt){er[Lt.key.toString()]=Lt.value}),{inject:er[j.INJECT_TAG],multiInject:er[j.MULTI_INJECT_TAG],targetName:er[j.NAME_TAG],unmanaged:er[j.UNMANAGED_TAG]}}},6748:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Request=void 0;var le=N(37791),ye=function(){function m(ve,j,ce,ue,ze){this.id=le.id(),this.serviceIdentifier=ve,this.parentContext=j,this.parentRequest=ce,this.target=ze,this.childRequests=[],this.bindings=Array.isArray(ue)?ue:[ue],this.requestScope=ce===null?new Map:null}return m.prototype.addChildRequest=function(ve,j,ce){var ue=new m(ve,this.parentContext,this,j,ce);return this.childRequests.push(ue),ue},m}();J.Request=ye},18924:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Target=void 0;var le=N(6867),ye=N(37791),m=N(47738),ve=N(88460),j=function(){function ce(ue,ze,ae,nt){this.id=ye.id(),this.type=ue,this.serviceIdentifier=ae,this.name=new ve.QueryableString(ze||""),this.metadata=new Array;var ke=null;typeof nt=="string"?ke=new m.Metadata(le.NAMED_TAG,nt):nt instanceof m.Metadata&&(ke=nt),ke!==null&&this.metadata.push(ke)}return ce.prototype.hasTag=function(ue){for(var ze=0,ae=this.metadata;ze<ae.length;ze++){var nt=ae[ze];if(nt.key===ue)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(le.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ue){return this.matchesTag(le.MULTI_INJECT_TAG)(ue)},ce.prototype.isNamed=function(){return this.hasTag(le.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ue){return le.NON_CUSTOM_TAG_KEYS.every(function(ze){return ue.key!==ze})})},ce.prototype.isOptional=function(){return this.matchesTag(le.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ue){return ue.key===le.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ue){return le.NON_CUSTOM_TAG_KEYS.every(function(ze){return ue.key!==ze})}):null},ce.prototype.matchesNamedTag=function(ue){return this.matchesTag(le.NAMED_TAG)(ue)},ce.prototype.matchesTag=function(ue){var ze=this;return function(ae){for(var nt=0,ke=ze.metadata;nt<ke.length;nt++){var st=ke[nt];if(st.key===ue&&st.value===ae)return!0}return!1}},ce}();J.Target=j},52279:function(Ot,J,N){"use strict";var le=this&&this.__spreadArray||function(ae,nt){for(var ke=0,st=nt.length,Gt=ae.length;ke<st;ke++,Gt++)ae[Gt]=nt[ke];return ae};Object.defineProperty(J,"__esModule",{value:!0}),J.resolveInstance=void 0;var ye=N(16674),m=N(28421),ve=N(6867);function j(ae,nt,ke){var st=nt.filter(function(sr){return sr.target!==null&&sr.target.type===m.TargetTypeEnum.ClassProperty}),Gt=st.map(ke);return st.forEach(function(sr,Pt){var er="";er=sr.target.name.value();var Lt=Gt[Pt];ae[er]=Lt}),ae}function ce(ae,nt){return new(ae.bind.apply(ae,le([void 0],nt)))}function ue(ae,nt){if(Reflect.hasMetadata(ve.POST_CONSTRUCT,ae)){var ke=Reflect.getMetadata(ve.POST_CONSTRUCT,ae);try{nt[ke.value]()}catch(st){throw new Error(ye.POST_CONSTRUCT_ERROR(ae.name,st.message))}}}function ze(ae,nt,ke){var st=null;if(nt.length>0){var Gt=nt.filter(function(Pt){return Pt.target!==null&&Pt.target.type===m.TargetTypeEnum.ConstructorArgument}),sr=Gt.map(ke);st=ce(ae,sr),st=j(st,nt,ke)}else st=new ae;return ue(ae,st),st}J.resolveInstance=ze},31927:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.resolve=void 0;var le=N(16674),ye=N(28421),m=N(85265),ve=N(55800),j=N(52279),ce=function(ae,nt,ke){try{return ke()}catch(st){throw m.isStackOverflowExeption(st)?new Error(le.CIRCULAR_DEPENDENCY_IN_FACTORY(ae,nt.toString())):st}},ue=function(ae){return function(nt){nt.parentContext.setCurrentRequest(nt);var ke=nt.bindings,st=nt.childRequests,Gt=nt.target&&nt.target.isArray(),sr=!nt.parentRequest||!nt.parentRequest.target||!nt.target||!nt.parentRequest.target.matchesArray(nt.target.serviceIdentifier);if(Gt&&sr)return st.map(function(tr){var q=ue(ae);return q(tr)});var Pt=null;if(nt.target.isOptional()&&ke.length===0)return;var er=ke[0],Lt=er.scope===ye.BindingScopeEnum.Singleton,ht=er.scope===ye.BindingScopeEnum.Request;if(Lt&&er.activated)return er.cache;if(ht&&ae!==null&&ae.has(er.id))return ae.get(er.id);if(er.type===ye.BindingTypeEnum.ConstantValue)Pt=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Function)Pt=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Constructor)Pt=er.implementationType;else if(er.type===ye.BindingTypeEnum.DynamicValue&&er.dynamicValue!==null)Pt=ce("toDynamicValue",er.serviceIdentifier,function(){return er.dynamicValue(nt.parentContext)});else if(er.type===ye.BindingTypeEnum.Factory&&er.factory!==null)Pt=ce("toFactory",er.serviceIdentifier,function(){return er.factory(nt.parentContext)});else if(er.type===ye.BindingTypeEnum.Provider&&er.provider!==null)Pt=ce("toProvider",er.serviceIdentifier,function(){return er.provider(nt.parentContext)});else if(er.type===ye.BindingTypeEnum.Instance&&er.implementationType!==null)Pt=j.resolveInstance(er.implementationType,st,ue(ae));else{var mt=ve.getServiceIdentifierAsString(nt.serviceIdentifier);throw new Error(le.INVALID_BINDING_TYPE+" "+mt)}return typeof er.onActivation=="function"&&(Pt=er.onActivation(nt.parentContext,Pt)),Lt&&(er.cache=Pt,er.activated=!0),ht&&ae!==null&&!ae.has(er.id)&&ae.set(er.id,Pt),Pt}};function ze(ae){var nt=ue(ae.plan.rootRequest.requestScope);return nt(ae.plan.rootRequest)}J.resolve=ze},83366:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInSyntax=void 0;var le=N(28421),ye=N(71325),m=function(){function ve(j){this._binding=j}return ve.prototype.inRequestScope=function(){return this._binding.scope=le.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inSingletonScope=function(){return this._binding.scope=le.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inTransientScope=function(){return this._binding.scope=le.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},ve}();J.BindingInSyntax=m},74889:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInWhenOnSyntax=void 0;var le=N(83366),ye=N(51811),m=N(98370),ve=function(){function j(ce){this._binding=ce,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new le.BindingInSyntax(ce)}return j.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},j.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},j.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},j.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},j.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},j.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},j.prototype.whenTargetTagged=function(ce,ue){return this._bindingWhenSyntax.whenTargetTagged(ce,ue)},j.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},j.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},j.prototype.whenParentTagged=function(ce,ue){return this._bindingWhenSyntax.whenParentTagged(ce,ue)},j.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},j.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},j.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},j.prototype.whenAnyAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ue)},j.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},j.prototype.whenNoAncestorTagged=function(ce,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ue)},j.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},j.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},j.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},j}();J.BindingInWhenOnSyntax=ve},51811:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingOnSyntax=void 0;var le=N(98370),ye=function(){function m(ve){this._binding=ve}return m.prototype.onActivation=function(ve){return this._binding.onActivation=ve,new le.BindingWhenSyntax(this._binding)},m}();J.BindingOnSyntax=ye},15451:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingToSyntax=void 0;var le=N(16674),ye=N(28421),m=N(74889),ve=N(71325),j=function(){function ce(ue){this._binding=ue}return ce.prototype.to=function(ue){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=ue,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+le.INVALID_TO_SELF_VALUE);var ue=this._binding.serviceIdentifier;return this.to(ue)},ce.prototype.toConstantValue=function(ue){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=ue,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ue){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ue,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ue){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ue){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ue){if(typeof ue!="function")throw new Error(le.INVALID_FUNCTION_BINDING);var ze=this.toConstantValue(ue);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,ze},ce.prototype.toAutoFactory=function(ue){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(ze){var ae=function(){return ze.container.get(ue)};return ae},this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ue){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=ue,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ue){this.toDynamicValue(function(ze){return ze.container.get(ue)})},ce}();J.BindingToSyntax=j},71325:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenOnSyntax=void 0;var le=N(51811),ye=N(98370),m=function(){function ve(j){this._binding=j,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new le.BindingOnSyntax(this._binding)}return ve.prototype.when=function(j){return this._bindingWhenSyntax.when(j)},ve.prototype.whenTargetNamed=function(j){return this._bindingWhenSyntax.whenTargetNamed(j)},ve.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ve.prototype.whenTargetTagged=function(j,ce){return this._bindingWhenSyntax.whenTargetTagged(j,ce)},ve.prototype.whenInjectedInto=function(j){return this._bindingWhenSyntax.whenInjectedInto(j)},ve.prototype.whenParentNamed=function(j){return this._bindingWhenSyntax.whenParentNamed(j)},ve.prototype.whenParentTagged=function(j,ce){return this._bindingWhenSyntax.whenParentTagged(j,ce)},ve.prototype.whenAnyAncestorIs=function(j){return this._bindingWhenSyntax.whenAnyAncestorIs(j)},ve.prototype.whenNoAncestorIs=function(j){return this._bindingWhenSyntax.whenNoAncestorIs(j)},ve.prototype.whenAnyAncestorNamed=function(j){return this._bindingWhenSyntax.whenAnyAncestorNamed(j)},ve.prototype.whenAnyAncestorTagged=function(j,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(j,ce)},ve.prototype.whenNoAncestorNamed=function(j){return this._bindingWhenSyntax.whenNoAncestorNamed(j)},ve.prototype.whenNoAncestorTagged=function(j,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(j,ce)},ve.prototype.whenAnyAncestorMatches=function(j){return this._bindingWhenSyntax.whenAnyAncestorMatches(j)},ve.prototype.whenNoAncestorMatches=function(j){return this._bindingWhenSyntax.whenNoAncestorMatches(j)},ve.prototype.onActivation=function(j){return this._bindingOnSyntax.onActivation(j)},ve}();J.BindingWhenOnSyntax=m},98370:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenSyntax=void 0;var le=N(51811),ye=N(80758),m=function(){function ve(j){this._binding=j}return ve.prototype.when=function(j){return this._binding.constraint=j,new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetNamed=function(j){return this._binding.constraint=ye.namedConstraint(j),new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(j){var ce=j.target!==null&&!j.target.isNamed()&&!j.target.isTagged();return ce},new le.BindingOnSyntax(this._binding)},ve.prototype.whenTargetTagged=function(j,ce){return this._binding.constraint=ye.taggedConstraint(j)(ce),new le.BindingOnSyntax(this._binding)},ve.prototype.whenInjectedInto=function(j){return this._binding.constraint=function(ce){return ye.typeConstraint(j)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentNamed=function(j){return this._binding.constraint=function(ce){return ye.namedConstraint(j)(ce.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenParentTagged=function(j,ce){return this._binding.constraint=function(ue){return ye.taggedConstraint(j)(ce)(ue.parentRequest)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorIs=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.typeConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorIs=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.typeConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorNamed=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,ye.namedConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorNamed=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,ye.namedConstraint(j))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorTagged=function(j,ce){return this._binding.constraint=function(ue){return ye.traverseAncerstors(ue,ye.taggedConstraint(j)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorTagged=function(j,ce){return this._binding.constraint=function(ue){return!ye.traverseAncerstors(ue,ye.taggedConstraint(j)(ce))},new le.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorMatches=function(j){return this._binding.constraint=function(ce){return ye.traverseAncerstors(ce,j)},new le.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorMatches=function(j){return this._binding.constraint=function(ce){return!ye.traverseAncerstors(ce,j)},new le.BindingOnSyntax(this._binding)},ve}();J.BindingWhenSyntax=m},80758:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.typeConstraint=J.namedConstraint=J.taggedConstraint=J.traverseAncerstors=void 0;var le=N(6867),ye=N(47738),m=function(ue,ze){var ae=ue.parentRequest;return ae!==null?ze(ae)?!0:m(ae,ze):!1};J.traverseAncerstors=m;var ve=function(ue){return function(ze){var ae=function(nt){return nt!==null&&nt.target!==null&&nt.target.matchesTag(ue)(ze)};return ae.metaData=new ye.Metadata(ue,ze),ae}};J.taggedConstraint=ve;var j=ve(le.NAMED_TAG);J.namedConstraint=j;var ce=function(ue){return function(ze){var ae=null;if(ze!==null)if(ae=ze.bindings[0],typeof ue=="string"){var nt=ae.serviceIdentifier;return nt===ue}else{var ke=ze.bindings[0].implementationType;return ue===ke}return!1}};J.typeConstraint=ce},70600:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiBindToService=void 0;var N=function(le){return function(ye){return function(){for(var m=[],ve=0;ve<arguments.length;ve++)m[ve]=arguments[ve];return m.forEach(function(j){return le.bind(j).toService(ye)})}}};J.multiBindToService=N},85265:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.isStackOverflowExeption=void 0;var le=N(16674);function ye(m){return m instanceof RangeError||m.message===le.STACK_OVERFLOW}J.isStackOverflowExeption=ye},37791:function(Ot,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.id=void 0;var N=0;function le(){return N++}J.id=le},55800:function(Ot,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.circularDependencyToException=J.listMetadataForTarget=J.listRegisteredBindingsForServiceIdentifier=J.getServiceIdentifierAsString=J.getFunctionName=void 0;var le=N(16674);function ye(ae){if(typeof ae=="function"){var nt=ae;return nt.name}else{if(typeof ae=="symbol")return ae.toString();var nt=ae;return nt}}J.getServiceIdentifierAsString=ye;function m(ae,nt,ke){var st="",Gt=ke(ae,nt);return Gt.length!==0&&(st=`
Registered bindings:`,Gt.forEach(function(sr){var Pt="Object";sr.implementationType!==null&&(Pt=ze(sr.implementationType)),st=st+`
 `+Pt,sr.constraint.metaData&&(st=st+" - "+sr.constraint.metaData)})),st}J.listRegisteredBindingsForServiceIdentifier=m;function ve(ae,nt){return ae.parentRequest===null?!1:ae.parentRequest.serviceIdentifier===nt?!0:ve(ae.parentRequest,nt)}function j(ae){function nt(st,Gt){Gt===void 0&&(Gt=[]);var sr=ye(st.serviceIdentifier);return Gt.push(sr),st.parentRequest!==null?nt(st.parentRequest,Gt):Gt}var ke=nt(ae);return ke.reverse().join(" --> ")}function ce(ae){ae.childRequests.forEach(function(nt){if(ve(nt,nt.serviceIdentifier)){var ke=j(nt);throw new Error(le.CIRCULAR_DEPENDENCY+" "+ke)}else ce(nt)})}J.circularDependencyToException=ce;function ue(ae,nt){if(nt.isTagged()||nt.isNamed()){var ke="",st=nt.getNamedTag(),Gt=nt.getCustomTags();return st!==null&&(ke+=st.toString()+`
`),Gt!==null&&Gt.forEach(function(sr){ke+=sr.toString()+`
`})," "+ae+`
 `+ae+" - "+ke}else return" "+ae}J.listMetadataForTarget=ue;function ze(ae){if(ae.name)return ae.name;var nt=ae.toString(),ke=nt.match(/^function\s*([^\s(]+)/);return ke?ke[1]:"Anonymous function: "+nt}J.getFunctionName=ze},31745:function(Ot){"use strict";Ot.exports=N,Ot.exports.default=N;var J=1e20;function N(j,ce,ue,ze,ae,nt){this.fontSize=j||24,this.buffer=ce===void 0?3:ce,this.cutoff=ze||.25,this.fontFamily=ae||"sans-serif",this.fontWeight=nt||"normal",this.radius=ue||8;var ke=this.size=this.fontSize+this.buffer*2,st=ke+this.buffer*2,Gt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Gt?this.canvas=my.createOffscreenCanvas(ke,ke,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ke),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(st*st),this.gridInner=new Float64Array(st*st),this.f=new Float64Array(st),this.z=new Float64Array(st+1),this.v=new Uint16Array(st),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Gt?this.middle=Math.round(ke/2*1):this.middle=Math.round(ke/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function le(j,ce,ue,ze,ae,nt,ke){nt.fill(J,0,ce*ue),ke.fill(0,0,ce*ue);for(var st=(ce-ze)/2,Gt=0;Gt<ae;Gt++)for(var sr=0;sr<ze;sr++){var Pt=(Gt+st)*ce+sr+st,er=j.data[4*(Gt*ze+sr)+3]/255;if(er===1)nt[Pt]=0,ke[Pt]=J;else if(er===0)nt[Pt]=J,ke[Pt]=0;else{var Lt=Math.max(0,.5-er),ht=Math.max(0,er-.5);nt[Pt]=Lt*Lt,ke[Pt]=ht*ht}}}function ye(j,ce,ue,ze,ae,nt,ke){for(var st=0;st<ce*ue;st++){var Gt=Math.sqrt(ze[st])-Math.sqrt(ae[st]);j[st]=Math.round(255-255*(Gt/nt+ke))}}N.prototype._draw=function(j,ce){var ue=this.ctx.measureText(j),ze=ue.width,ae=2*this.buffer,nt,ke,st,Gt,sr,Pt,er,Lt;ce&&this.useMetrics?(sr=Math.floor(ue.actualBoundingBoxAscent),Lt=this.buffer+Math.ceil(ue.actualBoundingBoxAscent),Pt=this.buffer,er=this.buffer,ke=Math.min(this.size,Math.ceil(ue.actualBoundingBoxRight-ue.actualBoundingBoxLeft)),Gt=Math.min(this.size-Pt,Math.ceil(ue.actualBoundingBoxAscent+ue.actualBoundingBoxDescent)),nt=ke+ae,st=Gt+ae,this.ctx.textBaseline="alphabetic"):(nt=ke=this.size,st=Gt=this.size,sr=19*this.fontSize/24,Pt=er=0,Lt=this.middle,this.ctx.textBaseline="middle");var ht;ke&&Gt&&(this.ctx.clearRect(er,Pt,ke,Gt),this.ctx.fillText(j,this.buffer,Lt),ht=this.ctx.getImageData(er,Pt,ke,Gt));var mt=new Uint8ClampedArray(nt*st);return le(ht,nt,st,ke,Gt,this.gridOuter,this.gridInner),m(this.gridOuter,nt,st,this.f,this.v,this.z),m(this.gridInner,nt,st,this.f,this.v,this.z),ye(mt,nt,st,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:mt,metrics:{width:ke,height:Gt,sdfWidth:nt,sdfHeight:st,top:sr,left:0,advance:ze}}},N.prototype.draw=function(j){return this._draw(j,!1).data},N.prototype.drawWithMetrics=function(j){return this._draw(j,!0)};function m(j,ce,ue,ze,ae,nt){for(var ke=0;ke<ce;ke++)ve(j,ke,ce,ue,ze,ae,nt);for(var st=0;st<ue;st++)ve(j,st*ce,1,ce,ze,ae,nt)}function ve(j,ce,ue,ze,ae,nt,ke){var st,Gt,sr,Pt;for(nt[0]=0,ke[0]=-J,ke[1]=J,st=0;st<ze;st++)ae[st]=j[ce+st*ue];for(st=1,Gt=0,sr=0;st<ze;st++){do Pt=nt[Gt],sr=(ae[st]-ae[Pt]+st*st-Pt*Pt)/(st-Pt)/2;while(sr<=ke[Gt]&&--Gt>-1);Gt++,nt[Gt]=st,ke[Gt]=sr,ke[Gt+1]=J}for(st=0,Gt=0;st<ze;st++){for(;ke[Gt+1]<st;)Gt++;Pt=nt[Gt],j[ce+st*ue]=ae[Pt]+(st-Pt)*(st-Pt)}}},18857:function(Ot,J,N){"use strict";N.r(J),N.d(J,{Function:function(){return uu},Interpreter:function(){return ho},default:function(){return Qu},evaluate:function(){return $u},vm:function(){return le}});var le={};N.r(le),N.d(le,{Script:function(){return Rl},compileFunction:function(){return Oc},createContext:function(){return ic},runInContext:function(){return Ku},runInNewContext:function(){return Rc}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ve={5:m,"5module":m+" export import",6:m+" const class extends export import super"},j=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ue="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ze=new RegExp("["+ce+"]"),ae=new RegExp("["+ce+ue+"]");ce=ue=null;var nt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ke=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function st(_,T){for(var F=65536,R=0;R<T.length;R+=2){if(F+=T[R],F>_)return!1;if(F+=T[R+1],F>=_)return!0}}function Gt(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ze.test(String.fromCharCode(_)):T===!1?!1:st(_,nt)}function sr(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ae.test(String.fromCharCode(_)):T===!1?!1:st(_,nt)||st(_,ke)}var Pt=function(T,F){F===void 0&&(F={}),this.label=T,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function er(_,T){return new Pt(_,{beforeExpr:!0,binop:T})}var Lt={beforeExpr:!0},ht={startsExpr:!0},mt={};function tr(_,T){return T===void 0&&(T={}),T.keyword=_,mt[_]=new Pt(_,T)}var q={num:new Pt("num",ht),regexp:new Pt("regexp",ht),string:new Pt("string",ht),name:new Pt("name",ht),eof:new Pt("eof"),bracketL:new Pt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Pt("]"),braceL:new Pt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Pt("}"),parenL:new Pt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Pt(")"),comma:new Pt(",",Lt),semi:new Pt(";",Lt),colon:new Pt(":",Lt),dot:new Pt("."),question:new Pt("?",Lt),questionDot:new Pt("?."),arrow:new Pt("=>",Lt),template:new Pt("template"),invalidTemplate:new Pt("invalidTemplate"),ellipsis:new Pt("...",Lt),backQuote:new Pt("`",ht),dollarBraceL:new Pt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Pt("=",{beforeExpr:!0,isAssign:!0}),assign:new Pt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Pt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Pt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:er("||",1),logicalAND:er("&&",2),bitwiseOR:er("|",3),bitwiseXOR:er("^",4),bitwiseAND:er("&",5),equality:er("==/!=/===/!==",6),relational:er("</>/<=/>=",7),bitShift:er("<</>>/>>>",8),plusMin:new Pt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:er("%",10),star:er("*",10),slash:er("/",10),starstar:new Pt("**",{beforeExpr:!0}),coalesce:er("??",1),_break:tr("break"),_case:tr("case",Lt),_catch:tr("catch"),_continue:tr("continue"),_debugger:tr("debugger"),_default:tr("default",Lt),_do:tr("do",{isLoop:!0,beforeExpr:!0}),_else:tr("else",Lt),_finally:tr("finally"),_for:tr("for",{isLoop:!0}),_function:tr("function",ht),_if:tr("if"),_return:tr("return",Lt),_switch:tr("switch"),_throw:tr("throw",Lt),_try:tr("try"),_var:tr("var"),_const:tr("const"),_while:tr("while",{isLoop:!0}),_with:tr("with"),_new:tr("new",{beforeExpr:!0,startsExpr:!0}),_this:tr("this",ht),_super:tr("super",ht),_class:tr("class",ht),_extends:tr("extends",Lt),_export:tr("export"),_import:tr("import",ht),_null:tr("null",ht),_true:tr("true",ht),_false:tr("false",ht),_in:tr("in",{beforeExpr:!0,binop:7}),_instanceof:tr("instanceof",{beforeExpr:!0,binop:7}),_typeof:tr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:tr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:tr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Jt=/\r\n?|\n|\u2028|\u2029/,_t=new RegExp(Jt.source,"g");function rt(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var At=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,tt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,$t=Object.prototype,br=$t.hasOwnProperty,Fr=$t.toString;function en(_,T){return br.call(_,T)}var Te=Array.isArray||function(_){return Fr.call(_)==="[object Array]"};function Ke(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var Fe=function(T,F){this.line=T,this.column=F};Fe.prototype.offset=function(T){return new Fe(this.line,this.column+T)};var Mt=function(T,F,R){this.start=F,this.end=R,T.sourceFile!==null&&(this.source=T.sourceFile)};function gt(_,T){for(var F=1,R=0;;){_t.lastIndex=R;var K=_t.exec(_);if(K&&K.index<T)++F,R=K.index+K[0].length;else return new Fe(F,T-R)}}var Zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(_){var T={};for(var F in Zt)T[F]=_&&en(_,F)?_[F]:Zt[F];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),Te(T.onToken)){var R=T.onToken;T.onToken=function(K){return R.push(K)}}return Te(T.onComment)&&(T.onComment=Er(T,T.onComment)),T}function Er(_,T){return function(F,R,K,xe,qe,pt){var vt={type:F?"Block":"Line",value:R,start:K,end:xe};_.locations&&(vt.loc=new Mt(this,qe,pt)),_.ranges&&(vt.range=[K,xe]),T.push(vt)}}var Kn=1,pn=2,Wi=Kn|pn,Zn=4,Gn=8,pi=16,$n=32,ui=64,Ji=128;function Ii(_,T){return pn|(_?Zn:0)|(T?Gn:0)}var Ei=0,zi=1,na=2,Si=3,ya=4,wn=5,_i=function(T,F,R){this.options=T=qt(T),this.sourceFile=T.sourceFile,this.keywords=Ke(ve[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var K="";if(T.allowReserved!==!0){for(var xe=T.ecmaVersion;!(K=ye[xe]);xe--);T.sourceType==="module"&&(K+=" await")}this.reservedWords=Ke(K);var qe=(K?K+" ":"")+ye.strict;this.reservedWordsStrict=Ke(qe),this.reservedWordsStrictBind=Ke(qe+" "+ye.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Jt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Kn),this.regexpState=null},ki={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};_i.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},ki.inFunction.get=function(){return(this.currentVarScope().flags&pn)>0},ki.inGenerator.get=function(){return(this.currentVarScope().flags&Gn)>0},ki.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},ki.allowSuper.get=function(){return(this.currentThisScope().flags&ui)>0},ki.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ji)>0},ki.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},_i.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&pn)>0},_i.extend=function(){for(var T=[],F=arguments.length;F--;)T[F]=arguments[F];for(var R=this,K=0;K<T.length;K++)R=T[K](R);return R},_i.parse=function(T,F){return new this(F,T).parse()},_i.parseExpressionAt=function(T,F,R){var K=new this(R,T,F);return K.nextToken(),K.parseExpression()},_i.tokenizer=function(T,F){return new this(F,T)},Object.defineProperties(_i.prototype,ki);var Xi=_i.prototype,za=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Xi.strictDirective=function(_){for(;;){tt.lastIndex=_,_+=tt.exec(this.input)[0].length;var T=za.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){tt.lastIndex=_+T[0].length;var F=tt.exec(this.input),R=F.index+F[0].length,K=this.input.charAt(R);return K===";"||K==="}"||Jt.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=T[0].length,tt.lastIndex=_,_+=tt.exec(this.input)[0].length,this.input[_]===";"&&_++}},Xi.eat=function(_){return this.type===_?(this.next(),!0):!1},Xi.isContextual=function(_){return this.type===q.name&&this.value===_&&!this.containsEsc},Xi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Xi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Xi.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||Jt.test(this.input.slice(this.lastTokEnd,this.start))},Xi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Xi.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},Xi.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Xi.expect=function(_){this.eat(_)||this.unexpected()},Xi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function de(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Xi.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=T?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},Xi.checkExpressionErrors=function(_,T){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!T)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Xi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Xi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Nn=_i.prototype;Nn.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==q.eof;){var F=this.parseStatement(null,!0,T);_.body.push(F)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var xe=K[R];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Ua={kind:"loop"},us={kind:"switch"};Nn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;tt.lastIndex=this.pos;var T=tt.exec(this.input),F=this.pos+T[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Gt(R,!0)){for(var K=F+1;sr(this.input.charCodeAt(K),!0);)++K;var xe=this.input.slice(F,K);if(!j.test(xe))return!0}return!1},Nn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;tt.lastIndex=this.pos;var _=tt.exec(this.input),T=this.pos+_[0].length;return!Jt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!sr(this.input.charAt(T+8)))},Nn.parseStatement=function(_,T,F){var R=this.type,K=this.startNode(),xe;switch(this.isLet(_)&&(R=q._var,xe="let"),R){case q._break:case q._continue:return this.parseBreakContinueStatement(K,R.keyword);case q._debugger:return this.parseDebuggerStatement(K);case q._do:return this.parseDoStatement(K);case q._for:return this.parseForStatement(K);case q._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case q._class:return _&&this.unexpected(),this.parseClass(K,!0);case q._if:return this.parseIfStatement(K);case q._return:return this.parseReturnStatement(K);case q._switch:return this.parseSwitchStatement(K);case q._throw:return this.parseThrowStatement(K);case q._try:return this.parseTryStatement(K);case q._const:case q._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement(K,xe);case q._while:return this.parseWhileStatement(K);case q._with:return this.parseWithStatement(K);case q.braceL:return this.parseBlock(!0,K);case q.semi:return this.parseEmptyStatement(K);case q._export:case q._import:if(this.options.ecmaVersion>10&&R===q._import){tt.lastIndex=this.pos;var qe=tt.exec(this.input),pt=this.pos+qe[0].length,vt=this.input.charCodeAt(pt);if(vt===40||vt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===q._import?this.parseImport(K):this.parseExport(K,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var cr=this.value,_r=this.parseExpression();return R===q.name&&_r.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(K,cr,_r,_):this.parseExpressionStatement(K,_r)}},Nn.parseBreakContinueStatement=function(_,T){var F=T==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?_.label=null:this.type!==q.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(F||K.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Nn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Nn.parseDoStatement=function(_){return this.next(),this.labels.push(Ua),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Nn.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ua),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var F=this.isLet();if(this.type===q._var||this.type===q._const||F){var R=this.startNode(),K=F?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,R)):(T>-1&&this.unexpected(T),this.parseFor(_,R))}var xe=new de,qe=this.parseExpression(!0,xe);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(qe,!1,xe),this.checkLVal(qe),this.parseForIn(_,qe)):(this.checkExpressionErrors(xe,!0),T>-1&&this.unexpected(T),this.parseFor(_,qe))},Nn.parseFunctionStatement=function(_,T,F){return this.next(),this.parseFunction(_,ir|(F?0:Tr),!1,T)},Nn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Nn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Nn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(q.braceL),this.labels.push(us),this.enterScope(0);for(var T,F=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var R=this.type===q._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),R?T.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,T.test=null),this.expect(q.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Nn.parseThrowStatement=function(_){return this.next(),Jt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var jt=[];Nn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===q._catch){var T=this.startNode();if(this.next(),this.eat(q.parenL)){T.param=this.parseBindingAtom();var F=T.param.type==="Identifier";this.enterScope(F?$n:0),this.checkLVal(T.param,F?ya:na),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(q._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Nn.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Nn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Ua),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Nn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Nn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Nn.parseLabeledStatement=function(_,T,F,R){for(var K=0,xe=this.labels;K<xe.length;K+=1){var qe=xe[K];qe.name===T&&this.raise(F.start,"Label '"+T+"' is already declared")}for(var pt=this.type.isLoop?"loop":this.type===q._switch?"switch":null,vt=this.labels.length-1;vt>=0;vt--){var cr=this.labels[vt];if(cr.statementStart===_.start)cr.statementStart=this.start,cr.kind=pt;else break}return this.labels.push({name:T,kind:pt,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Nn.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Nn.parseBlock=function(_,T,F){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(q.braceL),_&&this.enterScope(0);this.type!==q.braceR;){var R=this.parseStatement(null);T.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},Nn.parseFor=function(_,T){return _.init=T,this.expect(q.semi),_.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),_.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Nn.parseForIn=function(_,T){var F=this.type===q._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Nn.parseVar=function(_,T,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(q.eq)?R.init=this.parseMaybeAssign(T):F==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(T&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(q.comma))break}return _},Nn.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?zi:na,!1)};var ir=1,Tr=2,I=4;Nn.parseFunction=function(_,T,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===q.star&&T&Tr&&this.unexpected(),_.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(_.async=!!R),T&ir&&(_.id=T&I&&this.type!==q.name?null:this.parseIdent(),_.id&&!(T&Tr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?zi:na:Si));var K=this.yieldPos,xe=this.awaitPos,qe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ii(_.async,_.generator)),T&ir||(_.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=qe,this.finishNode(_,T&ir?"FunctionDeclaration":"FunctionExpression")},Nn.parseFunctionParams=function(_){this.expect(q.parenL),_.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Nn.parseClass=function(_,T){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(q.braceL);this.type!==q.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(R.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&(K&&this.raise(xe.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},Nn.parseClassElement=function(_){var T=this;if(this.eat(q.semi))return null;var F=this.startNode(),R=function(vt,cr){cr===void 0&&(cr=!1);var _r=T.start,Pn=T.startLoc;return T.eatContextual(vt)?T.type!==q.parenL&&(!cr||!T.canInsertSemicolon())?!0:(F.key&&T.unexpected(),F.computed=!1,F.key=T.startNodeAt(_r,Pn),F.key.name=vt,T.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var K=this.eat(q.star),xe=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(xe=!0,K=this.options.ecmaVersion>=9&&this.eat(q.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var qe=F.key,pt=!1;return!F.computed&&!F.static&&(qe.type==="Identifier"&&qe.name==="constructor"||qe.type==="Literal"&&qe.value==="constructor")?(F.kind!=="method"&&this.raise(qe.start,"Constructor can't have get/set modifier"),K&&this.raise(qe.start,"Constructor can't be a generator"),xe&&this.raise(qe.start,"Constructor can't be an async method"),F.kind="constructor",pt=_):F.static&&qe.type==="Identifier"&&qe.name==="prototype"&&this.raise(qe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,K,xe,pt),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Nn.parseClassMethod=function(_,T,F,R){return _.value=this.parseMethod(T,F,R),this.finishNode(_,"MethodDefinition")},Nn.parseClassId=function(_,T){this.type===q.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,na,!1)):(T===!0&&this.unexpected(),_.id=null)},Nn.parseClassSuper=function(_){_.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Nn.parseExport=function(_,T){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(T,"default",this.lastTokStart);var F;if(this.type===q._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,ir|I,!1,F)}else if(this.type===q._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,qe=_.specifiers;xe<qe.length;xe+=1){var pt=qe[xe];this.checkUnreserved(pt.local),this.checkLocalExport(pt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Nn.checkExport=function(_,T,F){!_||(en(_,T)&&this.raiseRecoverable(F,"Duplicate export '"+T+"'"),_[T]=!0)},Nn.checkPatternExport=function(_,T){var F=T.type;if(F==="Identifier")this.checkExport(_,T.name,T.start);else if(F==="ObjectPattern")for(var R=0,K=T.properties;R<K.length;R+=1){var xe=K[R];this.checkPatternExport(_,xe)}else if(F==="ArrayPattern")for(var qe=0,pt=T.elements;qe<pt.length;qe+=1){var vt=pt[qe];vt&&this.checkPatternExport(_,vt)}else F==="Property"?this.checkPatternExport(_,T.value):F==="AssignmentPattern"?this.checkPatternExport(_,T.left):F==="RestElement"?this.checkPatternExport(_,T.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},Nn.checkVariableExport=function(_,T){if(!!_)for(var F=0,R=T;F<R.length;F+=1){var K=R[F];this.checkPatternExport(_,K.id)}},Nn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Nn.parseExportSpecifiers=function(_){var T=[],F=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(F)F=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),T.push(this.finishNode(R,"ExportSpecifier"))}return T},Nn.parseImport=function(_){return this.next(),this.type===q.string?(_.specifiers=jt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Nn.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===q.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,na),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(q.comma))return _}if(this.type===q.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,na),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(q.braceL);!this.eat(q.braceR);){if(T)T=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,na),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Nn.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},Nn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var nr=_i.prototype;nr.toAssignable=function(_,T,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.toAssignable(xe,T),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},nr.toAssignableList=function(_,T){for(var F=_.length,R=0;R<F;R++){var K=_[R];K&&this.toAssignable(K,T)}if(F){var xe=_[F-1];this.options.ecmaVersion===6&&T&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},nr.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},nr.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},nr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},nr.parseBindingList=function(_,T,F){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(q.comma),T&&this.type===q.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===q.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),R.push(xe),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var qe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(qe),R.push(qe)}}return R},nr.parseBindingListItem=function(_){return _},nr.parseMaybeDefault=function(_,T,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return F;var R=this.startNodeAt(_,T);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},nr.checkLVal=function(_,T,F){switch(T===void 0&&(T=Ei),_.type){case"Identifier":T===na&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(en(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),T!==Ei&&T!==wn&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,T,F)}break;case"Property":this.checkLVal(_.value,T,F);break;case"ArrayPattern":for(var qe=0,pt=_.elements;qe<pt.length;qe+=1){var vt=pt[qe];vt&&this.checkLVal(vt,T,F)}break;case"AssignmentPattern":this.checkLVal(_.left,T,F);break;case"RestElement":this.checkLVal(_.argument,T,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,F);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var Dn=_i.prototype;Dn.checkPropClash=function(_,T,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&xe==="init"&&(T.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),T.proto=!0);return}K="$"+K;var qe=T[K];if(qe){var pt;xe==="init"?pt=this.strict&&qe.init||qe.get||qe.set:pt=qe.init||qe[xe],pt&&this.raiseRecoverable(R.start,"Redefinition of property")}else qe=T[K]={init:!1,get:!1,set:!1};qe[xe]=!0}},Dn.parseExpression=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,T);if(this.type===q.comma){var xe=this.startNodeAt(F,R);for(xe.expressions=[K];this.eat(q.comma);)xe.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(xe,"SequenceExpression")}return K},Dn.parseMaybeAssign=function(_,T,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,xe=-1;T?(K=T.parenthesizedAssign,xe=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new de,R=!0);var qe=this.start,pt=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var vt=this.parseMaybeConditional(_,T);if(F&&(vt=F.call(this,vt,qe,pt)),this.type.isAssign){var cr=this.startNodeAt(qe,pt);return cr.operator=this.value,cr.left=this.type===q.eq?this.toAssignable(vt,!1,T):vt,R||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=cr.left.start&&(T.shorthandAssign=-1),this.checkLVal(vt),this.next(),cr.right=this.parseMaybeAssign(_),this.finishNode(cr,"AssignmentExpression")}else R&&this.checkExpressionErrors(T,!0);return K>-1&&(T.parenthesizedAssign=K),xe>-1&&(T.trailingComma=xe),vt},Dn.parseMaybeConditional=function(_,T){var F=this.start,R=this.startLoc,K=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return K;if(this.eat(q.question)){var xe=this.startNodeAt(F,R);return xe.test=K,xe.consequent=this.parseMaybeAssign(),this.expect(q.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return K},Dn.parseExprOps=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||K.start===F&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,F,R,-1,_)},Dn.parseExprOp=function(_,T,F,R,K){var xe=this.type.binop;if(xe!=null&&(!K||this.type!==q._in)&&xe>R){var qe=this.type===q.logicalOR||this.type===q.logicalAND,pt=this.type===q.coalesce;pt&&(xe=q.logicalAND.binop);var vt=this.value;this.next();var cr=this.start,_r=this.startLoc,Pn=this.parseExprOp(this.parseMaybeUnary(null,!1),cr,_r,xe,K),ci=this.buildBinary(T,F,_,Pn,vt,qe||pt);return(qe&&this.type===q.coalesce||pt&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ci,T,F,R,K)}return _},Dn.buildBinary=function(_,T,F,R,K,xe){var qe=this.startNodeAt(_,T);return qe.left=F,qe.operator=K,qe.right=R,this.finishNode(qe,xe?"LogicalExpression":"BinaryExpression")},Dn.parseMaybeUnary=function(_,T){var F=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),T=!0;else if(this.type.prefix){var xe=this.startNode(),qe=this.type===q.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),qe?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):T=!0,K=this.finishNode(xe,qe?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var pt=this.startNodeAt(F,R);pt.operator=this.value,pt.prefix=!1,pt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(pt,"UpdateExpression")}}return!T&&this.eat(q.starstar)?this.buildBinary(F,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},Dn.parseExprSubscripts=function(_){var T=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,T,F);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Dn.parseSubscripts=function(_,T,F,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var qe=this.parseSubscript(_,T,F,R,K,xe);if(qe.optional&&(xe=!0),qe===_||qe.type==="ArrowFunctionExpression"){if(xe){var pt=this.startNodeAt(T,F);pt.expression=qe,qe=this.finishNode(pt,"ChainExpression")}return qe}_=qe}},Dn.parseSubscript=function(_,T,F,R,K,xe){var qe=this.options.ecmaVersion>=11,pt=qe&&this.eat(q.questionDot);R&&pt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var vt=this.eat(q.bracketL);if(vt||pt&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var cr=this.startNodeAt(T,F);cr.object=_,cr.property=vt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),cr.computed=!!vt,vt&&this.expect(q.bracketR),qe&&(cr.optional=pt),_=this.finishNode(cr,"MemberExpression")}else if(!R&&this.eat(q.parenL)){var _r=new de,Pn=this.yieldPos,ci=this.awaitPos,Jn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Hi=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,_r);if(K&&!pt&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(_r,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Pn,this.awaitPos=ci,this.awaitIdentPos=Jn,this.parseArrowExpression(this.startNodeAt(T,F),Hi,!0);this.checkExpressionErrors(_r,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ci||this.awaitPos,this.awaitIdentPos=Jn||this.awaitIdentPos;var sa=this.startNodeAt(T,F);sa.callee=_,sa.arguments=Hi,qe&&(sa.optional=pt),_=this.finishNode(sa,"CallExpression")}else if(this.type===q.backQuote){(pt||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ca=this.startNodeAt(T,F);Ca.tag=_,Ca.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ca,"TaggedTemplateExpression")}return _},Dn.parseExprAtom=function(_){this.type===q.slash&&this.readRegexp();var T,F=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(T,"Super");case q._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case q.name:var R=this.start,K=this.startLoc,xe=this.containsEsc,qe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&qe.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[qe],!1);if(this.options.ecmaVersion>=8&&qe.name==="async"&&this.type===q.name&&!xe)return qe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[qe],!0)}return qe;case q.regexp:var pt=this.value;return T=this.parseLiteral(pt.value),T.regex={pattern:pt.pattern,flags:pt.flags},T;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return T=this.startNode(),T.value=this.type===q._null?null:this.type===q._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case q.parenL:var vt=this.start,cr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(cr)&&(_.parenthesizedAssign=vt),_.parenthesizedBind<0&&(_.parenthesizedBind=vt)),cr;case q.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(q.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case q.braceL:return this.parseObj(!1,_);case q._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Dn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(_);case q.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},Dn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var T=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},Dn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Dn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Dn.parseParenExpression=function(){this.expect(q.parenL);var _=this.parseExpression();return this.expect(q.parenR),_},Dn.parseParenAndDistinguishExpression=function(_){var T=this.start,F=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,qe=this.startLoc,pt=[],vt=!0,cr=!1,_r=new de,Pn=this.yieldPos,ci=this.awaitPos,Jn;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(vt?vt=!1:this.expect(q.comma),K&&this.afterTrailingComma(q.parenR,!0)){cr=!0;break}else if(this.type===q.ellipsis){Jn=this.start,pt.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else pt.push(this.parseMaybeAssign(!1,_r,this.parseParenItem));var Hi=this.start,sa=this.startLoc;if(this.expect(q.parenR),_&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(_r,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Pn,this.awaitPos=ci,this.parseParenArrowList(T,F,pt);(!pt.length||cr)&&this.unexpected(this.lastTokStart),Jn&&this.unexpected(Jn),this.checkExpressionErrors(_r,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ci||this.awaitPos,pt.length>1?(R=this.startNodeAt(xe,qe),R.expressions=pt,this.finishNodeAt(R,"SequenceExpression",Hi,sa)):R=pt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ca=this.startNodeAt(T,F);return Ca.expression=R,this.finishNode(Ca,"ParenthesizedExpression")}else return R},Dn.parseParenItem=function(_){return _},Dn.parseParenArrowList=function(_,T,F){return this.parseArrowExpression(this.startNodeAt(_,T),F)};var li=[];Dn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){_.meta=T;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,xe=this.type===q._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(q.parenL)?_.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):_.arguments=li,this.finishNode(_,"NewExpression")},Dn.parseTemplateElement=function(_){var T=_.isTagged,F=this.startNode();return this.type===q.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===q.backQuote,this.finishNode(F,"TemplateElement")},Dn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:T});for(F.quasis=[R];!R.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(q.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(F,"TemplateLiteral")},Dn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!Jt.test(this.input.slice(this.lastTokEnd,this.start))},Dn.parseObj=function(_,T){var F=this.startNode(),R=!0,K={};for(F.properties=[],this.next();!this.eat(q.braceR);){if(R)R=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var xe=this.parseProperty(_,T);_||this.checkPropClash(xe,K,T),F.properties.push(xe)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Dn.parseProperty=function(_,T){var F=this.startNode(),R,K,xe,qe;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===q.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,T),this.type===q.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||T)&&(xe=this.start,qe=this.startLoc),_||(R=this.eat(q.star)));var pt=this.containsEsc;return this.parsePropertyName(F),!_&&!pt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(F,T)):K=!1,this.parsePropertyValue(F,_,R,K,xe,qe,T,pt),this.finishNode(F,"Property")},Dn.parsePropertyValue=function(_,T,F,R,K,xe,qe,pt){if((F||R)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,qe),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!T&&!pt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var vt=_.kind==="get"?0:1;if(_.value.params.length!==vt){var cr=_.value.start;_.kind==="get"?this.raiseRecoverable(cr,"getter should have no params"):this.raiseRecoverable(cr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",T?_.value=this.parseMaybeDefault(K,xe,_.key):this.type===q.eq&&qe?(qe.shorthandAssign<0&&(qe.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Dn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(q.bracketR),_.key;_.computed=!1}return _.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Dn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Dn.parseMethod=function(_,T,F){var R=this.startNode(),K=this.yieldPos,xe=this.awaitPos,qe=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ii(T,R.generator)|ui|(F?Ji:0)),this.expect(q.parenL),R.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=qe,this.finishNode(R,"FunctionExpression")},Dn.parseArrowExpression=function(_,T,F){var R=this.yieldPos,K=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(Ii(F,!1)|pi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},Dn.parseFunctionBody=function(_,T,F){var R=T&&this.type!==q.braceL,K=this.strict,xe=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var qe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||qe)&&(xe=this.strictDirective(this.end),xe&&qe&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var pt=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!K&&!xe&&!T&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,wn),_.body=this.parseBlock(!1,void 0,xe&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=pt}this.exitScope()},Dn.isSimpleParamList=function(_){for(var T=0,F=_;T<F.length;T+=1){var R=F[T];if(R.type!=="Identifier")return!1}return!0},Dn.checkParams=function(_,T){for(var F={},R=0,K=_.params;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,zi,T?null:F)}},Dn.parseExprList=function(_,T,F,R){for(var K=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(q.comma),T&&this.afterTrailingComma(_))break;var qe=void 0;F&&this.type===q.comma?qe=null:this.type===q.ellipsis?(qe=this.parseSpread(R),R&&this.type===q.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):qe=this.parseMaybeAssign(!1,R),K.push(qe)}return K},Dn.checkUnreserved=function(_){var T=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(T,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,F).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+R+"' is reserved"))}},Dn.parseIdent=function(_,T){var F=this.startNode();return this.type===q.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Dn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(q.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},Dn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Hn=_i.prototype;Hn.raise=function(_,T){var F=gt(this.input,_);T+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(T);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},Hn.raiseRecoverable=Hn.raise,Hn.curPosition=function(){if(this.options.locations)return new Fe(this.curLine,this.pos-this.lineStart)};var an=_i.prototype,Ai=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(_){this.scopeStack.push(new Ai(_))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(_){return _.flags&pn||!this.inModule&&_.flags&Kn},an.declareName=function(_,T,F){var R=!1;if(T===na){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Kn&&delete this.undefinedExports[_]}else if(T===ya){var xe=this.currentScope();xe.lexical.push(_)}else if(T===Si){var qe=this.currentScope();this.treatFunctionsAsVar?R=qe.lexical.indexOf(_)>-1:R=qe.lexical.indexOf(_)>-1||qe.var.indexOf(_)>-1,qe.functions.push(_)}else for(var pt=this.scopeStack.length-1;pt>=0;--pt){var vt=this.scopeStack[pt];if(vt.lexical.indexOf(_)>-1&&!(vt.flags&$n&&vt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(vt)&&vt.functions.indexOf(_)>-1){R=!0;break}if(vt.var.push(_),this.inModule&&vt.flags&Kn&&delete this.undefinedExports[_],vt.flags&Wi)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},an.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Wi)return T}},an.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Wi&&!(T.flags&pi))return T}};var wi=function(T,F,R){this.type="",this.start=F,this.end=0,T.options.locations&&(this.loc=new Mt(T,R)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[F,0])},Wa=_i.prototype;Wa.startNode=function(){return new wi(this,this.start,this.startLoc)},Wa.startNodeAt=function(_,T){return new wi(this,_,T)};function ls(_,T,F,R){return _.type=T,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}Wa.finishNode=function(_,T){return ls.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},Wa.finishNodeAt=function(_,T,F,R){return ls.call(this,_,T,F,R)};var fa=function(T,F,R,K,xe){this.token=T,this.isExpr=!!F,this.preserveSpace=!!R,this.override=K,this.generator=!!xe},wa={b_stat:new fa("{",!1),b_expr:new fa("{",!0),b_tmpl:new fa("${",!1),p_stat:new fa("(",!1),p_expr:new fa("(",!0),q_tmpl:new fa("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new fa("function",!1),f_expr:new fa("function",!0),f_expr_gen:new fa("function",!0,!1,null,!0),f_gen:new fa("function",!1,!1,null,!0)},ba=_i.prototype;ba.initialContext=function(){return[wa.b_stat]},ba.braceIsBlock=function(_){var T=this.curContext();return T===wa.f_expr||T===wa.f_stat?!0:_===q.colon&&(T===wa.b_stat||T===wa.b_expr)?!T.isExpr:_===q._return||_===q.name&&this.exprAllowed?Jt.test(this.input.slice(this.lastTokEnd,this.start)):_===q._else||_===q.semi||_===q.eof||_===q.parenR||_===q.arrow?!0:_===q.braceL?T===wa.b_stat:_===q._var||_===q._const||_===q.name?!1:!this.exprAllowed},ba.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},ba.updateContext=function(_){var T,F=this.type;F.keyword&&_===q.dot?this.exprAllowed=!1:(T=F.updateContext)?T.call(this,_):this.exprAllowed=F.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===wa.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},q.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?wa.b_stat:wa.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(wa.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(_){var T=_===q._if||_===q._for||_===q._with||_===q._while;this.context.push(T?wa.p_stat:wa.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(_){_.beforeExpr&&_!==q.semi&&_!==q._else&&!(_===q._return&&Jt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===q.colon||_===q.braceL)&&this.curContext()===wa.b_stat)?this.context.push(wa.f_expr):this.context.push(wa.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===wa.q_tmpl?this.context.pop():this.context.push(wa.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(_){if(_===q._function){var T=this.context.length-1;this.context[T]===wa.f_expr?this.context[T]=wa.f_expr_gen:this.context[T]=wa.f_gen}this.exprAllowed=!0},q.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=G+" Extended_Pictographic",ne=$,ge={9:G,10:$,11:ne},Ie="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",He="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",at=He+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",fe=at+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Be={9:He,10:at,11:fe},yt={};function vr(_){var T=yt[_]={binary:Ke(ge[_]+" "+Ie),nonBinary:{General_Category:Ke(Ie),Script:Ke(Be[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}vr(9),vr(10),vr(11);var Bt=_i.prototype,zt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};zt.prototype.reset=function(T,F,R){var K=R.indexOf("u")!==-1;this.start=T|0,this.source=F+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},zt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},zt.prototype.at=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return-1;var xe=R.charCodeAt(T);if(!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K)return xe;var qe=R.charCodeAt(T+1);return qe>=56320&&qe<=57343?(xe<<10)+qe-56613888:xe},zt.prototype.nextIndex=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return K;var xe=R.charCodeAt(T),qe;return!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K||(qe=R.charCodeAt(T+1))<56320||qe>57343?T+1:T+2},zt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},zt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},zt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},zt.prototype.eat=function(T,F){return F===void 0&&(F=!1),this.current(F)===T?(this.advance(F),!0):!1};function gr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Bt.validateRegExpFlags=function(_){for(var T=_.validFlags,F=_.flags,R=0;R<F.length;R++){var K=F.charAt(R);T.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Bt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Bt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,F=_.backReferenceNames;T<F.length;T+=1){var R=F[T];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Bt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Bt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Bt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Bt.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=T,!1},Bt.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Bt.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Bt.regexp_eatBracedQuantifier=function(_,T){var F=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Bt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Bt.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Bt.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Bt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Bt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Bt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Bt.regexp_eatSyntaxCharacter=function(_){var T=_.current();return bn(T)?(_.lastIntValue=T,_.advance(),!0):!1};function bn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Bt.regexp_eatPatternCharacters=function(_){for(var T=_.pos,F=0;(F=_.current())!==-1&&!bn(F);)_.advance();return _.pos!==T},Bt.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Bt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Bt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Bt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=gr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=gr(_.lastIntValue);return!0}return!1},Bt.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),ln(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function ln(_){return Gt(_,!0)||_===36||_===95}Bt.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Rt(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function Rt(_){return sr(_,!0)||_===36||_===95||_===8204||_===8205}Bt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Bt.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=T}return!1},Bt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Bt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Bt.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Bt.regexp_eatZero=function(_){return _.current()===48&&!Ci(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Bt.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Bt.regexp_eatControlLetter=function(_){var T=_.current();return un(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function un(_){return _>=65&&_<=90||_>=97&&_<=122}Bt.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var F=_.pos,R=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var qe=_.lastIntValue;if(qe>=56320&&qe<=57343)return _.lastIntValue=(K-55296)*1024+(qe-56320)+65536,!0}_.pos=xe,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&jr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function jr(_){return _>=0&&_<=1114111}Bt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Bt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Bt.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Hr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Bt.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Bt.regexp_validateUnicodePropertyNameAndValue=function(_,T,F){en(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(F)||_.raise("Invalid property value")},Bt.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Bt.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";ai(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function ai(_){return un(_)||_===95}Bt.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";rn(T=_.current());)_.lastStringValue+=gr(T),_.advance();return _.lastStringValue!==""};function rn(_){return ai(_)||Ci(_)}Bt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Bt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Bt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(T===-1||F===-1)&&_.raise("Invalid character class"),T!==-1&&F!==-1&&T>F&&_.raise("Range out of order in character class")}}},Bt.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Ti(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Bt.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Bt.regexp_eatClassControlLetter=function(_){var T=_.current();return Ci(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Bt.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Bt.regexp_eatDecimalDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Ci(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==T};function Ci(_){return _>=48&&_<=57}Bt.regexp_eatHexDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;$i(F=_.current());)_.lastIntValue=16*_.lastIntValue+yi(F),_.advance();return _.pos!==T};function $i(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function yi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Bt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+F*8+_.lastIntValue:_.lastIntValue=T*8+F}else _.lastIntValue=T;return!0}return!1},Bt.regexp_eatOctalDigit=function(_){var T=_.current();return Ti(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ti(_){return _>=48&&_<=55}Bt.regexp_eatFixedHexDigits=function(_,T){var F=_.pos;_.lastIntValue=0;for(var R=0;R<T;++R){var K=_.current();if(!$i(K))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+yi(K),_.advance()}return!0};var xi=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new Mt(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},ei=_i.prototype;ei.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ei.getToken=function(){return this.next(),new xi(this)},typeof Symbol!="undefined"&&(ei[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===q.eof,value:T}}}}),ei.curContext=function(){return this.context[this.context.length-1]},ei.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ei.readToken=function(_){return Gt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ei.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},ei.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){_t.lastIndex=T;for(var R;(R=_t.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,F),T,this.pos,_,this.curPosition())},ei.skipLineComment=function(_){for(var T=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!rt(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,F,this.curPosition())},ei.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&At.test(String.fromCharCode(_)))++this.pos;else break e}}},ei.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=T,this.updateContext(F)},ei.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},ei.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},ei.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),F=1,R=_===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++F,R=q.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(q.assign,F+1):this.finishOp(R,F)},ei.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(q.assign,3)}return this.finishOp(_===124?q.logicalOR:q.logicalAND,2)}return T===61?this.finishOp(q.assign,2):this.finishOp(_===124?q.bitwiseOR:q.bitwiseAND,1)},ei.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},ei.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Jt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):T===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},ei.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),F=1;return T===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(q.assign,F+1):this.finishOp(q.bitShift,F)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(F=2),this.finishOp(q.relational,F))},ei.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(_===61?q.eq:q.prefix,1)},ei.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(q.questionDot,2)}if(T===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},ei.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+ea(_)+"'")},ei.finishOp=function(_,T){var F=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,F)},ei.readRegexp=function(){for(var _,T,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Jt.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")T=!0;else if(R==="]"&&T)T=!1;else if(R==="/"&&!T)break;_=R==="\\"}++this.pos}var K=this.input.slice(F,this.pos);++this.pos;var xe=this.pos,qe=this.readWord1();this.containsEsc&&this.unexpected(xe);var pt=this.regexpState||(this.regexpState=new zt(this));pt.reset(F,K,qe),this.validateRegExpFlags(pt),this.validateRegExpPattern(pt);var vt=null;try{vt=new RegExp(K,qe)}catch(cr){}return this.finishToken(q.regexp,{pattern:K,flags:qe,value:vt})},ei.readInt=function(_,T,F){for(var R=this.options.ecmaVersion>=12&&T===void 0,K=F&&this.input.charCodeAt(this.pos)===48,xe=this.pos,qe=0,pt=0,vt=0,cr=T==null?Infinity:T;vt<cr;++vt,++this.pos){var _r=this.input.charCodeAt(this.pos),Pn=void 0;if(R&&_r===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),pt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),vt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),pt=_r;continue}if(_r>=97?Pn=_r-97+10:_r>=65?Pn=_r-65+10:_r>=48&&_r<=57?Pn=_r-48:Pn=Infinity,Pn>=_)break;pt=_r,qe=qe*_+Pn}return R&&pt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||T!=null&&this.pos-xe!==T?null:qe};function Gi(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ta(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ei.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Ta(this.input.slice(T,this.pos)),++this.pos):Gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,F)},ei.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var F=this.pos-T>=2&&this.input.charCodeAt(T)===48;F&&this.strict&&this.raise(T,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Ta(this.input.slice(T,this.pos));return++this.pos,Gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,K)}F&&/[89]/.test(this.input.slice(T,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=Gi(this.input.slice(T,this.pos),F);return this.finishToken(q.num,xe)},ei.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else T=this.readHexChar(4);return T};function ea(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ei.readString=function(_){for(var T="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(T+=this.input.slice(F,this.pos),T+=this.readEscapedChar(!1),F=this.pos):(rt(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(F,this.pos++),this.finishToken(q.string,T)};var Mi={};ei.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Mi)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ei.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Mi;this.raise(_,T)},ei.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(q.template,_));if(F===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(rt(F)){switch(_+=this.input.slice(T,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},ei.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ei.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ea(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,T=this.input.charCodeAt(this.pos),(R!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return rt(T)?"":String.fromCharCode(T)}},ei.readHexChar=function(_){var T=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(T,"Bad character escape sequence"),F},ei.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(sr(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var qe=this.readCodePoint();(T?Gt:sr)(qe,R)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=ea(qe),F=this.pos}else break;T=!1}return _+this.input.slice(F,this.pos)},ei.readWord=function(){var _=this.readWord1(),T=q.name;return this.keywords.test(_)&&(T=mt[_]),this.finishToken(T,_)};var Ui="7.4.1";_i.acorn={Parser:_i,version:Ui,defaultOptions:Zt,Position:Fe,SourceLocation:Mt,getLineInfo:gt,Node:wi,TokenType:Pt,tokTypes:q,keywordTypes:mt,TokContext:fa,tokContexts:wa,isIdentifierChar:sr,isIdentifierStart:Gt,Token:xi,isNewLine:rt,lineBreak:Jt,lineBreakG:_t,nonASCIIwhitespace:At};function Oa(_,T){return _i.parse(_,T)}function au(_,T,F){return _i.parseExpressionAt(_,T,F)}function Ea(_,T){return _i.tokenizer(_,T)}function Sa(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function _s(_){var T=typeof Map=="function"?new Map:void 0;return _s=function(R){if(R===null||!Yu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(R))return T.get(R);T.set(R,K)}function K(){return Qi(R,arguments,Ra(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),co(K,R)},_s(_)}function cs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Qi(_,T,F){return cs()?Qi=Reflect.construct:Qi=function(K,xe,qe){var pt=[null];pt.push.apply(pt,xe);var vt=Function.bind.apply(K,pt),cr=new vt;return qe&&co(cr,qe.prototype),cr},Qi.apply(null,arguments)}function Yu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function co(_,T){return co=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},co(_,T)}function Ra(_){return Ra=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Ra(_)}var $a=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(_s(Error)),Yi=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(_s(SyntaxError)),Ho=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(_s(ReferenceError)),Wo=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(_s(TypeError)),qu=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}($a),po=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(Yi),Xo=function(_){Sa(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ho),ha={UnknownError:[3001,"%0",qu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",qu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Xo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Xo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Xo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Xo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Xo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Xo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Xo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Xo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Xo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Xo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ho],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ho],IsNotConstructor:[2003,"%0 is not a constructor",Wo]};function fo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Yo(_,T,F){return fo()?Yo=Reflect.construct:Yo=function(K,xe,qe){var pt=[null];pt.push.apply(pt,xe);var vt=Function.bind.apply(K,pt),cr=new vt;return qe&&Qa(cr,qe.prototype),cr},Yo.apply(null,arguments)}function Qa(_,T){return Qa=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},Qa(_,T)}var ou="0.0.3";function Ic(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var ks=Object.prototype.hasOwnProperty,Q=Symbol("Break"),be=Symbol("Continue"),et=Symbol("DefaultCase"),Dt=Symbol("EmptyStatementReturn"),Dr=Symbol("WithScopeName"),ut=Symbol("SuperScopeName"),St=Symbol("RootScopeName"),Ja=Symbol("GlobalScopeName");function qi(_){return typeof _=="function"}var Za=function(){function _(F){this.interpreter=F}var T=_.prototype;return T.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function qe(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:xe.bind(R),getCurrentContext:qe.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function qo(_,T,F){if(F===void 0&&(F=!0),!(_ instanceof Za))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var R=_.generator(),K=R.getOptions(),xe={timeout:K.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},qe=F?R.getGlobalScope():R.getCurrentScope(),pt=new ho(qe,xe);return pt.evaluate(T)}}Object.defineProperty(qo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Yr(_){if(!(_ instanceof Za))throw new Error("Illegal call");for(var T=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),K=1;K<F;K++)R[K-1]=arguments[K];var xe=R.pop(),qe=new ho(T.getGlobalScope(),T.getOptions()),pt=`
		    (function anonymous(`+R.join(",")+`){
		        `+xe+`
		    });
		    `;return qe.evaluate(pt)}Object.defineProperty(Yr,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Vr=function(T){this.value=T},It=function(T){this.value=T},ko=function(T){this.value=T},oe=function(T,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=T,this.labelStack=[]};function Ys(){}function su(_,T){return _===void 0&&(_=null),new oe(Object.create(null),_,T)}function fs(_){return Object.create(_)}var ta={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:qo,Function:Yr};typeof JSON!="undefined"&&(ta.JSON=JSON),typeof Promise!="undefined"&&(ta.Promise=Promise),typeof Set!="undefined"&&(ta.Set=Set),typeof Map!="undefined"&&(ta.Map=Map),typeof Symbol!="undefined"&&(ta.Symbol=Symbol),typeof Proxy!="undefined"&&(ta.Proxy=Proxy),typeof WeakMap!="undefined"&&(ta.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ta.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ta.Reflect=Reflect);var ho=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(R){var K;if(R instanceof oe)K=R;else{var xe=null,qe=this.createSuperScope(R);this.options.rootContext&&(xe=new oe(fs(this.options.rootContext),qe,St)),K=new oe(R,xe||qe,Ja)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var pt=this.options._initEnv;pt&&pt.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(R){return R instanceof qu||R instanceof Xo||R instanceof po},T.createSuperScope=function(R){var K=Object.assign({},ta),xe=Object.keys(K);return xe.forEach(function(qe){qe in R&&delete K[qe]}),new oe(K,null,ut)},T.setCurrentContext=function(R){this.currentContext=R},T.setCurrentScope=function(R){this.currentScope=R},T.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=Oa(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},T.appendCode=function(R){return this.evaluate(R)},T.evaluateNode=function(R,K){var xe=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var qe=this.getCurrentScope(),pt=this.getCurrentContext(),vt=qe.labelStack.concat([]),cr=this.callStack.concat([]),_r=function(){xe.setCurrentScope(qe),xe.setCurrentContext(pt),qe.labelStack=vt,xe.callStack=cr};try{var Pn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Pn()}catch(ci){throw ci}finally{_r(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(R,K,xe){var qe=R[1].replace("%0",String(K));return xe!==null&&(qe+=this.getNodePosition(xe||this.lastExecNode)),qe},T.createError=function(R,K){return new K(R)},T.createThrowError=function(R,K){return this.createError(R,K)},T.createInternalThrowError=function(R,K,xe){return this.createError(this.createErrorMessage(R,K,xe),R[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},T.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},T.createClosure=function(R){var K=this,xe;switch(R.type){case"BinaryExpression":xe=this.binaryExpressionHandler(R);break;case"LogicalExpression":xe=this.logicalExpressionHandler(R);break;case"UnaryExpression":xe=this.unaryExpressionHandler(R);break;case"UpdateExpression":xe=this.updateExpressionHandler(R);break;case"ObjectExpression":xe=this.objectExpressionHandler(R);break;case"ArrayExpression":xe=this.arrayExpressionHandler(R);break;case"CallExpression":xe=this.callExpressionHandler(R);break;case"NewExpression":xe=this.newExpressionHandler(R);break;case"MemberExpression":xe=this.memberExpressionHandler(R);break;case"ThisExpression":xe=this.thisExpressionHandler(R);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(R);break;case"Literal":xe=this.literalHandler(R);break;case"Identifier":xe=this.identifierHandler(R);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(R);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":xe=this.programHandler(R);break;case"ExpressionStatement":xe=this.expressionStatementHandler(R);break;case"EmptyStatement":xe=this.emptyStatementHandler(R);break;case"ReturnStatement":xe=this.returnStatementHandler(R);break;case"FunctionExpression":xe=this.functionExpressionHandler(R);break;case"IfStatement":xe=this.ifStatementHandler(R);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(R);break;case"ForStatement":xe=this.forStatementHandler(R);break;case"WhileStatement":xe=this.whileStatementHandler(R);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(R);break;case"ForInStatement":xe=this.forInStatementHandler(R);break;case"WithStatement":xe=this.withStatementHandler(R);break;case"ThrowStatement":xe=this.throwStatementHandler(R);break;case"TryStatement":xe=this.tryStatementHandler(R);break;case"ContinueStatement":xe=this.continueStatementHandler(R);break;case"BreakStatement":xe=this.breakStatementHandler(R);break;case"SwitchStatement":xe=this.switchStatementHandler(R);break;case"LabeledStatement":xe=this.labeledStatementHandler(R);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ha.NodeTypeSyntaxError,R.type,R)}return function(){var qe=K.options.timeout;if(qe&&qe>0&&K.checkTimeout())throw K.createInternalThrowError(ha.ExecutionTimeOutError,qe,null);return K.lastExecNode=R,xe.apply(void 0,arguments)}},T.binaryExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),qe=this.createClosure(R.right);return function(){var pt=xe(),vt=qe();switch(R.operator){case"==":return pt==vt;case"!=":return pt!=vt;case"===":return pt===vt;case"!==":return pt!==vt;case"<":return pt<vt;case"<=":return pt<=vt;case">":return pt>vt;case">=":return pt>=vt;case"<<":return pt<<vt;case">>":return pt>>vt;case">>>":return pt>>>vt;case"+":return pt+vt;case"-":return pt-vt;case"*":return pt*vt;case"**":return Math.pow(pt,vt);case"/":return pt/vt;case"%":return pt%vt;case"|":return pt|vt;case"^":return pt^vt;case"&":return pt&vt;case"in":return pt in vt;case"instanceof":return pt instanceof vt;default:throw K.createInternalThrowError(ha.BinaryOperatorSyntaxError,R.operator,R)}}},T.logicalExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),qe=this.createClosure(R.right);return function(){switch(R.operator){case"||":return xe()||qe();case"&&":return xe()&&qe();default:throw K.createInternalThrowError(ha.LogicalOperatorSyntaxError,R.operator,R)}}},T.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var xe=this.createObjectGetter(R.argument),qe=this.createNameGetter(R.argument);return function(){var _r=xe(),Pn=qe();return delete _r[Pn]};default:var pt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var vt=this.createObjectGetter(R.argument),cr=this.createNameGetter(R.argument);pt=function(){return vt()[cr()]}}else pt=this.createClosure(R.argument);return function(){var _r=pt();switch(R.operator){case"-":return-_r;case"+":return+_r;case"!":return!_r;case"~":return~_r;case"void":return;case"typeof":return typeof _r;default:throw K.createInternalThrowError(ha.UnaryOperatorSyntaxError,R.operator,R)}}}},T.updateExpressionHandler=function(R){var K=this,xe=this.createObjectGetter(R.argument),qe=this.createNameGetter(R.argument);return function(){var pt=xe(),vt=qe();switch(K.assertVariable(pt,vt,R),R.operator){case"++":return R.prefix?++pt[vt]:pt[vt]++;case"--":return R.prefix?--pt[vt]:pt[vt]--;default:throw K.createInternalThrowError(ha.UpdateOperatorSyntaxError,R.operator,R)}}},T.objectExpressionHandler=function(R){var K=this,xe=[];function qe(vt){return vt.type==="Identifier"?vt.name:vt.type==="Literal"?vt.value:this.throwError(ha.ObjectStructureSyntaxError,vt.type,vt)}var pt=Object.create(null);return R.properties.forEach(function(vt){var cr=vt.kind,_r=qe(vt.key);(!pt[_r]||cr==="init")&&(pt[_r]={}),pt[_r][cr]=K.createClosure(vt.value),xe.push({key:_r,property:vt})}),function(){for(var vt={},cr=xe.length,_r=0;_r<cr;_r++){var Pn=xe[_r],ci=Pn.key,Jn=pt[ci],Hi=Jn.init?Jn.init():void 0,sa=Jn.get?Jn.get():function(){},Ca=Jn.set?Jn.set():function(gl){};if("set"in Jn||"get"in Jn){var Zi={configurable:!0,enumerable:!0,get:sa,set:Ca};Object.defineProperty(vt,ci,Zi)}else{var Co=Pn.property,xs=Co.kind;Co.key.type==="Identifier"&&Co.value.type==="FunctionExpression"&&xs==="init"&&!Co.value.id&&Ic(Hi,Co.key.name),vt[ci]=Hi}}return vt}},T.arrayExpressionHandler=function(R){var K=this,xe=R.elements.map(function(qe){return qe&&K.createClosure(qe)});return function(){for(var qe=xe.length,pt=Array(qe),vt=0;vt<qe;vt++){var cr=xe[vt];cr&&(pt[vt]=cr())}return pt}},T.safeObjectGet=function(R,K,xe){return R[K]},T.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var xe=this.createClosure(R.object),qe=this.createMemberKeyGetter(R),pt=this.source;return function(){var cr=xe(),_r=qe(),Pn=K.safeObjectGet(cr,_r,R);if(!Pn||!qi(Pn)){var ci=pt.slice(R.start,R.end);throw K.createInternalThrowError(ha.FunctionUndefinedReferenceError,ci,R)}return Pn.__IS_EVAL_FUNC?function(Jn){return Pn(new Za(K),Jn,!0)}:Pn.__IS_FUNCTION_FUNC?function(){for(var Jn=arguments.length,Hi=new Array(Jn),sa=0;sa<Jn;sa++)Hi[sa]=arguments[sa];return Pn.apply(void 0,[new Za(K)].concat(Hi))}:Pn.bind(cr)};default:var vt=this.createClosure(R);return function(){var cr="";R.type==="Identifier"&&(cr=R.name);var _r=vt();if(!_r||!qi(_r))throw K.createInternalThrowError(ha.FunctionUndefinedReferenceError,cr,R);if(R.type==="Identifier"&&_r.__IS_EVAL_FUNC&&cr==="eval")return function(Jn){var Hi=K.getScopeFromName(cr,K.getCurrentScope()),sa=Hi.name===ut||Hi.name===Ja||Hi.name===St;return _r(new Za(K),Jn,!sa)};if(_r.__IS_EVAL_FUNC)return function(Jn){return _r(new Za(K),Jn,!0)};if(_r.__IS_FUNCTION_FUNC)return function(){for(var Jn=arguments.length,Hi=new Array(Jn),sa=0;sa<Jn;sa++)Hi[sa]=arguments[sa];return _r.apply(void 0,[new Za(K)].concat(Hi))};var Pn=K.options.globalContextInFunction;if(R.type==="Identifier"){var ci=K.getIdentifierScope(R);ci.name===Dr&&(Pn=ci.data)}return _r.bind(Pn)}}},T.callExpressionHandler=function(R){var K=this,xe=this.createCallFunctionGetter(R.callee),qe=R.arguments.map(function(pt){return K.createClosure(pt)});return function(){return xe().apply(void 0,qe.map(function(pt){return pt()}))}},T.functionExpressionHandler=function(R){var K=this,xe=this,qe=this.source,pt=this.collectDeclVars,vt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var cr=R.id?R.id.name:"",_r=R.params.length,Pn=R.params.map(function(sa){return K.createParamNameGetter(sa)}),ci=this.createClosure(R.body),Jn=this.collectDeclVars,Hi=this.collectDeclFuncs;return this.collectDeclVars=pt,this.collectDeclFuncs=vt,function(){var sa=xe.getCurrentScope(),Ca=function Zi(){for(var Co=arguments.length,xs=new Array(Co),gl=0;gl<Co;gl++)xs[gl]=arguments[gl];xe.callStack.push(""+cr);var af=xe.getCurrentScope(),Ju=su(sa,"FunctionScope("+cr+")");xe.setCurrentScope(Ju),xe.addDeclarationsToScope(Jn,Hi,Ju),cr&&(Ju.data[cr]=Zi),Ju.data.arguments=arguments,Pn.forEach(function(yu,vo){Ju.data[yu()]=xs[vo]});var Lc=xe.getCurrentContext();xe.setCurrentContext(this);var Ou=ci();if(xe.setCurrentContext(Lc),xe.setCurrentScope(af),xe.callStack.pop(),Ou instanceof Vr)return Ou.value};return Ic(Ca,cr),Object.defineProperty(Ca,"length",{value:_r,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ca,"toString",{value:function(){return qe.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ca,"valueOf",{value:function(){return qe.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ca}},T.newExpressionHandler=function(R){var K=this,xe=this.source,qe=this.createClosure(R.callee),pt=R.arguments.map(function(vt){return K.createClosure(vt)});return function(){var vt=qe();if(!qi(vt)||vt.__IS_EVAL_FUNC){var cr=R.callee,_r=xe.slice(cr.start,cr.end);throw K.createInternalThrowError(ha.IsNotConstructor,_r,R)}return vt.__IS_FUNCTION_FUNC?vt.apply(void 0,[new Za(K)].concat(pt.map(function(Pn){return Pn()}))):Yo(vt,pt.map(function(Pn){return Pn()}))}},T.memberExpressionHandler=function(R){var K=this.createClosure(R.object),xe=this.createMemberKeyGetter(R);return function(){var qe=K(),pt=xe();return qe[pt]}},T.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},T.sequenceExpressionHandler=function(R){var K=this,xe=R.expressions.map(function(qe){return K.createClosure(qe)});return function(){for(var qe,pt=xe.length,vt=0;vt<pt;vt++){var cr=xe[vt];qe=cr()}return qe}},T.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},T.identifierHandler=function(R){var K=this;return function(){var xe=K.getCurrentScope(),qe=K.getScopeDataFromName(R.name,xe);return K.assertVariable(qe,R.name,R),qe[R.name]}},T.getIdentifierScope=function(R){var K=this.getCurrentScope(),xe=this.getScopeFromName(R.name,K);return xe},T.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var xe=this.createObjectGetter(R.left),qe=this.createNameGetter(R.left),pt=this.createClosure(R.right);return function(){var vt=xe(),cr=qe(),_r=pt();switch(R.operator!=="="&&K.assertVariable(vt,cr,R),R.operator){case"=":return vt[cr]=_r;case"+=":return vt[cr]+=_r;case"-=":return vt[cr]-=_r;case"*=":return vt[cr]*=_r;case"**=":return vt[cr]=Math.pow(vt[cr],_r);case"/=":return vt[cr]/=_r;case"%=":return vt[cr]%=_r;case"<<=":return vt[cr]<<=_r;case">>=":return vt[cr]>>=_r;case">>>=":return vt[cr]>>>=_r;case"&=":return vt[cr]&=_r;case"^=":return vt[cr]^=_r;case"|=":return vt[cr]|=_r;default:throw K.createInternalThrowError(ha.AssignmentExpressionSyntaxError,R.type,R)}}},T.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return Dt}},T.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ha.VariableTypeSyntaxError,R.type,R)},T.variableDeclarationHandler=function(R){for(var K=this,xe,qe=[],pt=0;pt<R.declarations.length;pt++){var vt=R.declarations[pt];this.varDeclaration(this.getVariableName(vt.id)),vt.init&&qe.push({type:"AssignmentExpression",operator:"=",left:vt.id,right:vt.init})}return qe.length&&(xe=this.createClosure({type:"BlockStatement",body:qe})),function(){if(xe){var cr=K.isVarDeclMode;K.isVarDeclMode=!0,xe(),K.isVarDeclMode=cr}return Dt}},T.assertVariable=function(R,K,xe){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(ha.VariableUndefinedReferenceError,K,xe)},T.programHandler=function(R){var K=this,xe=R.body.map(function(qe){return K.createClosure(qe)});return function(){for(var qe=Dt,pt=0;pt<xe.length;pt++){var vt=xe[pt],cr=K.setValue(vt());if(cr!==Dt&&(qe=cr,qe instanceof Vr||qe instanceof It||qe instanceof ko||qe===Q||qe===be))break}return qe}},T.expressionStatementHandler=function(R){return this.createClosure(R.expression)},T.emptyStatementHandler=function(R){return function(){return Dt}},T.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Ys;return function(){return new Vr(K())}},T.ifStatementHandler=function(R){var K=this.createClosure(R.test),xe=this.createClosure(R.consequent),qe=R.alternate?this.createClosure(R.alternate):function(){return Dt};return function(){return K()?xe():qe()}},T.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},T.forStatementHandler=function(R){var K=this,xe=Ys,qe=R.test?this.createClosure(R.test):function(){return!0},pt=Ys,vt=this.createClosure(R.body);return R.type==="ForStatement"&&(xe=R.init?this.createClosure(R.init):xe,pt=R.update?this.createClosure(R.update):Ys),function(cr){var _r,Pn=Dt,ci=R.type==="DoWhileStatement";for(cr&&cr.type==="LabeledStatement"&&(_r=cr.label.name),xe();ci||qe();pt()){ci=!1;var Jn=K.setValue(vt());if(!(Jn===Dt||Jn===be)){if(Jn===Q)break;if(Pn=Jn,Pn instanceof ko&&Pn.value===_r){Pn=Dt;continue}if(Pn instanceof Vr||Pn instanceof It||Pn instanceof ko)break}}return Pn}},T.whileStatementHandler=function(R){return this.forStatementHandler(R)},T.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},T.forInStatementHandler=function(R){var K=this,xe=R.left,qe=this.createClosure(R.right),pt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),xe=R.left.declarations[0].id),function(vt){var cr,_r=Dt,Pn;vt&&vt.type==="LabeledStatement"&&(cr=vt.label.name);var ci=qe();for(Pn in ci){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:Pn}})();var Jn=K.setValue(pt());if(!(Jn===Dt||Jn===be)){if(Jn===Q)break;if(_r=Jn,_r instanceof ko&&_r.value===cr){_r=Dt;continue}if(_r instanceof Vr||_r instanceof It||_r instanceof ko)break}}return _r}},T.withStatementHandler=function(R){var K=this,xe=this.createClosure(R.object),qe=this.createClosure(R.body);return function(){var pt=xe(),vt=K.getCurrentScope(),cr=new oe(pt,vt,Dr);K.setCurrentScope(cr);var _r=K.setValue(qe());return K.setCurrentScope(vt),_r}},T.throwStatementHandler=function(R){var K=this,xe=this.createClosure(R.argument);return function(){throw K.setValue(void 0),xe()}},T.tryStatementHandler=function(R){var K=this,xe=this.createClosure(R.block),qe=R.handler?this.catchClauseHandler(R.handler):null,pt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var vt=K.getCurrentScope(),cr=K.getCurrentContext(),_r=vt.labelStack.concat([]),Pn=K.callStack.concat([]),ci=Dt,Jn,Hi,sa=function(){K.setCurrentScope(vt),K.setCurrentContext(cr),vt.labelStack=_r,K.callStack=Pn};try{ci=K.setValue(xe()),ci instanceof Vr&&(Jn=ci)}catch(Ca){if(sa(),K.isInterruptThrow(Ca))throw Ca;if(qe)try{ci=K.setValue(qe(Ca)),ci instanceof Vr&&(Jn=ci)}catch(Zi){if(sa(),K.isInterruptThrow(Zi))throw Zi;Hi=Zi}}if(pt)try{ci=pt(),ci instanceof Vr&&(Jn=ci)}catch(Ca){if(sa(),K.isInterruptThrow(Ca))throw Ca;Hi=Ca}if(Hi)throw Hi;return Jn||ci}},T.catchClauseHandler=function(R){var K=this,xe=this.createParamNameGetter(R.param),qe=this.createClosure(R.body);return function(pt){var vt,cr=K.getCurrentScope(),_r=cr.data,Pn=xe(),ci=ks.call(_r,Pn),Jn=_r[Pn];return _r[Pn]=pt,vt=qe(),ci?_r[Pn]=Jn:delete _r[Pn],vt}},T.continueStatementHandler=function(R){return function(){return R.label?new ko(R.label.name):be}},T.breakStatementHandler=function(R){return function(){return R.label?new It(R.label.name):Q}},T.switchStatementHandler=function(R){var K=this,xe=this.createClosure(R.discriminant),qe=R.cases.map(function(pt){return K.switchCaseHandler(pt)});return function(){for(var pt=xe(),vt=!1,cr,_r,Pn,ci=0;ci<qe.length;ci++){var Jn=qe[ci](),Hi=Jn.testClosure();if(Hi===et){Pn=Jn;continue}if(vt||Hi===pt){if(vt=!0,_r=K.setValue(Jn.bodyClosure()),_r===Dt)continue;if(_r===Q||(cr=_r,cr instanceof Vr||cr instanceof It||cr instanceof ko||cr===be))break}}if(!vt&&Pn){_r=K.setValue(Pn.bodyClosure());var sa=_r===Dt||_r===Q||_r===be;sa||(cr=_r)}return cr}},T.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return et},xe=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:xe}}},T.labeledStatementHandler=function(R){var K=this,xe=R.label.name,qe=this.createClosure(R.body);return function(){var pt,vt=K.getCurrentScope();return vt.labelStack.push(xe),pt=qe(R),pt instanceof It&&pt.value===xe&&(pt=Dt),vt.labelStack.pop(),pt}},T.debuggerStatementHandler=function(R){return function(){debugger;return Dt}},T.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ha.ParamTypeSyntaxError,R.type,R)},T.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},T.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},T.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ha.AssignmentTypeSyntaxError,R.type,R)}},T.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ha.AssignmentTypeSyntaxError,R.type,R)}},T.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},T.funcDeclaration=function(R,K){var xe=this.collectDeclFuncs;xe[R]=K},T.addDeclarationsToScope=function(R,K,xe){var qe=xe.data;for(var pt in K){var vt=K[pt];qe[pt]=vt&&vt()}for(var cr in R)cr in qe||(qe[cr]=void 0)},T.getScopeValue=function(R,K){var xe=this.getScopeFromName(R,K);return xe.data[R]},T.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},T.getScopeFromName=function(R,K){var xe=K;do if(R in xe.data)return xe;while(xe=xe.parent);return this.globalScope},T.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===Dt||R===Q||R===be||R instanceof It||R instanceof ko||(this.value=R instanceof Vr?R.value:R),R},T.getValue=function(){return this.value},_}();ho.version=ou,ho.eval=qo,ho.Function=Yr,ho.ecmaVersion=5,ho.globalContextInFunction=void 0,ho.global=Object.create(null);function ic(_){return _===void 0&&(_=Object.create(null)),_}function Oc(_,T,F){T===void 0&&(T=[]),F===void 0&&(F={});var R=F.parsingContext,K=F.timeout===void 0?0:F.timeout,xe=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,qe=new ho(R,{ecmaVersion:F.ecmaVersion,timeout:K,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return qe.evaluate(xe)}function Ku(_,T,F){var R=new ho(T,F);return R.evaluate(_)}var Rc=Ku,Rl=function(){function _(F){this._code=F}var T=_.prototype;return T.runInContext=function(R){return Ku(this._code,R)},T.runInNewContext=function(R){return Ku(this._code,R)},_}(),$u=function(_,T,F){return Ku(_,T,F)};function uu(){for(var _=arguments.length,T=new Array(_),F=0;F<_;F++)T[F]=arguments[F];var R=T.pop();return Oc(R||"",T)}var Qu=$u},20396:function(Ot,J,N){var le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,m,ve,j){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ue=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ze=ce||ue,ae=["","webkit","Moz","MS","ms","o"],nt=ze?"":m.createElement("div"),ke="function",st=Math.round,Gt=Math.abs,sr=Date.now;function Pt(Q,be,et){return setTimeout(_t(Q,et),be)}function er(Q,be,et){return Array.isArray(Q)?(Lt(Q,et[be],et),!0):!1}function Lt(Q,be,et){var Dt;if(!!Q)if(Q.forEach)Q.forEach(be,et);else if(Q.length!==j)for(Dt=0;Dt<Q.length;)be.call(et,Q[Dt],Dt,Q),Dt++;else for(Dt in Q)Q.hasOwnProperty(Dt)&&be.call(et,Q[Dt],Dt,Q)}function ht(Q,be,et){var Dt="DEPRECATED METHOD: "+be+`
`+et+` AT 
`;return function(){var Dr=new Error("get-stack-trace"),ut=Dr&&Dr.stack?Dr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",St=ye.console&&(ye.console.warn||ye.console.log);return St&&St.call(ye.console,Dt,ut),Q.apply(this,arguments)}}var mt;typeof Object.assign!="function"?mt=function(be){if(be===j||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var et=Object(be),Dt=1;Dt<arguments.length;Dt++){var Dr=arguments[Dt];if(Dr!==j&&Dr!==null)for(var ut in Dr)Dr.hasOwnProperty(ut)&&(et[ut]=Dr[ut])}return et}:mt=Object.assign;var tr=ht(function(be,et,Dt){for(var Dr=Object.keys(et),ut=0;ut<Dr.length;)(!Dt||Dt&&be[Dr[ut]]===j)&&(be[Dr[ut]]=et[Dr[ut]]),ut++;return be},"extend","Use `assign`."),q=ht(function(be,et){return tr(be,et,!0)},"merge","Use `assign`.");function Jt(Q,be,et){var Dt=be.prototype,Dr;Dr=Q.prototype=Object.create(Dt),Dr.constructor=Q,Dr._super=Dt,et&&mt(Dr,et)}function _t(Q,be){return function(){return Q.apply(be,arguments)}}function rt(Q,be){return typeof Q==ke?Q.apply(be&&be[0]||j,be):Q}function At(Q,be){return Q===j?be:Q}function tt(Q,be,et){Lt(en(be),function(Dt){Q.addEventListener(Dt,et,!1)})}function $t(Q,be,et){Lt(en(be),function(Dt){Q.removeEventListener(Dt,et,!1)})}function br(Q,be){for(;Q;){if(Q==be)return!0;Q=Q.parentNode}return!1}function Fr(Q,be){return Q.indexOf(be)>-1}function en(Q){return Q.trim().split(/\s+/g)}function Te(Q,be,et){if(Q.indexOf&&!et)return Q.indexOf(be);for(var Dt=0;Dt<Q.length;){if(et&&Q[Dt][et]==be||!et&&Q[Dt]===be)return Dt;Dt++}return-1}function Ke(Q){return Array.prototype.slice.call(Q,0)}function Fe(Q,be,et){for(var Dt=[],Dr=[],ut=0;ut<Q.length;){var St=be?Q[ut][be]:Q[ut];Te(Dr,St)<0&&Dt.push(Q[ut]),Dr[ut]=St,ut++}return et&&(be?Dt=Dt.sort(function(qi,Za){return qi[be]>Za[be]}):Dt=Dt.sort()),Dt}function Mt(Q,be){for(var et,Dt,Dr=be[0].toUpperCase()+be.slice(1),ut=0;ut<ae.length;){if(et=ae[ut],Dt=et?et+Dr:be,Dt in Q)return Dt;ut++}return j}var gt=1;function Zt(){return gt++}function qt(Q){var be=Q.ownerDocument||Q;return be.defaultView||be.parentWindow||ye}var Er=/mobile|tablet|ip(ad|hone|od)|android/i,Kn="ontouchstart"in ye,pn=Mt(ye,"PointerEvent")!==j,Wi=Kn&&Er.test(navigator.userAgent),Zn="touch",Gn="pen",pi="mouse",$n="kinect",ui=25,Ji=1,Ii=2,Ei=4,zi=8,na=1,Si=2,ya=4,wn=8,_i=16,ki=Si|ya,Xi=wn|_i,za=ki|Xi,de=["x","y"],Nn=["clientX","clientY"];function Ua(Q,be){var et=this;this.manager=Q,this.callback=be,this.element=Q.element,this.target=Q.options.inputTarget,this.domHandler=function(Dt){rt(Q.options.enable,[Q])&&et.handler(Dt)},this.init()}Ua.prototype={handler:function(){},init:function(){this.evEl&&tt(this.element,this.evEl,this.domHandler),this.evTarget&&tt(this.target,this.evTarget,this.domHandler),this.evWin&&tt(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$t(this.element,this.evEl,this.domHandler),this.evTarget&&$t(this.target,this.evTarget,this.domHandler),this.evWin&&$t(qt(this.element),this.evWin,this.domHandler)}};function us(Q){var be,et=Q.options.inputClass;return et?be=et:pn?be=Ie:Wi?be=zt:Kn?be=Rt:be=ba,new be(Q,jt)}function jt(Q,be,et){var Dt=et.pointers.length,Dr=et.changedPointers.length,ut=be&Ji&&Dt-Dr==0,St=be&(Ei|zi)&&Dt-Dr==0;et.isFirst=!!ut,et.isFinal=!!St,ut&&(Q.session={}),et.eventType=be,ir(Q,et),Q.emit("hammer.input",et),Q.recognize(et),Q.session.prevInput=et}function ir(Q,be){var et=Q.session,Dt=be.pointers,Dr=Dt.length;et.firstInput||(et.firstInput=nr(be)),Dr>1&&!et.firstMultiple?et.firstMultiple=nr(be):Dr===1&&(et.firstMultiple=!1);var ut=et.firstInput,St=et.firstMultiple,Ja=St?St.center:ut.center,qi=be.center=Dn(Dt);be.timeStamp=sr(),be.deltaTime=be.timeStamp-ut.timeStamp,be.angle=Ai(Ja,qi),be.distance=an(Ja,qi),Tr(et,be),be.offsetDirection=Hn(be.deltaX,be.deltaY);var Za=li(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Za.x,be.overallVelocityY=Za.y,be.overallVelocity=Gt(Za.x)>Gt(Za.y)?Za.x:Za.y,be.scale=St?Wa(St.pointers,Dt):1,be.rotation=St?wi(St.pointers,Dt):0,be.maxPointers=et.prevInput?be.pointers.length>et.prevInput.maxPointers?be.pointers.length:et.prevInput.maxPointers:be.pointers.length,I(et,be);var qo=Q.element;br(be.srcEvent.target,qo)&&(qo=be.srcEvent.target),be.target=qo}function Tr(Q,be){var et=be.center,Dt=Q.offsetDelta||{},Dr=Q.prevDelta||{},ut=Q.prevInput||{};(be.eventType===Ji||ut.eventType===Ei)&&(Dr=Q.prevDelta={x:ut.deltaX||0,y:ut.deltaY||0},Dt=Q.offsetDelta={x:et.x,y:et.y}),be.deltaX=Dr.x+(et.x-Dt.x),be.deltaY=Dr.y+(et.y-Dt.y)}function I(Q,be){var et=Q.lastInterval||be,Dt=be.timeStamp-et.timeStamp,Dr,ut,St,Ja;if(be.eventType!=zi&&(Dt>ui||et.velocity===j)){var qi=be.deltaX-et.deltaX,Za=be.deltaY-et.deltaY,qo=li(Dt,qi,Za);ut=qo.x,St=qo.y,Dr=Gt(qo.x)>Gt(qo.y)?qo.x:qo.y,Ja=Hn(qi,Za),Q.lastInterval=be}else Dr=et.velocity,ut=et.velocityX,St=et.velocityY,Ja=et.direction;be.velocity=Dr,be.velocityX=ut,be.velocityY=St,be.direction=Ja}function nr(Q){for(var be=[],et=0;et<Q.pointers.length;)be[et]={clientX:st(Q.pointers[et].clientX),clientY:st(Q.pointers[et].clientY)},et++;return{timeStamp:sr(),pointers:be,center:Dn(be),deltaX:Q.deltaX,deltaY:Q.deltaY}}function Dn(Q){var be=Q.length;if(be===1)return{x:st(Q[0].clientX),y:st(Q[0].clientY)};for(var et=0,Dt=0,Dr=0;Dr<be;)et+=Q[Dr].clientX,Dt+=Q[Dr].clientY,Dr++;return{x:st(et/be),y:st(Dt/be)}}function li(Q,be,et){return{x:be/Q||0,y:et/Q||0}}function Hn(Q,be){return Q===be?na:Gt(Q)>=Gt(be)?Q<0?Si:ya:be<0?wn:_i}function an(Q,be,et){et||(et=de);var Dt=be[et[0]]-Q[et[0]],Dr=be[et[1]]-Q[et[1]];return Math.sqrt(Dt*Dt+Dr*Dr)}function Ai(Q,be,et){et||(et=de);var Dt=be[et[0]]-Q[et[0]],Dr=be[et[1]]-Q[et[1]];return Math.atan2(Dr,Dt)*180/Math.PI}function wi(Q,be){return Ai(be[1],be[0],Nn)+Ai(Q[1],Q[0],Nn)}function Wa(Q,be){return an(be[0],be[1],Nn)/an(Q[0],Q[1],Nn)}var ls={mousedown:Ji,mousemove:Ii,mouseup:Ei},fa="mousedown",wa="mousemove mouseup";function ba(){this.evEl=fa,this.evWin=wa,this.pressed=!1,Ua.apply(this,arguments)}Jt(ba,Ua,{handler:function(be){var et=ls[be.type];et&Ji&&be.button===0&&(this.pressed=!0),et&Ii&&be.which!==1&&(et=Ei),!!this.pressed&&(et&Ei&&(this.pressed=!1),this.callback(this.manager,et,{pointers:[be],changedPointers:[be],pointerType:pi,srcEvent:be}))}});var G={pointerdown:Ji,pointermove:Ii,pointerup:Ei,pointercancel:zi,pointerout:zi},$={2:Zn,3:Gn,4:pi,5:$n},ne="pointerdown",ge="pointermove pointerup pointercancel";!ze&&ye.MSPointerEvent&&!ye.PointerEvent&&(ne="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Ie(){this.evEl=ne,this.evWin=ge,Ua.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Jt(Ie,Ua,{handler:function(be){var et=this.store,Dt=!1,Dr=be.type.toLowerCase().replace("ms",""),ut=G[Dr],St=$[be.pointerType]||be.pointerType,Ja=St==Zn,qi=Te(et,be.pointerId,"pointerId");ut&Ji&&(be.button===0||Ja)?qi<0&&(et.push(be),qi=et.length-1):ut&(Ei|zi)&&(Dt=!0),!(qi<0)&&(et[qi]=be,this.callback(this.manager,ut,{pointers:et,changedPointers:[be],pointerType:St,srcEvent:be}),Dt&&et.splice(qi,1))}});var He={touchstart:Ji,touchmove:Ii,touchend:Ei,touchcancel:zi},at="touchstart",fe="touchstart touchmove touchend touchcancel";function Be(){this.evTarget=at,this.evWin=fe,this.started=!1,Ua.apply(this,arguments)}Jt(Be,Ua,{handler:function(be){var et=He[be.type];if(et===Ji&&(this.started=!0),!!this.started){var Dt=yt.call(this,be,et);et&(Ei|zi)&&Dt[0].length-Dt[1].length==0&&(this.started=!1),this.callback(this.manager,et,{pointers:Dt[0],changedPointers:Dt[1],pointerType:Zn,srcEvent:be})}}});function yt(Q,be){var et=Ke(Q.touches),Dt=Ke(Q.changedTouches);return be&(Ei|zi)&&(et=Fe(et.concat(Dt),"identifier",!0)),[et,Dt]}var vr={touchstart:Ji,touchmove:Ii,touchend:Ei,touchcancel:zi},Bt="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Bt,this.targetIds={},Ua.apply(this,arguments)}Jt(zt,Ua,{handler:function(be){var et=vr[be.type],Dt=gr.call(this,be,et);!Dt||this.callback(this.manager,et,{pointers:Dt[0],changedPointers:Dt[1],pointerType:Zn,srcEvent:be})}});function gr(Q,be){var et=Ke(Q.touches),Dt=this.targetIds;if(be&(Ji|Ii)&&et.length===1)return Dt[et[0].identifier]=!0,[et,et];var Dr,ut,St=Ke(Q.changedTouches),Ja=[],qi=this.target;if(ut=et.filter(function(Za){return br(Za.target,qi)}),be===Ji)for(Dr=0;Dr<ut.length;)Dt[ut[Dr].identifier]=!0,Dr++;for(Dr=0;Dr<St.length;)Dt[St[Dr].identifier]&&Ja.push(St[Dr]),be&(Ei|zi)&&delete Dt[St[Dr].identifier],Dr++;if(!!Ja.length)return[Fe(ut.concat(Ja),"identifier",!0),Ja]}var bn=2500,ln=25;function Rt(){Ua.apply(this,arguments);var Q=_t(this.handler,this);this.touch=new zt(this.manager,Q),this.mouse=new ba(this.manager,Q),this.primaryTouch=null,this.lastTouches=[]}Jt(Rt,Ua,{handler:function(be,et,Dt){var Dr=Dt.pointerType==Zn,ut=Dt.pointerType==pi;if(!(ut&&Dt.sourceCapabilities&&Dt.sourceCapabilities.firesTouchEvents)){if(Dr)un.call(this,et,Dt);else if(ut&&Hr.call(this,Dt))return;this.callback(be,et,Dt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function un(Q,be){Q&Ji?(this.primaryTouch=be.changedPointers[0].identifier,jr.call(this,be)):Q&(Ei|zi)&&jr.call(this,be)}function jr(Q){var be=Q.changedPointers[0];if(be.identifier===this.primaryTouch){var et={x:be.clientX,y:be.clientY};this.lastTouches.push(et);var Dt=this.lastTouches,Dr=function(){var ut=Dt.indexOf(et);ut>-1&&Dt.splice(ut,1)};setTimeout(Dr,bn)}}function Hr(Q){for(var be=Q.srcEvent.clientX,et=Q.srcEvent.clientY,Dt=0;Dt<this.lastTouches.length;Dt++){var Dr=this.lastTouches[Dt],ut=Math.abs(be-Dr.x),St=Math.abs(et-Dr.y);if(ut<=ln&&St<=ln)return!0}return!1}var ai=ze?j:Mt(nt.style,"touchAction"),rn=ai!==j,Ci="compute",$i="auto",yi="manipulation",Ti="none",xi="pan-x",ei="pan-y",Gi=Mi();function Ta(Q,be){this.manager=Q,this.set(be)}Ta.prototype={set:function(Q){Q==Ci&&(Q=this.compute()),rn&&this.manager.element.style&&Gi[Q]&&(this.manager.element.style[ai]=Q),this.actions=Q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Q=[];return Lt(this.manager.recognizers,function(be){rt(be.options.enable,[be])&&(Q=Q.concat(be.getTouchAction()))}),ea(Q.join(" "))},preventDefaults:function(Q){var be=Q.srcEvent,et=Q.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Dt=this.actions,Dr=Fr(Dt,Ti)&&!Gi[Ti],ut=Fr(Dt,ei)&&!Gi[ei],St=Fr(Dt,xi)&&!Gi[xi];if(Dr){var Ja=Q.pointers.length===1,qi=Q.distance<2,Za=Q.deltaTime<250;if(Ja&&qi&&Za)return}if(!(St&&ut)&&(Dr||ut&&et&ki||St&&et&Xi))return this.preventSrc(be)},preventSrc:function(Q){this.manager.session.prevented=!0,Q.preventDefault()}};function ea(Q){if(Fr(Q,Ti))return Ti;var be=Fr(Q,xi),et=Fr(Q,ei);return be&&et?Ti:be||et?be?xi:ei:Fr(Q,yi)?yi:$i}function Mi(){if(!rn)return!1;var Q={};if(ze)return Q;var be=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(et){Q[et]=be?ye.CSS.supports("touch-action",et):!0}),Q}var Ui=1,Oa=2,au=4,Ea=8,Sa=Ea,_s=16,cs=32;function Qi(Q){this.options=mt({},this.defaults,Q||{}),this.id=Zt(),this.manager=null,this.options.enable=At(this.options.enable,!0),this.state=Ui,this.simultaneous={},this.requireFail=[]}Qi.prototype={defaults:{},set:function(Q){return mt(this.options,Q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Q){if(er(Q,"recognizeWith",this))return this;var be=this.simultaneous;return Q=Ra(Q,this),be[Q.id]||(be[Q.id]=Q,Q.recognizeWith(this)),this},dropRecognizeWith:function(Q){return er(Q,"dropRecognizeWith",this)?this:(Q=Ra(Q,this),delete this.simultaneous[Q.id],this)},requireFailure:function(Q){if(er(Q,"requireFailure",this))return this;var be=this.requireFail;return Q=Ra(Q,this),Te(be,Q)===-1&&(be.push(Q),Q.requireFailure(this)),this},dropRequireFailure:function(Q){if(er(Q,"dropRequireFailure",this))return this;Q=Ra(Q,this);var be=Te(this.requireFail,Q);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Q){return!!this.simultaneous[Q.id]},emit:function(Q){var be=this,et=this.state;function Dt(Dr){be.manager.emit(Dr,Q)}et<Ea&&Dt(be.options.event+Yu(et)),Dt(be.options.event),Q.additionalEvent&&Dt(Q.additionalEvent),et>=Ea&&Dt(be.options.event+Yu(et))},tryEmit:function(Q){if(this.canEmit())return this.emit(Q);this.state=cs},canEmit:function(){for(var Q=0;Q<this.requireFail.length;){if(!(this.requireFail[Q].state&(cs|Ui)))return!1;Q++}return!0},recognize:function(Q){var be=mt({},Q);if(!rt(this.options.enable,[this,be])){this.reset(),this.state=cs;return}this.state&(Sa|_s|cs)&&(this.state=Ui),this.state=this.process(be),this.state&(Oa|au|Ea|_s)&&this.tryEmit(be)},process:function(Q){},getTouchAction:function(){},reset:function(){}};function Yu(Q){return Q&_s?"cancel":Q&Ea?"end":Q&au?"move":Q&Oa?"start":""}function co(Q){return Q==_i?"down":Q==wn?"up":Q==Si?"left":Q==ya?"right":""}function Ra(Q,be){var et=be.manager;return et?et.get(Q):Q}function $a(){Qi.apply(this,arguments)}Jt($a,Qi,{defaults:{pointers:1},attrTest:function(Q){var be=this.options.pointers;return be===0||Q.pointers.length===be},process:function(Q){var be=this.state,et=Q.eventType,Dt=be&(Oa|au),Dr=this.attrTest(Q);return Dt&&(et&zi||!Dr)?be|_s:Dt||Dr?et&Ei?be|Ea:be&Oa?be|au:Oa:cs}});function Yi(){$a.apply(this,arguments),this.pX=null,this.pY=null}Jt(Yi,$a,{defaults:{event:"pan",threshold:10,pointers:1,direction:za},getTouchAction:function(){var Q=this.options.direction,be=[];return Q&ki&&be.push(ei),Q&Xi&&be.push(xi),be},directionTest:function(Q){var be=this.options,et=!0,Dt=Q.distance,Dr=Q.direction,ut=Q.deltaX,St=Q.deltaY;return Dr&be.direction||(be.direction&ki?(Dr=ut===0?na:ut<0?Si:ya,et=ut!=this.pX,Dt=Math.abs(Q.deltaX)):(Dr=St===0?na:St<0?wn:_i,et=St!=this.pY,Dt=Math.abs(Q.deltaY))),Q.direction=Dr,et&&Dt>be.threshold&&Dr&be.direction},attrTest:function(Q){return $a.prototype.attrTest.call(this,Q)&&(this.state&Oa||!(this.state&Oa)&&this.directionTest(Q))},emit:function(Q){this.pX=Q.deltaX,this.pY=Q.deltaY;var be=co(Q.direction);be&&(Q.additionalEvent=this.options.event+be),this._super.emit.call(this,Q)}});function Ho(){$a.apply(this,arguments)}Jt(Ho,$a,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.scale-1)>this.options.threshold||this.state&Oa)},emit:function(Q){if(Q.scale!==1){var be=Q.scale<1?"in":"out";Q.additionalEvent=this.options.event+be}this._super.emit.call(this,Q)}});function Wo(){Qi.apply(this,arguments),this._timer=null,this._input=null}Jt(Wo,Qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[$i]},process:function(Q){var be=this.options,et=Q.pointers.length===be.pointers,Dt=Q.distance<be.threshold,Dr=Q.deltaTime>be.time;if(this._input=Q,!Dt||!et||Q.eventType&(Ei|zi)&&!Dr)this.reset();else if(Q.eventType&Ji)this.reset(),this._timer=Pt(function(){this.state=Sa,this.tryEmit()},be.time,this);else if(Q.eventType&Ei)return Sa;return cs},reset:function(){clearTimeout(this._timer)},emit:function(Q){this.state===Sa&&(Q&&Q.eventType&Ei?this.manager.emit(this.options.event+"up",Q):(this._input.timeStamp=sr(),this.manager.emit(this.options.event,this._input)))}});function qu(){$a.apply(this,arguments)}Jt(qu,$a,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.rotation)>this.options.threshold||this.state&Oa)}});function po(){$a.apply(this,arguments)}Jt(po,$a,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ki|Xi,pointers:1},getTouchAction:function(){return Yi.prototype.getTouchAction.call(this)},attrTest:function(Q){var be=this.options.direction,et;return be&(ki|Xi)?et=Q.overallVelocity:be&ki?et=Q.overallVelocityX:be&Xi&&(et=Q.overallVelocityY),this._super.attrTest.call(this,Q)&&be&Q.offsetDirection&&Q.distance>this.options.threshold&&Q.maxPointers==this.options.pointers&&Gt(et)>this.options.velocity&&Q.eventType&Ei},emit:function(Q){var be=co(Q.offsetDirection);be&&this.manager.emit(this.options.event+be,Q),this.manager.emit(this.options.event,Q)}});function Xo(){Qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Jt(Xo,Qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yi]},process:function(Q){var be=this.options,et=Q.pointers.length===be.pointers,Dt=Q.distance<be.threshold,Dr=Q.deltaTime<be.time;if(this.reset(),Q.eventType&Ji&&this.count===0)return this.failTimeout();if(Dt&&Dr&&et){if(Q.eventType!=Ei)return this.failTimeout();var ut=this.pTime?Q.timeStamp-this.pTime<be.interval:!0,St=!this.pCenter||an(this.pCenter,Q.center)<be.posThreshold;this.pTime=Q.timeStamp,this.pCenter=Q.center,!St||!ut?this.count=1:this.count+=1,this._input=Q;var Ja=this.count%be.taps;if(Ja===0)return this.hasRequireFailures()?(this._timer=Pt(function(){this.state=Sa,this.tryEmit()},be.interval,this),Oa):Sa}return cs},failTimeout:function(){return this._timer=Pt(function(){this.state=cs},this.options.interval,this),cs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Sa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ha(Q,be){return be=be||{},be.recognizers=At(be.recognizers,ha.defaults.preset),new Qa(Q,be)}ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:Ci,enable:!0,inputTarget:null,inputClass:null,preset:[[qu,{enable:!1}],[Ho,{enable:!1},["rotate"]],[po,{direction:ki}],[Yi,{direction:ki},["swipe"]],[Xo],[Xo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var fo=1,Yo=2;function Qa(Q,be){this.options=mt({},ha.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||Q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Q,this.input=us(this),this.touchAction=new Ta(this,this.options.touchAction),ou(this,!0),Lt(this.options.recognizers,function(et){var Dt=this.add(new et[0](et[1]));et[2]&&Dt.recognizeWith(et[2]),et[3]&&Dt.requireFailure(et[3])},this)}Qa.prototype={set:function(Q){return mt(this.options,Q),Q.touchAction&&this.touchAction.update(),Q.inputTarget&&(this.input.destroy(),this.input.target=Q.inputTarget,this.input.init()),this},stop:function(Q){this.session.stopped=Q?Yo:fo},recognize:function(Q){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(Q);var et,Dt=this.recognizers,Dr=be.curRecognizer;(!Dr||Dr&&Dr.state&Sa)&&(Dr=be.curRecognizer=null);for(var ut=0;ut<Dt.length;)et=Dt[ut],be.stopped!==Yo&&(!Dr||et==Dr||et.canRecognizeWith(Dr))?et.recognize(Q):et.reset(),!Dr&&et.state&(Oa|au|Ea)&&(Dr=be.curRecognizer=et),ut++}},get:function(Q){if(Q instanceof Qi)return Q;for(var be=this.recognizers,et=0;et<be.length;et++)if(be[et].options.event==Q)return be[et];return null},add:function(Q){if(er(Q,"add",this))return this;var be=this.get(Q.options.event);return be&&this.remove(be),this.recognizers.push(Q),Q.manager=this,this.touchAction.update(),Q},remove:function(Q){if(er(Q,"remove",this))return this;if(Q=this.get(Q),Q){var be=this.recognizers,et=Te(be,Q);et!==-1&&(be.splice(et,1),this.touchAction.update())}return this},on:function(Q,be){if(Q!==j&&be!==j){var et=this.handlers;return Lt(en(Q),function(Dt){et[Dt]=et[Dt]||[],et[Dt].push(be)}),this}},off:function(Q,be){if(Q!==j){var et=this.handlers;return Lt(en(Q),function(Dt){be?et[Dt]&&et[Dt].splice(Te(et[Dt],be),1):delete et[Dt]}),this}},emit:function(Q,be){this.options.domEvents&&Ic(Q,be);var et=this.handlers[Q]&&this.handlers[Q].slice();if(!(!et||!et.length)){be.type=Q,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Dt=0;Dt<et.length;)et[Dt](be),Dt++}},destroy:function(){this.element&&ou(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ou(Q,be){var et=Q.element;if(!!et.style){var Dt;Lt(Q.options.cssProps,function(Dr,ut){Dt=Mt(et.style,ut),be?(Q.oldCssProps[Dt]=et.style[Dt],et.style[Dt]=Dr):et.style[Dt]=Q.oldCssProps[Dt]||""}),be||(Q.oldCssProps={})}}function Ic(Q,be){if(!ze){var et=m.createEvent("Event");et.initEvent(Q,!0,!0),et.gesture=be,be.target.dispatchEvent(et)}}if(!ze){mt(ha,{INPUT_START:Ji,INPUT_MOVE:Ii,INPUT_END:Ei,INPUT_CANCEL:zi,STATE_POSSIBLE:Ui,STATE_BEGAN:Oa,STATE_CHANGED:au,STATE_ENDED:Ea,STATE_RECOGNIZED:Sa,STATE_CANCELLED:_s,STATE_FAILED:cs,DIRECTION_NONE:na,DIRECTION_LEFT:Si,DIRECTION_RIGHT:ya,DIRECTION_UP:wn,DIRECTION_DOWN:_i,DIRECTION_HORIZONTAL:ki,DIRECTION_VERTICAL:Xi,DIRECTION_ALL:za,Manager:Qa,Input:Ua,TouchAction:Ta,TouchInput:zt,MouseInput:ba,PointerEventInput:Ie,TouchMouseInput:Rt,SingleTouchInput:Be,Recognizer:Qi,AttrRecognizer:$a,Tap:Xo,Pan:Yi,Swipe:po,Pinch:Ho,Rotate:qu,Press:Wo,on:tt,off:$t,each:Lt,merge:q,extend:tr,assign:mt,inherit:Jt,bindFn:_t,prefixed:Mt});var ks=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ks.Hammer=ha,le=function(){return ha}.call(J,N,J,Ot),le!==j&&(Ot.exports=le)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ot,J,N){(function(le,ye){Ot.exports=ye(N(18857))})(this,function(le){"use strict";var ye=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},m=function(B,me){for(var Ue=Object.keys(me),Nt=0;Nt<Ue.length;++Nt)B[Ue[Nt]]=me[Ue[Nt]];return B},ve=`
`;function j(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function ce(B){var me=new Error("(regl) "+B);throw console.error(me),me}function ue(B,me){B||ce(me)}function ze(B){return B?": "+B:""}function ae(B,me,Ue){B in me||ce("unknown parameter ("+B+")"+ze(Ue)+". possible values: "+Object.keys(me).join())}function nt(B,me){ye(B)||ce("invalid parameter type"+ze(me)+". must be a typed array")}function ke(B,me){switch(me){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function st(B,me,Ue){ke(B,me)||ce("invalid parameter type"+ze(Ue)+". expected "+me+", got "+typeof B)}function Gt(B,me){B>=0&&(B|0)===B||ce("invalid parameter type, ("+B+")"+ze(me)+". must be a nonnegative integer")}function sr(B,me,Ue){me.indexOf(B)<0&&ce("invalid value"+ze(Ue)+". must be one of: "+me)}var Pt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function er(B){Object.keys(B).forEach(function(me){Pt.indexOf(me)<0&&ce('invalid regl constructor argument "'+me+'". must be one of '+Pt)})}function Lt(B,me){for(B=B+"";B.length<me;)B=" "+B;return B}function ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function mt(B,me){this.number=B,this.line=me,this.errors=[]}function tr(B,me,Ue){this.file=B,this.line=me,this.message=Ue}function q(){var B=new Error,me=(B.stack||B).toString(),Ue=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(Ue)return Ue[1];var Nt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return Nt?Nt[1]:"unknown"}function Jt(){var B=new Error,me=(B.stack||B).toString(),Ue=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(Ue)return Ue[1];var Nt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return Nt?Nt[1]:"unknown"}function _t(B,me){var Ue=B.split(`
`),Nt=1,or=0,Ft={unknown:new ht,0:new ht};Ft.unknown.name=Ft[0].name=me||q(),Ft.unknown.lines.push(new mt(0,""));for(var Ye=0;Ye<Ue.length;++Ye){var pr=Ue[Ye],De=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(pr);if(De)switch(De[1]){case"line":var Sr=/(\d+)(\s+\d+)?/.exec(De[2]);Sr&&(Nt=Sr[1]|0,Sr[2]&&(or=Sr[2]|0,or in Ft||(Ft[or]=new ht)));break;case"define":var Or=/SHADER_NAME(_B64)?\s+(.*)$/.exec(De[2]);Or&&(Ft[or].name=Or[1]?j(Or[2]):Or[2]);break}Ft[or].lines.push(new mt(Nt++,pr))}return Object.keys(Ft).forEach(function(Rr){var Zr=Ft[Rr];Zr.lines.forEach(function(xr){Zr.index[xr.number]=xr})}),Ft}function rt(B){var me=[];return B.split(`
`).forEach(function(Ue){if(!(Ue.length<5)){var Nt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ue);Nt?me.push(new tr(Nt[1]|0,Nt[2]|0,Nt[3].trim())):Ue.length>0&&me.push(new tr("unknown",0,Ue))}}),me}function At(B,me){me.forEach(function(Ue){var Nt=B[Ue.file];if(Nt){var or=Nt.index[Ue.line];if(or){or.errors.push(Ue),Nt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Ue)})}function tt(B,me,Ue,Nt,or){if(!B.getShaderParameter(me,B.COMPILE_STATUS)){var Ft=B.getShaderInfoLog(me),Ye=Nt===B.FRAGMENT_SHADER?"fragment":"vertex";Fe(Ue,"string",Ye+" shader source must be a string",or);var pr=_t(Ue,or),De=rt(Ft);At(pr,De),Object.keys(pr).forEach(function(Sr){var Or=pr[Sr];if(!Or.hasErrors)return;var Rr=[""],Zr=[""];function xr(Pr,ct){Rr.push(Pr),Zr.push(ct||"")}xr("file number "+Sr+": "+Or.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Or.lines.forEach(function(Pr){if(Pr.errors.length>0){xr(Lt(Pr.number,4)+"|  ","background-color:yellow; font-weight:bold"),xr(Pr.line+ve,"color:red; background-color:yellow; font-weight:bold");var ct=0;Pr.errors.forEach(function(Vt){var Cr=Vt.message,zr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Cr);if(zr){var hr=zr[1];switch(Cr=zr[2],hr){case"assign":hr="=";break}ct=Math.max(Pr.line.indexOf(hr,ct),0)}else ct=0;xr(Lt("| ",6)),xr(Lt("^^^",ct+3)+ve,"font-weight:bold"),xr(Lt("| ",6)),xr(Cr+ve,"font-weight:bold")}),xr(Lt("| ",6)+ve)}else xr(Lt(Pr.number,4)+"|  "),xr(Pr.line+ve,"color:red")}),typeof document!="undefined"&&!window.chrome?(Zr[0]=Rr.join("%c"),console.log.apply(console,Zr)):console.log(Rr.join(""))}),ue.raise("Error compiling "+Ye+" shader, "+pr[0].name)}}function $t(B,me,Ue,Nt,or){if(!B.getProgramParameter(me,B.LINK_STATUS)){var Ft=B.getProgramInfoLog(me),Ye=_t(Ue,or),pr=_t(Nt,or),De='Error linking program with vertex shader, "'+pr[0].name+'", and fragment shader "'+Ye[0].name+'"';typeof document!="undefined"?console.log("%c"+De+ve+"%c"+Ft,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(De+ve+Ft),ue.raise(De)}}function br(B){B._commandRef=q()}function Fr(B,me,Ue,Nt){br(B);function or(De){return De?Nt.id(De):0}B._fragId=or(B.static.frag),B._vertId=or(B.static.vert);function Ft(De,Sr){Object.keys(Sr).forEach(function(Or){De[Nt.id(Or)]=!0})}var Ye=B._uniformSet={};Ft(Ye,me.static),Ft(Ye,me.dynamic);var pr=B._attributeSet={};Ft(pr,Ue.static),Ft(pr,Ue.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function en(B,me){var Ue=Jt();ce(B+" in command "+(me||q())+(Ue==="unknown"?"":" called from "+Ue))}function Te(B,me,Ue){B||en(me,Ue||q())}function Ke(B,me,Ue,Nt){B in me||en("unknown parameter ("+B+")"+ze(Ue)+". possible values: "+Object.keys(me).join(),Nt||q())}function Fe(B,me,Ue,Nt){ke(B,me)||en("invalid parameter type"+ze(Ue)+". expected "+me+", got "+typeof B,Nt||q())}function Mt(B){B()}function gt(B,me,Ue){B.texture?sr(B.texture._texture.internalformat,me,"unsupported texture format for attachment"):sr(B.renderbuffer._renderbuffer.format,Ue,"unsupported renderbuffer format for attachment")}var Zt=33071,qt=9728,Er=9984,Kn=9985,pn=9986,Wi=9987,Zn=5120,Gn=5121,pi=5122,$n=5123,ui=5124,Ji=5125,Ii=5126,Ei=32819,zi=32820,na=33635,Si=34042,ya=36193,wn={};wn[Zn]=wn[Gn]=1,wn[pi]=wn[$n]=wn[ya]=wn[na]=wn[Ei]=wn[zi]=2,wn[ui]=wn[Ji]=wn[Ii]=wn[Si]=4;function _i(B,me){return B===zi||B===Ei||B===na?2:B===Si?4:wn[B]*me}function ki(B){return!(B&B-1)&&!!B}function Xi(B,me,Ue){var Nt,or=me.width,Ft=me.height,Ye=me.channels;ue(or>0&&or<=Ue.maxTextureSize&&Ft>0&&Ft<=Ue.maxTextureSize,"invalid texture shape"),(B.wrapS!==Zt||B.wrapT!==Zt)&&ue(ki(or)&&ki(Ft),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?or!==1&&Ft!==1&&ue(B.minFilter!==Er&&B.minFilter!==pn&&B.minFilter!==Kn&&B.minFilter!==Wi,"min filter requires mipmap"):(ue(ki(or)&&ki(Ft),"texture must be a square power of 2 to support mipmapping"),ue(me.mipmask===(or<<1)-1,"missing or incomplete mipmap data")),me.type===Ii&&(Ue.extensions.indexOf("oes_texture_float_linear")<0&&ue(B.minFilter===qt&&B.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),ue(!B.genMipmaps,"mipmap generation not supported with float textures"));var pr=me.images;for(Nt=0;Nt<16;++Nt)if(pr[Nt]){var De=or>>Nt,Sr=Ft>>Nt;ue(me.mipmask&1<<Nt,"missing mipmap data");var Or=pr[Nt];if(ue(Or.width===De&&Or.height===Sr,"invalid shape for mip images"),ue(Or.format===me.format&&Or.internalformat===me.internalformat&&Or.type===me.type,"incompatible type for mip image"),!Or.compressed)if(Or.data){var Rr=Math.ceil(_i(Or.type,Ye)*De/Or.unpackAlignment)*Or.unpackAlignment;ue(Or.data.byteLength===Rr*Sr,"invalid data for image, buffer size is inconsistent with image format")}else Or.element||Or.copy}else B.genMipmaps||ue((me.mipmask&1<<Nt)==0,"extra mipmap data");me.compressed&&ue(!B.genMipmaps,"mipmap generation for compressed images not supported")}function za(B,me,Ue,Nt){var or=B.width,Ft=B.height,Ye=B.channels;ue(or>0&&or<=Nt.maxTextureSize&&Ft>0&&Ft<=Nt.maxTextureSize,"invalid texture shape"),ue(or===Ft,"cube map must be square"),ue(me.wrapS===Zt&&me.wrapT===Zt,"wrap mode not supported by cube map");for(var pr=0;pr<Ue.length;++pr){var De=Ue[pr];ue(De.width===or&&De.height===Ft,"inconsistent cube map face shape"),me.genMipmaps&&(ue(!De.compressed,"can not generate mipmap for compressed textures"),ue(De.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Sr=De.images,Or=0;Or<16;++Or){var Rr=Sr[Or];if(Rr){var Zr=or>>Or,xr=Ft>>Or;ue(De.mipmask&1<<Or,"missing mipmap data"),ue(Rr.width===Zr&&Rr.height===xr,"invalid shape for mip images"),ue(Rr.format===B.format&&Rr.internalformat===B.internalformat&&Rr.type===B.type,"incompatible type for mip image"),Rr.compressed||(Rr.data?ue(Rr.data.byteLength===Zr*xr*Math.max(_i(Rr.type,Ye),Rr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Rr.element||Rr.copy)}}}}var de=m(ue,{optional:Mt,raise:ce,commandRaise:en,command:Te,parameter:ae,commandParameter:Ke,constructor:er,type:st,commandType:Fe,isTypedArray:nt,nni:Gt,oneOf:sr,shaderError:tt,linkError:$t,callSite:Jt,saveCommandRef:br,saveDrawInfo:Fr,framebufferFormat:gt,guessCommand:q,texture2D:Xi,textureCube:za}),Nn=0,Ua=0,us=5,jt=6;function ir(B,me){this.id=Nn++,this.type=B,this.data=me}function Tr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(B){if(B.length===0)return[];var me=B.charAt(0),Ue=B.charAt(B.length-1);if(B.length>1&&me===Ue&&(me==='"'||me==="'"))return['"'+Tr(B.substr(1,B.length-2))+'"'];var Nt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Nt)return I(B.substr(0,Nt.index)).concat(I(Nt[1])).concat(I(B.substr(Nt.index+Nt[0].length)));var or=B.split(".");if(or.length===1)return['"'+Tr(B)+'"'];for(var Ft=[],Ye=0;Ye<or.length;++Ye)Ft=Ft.concat(I(or[Ye]));return Ft}function nr(B){return"["+I(B).join("][")+"]"}function Dn(B,me){return new ir(B,nr(me+""))}function li(B){return typeof B=="function"&&!B._reglType||B instanceof ir}function Hn(B,me){if(typeof B=="function")return new ir(Ua,B);if(typeof B=="number"||typeof B=="boolean")return new ir(us,B);if(Array.isArray(B))return new ir(jt,B.map(function(Ue,Nt){return Hn(Ue,me+"["+Nt+"]")}));if(B instanceof ir)return B;de(!1,"invalid option type in uniform "+me)}var an={DynamicVariable:ir,define:Dn,isDynamic:li,unbox:Hn,accessor:nr},Ai={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},wi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wa=wi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ls(){var B={"":0},me=[""];return{id:function(Ue){var Nt=B[Ue];return Nt||(Nt=B[Ue]=me.length,me.push(Ue),Nt)},str:function(Ue){return me[Ue]}}}function fa(B,me,Ue){var Nt=document.createElement("canvas");m(Nt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Nt),B===document.body&&(Nt.style.position="absolute",m(B.style,{margin:0,padding:0}));function or(){var pr=window.innerWidth,De=window.innerHeight;if(B!==document.body){var Sr=Nt.getBoundingClientRect();pr=Sr.right-Sr.left,De=Sr.bottom-Sr.top}Nt.width=Ue*pr,Nt.height=Ue*De}var Ft;B!==document.body&&typeof ResizeObserver=="function"?(Ft=new ResizeObserver(function(){setTimeout(or)}),Ft.observe(B)):window.addEventListener("resize",or,!1);function Ye(){Ft?Ft.disconnect():window.removeEventListener("resize",or),B.removeChild(Nt)}return or(),{canvas:Nt,onDestroy:Ye}}function wa(B,me){function Ue(Nt){try{return B.getContext(Nt,me)}catch(or){return null}}return Ue("webgl")||Ue("experimental-webgl")||Ue("webgl-experimental")}function ba(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function G(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function $(B){return typeof B=="string"?B.split():(de(Array.isArray(B),"invalid extension array"),B)}function ne(B){return typeof B=="string"?(de(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var me=B||{},Ue,Nt,or,Ft,Ye={},pr=[],De=[],Sr=typeof window=="undefined"?1:window.devicePixelRatio,Or=!1,Rr=function(Pr){Pr&&de.raise(Pr)},Zr=function(){};if(typeof me=="string"?(de(typeof document!="undefined","selector queries only supported in DOM environments"),Ue=document.querySelector(me),de(Ue,"invalid query string for element")):typeof me=="object"?ba(me)?Ue=me:G(me)?(Ft=me,or=Ft.canvas):(de.constructor(me),"gl"in me?Ft=me.gl:"canvas"in me?or=ne(me.canvas):"container"in me&&(Nt=ne(me.container)),"attributes"in me&&(Ye=me.attributes,de.type(Ye,"object","invalid context attributes")),"extensions"in me&&(pr=$(me.extensions)),"optionalExtensions"in me&&(De=$(me.optionalExtensions)),"onDone"in me&&(de.type(me.onDone,"function","invalid or missing onDone callback"),Rr=me.onDone),"profile"in me&&(Or=!!me.profile),"pixelRatio"in me&&(Sr=+me.pixelRatio,de(Sr>0,"invalid pixel ratio"))):de.raise("invalid arguments to regl"),Ue&&(Ue.nodeName.toLowerCase()==="canvas"?or=Ue:Nt=Ue),!Ft){if(!or){de(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var xr=fa(Nt||document.body,Rr,Sr);if(!xr)return null;or=xr.canvas,Zr=xr.onDestroy}Ye.premultipliedAlpha===void 0&&(Ye.premultipliedAlpha=!0),Ft=wa(or,Ye)}return Ft?{gl:Ft,canvas:or,container:Nt,extensions:pr,optionalExtensions:De,pixelRatio:Sr,profile:Or,onDone:Rr,onDestroy:Zr}:(Zr(),Rr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ie(B,me){var Ue={};function Nt(pr){de.type(pr,"string","extension name must be string");var De=pr.toLowerCase(),Sr;try{Sr=Ue[De]=or(pr)}catch(Or){}return!!Sr}function or(pr){return B.getExtension(pr)?B.getExtension(pr):B.getExtension(pr.toLowerCase())?B.getExtension(pr.toLowerCase()):null}for(var Ft=0;Ft<me.extensions.length;++Ft){var Ye=me.extensions[Ft];if(!Nt(Ye))return me.onDestroy(),me.onDone('"'+Ye+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(Nt),{extensions:Ue,restore:function(){Object.keys(Ue).forEach(function(pr){if(Ue[pr]&&!Nt(pr))throw new Error("(regl): error restoring extension "+pr)})}}}function He(B,me){for(var Ue=Array(B),Nt=0;Nt<B;++Nt)Ue[Nt]=me(Nt);return Ue}var at=5120,fe=5121,Be=5122,yt=5123,vr=5124,Bt=5125,zt=5126;function gr(B){for(var me=16;me<=1<<28;me*=16)if(B<=me)return me;return 0}function bn(B){var me,Ue;return me=(B>65535)<<4,B>>>=me,Ue=(B>255)<<3,B>>>=Ue,me|=Ue,Ue=(B>15)<<2,B>>>=Ue,me|=Ue,Ue=(B>3)<<1,B>>>=Ue,me|=Ue,me|B>>1}function ln(){var B=He(8,function(){return[]});function me(Ft){var Ye=gr(Ft),pr=B[bn(Ye)>>2];return pr.length>0?pr.pop():new ArrayBuffer(Ye)}function Ue(Ft){B[bn(Ft.byteLength)>>2].push(Ft)}function Nt(Ft,Ye){var pr=null;switch(Ft){case at:pr=new Int8Array(me(Ye),0,Ye);break;case fe:pr=new Uint8Array(me(Ye),0,Ye);break;case Be:pr=new Int16Array(me(2*Ye),0,Ye);break;case yt:pr=new Uint16Array(me(2*Ye),0,Ye);break;case vr:pr=new Int32Array(me(4*Ye),0,Ye);break;case Bt:pr=new Uint32Array(me(4*Ye),0,Ye);break;case zt:pr=new Float32Array(me(4*Ye),0,Ye);break;default:return null}return pr.length!==Ye?pr.subarray(0,Ye):pr}function or(Ft){Ue(Ft.buffer)}return{alloc:me,free:Ue,allocType:Nt,freeType:or}}var Rt=ln();Rt.zero=ln();var un=3408,jr=3410,Hr=3411,ai=3412,rn=3413,Ci=3414,$i=3415,yi=33901,Ti=33902,xi=3379,ei=3386,Gi=34921,Ta=36347,ea=36348,Mi=35661,Ui=35660,Oa=34930,au=36349,Ea=34076,Sa=34024,_s=7936,cs=7937,Qi=7938,Yu=35724,co=34047,Ra=36063,$a=34852,Yi=3553,Ho=34067,Wo=34069,qu=33984,po=6408,Xo=5126,ha=5121,fo=36160,Yo=36053,Qa=36064,ou=16384,Ic=function(B,me){var Ue=1;me.ext_texture_filter_anisotropic&&(Ue=B.getParameter(co));var Nt=1,or=1;me.webgl_draw_buffers&&(Nt=B.getParameter($a),or=B.getParameter(Ra));var Ft=!!me.oes_texture_float;if(Ft){var Ye=B.createTexture();B.bindTexture(Yi,Ye),B.texImage2D(Yi,0,po,1,1,0,po,Xo,null);var pr=B.createFramebuffer();if(B.bindFramebuffer(fo,pr),B.framebufferTexture2D(fo,Qa,Yi,Ye,0),B.bindTexture(Yi,null),B.checkFramebufferStatus(fo)!==Yo)Ft=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(ou);var De=Rt.allocType(Xo,4);B.readPixels(0,0,1,1,po,Xo,De),B.getError()?Ft=!1:(B.deleteFramebuffer(pr),B.deleteTexture(Ye),Ft=De[0]===1),Rt.freeType(De)}}var Sr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Or=!0;if(!Sr){var Rr=B.createTexture(),Zr=Rt.allocType(ha,36);B.activeTexture(qu),B.bindTexture(Ho,Rr),B.texImage2D(Wo,0,po,3,3,0,po,ha,Zr),Rt.freeType(Zr),B.bindTexture(Ho,null),B.deleteTexture(Rr),Or=!B.getError()}return{colorBits:[B.getParameter(jr),B.getParameter(Hr),B.getParameter(ai),B.getParameter(rn)],depthBits:B.getParameter(Ci),stencilBits:B.getParameter($i),subpixelBits:B.getParameter(un),extensions:Object.keys(me).filter(function(xr){return!!me[xr]}),maxAnisotropic:Ue,maxDrawbuffers:Nt,maxColorAttachments:or,pointSizeDims:B.getParameter(yi),lineWidthDims:B.getParameter(Ti),maxViewportDims:B.getParameter(ei),maxCombinedTextureUnits:B.getParameter(Mi),maxCubeMapSize:B.getParameter(Ea),maxRenderbufferSize:B.getParameter(Sa),maxTextureUnits:B.getParameter(Oa),maxTextureSize:B.getParameter(xi),maxAttributes:B.getParameter(Gi),maxVertexUniforms:B.getParameter(Ta),maxVertexTextureUnits:B.getParameter(Ui),maxVaryingVectors:B.getParameter(ea),maxFragmentUniforms:B.getParameter(au),glsl:B.getParameter(Yu),renderer:B.getParameter(cs),vendor:B.getParameter(_s),version:B.getParameter(Qi),readFloat:Ft,npotTextureCube:Or}};function ks(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||ye(B.data))}var Q=function(B){return Object.keys(B).map(function(me){return B[me]})},be={shape:Ja,flatten:St};function et(B,me,Ue){for(var Nt=0;Nt<me;++Nt)Ue[Nt]=B[Nt]}function Dt(B,me,Ue,Nt){for(var or=0,Ft=0;Ft<me;++Ft)for(var Ye=B[Ft],pr=0;pr<Ue;++pr)Nt[or++]=Ye[pr]}function Dr(B,me,Ue,Nt,or,Ft){for(var Ye=Ft,pr=0;pr<me;++pr)for(var De=B[pr],Sr=0;Sr<Ue;++Sr)for(var Or=De[Sr],Rr=0;Rr<Nt;++Rr)or[Ye++]=Or[Rr]}function ut(B,me,Ue,Nt,or){for(var Ft=1,Ye=Ue+1;Ye<me.length;++Ye)Ft*=me[Ye];var pr=me[Ue];if(me.length-Ue==4){var De=me[Ue+1],Sr=me[Ue+2],Or=me[Ue+3];for(Ye=0;Ye<pr;++Ye)Dr(B[Ye],De,Sr,Or,Nt,or),or+=Ft}else for(Ye=0;Ye<pr;++Ye)ut(B[Ye],me,Ue+1,Nt,or),or+=Ft}function St(B,me,Ue,Nt){var or=1;if(me.length)for(var Ft=0;Ft<me.length;++Ft)or*=me[Ft];else or=0;var Ye=Nt||Rt.allocType(Ue,or);switch(me.length){case 0:break;case 1:et(B,me[0],Ye);break;case 2:Dt(B,me[0],me[1],Ye);break;case 3:Dr(B,me[0],me[1],me[2],Ye,0);break;default:ut(B,me,0,Ye,0)}return Ye}function Ja(B){for(var me=[],Ue=B;Ue.length;Ue=Ue[0])me.push(Ue.length);return me}var qi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Za=5120,qo=5122,Yr=5124,Vr=5121,It=5123,ko=5125,oe=5126,Ys=5126,su={int8:Za,int16:qo,int32:Yr,uint8:Vr,uint16:It,uint32:ko,float:oe,float32:Ys},fs=35048,ta=35040,ho={dynamic:fs,stream:ta,static:35044},ic=be.flatten,Oc=be.shape,Ku=35044,Rc=35040,Rl=5121,$u=5126,uu=[];uu[5120]=1,uu[5122]=2,uu[5124]=4,uu[5121]=1,uu[5123]=2,uu[5125]=4,uu[5126]=4;function Qu(B){return qi[Object.prototype.toString.call(B)]|0}function _(B,me){for(var Ue=0;Ue<me.length;++Ue)B[Ue]=me[Ue]}function T(B,me,Ue,Nt,or,Ft,Ye){for(var pr=0,De=0;De<Ue;++De)for(var Sr=0;Sr<Nt;++Sr)B[pr++]=me[or*De+Ft*Sr+Ye]}function F(B,me,Ue,Nt){var or=0,Ft={};function Ye(ct){this.id=or++,this.buffer=B.createBuffer(),this.type=ct,this.usage=Ku,this.byteLength=0,this.dimension=1,this.dtype=Rl,this.persistentData=null,Ue.profile&&(this.stats={size:0})}Ye.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Ye.prototype.destroy=function(){Zr(this)};var pr=[];function De(ct,Vt){var Cr=pr.pop();return Cr||(Cr=new Ye(ct)),Cr.bind(),Rr(Cr,Vt,Rc,0,1,!1),Cr}function Sr(ct){pr.push(ct)}function Or(ct,Vt,Cr){ct.byteLength=Vt.byteLength,B.bufferData(ct.type,Vt,Cr)}function Rr(ct,Vt,Cr,zr,hr,Lr){var Kr;if(ct.usage=Cr,Array.isArray(Vt)){if(ct.dtype=zr||$u,Vt.length>0){var Bn;if(Array.isArray(Vt[0])){Kr=Oc(Vt);for(var rr=1,ar=1;ar<Kr.length;++ar)rr*=Kr[ar];ct.dimension=rr,Bn=ic(Vt,Kr,ct.dtype),Or(ct,Bn,Cr),Lr?ct.persistentData=Bn:Rt.freeType(Bn)}else if(typeof Vt[0]=="number"){ct.dimension=hr;var _n=Rt.allocType(ct.dtype,Vt.length);_(_n,Vt),Or(ct,_n,Cr),Lr?ct.persistentData=_n:Rt.freeType(_n)}else ye(Vt[0])?(ct.dimension=Vt[0].length,ct.dtype=zr||Qu(Vt[0])||$u,Bn=ic(Vt,[Vt.length,Vt[0].length],ct.dtype),Or(ct,Bn,Cr),Lr?ct.persistentData=Bn:Rt.freeType(Bn)):de.raise("invalid buffer data")}}else if(ye(Vt))ct.dtype=zr||Qu(Vt),ct.dimension=hr,Or(ct,Vt,Cr),Lr&&(ct.persistentData=new Uint8Array(new Uint8Array(Vt.buffer)));else if(ks(Vt)){Kr=Vt.shape;var Gr=Vt.stride,Ar=Vt.offset,$r=0,Jr=0,di=0,ni=0;Kr.length===1?($r=Kr[0],Jr=1,di=Gr[0],ni=0):Kr.length===2?($r=Kr[0],Jr=Kr[1],di=Gr[0],ni=Gr[1]):de.raise("invalid shape"),ct.dtype=zr||Qu(Vt.data)||$u,ct.dimension=Jr;var Wr=Rt.allocType(ct.dtype,$r*Jr);T(Wr,Vt.data,$r,Jr,di,ni,Ar),Or(ct,Wr,Cr),Lr?ct.persistentData=Wr:Rt.freeType(Wr)}else Vt instanceof ArrayBuffer?(ct.dtype=Rl,ct.dimension=hr,Or(ct,Vt,Cr),Lr&&(ct.persistentData=new Uint8Array(new Uint8Array(Vt)))):de.raise("invalid buffer data")}function Zr(ct){me.bufferCount--,Nt(ct);var Vt=ct.buffer;de(Vt,"buffer must not be deleted already"),B.deleteBuffer(Vt),ct.buffer=null,delete Ft[ct.id]}function xr(ct,Vt,Cr,zr){me.bufferCount++;var hr=new Ye(Vt);Ft[hr.id]=hr;function Lr(rr){var ar=Ku,_n=null,Gr=0,Ar=0,$r=1;return Array.isArray(rr)||ye(rr)||ks(rr)||rr instanceof ArrayBuffer?_n=rr:typeof rr=="number"?Gr=rr|0:rr&&(de.type(rr,"object","buffer arguments must be an object, a number or an array"),"data"in rr&&(de(_n===null||Array.isArray(_n)||ye(_n)||ks(_n),"invalid data for buffer"),_n=rr.data),"usage"in rr&&(de.parameter(rr.usage,ho,"invalid buffer usage"),ar=ho[rr.usage]),"type"in rr&&(de.parameter(rr.type,su,"invalid buffer type"),Ar=su[rr.type]),"dimension"in rr&&(de.type(rr.dimension,"number","invalid dimension"),$r=rr.dimension|0),"length"in rr&&(de.nni(Gr,"buffer length must be a nonnegative integer"),Gr=rr.length|0)),hr.bind(),_n?Rr(hr,_n,ar,Ar,$r,zr):(Gr&&B.bufferData(hr.type,Gr,ar),hr.dtype=Ar||Rl,hr.usage=ar,hr.dimension=$r,hr.byteLength=Gr),Ue.profile&&(hr.stats.size=hr.byteLength*uu[hr.dtype]),Lr}function Kr(rr,ar){de(ar+rr.byteLength<=hr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+rr.byteLength+" starting from offset "+ar+" to a buffer of size "+hr.byteLength),B.bufferSubData(hr.type,ar,rr)}function Bn(rr,ar){var _n=(ar||0)|0,Gr;if(hr.bind(),ye(rr)||rr instanceof ArrayBuffer)Kr(rr,_n);else if(Array.isArray(rr)){if(rr.length>0)if(typeof rr[0]=="number"){var Ar=Rt.allocType(hr.dtype,rr.length);_(Ar,rr),Kr(Ar,_n),Rt.freeType(Ar)}else if(Array.isArray(rr[0])||ye(rr[0])){Gr=Oc(rr);var $r=ic(rr,Gr,hr.dtype);Kr($r,_n),Rt.freeType($r)}else de.raise("invalid buffer data")}else if(ks(rr)){Gr=rr.shape;var Jr=rr.stride,di=0,ni=0,Wr=0,on=0;Gr.length===1?(di=Gr[0],ni=1,Wr=Jr[0],on=0):Gr.length===2?(di=Gr[0],ni=Gr[1],Wr=Jr[0],on=Jr[1]):de.raise("invalid shape");var Qn=Array.isArray(rr.data)?hr.dtype:Qu(rr.data),fi=Rt.allocType(Qn,di*ni);T(fi,rr.data,di,ni,Wr,on,rr.offset),Kr(fi,_n),Rt.freeType(fi)}else de.raise("invalid data for buffer subdata");return Lr}return Cr||Lr(ct),Lr._reglType="buffer",Lr._buffer=hr,Lr.subdata=Bn,Ue.profile&&(Lr.stats=hr.stats),Lr.destroy=function(){Zr(hr)},Lr}function Pr(){Q(Ft).forEach(function(ct){ct.buffer=B.createBuffer(),B.bindBuffer(ct.type,ct.buffer),B.bufferData(ct.type,ct.persistentData||ct.byteLength,ct.usage)})}return Ue.profile&&(me.getTotalBufferSize=function(){var ct=0;return Object.keys(Ft).forEach(function(Vt){ct+=Ft[Vt].stats.size}),ct}),{create:xr,createStream:De,destroyStream:Sr,clear:function(){Q(Ft).forEach(Zr),pr.forEach(Zr)},getBuffer:function(ct){return ct&&ct._buffer instanceof Ye?ct._buffer:null},restore:Pr,_initBuffer:Rr}}var R=0,K=0,xe=1,qe=1,pt=4,vt=4,cr={points:R,point:K,lines:xe,line:qe,triangles:pt,triangle:vt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},_r=0,Pn=1,ci=4,Jn=5120,Hi=5121,sa=5122,Ca=5123,Zi=5124,Co=5125,xs=34963,gl=35040,af=35044;function Ju(B,me,Ue,Nt){var or={},Ft=0,Ye={uint8:Hi,uint16:Ca};me.oes_element_index_uint&&(Ye.uint32=Co);function pr(Pr){this.id=Ft++,or[this.id]=this,this.buffer=Pr,this.primType=ci,this.vertCount=0,this.type=0}pr.prototype.bind=function(){this.buffer.bind()};var De=[];function Sr(Pr){var ct=De.pop();return ct||(ct=new pr(Ue.create(null,xs,!0,!1)._buffer)),Rr(ct,Pr,gl,-1,-1,0,0),ct}function Or(Pr){De.push(Pr)}function Rr(Pr,ct,Vt,Cr,zr,hr,Lr){Pr.buffer.bind();var Kr;if(ct){var Bn=Lr;!Lr&&(!ye(ct)||ks(ct)&&!ye(ct.data))&&(Bn=me.oes_element_index_uint?Co:Ca),Ue._initBuffer(Pr.buffer,ct,Vt,Bn,3)}else B.bufferData(xs,hr,Vt),Pr.buffer.dtype=Kr||Hi,Pr.buffer.usage=Vt,Pr.buffer.dimension=3,Pr.buffer.byteLength=hr;if(Kr=Lr,!Lr){switch(Pr.buffer.dtype){case Hi:case Jn:Kr=Hi;break;case Ca:case sa:Kr=Ca;break;case Co:case Zi:Kr=Co;break;default:de.raise("unsupported type for element array")}Pr.buffer.dtype=Kr}Pr.type=Kr,de(Kr!==Co||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var rr=zr;rr<0&&(rr=Pr.buffer.byteLength,Kr===Ca?rr>>=1:Kr===Co&&(rr>>=2)),Pr.vertCount=rr;var ar=Cr;if(Cr<0){ar=ci;var _n=Pr.buffer.dimension;_n===1&&(ar=_r),_n===2&&(ar=Pn),_n===3&&(ar=ci)}Pr.primType=ar}function Zr(Pr){Nt.elementsCount--,de(Pr.buffer!==null,"must not double destroy elements"),delete or[Pr.id],Pr.buffer.destroy(),Pr.buffer=null}function xr(Pr,ct){var Vt=Ue.create(null,xs,!0),Cr=new pr(Vt._buffer);Nt.elementsCount++;function zr(hr){if(!hr)Vt(),Cr.primType=ci,Cr.vertCount=0,Cr.type=Hi;else if(typeof hr=="number")Vt(hr),Cr.primType=ci,Cr.vertCount=hr|0,Cr.type=Hi;else{var Lr=null,Kr=af,Bn=-1,rr=-1,ar=0,_n=0;Array.isArray(hr)||ye(hr)||ks(hr)?Lr=hr:(de.type(hr,"object","invalid arguments for elements"),"data"in hr&&(Lr=hr.data,de(Array.isArray(Lr)||ye(Lr)||ks(Lr),"invalid data for element buffer")),"usage"in hr&&(de.parameter(hr.usage,ho,"invalid element buffer usage"),Kr=ho[hr.usage]),"primitive"in hr&&(de.parameter(hr.primitive,cr,"invalid element buffer primitive"),Bn=cr[hr.primitive]),"count"in hr&&(de(typeof hr.count=="number"&&hr.count>=0,"invalid vertex count for elements"),rr=hr.count|0),"type"in hr&&(de.parameter(hr.type,Ye,"invalid buffer type"),_n=Ye[hr.type]),"length"in hr?ar=hr.length|0:(ar=rr,_n===Ca||_n===sa?ar*=2:(_n===Co||_n===Zi)&&(ar*=4))),Rr(Cr,Lr,Kr,Bn,rr,ar,_n)}return zr}return zr(Pr),zr._reglType="elements",zr._elements=Cr,zr.subdata=function(hr,Lr){return Vt.subdata(hr,Lr),zr},zr.destroy=function(){Zr(Cr)},zr}return{create:xr,createStream:Sr,destroyStream:Or,getElements:function(Pr){return typeof Pr=="function"&&Pr._elements instanceof pr?Pr._elements:null},clear:function(){Q(or).forEach(Zr)}}}var Lc=new Float32Array(1),Ou=new Uint32Array(Lc.buffer),yu=5123;function vo(B){for(var me=Rt.allocType(yu,B.length),Ue=0;Ue<B.length;++Ue)if(isNaN(B[Ue]))me[Ue]=65535;else if(B[Ue]===Infinity)me[Ue]=31744;else if(B[Ue]===-Infinity)me[Ue]=64512;else{Lc[0]=B[Ue];var Nt=Ou[0],or=Nt>>>31<<15,Ft=(Nt<<1>>>24)-127,Ye=Nt>>13&(1<<10)-1;if(Ft<-24)me[Ue]=or;else if(Ft<-14){var pr=-14-Ft;me[Ue]=or+(Ye+(1<<10)>>pr)}else Ft>15?me[Ue]=or+31744:me[Ue]=or+(Ft+15<<10)+Ye}return me}function ua(B){return Array.isArray(B)||ye(B)}var Eh=function(B){return!(B&B-1)&&!!B},Sh=34467,ro=3553,Xf=34067,_u=34069,Ds=6408,kc=6406,yl=6407,_a=6409,Ll=6410,ac=32854,ts=32855,Yf=36194,Ch=32819,Ah=32820,of=33635,_l=34042,Do=6402,Ru=34041,el=35904,Fo=35906,kl=36193,tl=33776,qs=33777,sf=33778,uf=33779,lf=35986,rl=35987,oc=34798,Dc=35840,cf=35841,Fc=35842,wh=35843,Bc=36196,xl=5121,ff=5123,hf=5125,Lu=5126,pf=10242,qf=10243,Th=10497,Dl=33071,sp=33648,rs=10240,ja=10241,sc=9728,Fl=9729,lu=9984,Li=9985,Ma=9986,Fs=9987,df=33170,bl=4352,vf=4353,up=4354,lp=34046,Nc=3317,uc=37440,nl=37441,Ao=37443,lc=37444,cc=33984,Xa=[lu,Ma,Li,Fs],mn=[0,_a,Ll,yl,Ds],eo={};eo[_a]=eo[kc]=eo[Do]=1,eo[Ru]=eo[Ll]=2,eo[yl]=eo[el]=3,eo[Ds]=eo[Fo]=4;function il(B){return"[object "+B+"]"}var al=il("HTMLCanvasElement"),xu=il("OffscreenCanvas"),Bs=il("CanvasRenderingContext2D"),Kf=il("ImageBitmap"),qr=il("HTMLImageElement"),mf=il("HTMLVideoElement"),$f=Object.keys(qi).concat([al,xu,Bs,Kf,qr,mf]),ku=[];ku[xl]=1,ku[Lu]=4,ku[kl]=2,ku[ff]=2,ku[hf]=4;var Fa=[];Fa[ac]=2,Fa[ts]=2,Fa[Yf]=2,Fa[Ru]=4,Fa[tl]=.5,Fa[qs]=.5,Fa[sf]=1,Fa[uf]=1,Fa[lf]=.5,Fa[rl]=1,Fa[oc]=1,Fa[Dc]=.5,Fa[cf]=.25,Fa[Fc]=.5,Fa[wh]=.25,Fa[Bc]=.5;function Ns(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function gf(B){if(!Array.isArray(B))return!1;var me=B.length;return!(me===0||!ua(B[0]))}function Du(B){return Object.prototype.toString.call(B)}function ws(B){return Du(B)===al}function mo(B){return Du(B)===xu}function Mh(B){return Du(B)===Bs}function pa(B){return Du(B)===Kf}function Qf(B){return Du(B)===qr}function Ph(B){return Du(B)===mf}function Ks(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&B.getContext)}function Ts(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&"src"in B&&"crossOrigin"in B)}function Pi(B){if(!B)return!1;if(Ks(B)||Ts(B))return!0;var me=Du(B);return $f.indexOf(me)>=0?!0:Ns(B)||gf(B)||ks(B)}function bu(B){return qi[Object.prototype.toString.call(B)]|0}function la(B,me){var Ue=me.length;switch(B.type){case xl:case ff:case hf:case Lu:var Nt=Rt.allocType(B.type,Ue);Nt.set(me),B.data=Nt;break;case kl:B.data=vo(me);break;default:de.raise("unsupported texture type, must specify a typed array")}}function no(B,me){return Rt.allocType(B.type===kl?Lu:B.type,me)}function zs(B,me){B.type===kl?(B.data=vo(me),Rt.freeType(me)):B.data=me}function cu(B,me,Ue,Nt,or,Ft){for(var Ye=B.width,pr=B.height,De=B.channels,Sr=Ye*pr*De,Or=no(B,Sr),Rr=0,Zr=0;Zr<pr;++Zr)for(var xr=0;xr<Ye;++xr)for(var Pr=0;Pr<De;++Pr)Or[Rr++]=me[Ue*xr+Nt*Zr+or*Pr+Ft];zs(B,Or)}function Us(B,me,Ue,Nt,or,Ft){var Ye;if(typeof Fa[B]!="undefined"?Ye=Fa[B]:Ye=eo[B]*ku[me],Ft&&(Ye*=6),or){for(var pr=0,De=Ue;De>=1;)pr+=Ye*De*De,De/=2;return pr}else return Ye*Ue*Nt}function hs(B,me,Ue,Nt,or,Ft,Ye){var pr={"don't care":bl,"dont care":bl,nice:up,fast:vf},De={repeat:Th,clamp:Dl,mirror:sp},Sr={nearest:sc,linear:Fl},Or=m({mipmap:Fs,"nearest mipmap nearest":lu,"linear mipmap nearest":Li,"nearest mipmap linear":Ma,"linear mipmap linear":Fs},Sr),Rr={none:0,browser:lc},Zr={uint8:xl,rgba4:Ch,rgb565:of,"rgb5 a1":Ah},xr={alpha:kc,luminance:_a,"luminance alpha":Ll,rgb:yl,rgba:Ds,rgba4:ac,"rgb5 a1":ts,rgb565:Yf},Pr={};me.ext_srgb&&(xr.srgb=el,xr.srgba=Fo),me.oes_texture_float&&(Zr.float32=Zr.float=Lu),me.oes_texture_half_float&&(Zr.float16=Zr["half float"]=kl),me.webgl_depth_texture&&(m(xr,{depth:Do,"depth stencil":Ru}),m(Zr,{uint16:ff,uint32:hf,"depth stencil":_l})),me.webgl_compressed_texture_s3tc&&m(Pr,{"rgb s3tc dxt1":tl,"rgba s3tc dxt1":qs,"rgba s3tc dxt3":sf,"rgba s3tc dxt5":uf}),me.webgl_compressed_texture_atc&&m(Pr,{"rgb atc":lf,"rgba atc explicit alpha":rl,"rgba atc interpolated alpha":oc}),me.webgl_compressed_texture_pvrtc&&m(Pr,{"rgb pvrtc 4bppv1":Dc,"rgb pvrtc 2bppv1":cf,"rgba pvrtc 4bppv1":Fc,"rgba pvrtc 2bppv1":wh}),me.webgl_compressed_texture_etc1&&(Pr["rgb etc1"]=Bc);var ct=Array.prototype.slice.call(B.getParameter(Sh)||new Uint32Array(0));Object.keys(Pr).forEach(function(Me){var Ut=Pr[Me];ct.indexOf(Ut)>=0&&(xr[Me]=Ut)});var Vt=Object.keys(xr);Ue.textureFormats=Vt;var Cr=[];Object.keys(xr).forEach(function(Me){var Ut=xr[Me];Cr[Ut]=Me});var zr=[];Object.keys(Zr).forEach(function(Me){var Ut=Zr[Me];zr[Ut]=Me});var hr=[];Object.keys(Sr).forEach(function(Me){var Ut=Sr[Me];hr[Ut]=Me});var Lr=[];Object.keys(Or).forEach(function(Me){var Ut=Or[Me];Lr[Ut]=Me});var Kr=[];Object.keys(De).forEach(function(Me){var Ut=De[Me];Kr[Ut]=Me});var Bn=Vt.reduce(function(Me,Ut){var wt=xr[Ut];return wt===_a||wt===kc||wt===_a||wt===Ll||wt===Do||wt===Ru||me.ext_srgb&&(wt===el||wt===Fo)?Me[wt]=wt:wt===ts||Ut.indexOf("rgba")>=0?Me[wt]=Ds:Me[wt]=yl,Me},{});function rr(){this.internalformat=Ds,this.format=Ds,this.type=xl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=lc,this.width=0,this.height=0,this.channels=0}function ar(Me,Ut){Me.internalformat=Ut.internalformat,Me.format=Ut.format,Me.type=Ut.type,Me.compressed=Ut.compressed,Me.premultiplyAlpha=Ut.premultiplyAlpha,Me.flipY=Ut.flipY,Me.unpackAlignment=Ut.unpackAlignment,Me.colorSpace=Ut.colorSpace,Me.width=Ut.width,Me.height=Ut.height,Me.channels=Ut.channels}function _n(Me,Ut){if(!(typeof Ut!="object"||!Ut)){if("premultiplyAlpha"in Ut&&(de.type(Ut.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Me.premultiplyAlpha=Ut.premultiplyAlpha),"flipY"in Ut&&(de.type(Ut.flipY,"boolean","invalid texture flip"),Me.flipY=Ut.flipY),"alignment"in Ut&&(de.oneOf(Ut.alignment,[1,2,4,8],"invalid texture unpack alignment"),Me.unpackAlignment=Ut.alignment),"colorSpace"in Ut&&(de.parameter(Ut.colorSpace,Rr,"invalid colorSpace"),Me.colorSpace=Rr[Ut.colorSpace]),"type"in Ut){var wt=Ut.type;de(me.oes_texture_float||!(wt==="float"||wt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),de(me.oes_texture_half_float||!(wt==="half float"||wt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),de(me.webgl_depth_texture||!(wt==="uint16"||wt==="uint32"||wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(wt,Zr,"invalid texture type"),Me.type=Zr[wt]}var cn=Me.width,Ni=Me.height,Se=Me.channels,re=!1;"shape"in Ut?(de(Array.isArray(Ut.shape)&&Ut.shape.length>=2,"shape must be an array"),cn=Ut.shape[0],Ni=Ut.shape[1],Ut.shape.length===3&&(Se=Ut.shape[2],de(Se>0&&Se<=4,"invalid number of channels"),re=!0),de(cn>=0&&cn<=Ue.maxTextureSize,"invalid width"),de(Ni>=0&&Ni<=Ue.maxTextureSize,"invalid height")):("radius"in Ut&&(cn=Ni=Ut.radius,de(cn>=0&&cn<=Ue.maxTextureSize,"invalid radius")),"width"in Ut&&(cn=Ut.width,de(cn>=0&&cn<=Ue.maxTextureSize,"invalid width")),"height"in Ut&&(Ni=Ut.height,de(Ni>=0&&Ni<=Ue.maxTextureSize,"invalid height")),"channels"in Ut&&(Se=Ut.channels,de(Se>0&&Se<=4,"invalid number of channels"),re=!0)),Me.width=cn|0,Me.height=Ni|0,Me.channels=Se|0;var Ve=!1;if("format"in Ut){var ft=Ut.format;de(me.webgl_depth_texture||!(ft==="depth"||ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(ft,xr,"invalid texture format");var kt=Me.internalformat=xr[ft];Me.format=Bn[kt],ft in Zr&&("type"in Ut||(Me.type=Zr[ft])),ft in Pr&&(Me.compressed=!0),Ve=!0}!re&&Ve?Me.channels=eo[Me.format]:re&&!Ve?Me.channels!==mn[Me.format]&&(Me.format=Me.internalformat=mn[Me.channels]):Ve&&re&&de(Me.channels===eo[Me.format],"number of channels inconsistent with specified format")}}function Gr(Me){B.pixelStorei(uc,Me.flipY),B.pixelStorei(nl,Me.premultiplyAlpha),B.pixelStorei(Ao,Me.colorSpace),B.pixelStorei(Nc,Me.unpackAlignment)}function Ar(){rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function $r(Me,Ut){var wt=null;if(Pi(Ut)?wt=Ut:Ut&&(de.type(Ut,"object","invalid pixel data type"),_n(Me,Ut),"x"in Ut&&(Me.xOffset=Ut.x|0),"y"in Ut&&(Me.yOffset=Ut.y|0),Pi(Ut.data)&&(wt=Ut.data)),de(!Me.compressed||wt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ut.copy){de(!wt,"can not specify copy and data field for the same texture");var cn=or.viewportWidth,Ni=or.viewportHeight;Me.width=Me.width||cn-Me.xOffset,Me.height=Me.height||Ni-Me.yOffset,Me.needsCopy=!0,de(Me.xOffset>=0&&Me.xOffset<cn&&Me.yOffset>=0&&Me.yOffset<Ni&&Me.width>0&&Me.width<=cn&&Me.height>0&&Me.height<=Ni,"copy texture read out of bounds")}else if(!wt)Me.width=Me.width||1,Me.height=Me.height||1,Me.channels=Me.channels||4;else if(ye(wt))Me.channels=Me.channels||4,Me.data=wt,!("type"in Ut)&&Me.type===xl&&(Me.type=bu(wt));else if(Ns(wt))Me.channels=Me.channels||4,la(Me,wt),Me.alignment=1,Me.needsFree=!0;else if(ks(wt)){var Se=wt.data;!Array.isArray(Se)&&Me.type===xl&&(Me.type=bu(Se));var re=wt.shape,Ve=wt.stride,ft,kt,$e,Ne,ot,_e;re.length===3?($e=re[2],_e=Ve[2]):(de(re.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$e=1,_e=1),ft=re[0],kt=re[1],Ne=Ve[0],ot=Ve[1],Me.alignment=1,Me.width=ft,Me.height=kt,Me.channels=$e,Me.format=Me.internalformat=mn[$e],Me.needsFree=!0,cu(Me,Se,Ne,ot,_e,wt.offset)}else if(Ks(wt)||ws(wt)||mo(wt)||Mh(wt))Ks(wt)||ws(wt)||mo(wt)?Me.element=wt:Me.element=wt.canvas,Me.width=Me.element.width,Me.height=Me.element.height,Me.channels=4;else if(pa(wt))Me.element=wt,Me.width=wt.width,Me.height=wt.height,Me.channels=4;else if(Qf(wt))Me.element=wt,Me.width=wt.naturalWidth,Me.height=wt.naturalHeight,Me.channels=4;else if(Ts(wt))Me.element=wt,Me.width=wt.width,Me.height=wt.height,Me.channels=4;else if(Ph(wt))Me.element=wt,Me.width=wt.videoWidth,Me.height=wt.videoHeight,Me.channels=4;else if(gf(wt)){var je=Me.width||wt[0].length,Ae=Me.height||wt.length,dt=Me.channels;ua(wt[0][0])?dt=dt||wt[0][0].length:dt=dt||1;for(var Tt=be.shape(wt),dr=1,Nr=0;Nr<Tt.length;++Nr)dr*=Tt[Nr];var Ur=no(Me,dr);be.flatten(wt,Tt,"",Ur),zs(Me,Ur),Me.alignment=1,Me.width=je,Me.height=Ae,Me.channels=dt,Me.format=Me.internalformat=mn[dt],Me.needsFree=!0}Me.type===Lu?de(Ue.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Me.type===kl&&de(Ue.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Jr(Me,Ut,wt){var cn=Me.element,Ni=Me.data,Se=Me.internalformat,re=Me.format,Ve=Me.type,ft=Me.width,kt=Me.height;Gr(Me),cn?B.texImage2D(Ut,wt,re,re,Ve,cn):Me.compressed?B.compressedTexImage2D(Ut,wt,Se,ft,kt,0,Ni):Me.needsCopy?(Nt(),B.copyTexImage2D(Ut,wt,re,Me.xOffset,Me.yOffset,ft,kt,0)):B.texImage2D(Ut,wt,re,ft,kt,0,re,Ve,Ni||null)}function di(Me,Ut,wt,cn,Ni){var Se=Me.element,re=Me.data,Ve=Me.internalformat,ft=Me.format,kt=Me.type,$e=Me.width,Ne=Me.height;Gr(Me),Se?B.texSubImage2D(Ut,Ni,wt,cn,ft,kt,Se):Me.compressed?B.compressedTexSubImage2D(Ut,Ni,wt,cn,Ve,$e,Ne,re):Me.needsCopy?(Nt(),B.copyTexSubImage2D(Ut,Ni,wt,cn,Me.xOffset,Me.yOffset,$e,Ne)):B.texSubImage2D(Ut,Ni,wt,cn,$e,Ne,ft,kt,re)}var ni=[];function Wr(){return ni.pop()||new Ar}function on(Me){Me.needsFree&&Rt.freeType(Me.data),Ar.call(Me),ni.push(Me)}function Qn(){rr.call(this),this.genMipmaps=!1,this.mipmapHint=bl,this.mipmask=0,this.images=Array(16)}function fi(Me,Ut,wt){var cn=Me.images[0]=Wr();Me.mipmask=1,cn.width=Me.width=Ut,cn.height=Me.height=wt,cn.channels=Me.channels=4}function Fi(Me,Ut){var wt=null;if(Pi(Ut))wt=Me.images[0]=Wr(),ar(wt,Me),$r(wt,Ut),Me.mipmask=1;else if(_n(Me,Ut),Array.isArray(Ut.mipmap))for(var cn=Ut.mipmap,Ni=0;Ni<cn.length;++Ni)wt=Me.images[Ni]=Wr(),ar(wt,Me),wt.width>>=Ni,wt.height>>=Ni,$r(wt,cn[Ni]),Me.mipmask|=1<<Ni;else wt=Me.images[0]=Wr(),ar(wt,Me),$r(wt,Ut),Me.mipmask=1;ar(Me,Me.images[0]),Me.compressed&&(Me.internalformat===tl||Me.internalformat===qs||Me.internalformat===sf||Me.internalformat===uf)&&de(Me.width%4==0&&Me.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ya(Me,Ut){for(var wt=Me.images,cn=0;cn<wt.length;++cn){if(!wt[cn])return;Jr(wt[cn],Ut,cn)}}var io=[];function Bi(){var Me=io.pop()||new Qn;rr.call(Me),Me.mipmask=0;for(var Ut=0;Ut<16;++Ut)Me.images[Ut]=null;return Me}function as(Me){for(var Ut=Me.images,wt=0;wt<Ut.length;++wt)Ut[wt]&&on(Ut[wt]),Ut[wt]=null;io.push(Me)}function Ba(){this.minFilter=sc,this.magFilter=sc,this.wrapS=Dl,this.wrapT=Dl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=bl}function Zo(Me,Ut){if("min"in Ut){var wt=Ut.min;de.parameter(wt,Or),Me.minFilter=Or[wt],Xa.indexOf(Me.minFilter)>=0&&!("faces"in Ut)&&(Me.genMipmaps=!0)}if("mag"in Ut){var cn=Ut.mag;de.parameter(cn,Sr),Me.magFilter=Sr[cn]}var Ni=Me.wrapS,Se=Me.wrapT;if("wrap"in Ut){var re=Ut.wrap;typeof re=="string"?(de.parameter(re,De),Ni=Se=De[re]):Array.isArray(re)&&(de.parameter(re[0],De),de.parameter(re[1],De),Ni=De[re[0]],Se=De[re[1]])}else{if("wrapS"in Ut){var Ve=Ut.wrapS;de.parameter(Ve,De),Ni=De[Ve]}if("wrapT"in Ut){var ft=Ut.wrapT;de.parameter(ft,De),Se=De[ft]}}if(Me.wrapS=Ni,Me.wrapT=Se,"anisotropic"in Ut){var kt=Ut.anisotropic;de(typeof kt=="number"&&kt>=1&&kt<=Ue.maxAnisotropic,"aniso samples must be between 1 and "),Me.anisotropic=Ut.anisotropic}if("mipmap"in Ut){var $e=!1;switch(typeof Ut.mipmap){case"string":de.parameter(Ut.mipmap,pr,"invalid mipmap hint"),Me.mipmapHint=pr[Ut.mipmap],Me.genMipmaps=!0,$e=!0;break;case"boolean":$e=Me.genMipmaps=Ut.mipmap;break;case"object":de(Array.isArray(Ut.mipmap),"invalid mipmap type"),Me.genMipmaps=!1,$e=!0;break;default:de.raise("invalid mipmap type")}$e&&!("min"in Ut)&&(Me.minFilter=lu)}}function _o(Me,Ut){B.texParameteri(Ut,ja,Me.minFilter),B.texParameteri(Ut,rs,Me.magFilter),B.texParameteri(Ut,pf,Me.wrapS),B.texParameteri(Ut,qf,Me.wrapT),me.ext_texture_filter_anisotropic&&B.texParameteri(Ut,lp,Me.anisotropic),Me.genMipmaps&&(B.hint(df,Me.mipmapHint),B.generateMipmap(Ut))}var jo=0,Po={},vs=Ue.maxTextureUnits,ao=Array(vs).map(function(){return null});function vi(Me){rr.call(this),this.mipmask=0,this.internalformat=Ds,this.id=jo++,this.refCount=1,this.target=Me,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ba,Ye.profile&&(this.stats={size:0})}function Io(Me){B.activeTexture(cc),B.bindTexture(Me.target,Me.texture)}function ji(){var Me=ao[0];Me?B.bindTexture(Me.target,Me.texture):B.bindTexture(ro,null)}function os(Me){var Ut=Me.texture;de(Ut,"must not double destroy texture");var wt=Me.unit,cn=Me.target;wt>=0&&(B.activeTexture(cc+wt),B.bindTexture(cn,null),ao[wt]=null),B.deleteTexture(Ut),Me.texture=null,Me.params=null,Me.pixels=null,Me.refCount=0,delete Po[Me.id],Ft.textureCount--}m(vi.prototype,{bind:function(){var Me=this;Me.bindCount+=1;var Ut=Me.unit;if(Ut<0){for(var wt=0;wt<vs;++wt){var cn=ao[wt];if(cn){if(cn.bindCount>0)continue;cn.unit=-1}ao[wt]=Me,Ut=wt;break}Ut>=vs&&de.raise("insufficient number of texture units"),Ye.profile&&Ft.maxTextureUnits<Ut+1&&(Ft.maxTextureUnits=Ut+1),Me.unit=Ut,B.activeTexture(cc+Ut),B.bindTexture(Me.target,Me.texture)}return Ut},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&os(this)}});function hn(Me,Ut){var wt=new vi(ro);Po[wt.id]=wt,Ft.textureCount++;function cn(re,Ve){var ft=wt.texInfo;Ba.call(ft);var kt=Bi();return typeof re=="number"?typeof Ve=="number"?fi(kt,re|0,Ve|0):fi(kt,re|0,re|0):re?(de.type(re,"object","invalid arguments to regl.texture"),Zo(ft,re),Fi(kt,re)):fi(kt,1,1),ft.genMipmaps&&(kt.mipmask=(kt.width<<1)-1),wt.mipmask=kt.mipmask,ar(wt,kt),de.texture2D(ft,kt,Ue),wt.internalformat=kt.internalformat,cn.width=kt.width,cn.height=kt.height,Io(wt),Ya(kt,ro),_o(ft,ro),ji(),as(kt),Ye.profile&&(wt.stats.size=Us(wt.internalformat,wt.type,kt.width,kt.height,ft.genMipmaps,!1)),cn.format=Cr[wt.internalformat],cn.type=zr[wt.type],cn.mag=hr[ft.magFilter],cn.min=Lr[ft.minFilter],cn.wrapS=Kr[ft.wrapS],cn.wrapT=Kr[ft.wrapT],cn}function Ni(re,Ve,ft,kt){de(!!re,"must specify image data");var $e=Ve|0,Ne=ft|0,ot=kt|0,_e=Wr();return ar(_e,wt),_e.width=0,_e.height=0,$r(_e,re),_e.width=_e.width||(wt.width>>ot)-$e,_e.height=_e.height||(wt.height>>ot)-Ne,de(wt.type===_e.type&&wt.format===_e.format&&wt.internalformat===_e.internalformat,"incompatible format for texture.subimage"),de($e>=0&&Ne>=0&&$e+_e.width<=wt.width&&Ne+_e.height<=wt.height,"texture.subimage write out of bounds"),de(wt.mipmask&1<<ot,"missing mipmap data"),de(_e.data||_e.element||_e.needsCopy,"missing image data"),Io(wt),di(_e,ro,$e,Ne,ot),ji(),on(_e),cn}function Se(re,Ve){var ft=re|0,kt=Ve|0||ft;if(ft===wt.width&&kt===wt.height)return cn;cn.width=wt.width=ft,cn.height=wt.height=kt,Io(wt);for(var $e=0;wt.mipmask>>$e;++$e){var Ne=ft>>$e,ot=kt>>$e;if(!Ne||!ot)break;B.texImage2D(ro,$e,wt.format,Ne,ot,0,wt.format,wt.type,null)}return ji(),Ye.profile&&(wt.stats.size=Us(wt.internalformat,wt.type,ft,kt,!1,!1)),cn}return cn(Me,Ut),cn.subimage=Ni,cn.resize=Se,cn._reglType="texture2d",cn._texture=wt,Ye.profile&&(cn.stats=wt.stats),cn.destroy=function(){wt.decRef()},cn}function mi(Me,Ut,wt,cn,Ni,Se){var re=new vi(Xf);Po[re.id]=re,Ft.cubeCount++;var Ve=new Array(6);function ft(Ne,ot,_e,je,Ae,dt){var Tt,dr=re.texInfo;for(Ba.call(dr),Tt=0;Tt<6;++Tt)Ve[Tt]=Bi();if(typeof Ne=="number"||!Ne){var Nr=Ne|0||1;for(Tt=0;Tt<6;++Tt)fi(Ve[Tt],Nr,Nr)}else if(typeof Ne=="object")if(ot)Fi(Ve[0],Ne),Fi(Ve[1],ot),Fi(Ve[2],_e),Fi(Ve[3],je),Fi(Ve[4],Ae),Fi(Ve[5],dt);else if(Zo(dr,Ne),_n(re,Ne),"faces"in Ne){var Ur=Ne.faces;for(de(Array.isArray(Ur)&&Ur.length===6,"cube faces must be a length 6 array"),Tt=0;Tt<6;++Tt)de(typeof Ur[Tt]=="object"&&!!Ur[Tt],"invalid input for cube map face"),ar(Ve[Tt],re),Fi(Ve[Tt],Ur[Tt])}else for(Tt=0;Tt<6;++Tt)Fi(Ve[Tt],Ne);else de.raise("invalid arguments to cube map");for(ar(re,Ve[0]),de.optional(function(){Ue.npotTextureCube||de(Eh(re.width)&&Eh(re.height),"your browser does not support non power or two texture dimensions")}),dr.genMipmaps?re.mipmask=(Ve[0].width<<1)-1:re.mipmask=Ve[0].mipmask,de.textureCube(re,dr,Ve,Ue),re.internalformat=Ve[0].internalformat,ft.width=Ve[0].width,ft.height=Ve[0].height,Io(re),Tt=0;Tt<6;++Tt)Ya(Ve[Tt],_u+Tt);for(_o(dr,Xf),ji(),Ye.profile&&(re.stats.size=Us(re.internalformat,re.type,ft.width,ft.height,dr.genMipmaps,!0)),ft.format=Cr[re.internalformat],ft.type=zr[re.type],ft.mag=hr[dr.magFilter],ft.min=Lr[dr.minFilter],ft.wrapS=Kr[dr.wrapS],ft.wrapT=Kr[dr.wrapT],Tt=0;Tt<6;++Tt)as(Ve[Tt]);return ft}function kt(Ne,ot,_e,je,Ae){de(!!ot,"must specify image data"),de(typeof Ne=="number"&&Ne===(Ne|0)&&Ne>=0&&Ne<6,"invalid face");var dt=_e|0,Tt=je|0,dr=Ae|0,Nr=Wr();return ar(Nr,re),Nr.width=0,Nr.height=0,$r(Nr,ot),Nr.width=Nr.width||(re.width>>dr)-dt,Nr.height=Nr.height||(re.height>>dr)-Tt,de(re.type===Nr.type&&re.format===Nr.format&&re.internalformat===Nr.internalformat,"incompatible format for texture.subimage"),de(dt>=0&&Tt>=0&&dt+Nr.width<=re.width&&Tt+Nr.height<=re.height,"texture.subimage write out of bounds"),de(re.mipmask&1<<dr,"missing mipmap data"),de(Nr.data||Nr.element||Nr.needsCopy,"missing image data"),Io(re),di(Nr,_u+Ne,dt,Tt,dr),ji(),on(Nr),ft}function $e(Ne){var ot=Ne|0;if(ot!==re.width){ft.width=re.width=ot,ft.height=re.height=ot,Io(re);for(var _e=0;_e<6;++_e)for(var je=0;re.mipmask>>je;++je)B.texImage2D(_u+_e,je,re.format,ot>>je,ot>>je,0,re.format,re.type,null);return ji(),Ye.profile&&(re.stats.size=Us(re.internalformat,re.type,ft.width,ft.height,!1,!0)),ft}}return ft(Me,Ut,wt,cn,Ni,Se),ft.subimage=kt,ft.resize=$e,ft._reglType="textureCube",ft._texture=re,Ye.profile&&(ft.stats=re.stats),ft.destroy=function(){re.decRef()},ft}function ca(){for(var Me=0;Me<vs;++Me)B.activeTexture(cc+Me),B.bindTexture(ro,null),ao[Me]=null;Q(Po).forEach(os),Ft.cubeCount=0,Ft.textureCount=0}Ye.profile&&(Ft.getTotalTextureSize=function(){var Me=0;return Object.keys(Po).forEach(function(Ut){Me+=Po[Ut].stats.size}),Me});function xo(){for(var Me=0;Me<vs;++Me){var Ut=ao[Me];Ut&&(Ut.bindCount=0,Ut.unit=-1,ao[Me]=null)}Q(Po).forEach(function(wt){wt.texture=B.createTexture(),B.bindTexture(wt.target,wt.texture);for(var cn=0;cn<32;++cn)if((wt.mipmask&1<<cn)!=0)if(wt.target===ro)B.texImage2D(ro,cn,wt.internalformat,wt.width>>cn,wt.height>>cn,0,wt.internalformat,wt.type,null);else for(var Ni=0;Ni<6;++Ni)B.texImage2D(_u+Ni,cn,wt.internalformat,wt.width>>cn,wt.height>>cn,0,wt.internalformat,wt.type,null);_o(wt.texInfo,wt.target)})}function pl(){for(var Me=0;Me<vs;++Me){var Ut=ao[Me];Ut&&(Ut.bindCount=0,Ut.unit=-1,ao[Me]=null),B.activeTexture(cc+Me),B.bindTexture(ro,null),B.bindTexture(Xf,null)}}return{create2D:hn,createCube:mi,clear:ca,getTexture:function(Me){return null},restore:xo,refresh:pl}}var Zs=36161,In=32854,An=32855,fc=36194,ps=33189,Eu=36168,Ko=34041,xa=35907,yf=34836,zc=34842,ia=34843,La=[];La[In]=2,La[An]=2,La[fc]=2,La[ps]=2,La[Eu]=1,La[Ko]=4,La[xa]=4,La[yf]=16,La[zc]=8,La[ia]=6;function Jf(B,me,Ue){return La[B]*me*Ue}var ol=function(B,me,Ue,Nt,or){var Ft={rgba4:In,rgb565:fc,"rgb5 a1":An,depth:ps,stencil:Eu,"depth stencil":Ko};me.ext_srgb&&(Ft.srgba=xa),me.ext_color_buffer_half_float&&(Ft.rgba16f=zc,Ft.rgb16f=ia),me.webgl_color_buffer_float&&(Ft.rgba32f=yf);var Ye=[];Object.keys(Ft).forEach(function(xr){var Pr=Ft[xr];Ye[Pr]=xr});var pr=0,De={};function Sr(xr){this.id=pr++,this.refCount=1,this.renderbuffer=xr,this.format=In,this.width=0,this.height=0,or.profile&&(this.stats={size:0})}Sr.prototype.decRef=function(){--this.refCount<=0&&Or(this)};function Or(xr){var Pr=xr.renderbuffer;de(Pr,"must not double destroy renderbuffer"),B.bindRenderbuffer(Zs,null),B.deleteRenderbuffer(Pr),xr.renderbuffer=null,xr.refCount=0,delete De[xr.id],Nt.renderbufferCount--}function Rr(xr,Pr){var ct=new Sr(B.createRenderbuffer());De[ct.id]=ct,Nt.renderbufferCount++;function Vt(zr,hr){var Lr=0,Kr=0,Bn=In;if(typeof zr=="object"&&zr){var rr=zr;if("shape"in rr){var ar=rr.shape;de(Array.isArray(ar)&&ar.length>=2,"invalid renderbuffer shape"),Lr=ar[0]|0,Kr=ar[1]|0}else"radius"in rr&&(Lr=Kr=rr.radius|0),"width"in rr&&(Lr=rr.width|0),"height"in rr&&(Kr=rr.height|0);"format"in rr&&(de.parameter(rr.format,Ft,"invalid renderbuffer format"),Bn=Ft[rr.format])}else typeof zr=="number"?(Lr=zr|0,typeof hr=="number"?Kr=hr|0:Kr=Lr):zr?de.raise("invalid arguments to renderbuffer constructor"):Lr=Kr=1;if(de(Lr>0&&Kr>0&&Lr<=Ue.maxRenderbufferSize&&Kr<=Ue.maxRenderbufferSize,"invalid renderbuffer size"),!(Lr===ct.width&&Kr===ct.height&&Bn===ct.format))return Vt.width=ct.width=Lr,Vt.height=ct.height=Kr,ct.format=Bn,B.bindRenderbuffer(Zs,ct.renderbuffer),B.renderbufferStorage(Zs,Bn,Lr,Kr),de(B.getError()===0,"invalid render buffer format"),or.profile&&(ct.stats.size=Jf(ct.format,ct.width,ct.height)),Vt.format=Ye[ct.format],Vt}function Cr(zr,hr){var Lr=zr|0,Kr=hr|0||Lr;return Lr===ct.width&&Kr===ct.height||(de(Lr>0&&Kr>0&&Lr<=Ue.maxRenderbufferSize&&Kr<=Ue.maxRenderbufferSize,"invalid renderbuffer size"),Vt.width=ct.width=Lr,Vt.height=ct.height=Kr,B.bindRenderbuffer(Zs,ct.renderbuffer),B.renderbufferStorage(Zs,ct.format,Lr,Kr),de(B.getError()===0,"invalid render buffer format"),or.profile&&(ct.stats.size=Jf(ct.format,ct.width,ct.height))),Vt}return Vt(xr,Pr),Vt.resize=Cr,Vt._reglType="renderbuffer",Vt._renderbuffer=ct,or.profile&&(Vt.stats=ct.stats),Vt.destroy=function(){ct.decRef()},Vt}or.profile&&(Nt.getTotalRenderbufferSize=function(){var xr=0;return Object.keys(De).forEach(function(Pr){xr+=De[Pr].stats.size}),xr});function Zr(){Q(De).forEach(function(xr){xr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Zs,xr.renderbuffer),B.renderbufferStorage(Zs,xr.format,xr.width,xr.height)}),B.bindRenderbuffer(Zs,null)}return{create:Rr,clear:function(){Q(De).forEach(Or)},restore:Zr}},$s=36160,Su=36161,wo=3553,sl=34069,Cu=36064,El=36096,ul=36128,hc=33306,_f=36053,Sl=36054,Cl=36055,Ih=36057,Al=36061,Bl=36193,xf=5121,Fu=5126,bs=6407,bf=6408,pc=6402,Oh=[bs,bf],Nl=[];Nl[bf]=4,Nl[bs]=3;var l=[];l[xf]=1,l[Fu]=4,l[Bl]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,M=34041,L=35907,U=34836,X=34842,se=34843,he=[h,c,d,L,X,se,U],pe={};pe[_f]="complete",pe[Sl]="incomplete attachment",pe[Ih]="incomplete dimensions",pe[Cl]="incomplete, missing attachment",pe[Al]="unsupported";function Le(B,me,Ue,Nt,or,Ft){var Ye={cur:null,next:null,dirty:!1,setFBO:null},pr=["rgba"],De=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&De.push("srgba"),me.ext_color_buffer_half_float&&De.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&De.push("rgba32f");var Sr=["uint8"];me.oes_texture_half_float&&Sr.push("half float","float16"),me.oes_texture_float&&Sr.push("float","float32");function Or(Ar,$r,Jr){this.target=Ar,this.texture=$r,this.renderbuffer=Jr;var di=0,ni=0;$r?(di=$r.width,ni=$r.height):Jr&&(di=Jr.width,ni=Jr.height),this.width=di,this.height=ni}function Rr(Ar){Ar&&(Ar.texture&&Ar.texture._texture.decRef(),Ar.renderbuffer&&Ar.renderbuffer._renderbuffer.decRef())}function Zr(Ar,$r,Jr){if(!!Ar)if(Ar.texture){var di=Ar.texture._texture,ni=Math.max(1,di.width),Wr=Math.max(1,di.height);de(ni===$r&&Wr===Jr,"inconsistent width/height for supplied texture"),di.refCount+=1}else{var on=Ar.renderbuffer._renderbuffer;de(on.width===$r&&on.height===Jr,"inconsistent width/height for renderbuffer"),on.refCount+=1}}function xr(Ar,$r){$r&&($r.texture?B.framebufferTexture2D($s,Ar,$r.target,$r.texture._texture.texture,0):B.framebufferRenderbuffer($s,Ar,Su,$r.renderbuffer._renderbuffer.renderbuffer))}function Pr(Ar){var $r=wo,Jr=null,di=null,ni=Ar;typeof Ar=="object"&&(ni=Ar.data,"target"in Ar&&($r=Ar.target|0)),de.type(ni,"function","invalid attachment data");var Wr=ni._reglType;return Wr==="texture2d"?(Jr=ni,de($r===wo)):Wr==="textureCube"?(Jr=ni,de($r>=sl&&$r<sl+6,"invalid cube map target")):Wr==="renderbuffer"?(di=ni,$r=Su):de.raise("invalid regl object for attachment"),new Or($r,Jr,di)}function ct(Ar,$r,Jr,di,ni){if(Jr){var Wr=Nt.create2D({width:Ar,height:$r,format:di,type:ni});return Wr._texture.refCount=0,new Or(wo,Wr,null)}else{var on=or.create({width:Ar,height:$r,format:di});return on._renderbuffer.refCount=0,new Or(Su,null,on)}}function Vt(Ar){return Ar&&(Ar.texture||Ar.renderbuffer)}function Cr(Ar,$r,Jr){Ar&&(Ar.texture?Ar.texture.resize($r,Jr):Ar.renderbuffer&&Ar.renderbuffer.resize($r,Jr),Ar.width=$r,Ar.height=Jr)}var zr=0,hr={};function Lr(){this.id=zr++,hr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Kr(Ar){Ar.colorAttachments.forEach(Rr),Rr(Ar.depthAttachment),Rr(Ar.stencilAttachment),Rr(Ar.depthStencilAttachment)}function Bn(Ar){var $r=Ar.framebuffer;de($r,"must not double destroy framebuffer"),B.deleteFramebuffer($r),Ar.framebuffer=null,Ft.framebufferCount--,delete hr[Ar.id]}function rr(Ar){var $r;B.bindFramebuffer($s,Ar.framebuffer);var Jr=Ar.colorAttachments;for($r=0;$r<Jr.length;++$r)xr(Cu+$r,Jr[$r]);for($r=Jr.length;$r<Ue.maxColorAttachments;++$r)B.framebufferTexture2D($s,Cu+$r,wo,null,0);B.framebufferTexture2D($s,hc,wo,null,0),B.framebufferTexture2D($s,El,wo,null,0),B.framebufferTexture2D($s,ul,wo,null,0),xr(El,Ar.depthAttachment),xr(ul,Ar.stencilAttachment),xr(hc,Ar.depthStencilAttachment);var di=B.checkFramebufferStatus($s);!B.isContextLost()&&di!==_f&&de.raise("framebuffer configuration not supported, status = "+pe[di]),B.bindFramebuffer($s,Ye.next?Ye.next.framebuffer:null),Ye.cur=Ye.next,B.getError()}function ar(Ar,$r){var Jr=new Lr;Ft.framebufferCount++;function di(Wr,on){var Qn;de(Ye.next!==Jr,"can not update framebuffer which is currently in use");var fi=0,Fi=0,Ya=!0,io=!0,Bi=null,as=!0,Ba="rgba",Zo="uint8",_o=1,jo=null,Po=null,vs=null,ao=!1;if(typeof Wr=="number")fi=Wr|0,Fi=on|0||fi;else if(!Wr)fi=Fi=1;else{de.type(Wr,"object","invalid arguments for framebuffer");var vi=Wr;if("shape"in vi){var Io=vi.shape;de(Array.isArray(Io)&&Io.length>=2,"invalid shape for framebuffer"),fi=Io[0],Fi=Io[1]}else"radius"in vi&&(fi=Fi=vi.radius),"width"in vi&&(fi=vi.width),"height"in vi&&(Fi=vi.height);("color"in vi||"colors"in vi)&&(Bi=vi.color||vi.colors,Array.isArray(Bi)&&de(Bi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),Bi||("colorCount"in vi&&(_o=vi.colorCount|0,de(_o>0,"invalid color buffer count")),"colorTexture"in vi&&(as=!!vi.colorTexture,Ba="rgba4"),"colorType"in vi&&(Zo=vi.colorType,as?(de(me.oes_texture_float||!(Zo==="float"||Zo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),de(me.oes_texture_half_float||!(Zo==="half float"||Zo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Zo==="half float"||Zo==="float16"?(de(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ba="rgba16f"):(Zo==="float"||Zo==="float32")&&(de(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ba="rgba32f"),de.oneOf(Zo,Sr,"invalid color type")),"colorFormat"in vi&&(Ba=vi.colorFormat,pr.indexOf(Ba)>=0?as=!0:De.indexOf(Ba)>=0?as=!1:de.optional(function(){as?de.oneOf(vi.colorFormat,pr,"invalid color format for texture"):de.oneOf(vi.colorFormat,De,"invalid color format for renderbuffer")}))),("depthTexture"in vi||"depthStencilTexture"in vi)&&(ao=!!(vi.depthTexture||vi.depthStencilTexture),de(!ao||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in vi&&(typeof vi.depth=="boolean"?Ya=vi.depth:(jo=vi.depth,io=!1)),"stencil"in vi&&(typeof vi.stencil=="boolean"?io=vi.stencil:(Po=vi.stencil,Ya=!1)),"depthStencil"in vi&&(typeof vi.depthStencil=="boolean"?Ya=io=vi.depthStencil:(vs=vi.depthStencil,Ya=!1,io=!1))}var ji=null,os=null,hn=null,mi=null;if(Array.isArray(Bi))ji=Bi.map(Pr);else if(Bi)ji=[Pr(Bi)];else for(ji=new Array(_o),Qn=0;Qn<_o;++Qn)ji[Qn]=ct(fi,Fi,as,Ba,Zo);de(me.webgl_draw_buffers||ji.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),de(ji.length<=Ue.maxColorAttachments,"too many color attachments, not supported"),fi=fi||ji[0].width,Fi=Fi||ji[0].height,jo?os=Pr(jo):Ya&&!io&&(os=ct(fi,Fi,ao,"depth","uint32")),Po?hn=Pr(Po):io&&!Ya&&(hn=ct(fi,Fi,!1,"stencil","uint8")),vs?mi=Pr(vs):!jo&&!Po&&io&&Ya&&(mi=ct(fi,Fi,ao,"depth stencil","depth stencil")),de(!!jo+!!Po+!!vs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ca=null;for(Qn=0;Qn<ji.length;++Qn)if(Zr(ji[Qn],fi,Fi),de(!ji[Qn]||ji[Qn].texture&&Oh.indexOf(ji[Qn].texture._texture.format)>=0||ji[Qn].renderbuffer&&he.indexOf(ji[Qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Qn+" is invalid"),ji[Qn]&&ji[Qn].texture){var xo=Nl[ji[Qn].texture._texture.format]*l[ji[Qn].texture._texture.type];ca===null?ca=xo:de(ca===xo,"all color attachments much have the same number of bits per pixel.")}return Zr(os,fi,Fi),de(!os||os.texture&&os.texture._texture.format===pc||os.renderbuffer&&os.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Zr(hn,fi,Fi),de(!hn||hn.renderbuffer&&hn.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Zr(mi,fi,Fi),de(!mi||mi.texture&&mi.texture._texture.format===M||mi.renderbuffer&&mi.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),Kr(Jr),Jr.width=fi,Jr.height=Fi,Jr.colorAttachments=ji,Jr.depthAttachment=os,Jr.stencilAttachment=hn,Jr.depthStencilAttachment=mi,di.color=ji.map(Vt),di.depth=Vt(os),di.stencil=Vt(hn),di.depthStencil=Vt(mi),di.width=Jr.width,di.height=Jr.height,rr(Jr),di}function ni(Wr,on){de(Ye.next!==Jr,"can not resize a framebuffer which is currently in use");var Qn=Math.max(Wr|0,1),fi=Math.max(on|0||Qn,1);if(Qn===Jr.width&&fi===Jr.height)return di;for(var Fi=Jr.colorAttachments,Ya=0;Ya<Fi.length;++Ya)Cr(Fi[Ya],Qn,fi);return Cr(Jr.depthAttachment,Qn,fi),Cr(Jr.stencilAttachment,Qn,fi),Cr(Jr.depthStencilAttachment,Qn,fi),Jr.width=di.width=Qn,Jr.height=di.height=fi,rr(Jr),di}return di(Ar,$r),m(di,{resize:ni,_reglType:"framebuffer",_framebuffer:Jr,destroy:function(){Bn(Jr),Kr(Jr)},use:function(Wr){Ye.setFBO({framebuffer:di},Wr)}})}function _n(Ar){var $r=Array(6);function Jr(ni){var Wr;de($r.indexOf(Ye.next)<0,"can not update framebuffer which is currently in use");var on={color:null},Qn=0,fi=null,Fi="rgba",Ya="uint8",io=1;if(typeof ni=="number")Qn=ni|0;else if(!ni)Qn=1;else{de.type(ni,"object","invalid arguments for framebuffer");var Bi=ni;if("shape"in Bi){var as=Bi.shape;de(Array.isArray(as)&&as.length>=2,"invalid shape for framebuffer"),de(as[0]===as[1],"cube framebuffer must be square"),Qn=as[0]}else"radius"in Bi&&(Qn=Bi.radius|0),"width"in Bi?(Qn=Bi.width|0,"height"in Bi&&de(Bi.height===Qn,"must be square")):"height"in Bi&&(Qn=Bi.height|0);("color"in Bi||"colors"in Bi)&&(fi=Bi.color||Bi.colors,Array.isArray(fi)&&de(fi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),fi||("colorCount"in Bi&&(io=Bi.colorCount|0,de(io>0,"invalid color buffer count")),"colorType"in Bi&&(de.oneOf(Bi.colorType,Sr,"invalid color type"),Ya=Bi.colorType),"colorFormat"in Bi&&(Fi=Bi.colorFormat,de.oneOf(Bi.colorFormat,pr,"invalid color format for texture"))),"depth"in Bi&&(on.depth=Bi.depth),"stencil"in Bi&&(on.stencil=Bi.stencil),"depthStencil"in Bi&&(on.depthStencil=Bi.depthStencil)}var Ba;if(fi)if(Array.isArray(fi))for(Ba=[],Wr=0;Wr<fi.length;++Wr)Ba[Wr]=fi[Wr];else Ba=[fi];else{Ba=Array(io);var Zo={radius:Qn,format:Fi,type:Ya};for(Wr=0;Wr<io;++Wr)Ba[Wr]=Nt.createCube(Zo)}for(on.color=Array(Ba.length),Wr=0;Wr<Ba.length;++Wr){var _o=Ba[Wr];de(typeof _o=="function"&&_o._reglType==="textureCube","invalid cube map"),Qn=Qn||_o.width,de(_o.width===Qn&&_o.height===Qn,"invalid cube map shape"),on.color[Wr]={target:sl,data:Ba[Wr]}}for(Wr=0;Wr<6;++Wr){for(var jo=0;jo<Ba.length;++jo)on.color[jo].target=sl+Wr;Wr>0&&(on.depth=$r[0].depth,on.stencil=$r[0].stencil,on.depthStencil=$r[0].depthStencil),$r[Wr]?$r[Wr](on):$r[Wr]=ar(on)}return m(Jr,{width:Qn,height:Qn,color:Ba})}function di(ni){var Wr,on=ni|0;if(de(on>0&&on<=Ue.maxCubeMapSize,"invalid radius for cube fbo"),on===Jr.width)return Jr;var Qn=Jr.color;for(Wr=0;Wr<Qn.length;++Wr)Qn[Wr].resize(on);for(Wr=0;Wr<6;++Wr)$r[Wr].resize(on);return Jr.width=Jr.height=on,Jr}return Jr(Ar),m(Jr,{faces:$r,resize:di,_reglType:"framebufferCube",destroy:function(){$r.forEach(function(ni){ni.destroy()})}})}function Gr(){Ye.cur=null,Ye.next=null,Ye.dirty=!0,Q(hr).forEach(function(Ar){Ar.framebuffer=B.createFramebuffer(),rr(Ar)})}return m(Ye,{getFramebuffer:function(Ar){if(typeof Ar=="function"&&Ar._reglType==="framebuffer"){var $r=Ar._framebuffer;if($r instanceof Lr)return $r}return null},create:ar,createCube:_n,clear:function(){Q(hr).forEach(Bn)},restore:Gr})}var Oe=5126,We=34962,we=34963,Xe=["attributes","elements","offset","count","primitive","instances"];function it(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Oe,this.offset=0,this.stride=0,this.divisor=0}function bt(B,me,Ue,Nt,or,Ft,Ye){for(var pr=Ue.maxAttributes,De=new Array(pr),Sr=0;Sr<pr;++Sr)De[Sr]=new it;var Or=0,Rr={},Zr={Record:it,scope:{},state:De,currentVAO:null,targetVAO:null,restore:Pr()?Kr:function(){},createVAO:Bn,getVAO:Vt,destroyBuffer:xr,setVAO:Pr()?Cr:zr,clear:Pr()?hr:function(){}};function xr(rr){for(var ar=0;ar<De.length;++ar){var _n=De[ar];_n.buffer===rr&&(B.disableVertexAttribArray(ar),_n.buffer=null)}}function Pr(){return me.oes_vertex_array_object}function ct(){return me.angle_instanced_arrays}function Vt(rr){return typeof rr=="function"&&rr._vao?rr._vao:null}function Cr(rr){if(rr!==Zr.currentVAO){var ar=Pr();rr?ar.bindVertexArrayOES(rr.vao):ar.bindVertexArrayOES(null),Zr.currentVAO=rr}}function zr(rr){if(rr!==Zr.currentVAO){if(rr)rr.bindAttrs();else{for(var ar=ct(),_n=0;_n<De.length;++_n){var Gr=De[_n];Gr.buffer?(B.enableVertexAttribArray(_n),Gr.buffer.bind(),B.vertexAttribPointer(_n,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offfset),ar&&Gr.divisor&&ar.vertexAttribDivisorANGLE(_n,Gr.divisor)):(B.disableVertexAttribArray(_n),B.vertexAttrib4f(_n,Gr.x,Gr.y,Gr.z,Gr.w))}Ye.elements?B.bindBuffer(we,Ye.elements.buffer.buffer):B.bindBuffer(we,null)}Zr.currentVAO=rr}}function hr(){Q(Rr).forEach(function(rr){rr.destroy()})}function Lr(){this.id=++Or,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var rr=Pr();rr?this.vao=rr.createVertexArrayOES():this.vao=null,Rr[this.id]=this,this.buffers=[]}Lr.prototype.bindAttrs=function(){for(var rr=ct(),ar=this.attributes,_n=0;_n<ar.length;++_n){var Gr=ar[_n];Gr.buffer?(B.enableVertexAttribArray(_n),B.bindBuffer(We,Gr.buffer.buffer),B.vertexAttribPointer(_n,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offset),rr&&Gr.divisor&&rr.vertexAttribDivisorANGLE(_n,Gr.divisor)):(B.disableVertexAttribArray(_n),B.vertexAttrib4f(_n,Gr.x,Gr.y,Gr.z,Gr.w))}for(var Ar=ar.length;Ar<pr;++Ar)B.disableVertexAttribArray(Ar);var $r=Ft.getElements(this.elements);$r?B.bindBuffer(we,$r.buffer.buffer):B.bindBuffer(we,null)},Lr.prototype.refresh=function(){var rr=Pr();rr&&(rr.bindVertexArrayOES(this.vao),this.bindAttrs(),Zr.currentVAO=null,rr.bindVertexArrayOES(null))},Lr.prototype.destroy=function(){if(this.vao){var rr=Pr();this===Zr.currentVAO&&(Zr.currentVAO=null,rr.bindVertexArrayOES(null)),rr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Rr[this.id]&&(delete Rr[this.id],Nt.vaoCount-=1)};function Kr(){var rr=Pr();rr&&Q(Rr).forEach(function(ar){ar.refresh()})}function Bn(rr){var ar=new Lr;Nt.vaoCount+=1;function _n(Gr){var Ar;if(Array.isArray(Gr))Ar=Gr,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(de(typeof Gr=="object","invalid arguments for create vao"),de("attributes"in Gr,"must specify attributes for vao"),Gr.elements){var $r=Gr.elements;ar.ownsElements?typeof $r=="function"&&$r._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements($r),ar.ownsElements=!1):Ft.getElements(Gr.elements)?(ar.elements=Gr.elements,ar.ownsElements=!1):(ar.elements=Ft.create(Gr.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;Ar=Gr.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in Gr&&(ar.offset=Gr.offset|0),"count"in Gr&&(ar.count=Gr.count|0),"instances"in Gr&&(ar.instances=Gr.instances|0),"primitive"in Gr&&(de(Gr.primitive in cr,"bad primitive type: "+Gr.primitive),ar.primitive=cr[Gr.primitive]),de.optional(function(){for(var Ya=Object.keys(Gr),io=0;io<Ya.length;++io)de(Xe.indexOf(Ya[io])>=0,'invalid option for vao: "'+Ya[io]+'" valid options are '+Xe)}),de(Array.isArray(Ar),"attributes must be an array")}de(Ar.length<pr,"too many attributes"),de(Ar.length>0,"must specify at least one attribute");var Jr={},di=ar.attributes;di.length=Ar.length;for(var ni=0;ni<Ar.length;++ni){var Wr=Ar[ni],on=di[ni]=new it,Qn=Wr.data||Wr;if(Array.isArray(Qn)||ye(Qn)||ks(Qn)){var fi;ar.buffers[ni]&&(fi=ar.buffers[ni],ye(Qn)&&fi._buffer.byteLength>=Qn.byteLength?fi.subdata(Qn):(fi.destroy(),ar.buffers[ni]=null)),ar.buffers[ni]||(fi=ar.buffers[ni]=or.create(Wr,We,!1,!0)),on.buffer=or.getBuffer(fi),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1,Jr[ni]=1}else or.getBuffer(Wr)?(on.buffer=or.getBuffer(Wr),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1):or.getBuffer(Wr.buffer)?(on.buffer=or.getBuffer(Wr.buffer),on.size=(+Wr.size||on.buffer.dimension)|0,on.normalized=!!Wr.normalized||!1,"type"in Wr?(de.parameter(Wr.type,su,"invalid buffer type"),on.type=su[Wr.type]):on.type=on.buffer.dtype,on.offset=(Wr.offset||0)|0,on.stride=(Wr.stride||0)|0,on.divisor=(Wr.divisor||0)|0,on.state=1,de(on.size>=1&&on.size<=4,"size must be between 1 and 4"),de(on.offset>=0,"invalid offset"),de(on.stride>=0&&on.stride<=255,"stride must be between 0 and 255"),de(on.divisor>=0,"divisor must be positive"),de(!on.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Wr?(de(ni>0,"first attribute must not be a constant"),on.x=+Wr.x||0,on.y=+Wr.y||0,on.z=+Wr.z||0,on.w=+Wr.w||0,on.state=2):de(!1,"invalid attribute spec for location "+ni)}for(var Fi=0;Fi<ar.buffers.length;++Fi)!Jr[Fi]&&ar.buffers[Fi]&&(ar.buffers[Fi].destroy(),ar.buffers[Fi]=null);return ar.refresh(),_n}return _n.destroy=function(){for(var Gr=0;Gr<ar.buffers.length;++Gr)ar.buffers[Gr]&&ar.buffers[Gr].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},_n._vao=ar,_n._reglType="vao",_n(rr)}return Zr}var Ht=35632,Wt=35633,Qt=35718,mr=35721;function lr(B,me,Ue,Nt){var or={},Ft={};function Ye(ct,Vt,Cr,zr){this.name=ct,this.id=Vt,this.location=Cr,this.info=zr}function pr(ct,Vt){for(var Cr=0;Cr<ct.length;++Cr)if(ct[Cr].id===Vt.id){ct[Cr].location=Vt.location;return}ct.push(Vt)}function De(ct,Vt,Cr){var zr=ct===Ht?or:Ft,hr=zr[Vt];if(!hr){var Lr=me.str(Vt);hr=B.createShader(ct),B.shaderSource(hr,Lr),B.compileShader(hr),de.shaderError(B,hr,Lr,ct,Cr),zr[Vt]=hr}return hr}var Sr={},Or=[],Rr=0;function Zr(ct,Vt){this.id=Rr++,this.fragId=ct,this.vertId=Vt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Nt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function xr(ct,Vt,Cr){var zr,hr,Lr=De(Ht,ct.fragId),Kr=De(Wt,ct.vertId),Bn=ct.program=B.createProgram();if(B.attachShader(Bn,Lr),B.attachShader(Bn,Kr),Cr)for(zr=0;zr<Cr.length;++zr){var rr=Cr[zr];B.bindAttribLocation(Bn,rr[0],rr[1])}B.linkProgram(Bn),de.linkError(B,Bn,me.str(ct.fragId),me.str(ct.vertId),Vt);var ar=B.getProgramParameter(Bn,Qt);Nt.profile&&(ct.stats.uniformsCount=ar);var _n=ct.uniforms;for(zr=0;zr<ar;++zr)if(hr=B.getActiveUniform(Bn,zr),hr)if(hr.size>1)for(var Gr=0;Gr<hr.size;++Gr){var Ar=hr.name.replace("[0]","["+Gr+"]");pr(_n,new Ye(Ar,me.id(Ar),B.getUniformLocation(Bn,Ar),hr))}else pr(_n,new Ye(hr.name,me.id(hr.name),B.getUniformLocation(Bn,hr.name),hr));var $r=B.getProgramParameter(Bn,mr);Nt.profile&&(ct.stats.attributesCount=$r);var Jr=ct.attributes;for(zr=0;zr<$r;++zr)hr=B.getActiveAttrib(Bn,zr),hr&&pr(Jr,new Ye(hr.name,me.id(hr.name),B.getAttribLocation(Bn,hr.name),hr))}Nt.profile&&(Ue.getMaxUniformsCount=function(){var ct=0;return Or.forEach(function(Vt){Vt.stats.uniformsCount>ct&&(ct=Vt.stats.uniformsCount)}),ct},Ue.getMaxAttributesCount=function(){var ct=0;return Or.forEach(function(Vt){Vt.stats.attributesCount>ct&&(ct=Vt.stats.attributesCount)}),ct});function Pr(){or={},Ft={};for(var ct=0;ct<Or.length;++ct)xr(Or[ct],null,Or[ct].attributes.map(function(Vt){return[Vt.location,Vt.name]}))}return{clear:function(){var ct=B.deleteShader.bind(B);Q(or).forEach(ct),or={},Q(Ft).forEach(ct),Ft={},Or.forEach(function(Vt){B.deleteProgram(Vt.program)}),Or.length=0,Sr={},Ue.shaderCount=0},program:function(ct,Vt,Cr,zr){de.command(ct>=0,"missing vertex shader",Cr),de.command(Vt>=0,"missing fragment shader",Cr);var hr=Sr[Vt];hr||(hr=Sr[Vt]={});var Lr=hr[ct];if(Lr&&(Lr.refCount++,!zr))return Lr;var Kr=new Zr(Vt,ct);return Ue.shaderCount++,xr(Kr,Cr,zr),Lr||(hr[ct]=Kr),Or.push(Kr),m(Kr,{destroy:function(){if(Kr.refCount--,Kr.refCount<=0){B.deleteProgram(Kr.program);var Bn=Or.indexOf(Kr);Or.splice(Bn,1),Ue.shaderCount--}hr[Kr.vertId].refCount<=0&&(B.deleteShader(Ft[Kr.vertId]),delete Ft[Kr.vertId],delete Sr[Kr.fragId][Kr.vertId]),Object.keys(Sr[Kr.fragId]).length||(B.deleteShader(or[Kr.fragId]),delete or[Kr.fragId],delete Sr[Kr.fragId])}})},restore:Pr,shader:De,frag:-1,vert:-1}}var Mr=6408,tn=5121,Ln=3333,kn=5126;function Fn(B,me,Ue,Nt,or,Ft,Ye){function pr(Or){var Rr;me.next===null?(de(or.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Rr=tn):(de(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Rr=me.next.colorAttachments[0].texture._texture.type,de.optional(function(){Ft.oes_texture_float?(de(Rr===tn||Rr===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Rr===kn&&de(Ye.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):de(Rr===tn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Zr=0,xr=0,Pr=Nt.framebufferWidth,ct=Nt.framebufferHeight,Vt=null;ye(Or)?Vt=Or:Or&&(de.type(Or,"object","invalid arguments to regl.read()"),Zr=Or.x|0,xr=Or.y|0,de(Zr>=0&&Zr<Nt.framebufferWidth,"invalid x offset for regl.read"),de(xr>=0&&xr<Nt.framebufferHeight,"invalid y offset for regl.read"),Pr=(Or.width||Nt.framebufferWidth-Zr)|0,ct=(Or.height||Nt.framebufferHeight-xr)|0,Vt=Or.data||null),Vt&&(Rr===tn?de(Vt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Rr===kn&&de(Vt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),de(Pr>0&&Pr+Zr<=Nt.framebufferWidth,"invalid width for read pixels"),de(ct>0&&ct+xr<=Nt.framebufferHeight,"invalid height for read pixels"),Ue();var Cr=Pr*ct*4;return Vt||(Rr===tn?Vt=new Uint8Array(Cr):Rr===kn&&(Vt=Vt||new Float32Array(Cr))),de.isTypedArray(Vt,"data buffer for regl.read() must be a typedarray"),de(Vt.byteLength>=Cr,"data buffer for regl.read() too small"),B.pixelStorei(Ln,4),B.readPixels(Zr,xr,Pr,ct,Mr,Rr,Vt),Vt}function De(Or){var Rr;return me.setFBO({framebuffer:Or.framebuffer},function(){Rr=pr(Or)}),Rr}function Sr(Or){return!Or||!("framebuffer"in Or)?pr(Or):De(Or)}return Sr}function Oi(B){return Array.prototype.slice.call(B)}function wr(B){return Oi(B).join("")}function Yn(){var B=0,me=[],Ue=[];function Nt(Rr){for(var Zr=0;Zr<Ue.length;++Zr)if(Ue[Zr]===Rr)return me[Zr];var xr="g"+B++;return me.push(xr),Ue.push(Rr),xr}function or(){var Rr=[];function Zr(){Rr.push.apply(Rr,Oi(arguments))}var xr=[];function Pr(){var ct="v"+B++;return xr.push(ct),arguments.length>0&&(Rr.push(ct,"="),Rr.push.apply(Rr,Oi(arguments)),Rr.push(";")),ct}return m(Zr,{def:Pr,toString:function(){return wr([xr.length>0?"var "+xr.join(",")+";":"",wr(Rr)])}})}function Ft(){var Rr=or(),Zr=or(),xr=Rr.toString,Pr=Zr.toString;function ct(Vt,Cr){Zr(Vt,Cr,"=",Rr.def(Vt,Cr),";")}return m(function(){Rr.apply(Rr,Oi(arguments))},{def:Rr.def,entry:Rr,exit:Zr,save:ct,set:function(Vt,Cr,zr){ct(Vt,Cr),Rr(Vt,Cr,"=",zr,";")},toString:function(){return xr()+Pr()}})}function Ye(){var Rr=wr(arguments),Zr=Ft(),xr=Ft(),Pr=Zr.toString,ct=xr.toString;return m(Zr,{then:function(){return Zr.apply(Zr,Oi(arguments)),this},else:function(){return xr.apply(xr,Oi(arguments)),this},toString:function(){var Vt=ct();return Vt&&(Vt="else{"+Vt+"}"),wr(["if(",Rr,"){",Pr(),"}",Vt])}})}var pr=or(),De={};function Sr(Rr,Zr){var xr=[];function Pr(){var hr="a"+xr.length;return xr.push(hr),hr}Zr=Zr||0;for(var ct=0;ct<Zr;++ct)Pr();var Vt=Ft(),Cr=Vt.toString,zr=De[Rr]=m(Vt,{arg:Pr,toString:function(){return wr(["function(",xr.join(),"){",Cr(),"}"])}});return zr}function Or(){var Rr=['"use strict";',pr,"return {"];Object.keys(De).forEach(function(ct){Rr.push('"',ct,'":',De[ct].toString(),",")}),Rr.push("}");var Zr=wr(Rr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),xr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Pr=xr?le.Function.apply(null,me.concat(Zr)):Function.apply(null,me.concat(Zr));return Pr.apply(null,Ue)}return{global:pr,link:Nt,block:or,proc:Sr,scope:Ft,cond:Ye,compile:Or}}var ti="xyzw".split(""),ri=5121,Wn=1,oi=2,On=0,Sn=1,go=2,Xn=3,Bo=4,To=5,Va=6,Ga="dither",Ms="blend.enable",ds="blend.color",Au="blend.equation",$o="blend.func",Ps="depth.enable",fu="depth.func",zl="depth.range",Ul="depth.mask",Bu="colorMask",Zl="cull.enable",jl="cull.face",Qs="frontFace",Vl="lineWidth",wu="polygonOffset.enable",yo="polygonOffset.offset",Nu="sample.alpha",Qo="sample.enable",zu="sample.coverage",Di="stencil.enable",js="stencil.mask",ns="stencil.func",Uu="stencil.opFront",Gl="stencil.opBack",Uc="scissor.enable",Ef="scissor.box",Js="viewport",Hl="profile",hu="framebuffer",wl="vert",dc="frag",eu="elements",No="primitive",Zc="count",eh="offset",Rh="instances",th="vao",cp="Width",Tu="Height",vc=hu+cp,Zu=hu+Tu,Lh=Js+cp,jc=Js+Tu,ll="drawingBuffer",Sf=ll+cp,qp=ll+Tu,kd=[$o,Au,ns,Uu,Gl,zu,Js,Ef,yo],Cf=34962,zo=34963,is=35632,kh=35633,fp=3553,mc=34067,wv=2884,rh=3042,Tv=3024,Uo=2960,nh=2929,ju=3089,hp=32823,pp=32926,Dh=32928,Wl=5126,Vc=35664,cl=35665,Gc=35666,Af=5124,Hc=35667,fl=35668,ih=35669,wf=35670,Tf=35671,Wc=35672,Mf=35673,Vs=35674,pu=35675,Pf=35676,ah=35678,oh=35680,Fh=4,Tl=1028,Xc=1029,Kp=2304,If=2305,$p=32775,Qp=32776,Jp=519,du=7680,dp=0,Bh=1,Of=32774,hl=513,vp=36160,Dd=36064,Ml={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],gc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Vu={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ed={frag:is,vert:kh},mp={cw:Kp,ccw:If};function Nh(B){return Array.isArray(B)||ye(B)||ks(B)}function gp(B){return B.sort(function(me,Ue){return me===Js?-1:Ue===Js?1:me<Ue?-1:1})}function da(B,me,Ue,Nt){this.thisDep=B,this.contextDep=me,this.propDep=Ue,this.append=Nt}function Xl(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Mo(B){return new da(!1,!1,!1,B)}function Gs(B,me){var Ue=B.type;if(Ue===On){var Nt=B.data.length;return new da(!0,Nt>=1,Nt>=2,me)}else if(Ue===Bo){var or=B.data;return new da(or.thisDep,or.contextDep,or.propDep,me)}else{if(Ue===To)return new da(!1,!1,!1,me);if(Ue===Va){for(var Ft=!1,Ye=!1,pr=!1,De=0;De<B.data.length;++De){var Sr=B.data[De];if(Sr.type===Sn)pr=!0;else if(Sr.type===go)Ye=!0;else if(Sr.type===Xn)Ft=!0;else if(Sr.type===On){Ft=!0;var Or=Sr.data;Or>=1&&(Ye=!0),Or>=2&&(pr=!0)}else Sr.type===Bo&&(Ft=Ft||Sr.data.thisDep,Ye=Ye||Sr.data.contextDep,pr=pr||Sr.data.propDep)}return new da(Ft,Ye,pr,me)}else return new da(Ue===Xn,Ue===go,Ue===Sn,me)}}var zh=new da(!1,!1,!1,function(){});function td(B,me,Ue,Nt,or,Ft,Ye,pr,De,Sr,Or,Rr,Zr,xr,Pr){var ct=Sr.Record,Vt={add:32774,subtract:32778,"reverse subtract":32779};Ue.ext_blend_minmax&&(Vt.min=$p,Vt.max=Qp);var Cr=Ue.angle_instanced_arrays,zr=Ue.webgl_draw_buffers,hr=Ue.oes_vertex_array_object,Lr={dirty:!0,profile:Pr.profile},Kr={},Bn=[],rr={},ar={};function _n(Se){return Se.replace(".","_")}function Gr(Se,re,Ve){var ft=_n(Se);Bn.push(Se),Kr[ft]=Lr[ft]=!!Ve,rr[ft]=re}function Ar(Se,re,Ve){var ft=_n(Se);Bn.push(Se),Array.isArray(Ve)?(Lr[ft]=Ve.slice(),Kr[ft]=Ve.slice()):Lr[ft]=Kr[ft]=Ve,ar[ft]=re}Gr(Ga,Tv),Gr(Ms,rh),Ar(ds,"blendColor",[0,0,0,0]),Ar(Au,"blendEquationSeparate",[Of,Of]),Ar($o,"blendFuncSeparate",[Bh,dp,Bh,dp]),Gr(Ps,nh,!0),Ar(fu,"depthFunc",hl),Ar(zl,"depthRange",[0,1]),Ar(Ul,"depthMask",!0),Ar(Bu,Bu,[!0,!0,!0,!0]),Gr(Zl,wv),Ar(jl,"cullFace",Xc),Ar(Qs,Qs,If),Ar(Vl,Vl,1),Gr(wu,hp),Ar(yo,"polygonOffset",[0,0]),Gr(Nu,pp),Gr(Qo,Dh),Ar(zu,"sampleCoverage",[1,!1]),Gr(Di,Uo),Ar(js,"stencilMask",-1),Ar(ns,"stencilFunc",[Jp,0,-1]),Ar(Uu,"stencilOpSeparate",[Tl,du,du,du]),Ar(Gl,"stencilOpSeparate",[Xc,du,du,du]),Gr(Uc,ju),Ar(Ef,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Ar(Js,Js,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var $r={gl:B,context:Zr,strings:me,next:Kr,current:Lr,draw:Rr,elements:Ft,buffer:or,shader:Or,attributes:Sr.state,vao:Sr,uniforms:De,framebuffer:pr,extensions:Ue,timer:xr,isBufferArgs:Nh},Jr={primTypes:cr,compareFuncs:gc,blendFuncs:Ml,blendEquations:Vt,stencilOps:Vu,glTypes:su,orientationType:mp};de.optional(function(){$r.isArrayLike=ua}),zr&&(Jr.backBuffer=[Xc],Jr.drawBuffer=He(Nt.maxDrawbuffers,function(Se){return Se===0?[0]:He(Se,function(re){return Dd+re})}));var di=0;function ni(){var Se=Yn(),re=Se.link,Ve=Se.global;Se.id=di++,Se.batchId="0";var ft=re($r),kt=Se.shared={props:"a0"};Object.keys($r).forEach(function(je){kt[je]=Ve.def(ft,".",je)}),de.optional(function(){Se.CHECK=re(de),Se.commandStr=de.guessCommand(),Se.command=re(Se.commandStr),Se.assert=function(je,Ae,dt){je("if(!(",Ae,"))",this.CHECK,".commandRaise(",re(dt),",",this.command,");")},Jr.invalidBlendCombinations=Rf});var $e=Se.next={},Ne=Se.current={};Object.keys(ar).forEach(function(je){Array.isArray(Lr[je])&&($e[je]=Ve.def(kt.next,".",je),Ne[je]=Ve.def(kt.current,".",je))});var ot=Se.constants={};Object.keys(Jr).forEach(function(je){ot[je]=Ve.def(JSON.stringify(Jr[je]))}),Se.invoke=function(je,Ae){switch(Ae.type){case On:var dt=["this",kt.context,kt.props,Se.batchId];return je.def(re(Ae.data),".call(",dt.slice(0,Math.max(Ae.data.length+1,4)),")");case Sn:return je.def(kt.props,Ae.data);case go:return je.def(kt.context,Ae.data);case Xn:return je.def("this",Ae.data);case Bo:return Ae.data.append(Se,je),Ae.data.ref;case To:return Ae.data.toString();case Va:return Ae.data.map(function(Tt){return Se.invoke(je,Tt)})}},Se.attribCache={};var _e={};return Se.scopeAttrib=function(je){var Ae=me.id(je);if(Ae in _e)return _e[Ae];var dt=Sr.scope[Ae];dt||(dt=Sr.scope[Ae]=new ct);var Tt=_e[Ae]=re(dt);return Tt},Se}function Wr(Se){var re=Se.static,Ve=Se.dynamic,ft;if(Hl in re){var kt=!!re[Hl];ft=Mo(function(Ne,ot){return kt}),ft.enable=kt}else if(Hl in Ve){var $e=Ve[Hl];ft=Gs($e,function(Ne,ot){return Ne.invoke(ot,$e)})}return ft}function on(Se,re){var Ve=Se.static,ft=Se.dynamic;if(hu in Ve){var kt=Ve[hu];return kt?(kt=pr.getFramebuffer(kt),de.command(kt,"invalid framebuffer object"),Mo(function(Ne,ot){var _e=Ne.link(kt),je=Ne.shared;ot.set(je.framebuffer,".next",_e);var Ae=je.context;return ot.set(Ae,"."+vc,_e+".width"),ot.set(Ae,"."+Zu,_e+".height"),_e})):Mo(function(Ne,ot){var _e=Ne.shared;ot.set(_e.framebuffer,".next","null");var je=_e.context;return ot.set(je,"."+vc,je+"."+Sf),ot.set(je,"."+Zu,je+"."+qp),"null"})}else if(hu in ft){var $e=ft[hu];return Gs($e,function(Ne,ot){var _e=Ne.invoke(ot,$e),je=Ne.shared,Ae=je.framebuffer,dt=ot.def(Ae,".getFramebuffer(",_e,")");de.optional(function(){Ne.assert(ot,"!"+_e+"||"+dt,"invalid framebuffer object")}),ot.set(Ae,".next",dt);var Tt=je.context;return ot.set(Tt,"."+vc,dt+"?"+dt+".width:"+Tt+"."+Sf),ot.set(Tt,"."+Zu,dt+"?"+dt+".height:"+Tt+"."+qp),dt})}else return null}function Qn(Se,re,Ve){var ft=Se.static,kt=Se.dynamic;function $e(_e){if(_e in ft){var je=ft[_e];de.commandType(je,"object","invalid "+_e,Ve.commandStr);var Ae=!0,dt=je.x|0,Tt=je.y|0,dr,Nr;return"width"in je?(dr=je.width|0,de.command(dr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,"height"in je?(Nr=je.height|0,de.command(Nr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,new da(!Ae&&re&&re.thisDep,!Ae&&re&&re.contextDep,!Ae&&re&&re.propDep,function(Br,Cn){var fn=Br.shared.context,En=dr;"width"in je||(En=Cn.def(fn,".",vc,"-",dt));var xn=Nr;return"height"in je||(xn=Cn.def(fn,".",Zu,"-",Tt)),[dt,Tt,En,xn]})}else if(_e in kt){var Ur=kt[_e],nn=Gs(Ur,function(Br,Cn){var fn=Br.invoke(Cn,Ur);de.optional(function(){Br.assert(Cn,fn+"&&typeof "+fn+'==="object"',"invalid "+_e)});var En=Br.shared.context,xn=Cn.def(fn,".x|0"),dn=Cn.def(fn,".y|0"),qn=Cn.def('"width" in ',fn,"?",fn,".width|0:","(",En,".",vc,"-",xn,")"),va=Cn.def('"height" in ',fn,"?",fn,".height|0:","(",En,".",Zu,"-",dn,")");return de.optional(function(){Br.assert(Cn,qn+">=0&&"+va+">=0","invalid "+_e)}),[xn,dn,qn,va]});return re&&(nn.thisDep=nn.thisDep||re.thisDep,nn.contextDep=nn.contextDep||re.contextDep,nn.propDep=nn.propDep||re.propDep),nn}else return re?new da(re.thisDep,re.contextDep,re.propDep,function(Br,Cn){var fn=Br.shared.context;return[0,0,Cn.def(fn,".",vc),Cn.def(fn,".",Zu)]}):null}var Ne=$e(Js);if(Ne){var ot=Ne;Ne=new da(Ne.thisDep,Ne.contextDep,Ne.propDep,function(_e,je){var Ae=ot.append(_e,je),dt=_e.shared.context;return je.set(dt,"."+Lh,Ae[2]),je.set(dt,"."+jc,Ae[3]),Ae})}return{viewport:Ne,scissor_box:$e(Ef)}}function fi(Se,re){var Ve=Se.static,ft=typeof Ve[dc]=="string"&&typeof Ve[wl]=="string";if(ft){if(Object.keys(re.dynamic).length>0)return null;var kt=re.static,$e=Object.keys(kt);if($e.length>0&&typeof kt[$e[0]]=="number"){for(var Ne=[],ot=0;ot<$e.length;++ot)de(typeof kt[$e[ot]]=="number","must specify all vertex attribute locations when using vaos"),Ne.push([kt[$e[ot]]|0,$e[ot]]);return Ne}}return null}function Fi(Se,re,Ve){var ft=Se.static,kt=Se.dynamic;function $e(Ae){if(Ae in ft){var dt=me.id(ft[Ae]);de.optional(function(){Or.shader(ed[Ae],dt,de.guessCommand())});var Tt=Mo(function(){return dt});return Tt.id=dt,Tt}else if(Ae in kt){var dr=kt[Ae];return Gs(dr,function(Nr,Ur){var nn=Nr.invoke(Ur,dr),Br=Ur.def(Nr.shared.strings,".id(",nn,")");return de.optional(function(){Ur(Nr.shared.shader,".shader(",ed[Ae],",",Br,",",Nr.command,");")}),Br})}return null}var Ne=$e(dc),ot=$e(wl),_e=null,je;return Xl(Ne)&&Xl(ot)?(_e=Or.program(ot.id,Ne.id,null,Ve),je=Mo(function(Ae,dt){return Ae.link(_e)})):je=new da(Ne&&Ne.thisDep||ot&&ot.thisDep,Ne&&Ne.contextDep||ot&&ot.contextDep,Ne&&Ne.propDep||ot&&ot.propDep,function(Ae,dt){var Tt=Ae.shared.shader,dr;Ne?dr=Ne.append(Ae,dt):dr=dt.def(Tt,".",dc);var Nr;ot?Nr=ot.append(Ae,dt):Nr=dt.def(Tt,".",wl);var Ur=Tt+".program("+Nr+","+dr;return de.optional(function(){Ur+=","+Ae.command}),dt.def(Ur+")")}),{frag:Ne,vert:ot,progVar:je,program:_e}}function Ya(Se,re){var Ve=Se.static,ft=Se.dynamic,kt={},$e=!1;function Ne(){if(th in Ve){var Cn=Ve[th];return Cn!==null&&Sr.getVAO(Cn)===null&&(Cn=Sr.createVAO(Cn)),$e=!0,kt.vao=Cn,Mo(function(En){var xn=Sr.getVAO(Cn);return xn?En.link(xn):"null"})}else if(th in ft){$e=!0;var fn=ft[th];return Gs(fn,function(En,xn){var dn=En.invoke(xn,fn);return xn.def(En.shared.vao+".getVAO("+dn+")")})}return null}var ot=Ne(),_e=!1;function je(){if(eu in Ve){var Cn=Ve[eu];if(kt.elements=Cn,Nh(Cn)){var fn=kt.elements=Ft.create(Cn,!0);Cn=Ft.getElements(fn),_e=!0}else Cn&&(Cn=Ft.getElements(Cn),_e=!0,de.command(Cn,"invalid elements",re.commandStr));var En=Mo(function(dn,qn){if(Cn){var va=dn.link(Cn);return dn.ELEMENTS=va,va}return dn.ELEMENTS=null,null});return En.value=Cn,En}else if(eu in ft){_e=!0;var xn=ft[eu];return Gs(xn,function(dn,qn){var va=dn.shared,ss=va.isBufferArgs,ka=va.elements,aa=dn.invoke(qn,xn),Pl=qn.def("null"),Is=qn.def(ss,"(",aa,")"),dl=dn.cond(Is).then(Pl,"=",ka,".createStream(",aa,");").else(Pl,"=",ka,".getElements(",aa,");");return de.optional(function(){dn.assert(dl.else,"!"+aa+"||"+Pl,"invalid elements")}),qn.entry(dl),qn.exit(dn.cond(Is).then(ka,".destroyStream(",Pl,");")),dn.ELEMENTS=Pl,Pl})}else if($e)return new da(ot.thisDep,ot.contextDep,ot.propDep,function(dn,qn){return qn.def(dn.shared.vao+".currentVAO?"+dn.shared.elements+".getElements("+dn.shared.vao+".currentVAO.elements):null")});return null}var Ae=je();function dt(){if(No in Ve){var Cn=Ve[No];return kt.primitive=Cn,de.commandParameter(Cn,cr,"invalid primitve",re.commandStr),Mo(function(En,xn){return cr[Cn]})}else if(No in ft){var fn=ft[No];return Gs(fn,function(En,xn){var dn=En.constants.primTypes,qn=En.invoke(xn,fn);return de.optional(function(){En.assert(xn,qn+" in "+dn,"invalid primitive, must be one of "+Object.keys(cr))}),xn.def(dn,"[",qn,"]")})}else{if(_e)return Xl(Ae)?Ae.value?Mo(function(En,xn){return xn.def(En.ELEMENTS,".primType")}):Mo(function(){return Fh}):new da(Ae.thisDep,Ae.contextDep,Ae.propDep,function(En,xn){var dn=En.ELEMENTS;return xn.def(dn,"?",dn,".primType:",Fh)});if($e)return new da(ot.thisDep,ot.contextDep,ot.propDep,function(En,xn){return xn.def(En.shared.vao+".currentVAO?"+En.shared.vao+".currentVAO.primitive:"+Fh)})}return null}function Tt(Cn,fn){if(Cn in Ve){var En=Ve[Cn]|0;return fn?kt.offset=En:kt.instances=En,de.command(!fn||En>=0,"invalid "+Cn,re.commandStr),Mo(function(dn,qn){return fn&&(dn.OFFSET=En),En})}else if(Cn in ft){var xn=ft[Cn];return Gs(xn,function(dn,qn){var va=dn.invoke(qn,xn);return fn&&(dn.OFFSET=va,de.optional(function(){dn.assert(qn,va+">=0","invalid "+Cn)})),va})}else if(fn){if(_e)return Mo(function(dn,qn){return dn.OFFSET=0,0});if($e)return new da(ot.thisDep,ot.contextDep,ot.propDep,function(dn,qn){return qn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.offset:0")})}else if($e)return new da(ot.thisDep,ot.contextDep,ot.propDep,function(dn,qn){return qn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.instances:-1")});return null}var dr=Tt(eh,!0);function Nr(){if(Zc in Ve){var Cn=Ve[Zc]|0;return kt.count=Cn,de.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",re.commandStr),Mo(function(){return Cn})}else if(Zc in ft){var fn=ft[Zc];return Gs(fn,function(qn,va){var ss=qn.invoke(va,fn);return de.optional(function(){qn.assert(va,"typeof "+ss+'==="number"&&'+ss+">=0&&"+ss+"===("+ss+"|0)","invalid vertex count")}),ss})}else if(_e)if(Xl(Ae)){if(Ae)return dr?new da(dr.thisDep,dr.contextDep,dr.propDep,function(qn,va){var ss=va.def(qn.ELEMENTS,".vertCount-",qn.OFFSET);return de.optional(function(){qn.assert(va,ss+">=0","invalid vertex offset/element buffer too small")}),ss}):Mo(function(qn,va){return va.def(qn.ELEMENTS,".vertCount")});var En=Mo(function(){return-1});return de.optional(function(){En.MISSING=!0}),En}else{var xn=new da(Ae.thisDep||dr.thisDep,Ae.contextDep||dr.contextDep,Ae.propDep||dr.propDep,function(qn,va){var ss=qn.ELEMENTS;return qn.OFFSET?va.def(ss,"?",ss,".vertCount-",qn.OFFSET,":-1"):va.def(ss,"?",ss,".vertCount:-1")});return de.optional(function(){xn.DYNAMIC=!0}),xn}else if($e){var dn=new da(ot.thisDep,ot.contextDep,ot.propDep,function(qn,va){return va.def(qn.shared.vao,".currentVAO?",qn.shared.vao,".currentVAO.count:-1")});return dn}return null}var Ur=dt(),nn=Nr(),Br=Tt(Rh,!1);return{elements:Ae,primitive:Ur,count:nn,instances:Br,offset:dr,vao:ot,vaoActive:$e,elementsActive:_e,static:kt}}function io(Se,re){var Ve=Se.static,ft=Se.dynamic,kt={};return Bn.forEach(function($e){var Ne=_n($e);function ot(_e,je){if($e in Ve){var Ae=_e(Ve[$e]);kt[Ne]=Mo(function(){return Ae})}else if($e in ft){var dt=ft[$e];kt[Ne]=Gs(dt,function(Tt,dr){return je(Tt,dr,Tt.invoke(dr,dt))})}}switch($e){case Zl:case Ms:case Ga:case Di:case Ps:case Uc:case wu:case Nu:case Qo:case Ul:return ot(function(_e){return de.commandType(_e,"boolean",$e,re.commandStr),_e},function(_e,je,Ae){return de.optional(function(){_e.assert(je,"typeof "+Ae+'==="boolean"',"invalid flag "+$e,_e.commandStr)}),Ae});case fu:return ot(function(_e){return de.commandParameter(_e,gc,"invalid "+$e,re.commandStr),gc[_e]},function(_e,je,Ae){var dt=_e.constants.compareFuncs;return de.optional(function(){_e.assert(je,Ae+" in "+dt,"invalid "+$e+", must be one of "+Object.keys(gc))}),je.def(dt,"[",Ae,"]")});case zl:return ot(function(_e){return de.command(ua(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",re.commandStr),_e},function(_e,je,Ae){de.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var dt=je.def("+",Ae,"[0]"),Tt=je.def("+",Ae,"[1]");return[dt,Tt]});case $o:return ot(function(_e){de.commandType(_e,"object","blend.func",re.commandStr);var je="srcRGB"in _e?_e.srcRGB:_e.src,Ae="srcAlpha"in _e?_e.srcAlpha:_e.src,dt="dstRGB"in _e?_e.dstRGB:_e.dst,Tt="dstAlpha"in _e?_e.dstAlpha:_e.dst;return de.commandParameter(je,Ml,Ne+".srcRGB",re.commandStr),de.commandParameter(Ae,Ml,Ne+".srcAlpha",re.commandStr),de.commandParameter(dt,Ml,Ne+".dstRGB",re.commandStr),de.commandParameter(Tt,Ml,Ne+".dstAlpha",re.commandStr),de.command(Rf.indexOf(je+", "+dt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+je+", "+dt+")",re.commandStr),[Ml[je],Ml[dt],Ml[Ae],Ml[Tt]]},function(_e,je,Ae){var dt=_e.constants.blendFuncs;de.optional(function(){_e.assert(je,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function Tt(fn,En){var xn=je.def('"',fn,En,'" in ',Ae,"?",Ae,".",fn,En,":",Ae,".",fn);return de.optional(function(){_e.assert(je,xn+" in "+dt,"invalid "+$e+"."+fn+En+", must be one of "+Object.keys(Ml))}),xn}var dr=Tt("src","RGB"),Nr=Tt("dst","RGB");de.optional(function(){var fn=_e.constants.invalidBlendCombinations;_e.assert(je,fn+".indexOf("+dr+'+", "+'+Nr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ur=je.def(dt,"[",dr,"]"),nn=je.def(dt,"[",Tt("src","Alpha"),"]"),Br=je.def(dt,"[",Nr,"]"),Cn=je.def(dt,"[",Tt("dst","Alpha"),"]");return[Ur,Br,nn,Cn]});case Au:return ot(function(_e){if(typeof _e=="string")return de.commandParameter(_e,Vt,"invalid "+$e,re.commandStr),[Vt[_e],Vt[_e]];if(typeof _e=="object")return de.commandParameter(_e.rgb,Vt,$e+".rgb",re.commandStr),de.commandParameter(_e.alpha,Vt,$e+".alpha",re.commandStr),[Vt[_e.rgb],Vt[_e.alpha]];de.commandRaise("invalid blend.equation",re.commandStr)},function(_e,je,Ae){var dt=_e.constants.blendEquations,Tt=je.def(),dr=je.def(),Nr=_e.cond("typeof ",Ae,'==="string"');return de.optional(function(){function Ur(nn,Br,Cn){_e.assert(nn,Cn+" in "+dt,"invalid "+Br+", must be one of "+Object.keys(Vt))}Ur(Nr.then,$e,Ae),_e.assert(Nr.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+$e),Ur(Nr.else,$e+".rgb",Ae+".rgb"),Ur(Nr.else,$e+".alpha",Ae+".alpha")}),Nr.then(Tt,"=",dr,"=",dt,"[",Ae,"];"),Nr.else(Tt,"=",dt,"[",Ae,".rgb];",dr,"=",dt,"[",Ae,".alpha];"),je(Nr),[Tt,dr]});case ds:return ot(function(_e){return de.command(ua(_e)&&_e.length===4,"blend.color must be a 4d array",re.commandStr),He(4,function(je){return+_e[je]})},function(_e,je,Ae){return de.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),He(4,function(dt){return je.def("+",Ae,"[",dt,"]")})});case js:return ot(function(_e){return de.commandType(_e,"number",Ne,re.commandStr),_e|0},function(_e,je,Ae){return de.optional(function(){_e.assert(je,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),je.def(Ae,"|0")});case ns:return ot(function(_e){de.commandType(_e,"object",Ne,re.commandStr);var je=_e.cmp||"keep",Ae=_e.ref||0,dt="mask"in _e?_e.mask:-1;return de.commandParameter(je,gc,$e+".cmp",re.commandStr),de.commandType(Ae,"number",$e+".ref",re.commandStr),de.commandType(dt,"number",$e+".mask",re.commandStr),[gc[je],Ae,dt]},function(_e,je,Ae){var dt=_e.constants.compareFuncs;de.optional(function(){function Ur(){_e.assert(je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ur(Ae+"&&typeof ",Ae,'==="object"'),Ur('!("cmp" in ',Ae,")||(",Ae,".cmp in ",dt,")")});var Tt=je.def('"cmp" in ',Ae,"?",dt,"[",Ae,".cmp]",":",du),dr=je.def(Ae,".ref|0"),Nr=je.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[Tt,dr,Nr]});case Uu:case Gl:return ot(function(_e){de.commandType(_e,"object",Ne,re.commandStr);var je=_e.fail||"keep",Ae=_e.zfail||"keep",dt=_e.zpass||"keep";return de.commandParameter(je,Vu,$e+".fail",re.commandStr),de.commandParameter(Ae,Vu,$e+".zfail",re.commandStr),de.commandParameter(dt,Vu,$e+".zpass",re.commandStr),[$e===Gl?Xc:Tl,Vu[je],Vu[Ae],Vu[dt]]},function(_e,je,Ae){var dt=_e.constants.stencilOps;de.optional(function(){_e.assert(je,Ae+"&&typeof "+Ae+'==="object"',"invalid "+$e)});function Tt(dr){return de.optional(function(){_e.assert(je,'!("'+dr+'" in '+Ae+")||("+Ae+"."+dr+" in "+dt+")","invalid "+$e+"."+dr+", must be one of "+Object.keys(Vu))}),je.def('"',dr,'" in ',Ae,"?",dt,"[",Ae,".",dr,"]:",du)}return[$e===Gl?Xc:Tl,Tt("fail"),Tt("zfail"),Tt("zpass")]});case yo:return ot(function(_e){de.commandType(_e,"object",Ne,re.commandStr);var je=_e.factor|0,Ae=_e.units|0;return de.commandType(je,"number",Ne+".factor",re.commandStr),de.commandType(Ae,"number",Ne+".units",re.commandStr),[je,Ae]},function(_e,je,Ae){de.optional(function(){_e.assert(je,Ae+"&&typeof "+Ae+'==="object"',"invalid "+$e)});var dt=je.def(Ae,".factor|0"),Tt=je.def(Ae,".units|0");return[dt,Tt]});case jl:return ot(function(_e){var je=0;return _e==="front"?je=Tl:_e==="back"&&(je=Xc),de.command(!!je,Ne,re.commandStr),je},function(_e,je,Ae){return de.optional(function(){_e.assert(je,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),je.def(Ae,'==="front"?',Tl,":",Xc)});case Vl:return ot(function(_e){return de.command(typeof _e=="number"&&_e>=Nt.lineWidthDims[0]&&_e<=Nt.lineWidthDims[1],"invalid line width, must be a positive number between "+Nt.lineWidthDims[0]+" and "+Nt.lineWidthDims[1],re.commandStr),_e},function(_e,je,Ae){return de.optional(function(){_e.assert(je,"typeof "+Ae+'==="number"&&'+Ae+">="+Nt.lineWidthDims[0]+"&&"+Ae+"<="+Nt.lineWidthDims[1],"invalid line width")}),Ae});case Qs:return ot(function(_e){return de.commandParameter(_e,mp,Ne,re.commandStr),mp[_e]},function(_e,je,Ae){return de.optional(function(){_e.assert(je,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),je.def(Ae+'==="cw"?'+Kp+":"+If)});case Bu:return ot(function(_e){return de.command(ua(_e)&&_e.length===4,"color.mask must be length 4 array",re.commandStr),_e.map(function(je){return!!je})},function(_e,je,Ae){return de.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),He(4,function(dt){return"!!"+Ae+"["+dt+"]"})});case zu:return ot(function(_e){de.command(typeof _e=="object"&&_e,Ne,re.commandStr);var je="value"in _e?_e.value:1,Ae=!!_e.invert;return de.command(typeof je=="number"&&je>=0&&je<=1,"sample.coverage.value must be a number between 0 and 1",re.commandStr),[je,Ae]},function(_e,je,Ae){de.optional(function(){_e.assert(je,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var dt=je.def('"value" in ',Ae,"?+",Ae,".value:1"),Tt=je.def("!!",Ae,".invert");return[dt,Tt]})}}),kt}function Bi(Se,re){var Ve=Se.static,ft=Se.dynamic,kt={};return Object.keys(Ve).forEach(function($e){var Ne=Ve[$e],ot;if(typeof Ne=="number"||typeof Ne=="boolean")ot=Mo(function(){return Ne});else if(typeof Ne=="function"){var _e=Ne._reglType;_e==="texture2d"||_e==="textureCube"?ot=Mo(function(je){return je.link(Ne)}):_e==="framebuffer"||_e==="framebufferCube"?(de.command(Ne.color.length>0,'missing color attachment for framebuffer sent to uniform "'+$e+'"',re.commandStr),ot=Mo(function(je){return je.link(Ne.color[0])})):de.commandRaise('invalid data for uniform "'+$e+'"',re.commandStr)}else ua(Ne)?ot=Mo(function(je){var Ae=je.global.def("[",He(Ne.length,function(dt){return de.command(typeof Ne[dt]=="number"||typeof Ne[dt]=="boolean","invalid uniform "+$e,je.commandStr),Ne[dt]}),"]");return Ae}):de.commandRaise('invalid or missing data for uniform "'+$e+'"',re.commandStr);ot.value=Ne,kt[$e]=ot}),Object.keys(ft).forEach(function($e){var Ne=ft[$e];kt[$e]=Gs(Ne,function(ot,_e){return ot.invoke(_e,Ne)})}),kt}function as(Se,re){var Ve=Se.static,ft=Se.dynamic,kt={};return Object.keys(Ve).forEach(function($e){var Ne=Ve[$e],ot=me.id($e),_e=new ct;if(Nh(Ne))_e.state=Wn,_e.buffer=or.getBuffer(or.create(Ne,Cf,!1,!0)),_e.type=0;else{var je=or.getBuffer(Ne);if(je)_e.state=Wn,_e.buffer=je,_e.type=0;else if(de.command(typeof Ne=="object"&&Ne,"invalid data for attribute "+$e,re.commandStr),"constant"in Ne){var Ae=Ne.constant;_e.buffer="null",_e.state=oi,typeof Ae=="number"?_e.x=Ae:(de.command(ua(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+$e,re.commandStr),ti.forEach(function(Br,Cn){Cn<Ae.length&&(_e[Br]=Ae[Cn])}))}else{Nh(Ne.buffer)?je=or.getBuffer(or.create(Ne.buffer,Cf,!1,!0)):je=or.getBuffer(Ne.buffer),de.command(!!je,'missing buffer for attribute "'+$e+'"',re.commandStr);var dt=Ne.offset|0;de.command(dt>=0,'invalid offset for attribute "'+$e+'"',re.commandStr);var Tt=Ne.stride|0;de.command(Tt>=0&&Tt<256,'invalid stride for attribute "'+$e+'", must be integer betweeen [0, 255]',re.commandStr);var dr=Ne.size|0;de.command(!("size"in Ne)||dr>0&&dr<=4,'invalid size for attribute "'+$e+'", must be 1,2,3,4',re.commandStr);var Nr=!!Ne.normalized,Ur=0;"type"in Ne&&(de.commandParameter(Ne.type,su,"invalid type for attribute "+$e,re.commandStr),Ur=su[Ne.type]);var nn=Ne.divisor|0;de.optional(function(){"divisor"in Ne&&(de.command(nn===0||Cr,'cannot specify divisor for attribute "'+$e+'", instancing not supported',re.commandStr),de.command(nn>=0,'invalid divisor for attribute "'+$e+'"',re.commandStr));var Br=re.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ne).forEach(function(fn){de.command(Cn.indexOf(fn)>=0,'unknown parameter "'+fn+'" for attribute pointer "'+$e+'" (valid parameters are '+Cn+")",Br)})}),_e.buffer=je,_e.state=Wn,_e.size=dr,_e.normalized=Nr,_e.type=Ur||je.dtype,_e.offset=dt,_e.stride=Tt,_e.divisor=nn}}kt[$e]=Mo(function(Br,Cn){var fn=Br.attribCache;if(ot in fn)return fn[ot];var En={isStream:!1};return Object.keys(_e).forEach(function(xn){En[xn]=_e[xn]}),_e.buffer&&(En.buffer=Br.link(_e.buffer),En.type=En.type||En.buffer+".dtype"),fn[ot]=En,En})}),Object.keys(ft).forEach(function($e){var Ne=ft[$e];function ot(_e,je){var Ae=_e.invoke(je,Ne),dt=_e.shared,Tt=_e.constants,dr=dt.isBufferArgs,Nr=dt.buffer;de.optional(function(){_e.assert(je,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+dr+"("+Ae+")||"+Nr+".getBuffer("+Ae+")||"+Nr+".getBuffer("+Ae+".buffer)||"+dr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+dt.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+$e+'"')});var Ur={isStream:je.def(!1)},nn=new ct;nn.state=Wn,Object.keys(nn).forEach(function(En){Ur[En]=je.def(""+nn[En])});var Br=Ur.buffer,Cn=Ur.type;je("if(",dr,"(",Ae,")){",Ur.isStream,"=true;",Br,"=",Nr,".createStream(",Cf,",",Ae,");",Cn,"=",Br,".dtype;","}else{",Br,"=",Nr,".getBuffer(",Ae,");","if(",Br,"){",Cn,"=",Br,".dtype;",'}else if("constant" in ',Ae,"){",Ur.state,"=",oi,";","if(typeof "+Ae+'.constant === "number"){',Ur[ti[0]],"=",Ae,".constant;",ti.slice(1).map(function(En){return Ur[En]}).join("="),"=0;","}else{",ti.map(function(En,xn){return Ur[En]+"="+Ae+".constant.length>"+xn+"?"+Ae+".constant["+xn+"]:0;"}).join(""),"}}else{","if(",dr,"(",Ae,".buffer)){",Br,"=",Nr,".createStream(",Cf,",",Ae,".buffer);","}else{",Br,"=",Nr,".getBuffer(",Ae,".buffer);","}",Cn,'="type" in ',Ae,"?",Tt.glTypes,"[",Ae,".type]:",Br,".dtype;",Ur.normalized,"=!!",Ae,".normalized;");function fn(En){je(Ur[En],"=",Ae,".",En,"|0;")}return fn("size"),fn("offset"),fn("stride"),fn("divisor"),je("}}"),je.exit("if(",Ur.isStream,"){",Nr,".destroyStream(",Br,");","}"),Ur}kt[$e]=Gs(Ne,ot)}),kt}function Ba(Se){var re=Se.static,Ve=Se.dynamic,ft={};return Object.keys(re).forEach(function(kt){var $e=re[kt];ft[kt]=Mo(function(Ne,ot){return typeof $e=="number"||typeof $e=="boolean"?""+$e:Ne.link($e)})}),Object.keys(Ve).forEach(function(kt){var $e=Ve[kt];ft[kt]=Gs($e,function(Ne,ot){return Ne.invoke(ot,$e)})}),ft}function Zo(Se,re,Ve,ft,kt){var $e=Se.static,Ne=Se.dynamic;de.optional(function(){var fn=[hu,wl,dc,eu,No,eh,Zc,Rh,Hl,th].concat(Bn);function En(xn){Object.keys(xn).forEach(function(dn){de.command(fn.indexOf(dn)>=0,'unknown parameter "'+dn+'"',kt.commandStr)})}En($e),En(Ne)});var ot=fi(Se,re),_e=on(Se,kt),je=Qn(Se,_e,kt),Ae=Ya(Se,kt),dt=io(Se,kt),Tt=Fi(Se,kt,ot);function dr(fn){var En=je[fn];En&&(dt[fn]=En)}dr(Js),dr(_n(Ef));var Nr=Object.keys(dt).length>0,Ur={framebuffer:_e,draw:Ae,shader:Tt,state:dt,dirty:Nr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ur.profile=Wr(Se,kt),Ur.uniforms=Bi(Ve,kt),Ur.drawVAO=Ur.scopeVAO=Ae.vao,!Ur.drawVAO&&Tt.program&&!ot&&Ue.angle_instanced_arrays&&Ae.static.elements){var nn=!0,Br=Tt.program.attributes.map(function(fn){var En=re.static[fn];return nn=nn&&!!En,En});if(nn&&Br.length>0){var Cn=Sr.getVAO(Sr.createVAO({attributes:Br,elements:Ae.static.elements}));Ur.drawVAO=new da(null,null,null,function(fn,En){return fn.link(Cn)}),Ur.useVAO=!0}}return ot?Ur.useVAO=!0:Ur.attributes=as(re,kt),Ur.context=Ba(ft,kt),Ur}function _o(Se,re,Ve){var ft=Se.shared,kt=ft.context,$e=Se.scope();Object.keys(Ve).forEach(function(Ne){re.save(kt,"."+Ne);var ot=Ve[Ne],_e=ot.append(Se,re);Array.isArray(_e)?$e(kt,".",Ne,"=[",_e.join(),"];"):$e(kt,".",Ne,"=",_e,";")}),re($e)}function jo(Se,re,Ve,ft){var kt=Se.shared,$e=kt.gl,Ne=kt.framebuffer,ot;zr&&(ot=re.def(kt.extensions,".webgl_draw_buffers"));var _e=Se.constants,je=_e.drawBuffer,Ae=_e.backBuffer,dt;Ve?dt=Ve.append(Se,re):dt=re.def(Ne,".next"),ft||re("if(",dt,"!==",Ne,".cur){"),re("if(",dt,"){",$e,".bindFramebuffer(",vp,",",dt,".framebuffer);"),zr&&re(ot,".drawBuffersWEBGL(",je,"[",dt,".colorAttachments.length]);"),re("}else{",$e,".bindFramebuffer(",vp,",null);"),zr&&re(ot,".drawBuffersWEBGL(",Ae,");"),re("}",Ne,".cur=",dt,";"),ft||re("}")}function Po(Se,re,Ve){var ft=Se.shared,kt=ft.gl,$e=Se.current,Ne=Se.next,ot=ft.current,_e=ft.next,je=Se.cond(ot,".dirty");Bn.forEach(function(Ae){var dt=_n(Ae);if(!(dt in Ve.state)){var Tt,dr;if(dt in Ne){Tt=Ne[dt],dr=$e[dt];var Nr=He(Lr[dt].length,function(nn){return je.def(Tt,"[",nn,"]")});je(Se.cond(Nr.map(function(nn,Br){return nn+"!=="+dr+"["+Br+"]"}).join("||")).then(kt,".",ar[dt],"(",Nr,");",Nr.map(function(nn,Br){return dr+"["+Br+"]="+nn}).join(";"),";"))}else{Tt=je.def(_e,".",dt);var Ur=Se.cond(Tt,"!==",ot,".",dt);je(Ur),dt in rr?Ur(Se.cond(Tt).then(kt,".enable(",rr[dt],");").else(kt,".disable(",rr[dt],");"),ot,".",dt,"=",Tt,";"):Ur(kt,".",ar[dt],"(",Tt,");",ot,".",dt,"=",Tt,";")}}}),Object.keys(Ve.state).length===0&&je(ot,".dirty=false;"),re(je)}function vs(Se,re,Ve,ft){var kt=Se.shared,$e=Se.current,Ne=kt.current,ot=kt.gl;gp(Object.keys(Ve)).forEach(function(_e){var je=Ve[_e];if(!(ft&&!ft(je))){var Ae=je.append(Se,re);if(rr[_e]){var dt=rr[_e];Xl(je)?Ae?re(ot,".enable(",dt,");"):re(ot,".disable(",dt,");"):re(Se.cond(Ae).then(ot,".enable(",dt,");").else(ot,".disable(",dt,");")),re(Ne,".",_e,"=",Ae,";")}else if(ua(Ae)){var Tt=$e[_e];re(ot,".",ar[_e],"(",Ae,");",Ae.map(function(dr,Nr){return Tt+"["+Nr+"]="+dr}).join(";"),";")}else re(ot,".",ar[_e],"(",Ae,");",Ne,".",_e,"=",Ae,";")}})}function ao(Se,re){Cr&&(Se.instancing=re.def(Se.shared.extensions,".angle_instanced_arrays"))}function vi(Se,re,Ve,ft,kt){var $e=Se.shared,Ne=Se.stats,ot=$e.current,_e=$e.timer,je=Ve.profile;function Ae(){var fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return fn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var dt,Tt;function dr(fn){dt=re.def(),fn(dt,"=",Ae(),";"),typeof kt=="string"?fn(Ne,".count+=",kt,";"):fn(Ne,".count++;"),xr&&(ft?(Tt=re.def(),fn(Tt,"=",_e,".getNumPendingQueries();")):fn(_e,".beginQuery(",Ne,");"))}function Nr(fn){fn(Ne,".cpuTime+=",Ae(),"-",dt,";"),xr&&(ft?fn(_e,".pushScopeStats(",Tt,",",_e,".getNumPendingQueries(),",Ne,");"):fn(_e,".endQuery();"))}function Ur(fn){var En=re.def(ot,".profile");re(ot,".profile=",fn,";"),re.exit(ot,".profile=",En,";")}var nn;if(je){if(Xl(je)){je.enable?(dr(re),Nr(re.exit),Ur("true")):Ur("false");return}nn=je.append(Se,re),Ur(nn)}else nn=re.def(ot,".profile");var Br=Se.block();dr(Br),re("if(",nn,"){",Br,"}");var Cn=Se.block();Nr(Cn),re.exit("if(",nn,"){",Cn,"}")}function Io(Se,re,Ve,ft,kt){var $e=Se.shared;function Ne(_e){switch(_e){case Vc:case Hc:case Tf:return 2;case cl:case fl:case Wc:return 3;case Gc:case ih:case Mf:return 4;default:return 1}}function ot(_e,je,Ae){var dt=$e.gl,Tt=re.def(_e,".location"),dr=re.def($e.attributes,"[",Tt,"]"),Nr=Ae.state,Ur=Ae.buffer,nn=[Ae.x,Ae.y,Ae.z,Ae.w],Br=["buffer","normalized","offset","stride"];function Cn(){re("if(!",dr,".buffer){",dt,".enableVertexAttribArray(",Tt,");}");var En=Ae.type,xn;if(Ae.size?xn=re.def(Ae.size,"||",je):xn=je,re("if(",dr,".type!==",En,"||",dr,".size!==",xn,"||",Br.map(function(qn){return dr+"."+qn+"!=="+Ae[qn]}).join("||"),"){",dt,".bindBuffer(",Cf,",",Ur,".buffer);",dt,".vertexAttribPointer(",[Tt,xn,En,Ae.normalized,Ae.stride,Ae.offset],");",dr,".type=",En,";",dr,".size=",xn,";",Br.map(function(qn){return dr+"."+qn+"="+Ae[qn]+";"}).join(""),"}"),Cr){var dn=Ae.divisor;re("if(",dr,".divisor!==",dn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[Tt,dn],");",dr,".divisor=",dn,";}")}}function fn(){re("if(",dr,".buffer){",dt,".disableVertexAttribArray(",Tt,");",dr,".buffer=null;","}if(",ti.map(function(En,xn){return dr+"."+En+"!=="+nn[xn]}).join("||"),"){",dt,".vertexAttrib4f(",Tt,",",nn,");",ti.map(function(En,xn){return dr+"."+En+"="+nn[xn]+";"}).join(""),"}")}Nr===Wn?Cn():Nr===oi?fn():(re("if(",Nr,"===",Wn,"){"),Cn(),re("}else{"),fn(),re("}"))}ft.forEach(function(_e){var je=_e.name,Ae=Ve.attributes[je],dt;if(Ae){if(!kt(Ae))return;dt=Ae.append(Se,re)}else{if(!kt(zh))return;var Tt=Se.scopeAttrib(je);de.optional(function(){Se.assert(re,Tt+".state","missing attribute "+je)}),dt={},Object.keys(new ct).forEach(function(dr){dt[dr]=re.def(Tt,".",dr)})}ot(Se.link(_e),Ne(_e.info.type),dt)})}function ji(Se,re,Ve,ft,kt,$e){for(var Ne=Se.shared,ot=Ne.gl,_e,je=0;je<ft.length;++je){var Ae=ft[je],dt=Ae.name,Tt=Ae.info.type,dr=Ve.uniforms[dt],Nr=Se.link(Ae),Ur=Nr+".location",nn;if(dr){if(!kt(dr))continue;if(Xl(dr)){var Br=dr.value;if(de.command(Br!==null&&typeof Br!="undefined",'missing uniform "'+dt+'"',Se.commandStr),Tt===ah||Tt===oh){de.command(typeof Br=="function"&&(Tt===ah&&(Br._reglType==="texture2d"||Br._reglType==="framebuffer")||Tt===oh&&(Br._reglType==="textureCube"||Br._reglType==="framebufferCube")),"invalid texture for uniform "+dt,Se.commandStr);var Cn=Se.link(Br._texture||Br.color[0]._texture);re(ot,".uniform1i(",Ur,",",Cn+".bind());"),re.exit(Cn,".unbind();")}else if(Tt===Vs||Tt===pu||Tt===Pf){de.optional(function(){de.command(ua(Br),"invalid matrix for uniform "+dt,Se.commandStr),de.command(Tt===Vs&&Br.length===4||Tt===pu&&Br.length===9||Tt===Pf&&Br.length===16,"invalid length for matrix uniform "+dt,Se.commandStr)});var fn=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Br)+"])"),En=2;Tt===pu?En=3:Tt===Pf&&(En=4),re(ot,".uniformMatrix",En,"fv(",Ur,",false,",fn,");")}else{switch(Tt){case Wl:de.commandType(Br,"number","uniform "+dt,Se.commandStr),_e="1f";break;case Vc:de.command(ua(Br)&&Br.length===2,"uniform "+dt,Se.commandStr),_e="2f";break;case cl:de.command(ua(Br)&&Br.length===3,"uniform "+dt,Se.commandStr),_e="3f";break;case Gc:de.command(ua(Br)&&Br.length===4,"uniform "+dt,Se.commandStr),_e="4f";break;case wf:de.commandType(Br,"boolean","uniform "+dt,Se.commandStr),_e="1i";break;case Af:de.commandType(Br,"number","uniform "+dt,Se.commandStr),_e="1i";break;case Tf:de.command(ua(Br)&&Br.length===2,"uniform "+dt,Se.commandStr),_e="2i";break;case Hc:de.command(ua(Br)&&Br.length===2,"uniform "+dt,Se.commandStr),_e="2i";break;case Wc:de.command(ua(Br)&&Br.length===3,"uniform "+dt,Se.commandStr),_e="3i";break;case fl:de.command(ua(Br)&&Br.length===3,"uniform "+dt,Se.commandStr),_e="3i";break;case Mf:de.command(ua(Br)&&Br.length===4,"uniform "+dt,Se.commandStr),_e="4i";break;case ih:de.command(ua(Br)&&Br.length===4,"uniform "+dt,Se.commandStr),_e="4i";break}re(ot,".uniform",_e,"(",Ur,",",ua(Br)?Array.prototype.slice.call(Br):Br,");")}continue}else nn=dr.append(Se,re)}else{if(!kt(zh))continue;nn=re.def(Ne.uniforms,"[",me.id(dt),"]")}Tt===ah?(de(!Array.isArray(nn),"must specify a scalar prop for textures"),re("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):Tt===oh&&(de(!Array.isArray(nn),"must specify a scalar prop for cube maps"),re("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),de.optional(function(){function Is(Pu,yc){Se.assert(re,Pu,'bad data or missing for uniform "'+dt+'".  '+yc)}function dl(Pu){de(!Array.isArray(nn),"must not specify an array type for uniform"),Is("typeof "+nn+'==="'+Pu+'"',"invalid type, expected "+Pu)}function Mu(Pu,yc){Array.isArray(nn)?de(nn.length===Pu,"must have length "+Pu):Is(Ne.isArrayLike+"("+nn+")&&"+nn+".length==="+Pu,"invalid vector, should have length "+Pu,Se.commandStr)}function _p(Pu){de(!Array.isArray(nn),"must not specify a value type"),Is("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(Pu===fp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(Tt){case Af:dl("number");break;case Hc:Mu(2,"number");break;case fl:Mu(3,"number");break;case ih:Mu(4,"number");break;case Wl:dl("number");break;case Vc:Mu(2,"number");break;case cl:Mu(3,"number");break;case Gc:Mu(4,"number");break;case wf:dl("boolean");break;case Tf:Mu(2,"boolean");break;case Wc:Mu(3,"boolean");break;case Mf:Mu(4,"boolean");break;case Vs:Mu(4,"number");break;case pu:Mu(9,"number");break;case Pf:Mu(16,"number");break;case ah:_p(fp);break;case oh:_p(mc);break}});var xn=1;switch(Tt){case ah:case oh:var dn=re.def(nn,"._texture");re(ot,".uniform1i(",Ur,",",dn,".bind());"),re.exit(dn,".unbind();");continue;case Af:case wf:_e="1i";break;case Hc:case Tf:_e="2i",xn=2;break;case fl:case Wc:_e="3i",xn=3;break;case ih:case Mf:_e="4i",xn=4;break;case Wl:_e="1f";break;case Vc:_e="2f",xn=2;break;case cl:_e="3f",xn=3;break;case Gc:_e="4f",xn=4;break;case Vs:_e="Matrix2fv";break;case pu:_e="Matrix3fv";break;case Pf:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){re(ot,".uniform",_e,"(",Ur,",");var qn=Math.pow(Tt-Vs+2,2),va=Se.global.def("new Float32Array(",qn,")");Array.isArray(nn)?re("false,(",He(qn,function(Is){return va+"["+Is+"]="+nn[Is]}),",",va,")"):re("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",He(qn,function(Is){return va+"["+Is+"]="+nn+"["+Is+"]"}),",",va,")"),re(");")}else if(xn>1){for(var ss=[],ka=[],aa=0;aa<xn;++aa)Array.isArray(nn)?ka.push(nn[aa]):ka.push(re.def(nn+"["+aa+"]")),$e&&ss.push(re.def());$e&&re("if(!",Se.batchId,"||",ss.map(function(Is,dl){return Is+"!=="+ka[dl]}).join("||"),"){",ss.map(function(Is,dl){return Is+"="+ka[dl]+";"}).join("")),re(ot,".uniform",_e,"(",Ur,",",ka.join(","),");"),$e&&re("}")}else{if(de(!Array.isArray(nn),"uniform value must not be an array"),$e){var Pl=re.def();re("if(!",Se.batchId,"||",Pl,"!==",nn,"){",Pl,"=",nn,";")}re(ot,".uniform",_e,"(",Ur,",",nn,");"),$e&&re("}")}}}function os(Se,re,Ve,ft){var kt=Se.shared,$e=kt.gl,Ne=kt.draw,ot=ft.draw;function _e(){var xn=ot.elements,dn,qn=re;return xn?((xn.contextDep&&ft.contextDynamic||xn.propDep)&&(qn=Ve),dn=xn.append(Se,qn),ot.elementsActive&&qn("if("+dn+")"+$e+".bindBuffer("+zo+","+dn+".buffer.buffer);")):(dn=qn.def(),qn(dn,"=",Ne,".",eu,";","if(",dn,"){",$e,".bindBuffer(",zo,",",dn,".buffer.buffer);}","else if(",kt.vao,".currentVAO){",dn,"=",Se.shared.elements+".getElements("+kt.vao,".currentVAO.elements);",hr?"":"if("+dn+")"+$e+".bindBuffer("+zo+","+dn+".buffer.buffer);","}")),dn}function je(){var xn=ot.count,dn,qn=re;return xn?((xn.contextDep&&ft.contextDynamic||xn.propDep)&&(qn=Ve),dn=xn.append(Se,qn),de.optional(function(){xn.MISSING&&Se.assert(re,"false","missing vertex count"),xn.DYNAMIC&&Se.assert(qn,dn+">=0","missing vertex count")})):(dn=qn.def(Ne,".",Zc),de.optional(function(){Se.assert(qn,dn+">=0","missing vertex count")})),dn}var Ae=_e();function dt(xn){var dn=ot[xn];return dn?dn.contextDep&&ft.contextDynamic||dn.propDep?dn.append(Se,Ve):dn.append(Se,re):re.def(Ne,".",xn)}var Tt=dt(No),dr=dt(eh),Nr=je();if(typeof Nr=="number"){if(Nr===0)return}else Ve("if(",Nr,"){"),Ve.exit("}");var Ur,nn;Cr&&(Ur=dt(Rh),nn=Se.instancing);var Br=Ae+".type",Cn=ot.elements&&Xl(ot.elements)&&!ot.vaoActive;function fn(){function xn(){Ve(nn,".drawElementsInstancedANGLE(",[Tt,Nr,Br,dr+"<<(("+Br+"-"+ri+")>>1)",Ur],");")}function dn(){Ve(nn,".drawArraysInstancedANGLE(",[Tt,dr,Nr,Ur],");")}Ae&&Ae!=="null"?Cn?xn():(Ve("if(",Ae,"){"),xn(),Ve("}else{"),dn(),Ve("}")):dn()}function En(){function xn(){Ve($e+".drawElements("+[Tt,Nr,Br,dr+"<<(("+Br+"-"+ri+")>>1)"]+");")}function dn(){Ve($e+".drawArrays("+[Tt,dr,Nr]+");")}Ae&&Ae!=="null"?Cn?xn():(Ve("if(",Ae,"){"),xn(),Ve("}else{"),dn(),Ve("}")):dn()}Cr&&(typeof Ur!="number"||Ur>=0)?typeof Ur=="string"?(Ve("if(",Ur,">0){"),fn(),Ve("}else if(",Ur,"<0){"),En(),Ve("}")):fn():En()}function hn(Se,re,Ve,ft,kt){var $e=ni(),Ne=$e.proc("body",kt);return de.optional(function(){$e.commandStr=re.commandStr,$e.command=$e.link(re.commandStr)}),Cr&&($e.instancing=Ne.def($e.shared.extensions,".angle_instanced_arrays")),Se($e,Ne,Ve,ft),$e.compile().body}function mi(Se,re,Ve,ft){ao(Se,re),Ve.useVAO?Ve.drawVAO?re(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,re),");"):re(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(re(Se.shared.vao,".setVAO(null);"),Io(Se,re,Ve,ft.attributes,function(){return!0})),ji(Se,re,Ve,ft.uniforms,function(){return!0},!1),os(Se,re,re,Ve)}function ca(Se,re){var Ve=Se.proc("draw",1);ao(Se,Ve),_o(Se,Ve,re.context),jo(Se,Ve,re.framebuffer),Po(Se,Ve,re),vs(Se,Ve,re.state),vi(Se,Ve,re,!1,!0);var ft=re.shader.progVar.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",ft,".program);"),re.shader.program)mi(Se,Ve,re,re.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var kt=Se.global.def("{}"),$e=Ve.def(ft,".id"),Ne=Ve.def(kt,"[",$e,"]");Ve(Se.cond(Ne).then(Ne,".call(this,a0);").else(Ne,"=",kt,"[",$e,"]=",Se.link(function(ot){return hn(mi,Se,re,ot,1)}),"(",ft,");",Ne,".call(this,a0);"))}Object.keys(re.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function xo(Se,re,Ve,ft){Se.batchId="a1",ao(Se,re);function kt(){return!0}Io(Se,re,Ve,ft.attributes,kt),ji(Se,re,Ve,ft.uniforms,kt,!1),os(Se,re,re,Ve)}function pl(Se,re,Ve,ft){ao(Se,re);var kt=Ve.contextDep,$e=re.def(),Ne="a0",ot="a1",_e=re.def();Se.shared.props=_e,Se.batchId=$e;var je=Se.scope(),Ae=Se.scope();re(je.entry,"for(",$e,"=0;",$e,"<",ot,";++",$e,"){",_e,"=",Ne,"[",$e,"];",Ae,"}",je.exit);function dt(Br){return Br.contextDep&&kt||Br.propDep}function Tt(Br){return!dt(Br)}if(Ve.needsContext&&_o(Se,Ae,Ve.context),Ve.needsFramebuffer&&jo(Se,Ae,Ve.framebuffer),vs(Se,Ae,Ve.state,dt),Ve.profile&&dt(Ve.profile)&&vi(Se,Ae,Ve,!1,!0),ft)Ve.useVAO?Ve.drawVAO?dt(Ve.drawVAO)?Ae(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,Ae),");"):je(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,je),");"):je(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(je(Se.shared.vao,".setVAO(null);"),Io(Se,je,Ve,ft.attributes,Tt),Io(Se,Ae,Ve,ft.attributes,dt)),ji(Se,je,Ve,ft.uniforms,Tt,!1),ji(Se,Ae,Ve,ft.uniforms,dt,!0),os(Se,je,Ae,Ve);else{var dr=Se.global.def("{}"),Nr=Ve.shader.progVar.append(Se,Ae),Ur=Ae.def(Nr,".id"),nn=Ae.def(dr,"[",Ur,"]");Ae(Se.shared.gl,".useProgram(",Nr,".program);","if(!",nn,"){",nn,"=",dr,"[",Ur,"]=",Se.link(function(Br){return hn(xo,Se,Ve,Br,2)}),"(",Nr,");}",nn,".call(this,a0[",$e,"],",$e,");")}}function Me(Se,re){var Ve=Se.proc("batch",2);Se.batchId="0",ao(Se,Ve);var ft=!1,kt=!0;Object.keys(re.context).forEach(function(dr){ft=ft||re.context[dr].propDep}),ft||(_o(Se,Ve,re.context),kt=!1);var $e=re.framebuffer,Ne=!1;$e?($e.propDep?ft=Ne=!0:$e.contextDep&&ft&&(Ne=!0),Ne||jo(Se,Ve,$e)):jo(Se,Ve,null),re.state.viewport&&re.state.viewport.propDep&&(ft=!0);function ot(dr){return dr.contextDep&&ft||dr.propDep}Po(Se,Ve,re),vs(Se,Ve,re.state,function(dr){return!ot(dr)}),(!re.profile||!ot(re.profile))&&vi(Se,Ve,re,!1,"a1"),re.contextDep=ft,re.needsContext=kt,re.needsFramebuffer=Ne;var _e=re.shader.progVar;if(_e.contextDep&&ft||_e.propDep)pl(Se,Ve,re,null);else{var je=_e.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",je,".program);"),re.shader.program)pl(Se,Ve,re,re.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var Ae=Se.global.def("{}"),dt=Ve.def(je,".id"),Tt=Ve.def(Ae,"[",dt,"]");Ve(Se.cond(Tt).then(Tt,".call(this,a0,a1);").else(Tt,"=",Ae,"[",dt,"]=",Se.link(function(dr){return hn(pl,Se,re,dr,2)}),"(",je,");",Tt,".call(this,a0,a1);"))}}Object.keys(re.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Ut(Se,re){var Ve=Se.proc("scope",3);Se.batchId="a2";var ft=Se.shared,kt=ft.current;_o(Se,Ve,re.context),re.framebuffer&&re.framebuffer.append(Se,Ve),gp(Object.keys(re.state)).forEach(function(Ne){var ot=re.state[Ne],_e=ot.append(Se,Ve);ua(_e)?_e.forEach(function(je,Ae){Ve.set(Se.next[Ne],"["+Ae+"]",je)}):Ve.set(ft.next,"."+Ne,_e)}),vi(Se,Ve,re,!0,!0),[eu,eh,Zc,Rh,No].forEach(function(Ne){var ot=re.draw[Ne];!ot||Ve.set(ft.draw,"."+Ne,""+ot.append(Se,Ve))}),Object.keys(re.uniforms).forEach(function(Ne){var ot=re.uniforms[Ne].append(Se,Ve);Array.isArray(ot)&&(ot="["+ot.join()+"]"),Ve.set(ft.uniforms,"["+me.id(Ne)+"]",ot)}),Object.keys(re.attributes).forEach(function(Ne){var ot=re.attributes[Ne].append(Se,Ve),_e=Se.scopeAttrib(Ne);Object.keys(new ct).forEach(function(je){Ve.set(_e,"."+je,ot[je])})}),re.scopeVAO&&Ve.set(ft.vao,".targetVAO",re.scopeVAO.append(Se,Ve));function $e(Ne){var ot=re.shader[Ne];ot&&Ve.set(ft.shader,"."+Ne,ot.append(Se,Ve))}$e(wl),$e(dc),Object.keys(re.state).length>0&&(Ve(kt,".dirty=true;"),Ve.exit(kt,".dirty=true;")),Ve("a1(",Se.shared.context,",a0,",Se.batchId,");")}function wt(Se){if(!(typeof Se!="object"||ua(Se))){for(var re=Object.keys(Se),Ve=0;Ve<re.length;++Ve)if(an.isDynamic(Se[re[Ve]]))return!0;return!1}}function cn(Se,re,Ve){var ft=re.static[Ve];if(!ft||!wt(ft))return;var kt=Se.global,$e=Object.keys(ft),Ne=!1,ot=!1,_e=!1,je=Se.global.def("{}");$e.forEach(function(dt){var Tt=ft[dt];if(an.isDynamic(Tt)){typeof Tt=="function"&&(Tt=ft[dt]=an.unbox(Tt));var dr=Gs(Tt,null);Ne=Ne||dr.thisDep,_e=_e||dr.propDep,ot=ot||dr.contextDep}else{switch(kt(je,".",dt,"="),typeof Tt){case"number":kt(Tt);break;case"string":kt('"',Tt,'"');break;case"object":Array.isArray(Tt)&&kt("[",Tt.join(),"]");break;default:kt(Se.link(Tt));break}kt(";")}});function Ae(dt,Tt){$e.forEach(function(dr){var Nr=ft[dr];if(!!an.isDynamic(Nr)){var Ur=dt.invoke(Tt,Nr);Tt(je,".",dr,"=",Ur,";")}})}re.dynamic[Ve]=new an.DynamicVariable(Bo,{thisDep:Ne,contextDep:ot,propDep:_e,ref:je,append:Ae}),delete re.static[Ve]}function Ni(Se,re,Ve,ft,kt){var $e=ni();$e.stats=$e.link(kt),Object.keys(re.static).forEach(function(ot){cn($e,re,ot)}),kd.forEach(function(ot){cn($e,Se,ot)});var Ne=Zo(Se,re,Ve,ft,$e);return ca($e,Ne),Ut($e,Ne),Me($e,Ne),m($e.compile(),{destroy:function(){Ne.shader.program.destroy()}})}return{next:Kr,current:Lr,procs:function(){var Se=ni(),re=Se.proc("poll"),Ve=Se.proc("refresh"),ft=Se.block();re(ft),Ve(ft);var kt=Se.shared,$e=kt.gl,Ne=kt.next,ot=kt.current;ft(ot,".dirty=false;"),jo(Se,re),jo(Se,Ve,null,!0);var _e;Cr&&(_e=Se.link(Cr)),Ue.oes_vertex_array_object&&Ve(Se.link(Ue.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var je=0;je<Nt.maxAttributes;++je){var Ae=Ve.def(kt.attributes,"[",je,"]"),dt=Se.cond(Ae,".buffer");dt.then($e,".enableVertexAttribArray(",je,");",$e,".bindBuffer(",Cf,",",Ae,".buffer.buffer);",$e,".vertexAttribPointer(",je,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else($e,".disableVertexAttribArray(",je,");",$e,".vertexAttrib4f(",je,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ve(dt),Cr&&Ve(_e,".vertexAttribDivisorANGLE(",je,",",Ae,".divisor);")}return Ve(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(rr).forEach(function(Tt){var dr=rr[Tt],Nr=ft.def(Ne,".",Tt),Ur=Se.block();Ur("if(",Nr,"){",$e,".enable(",dr,")}else{",$e,".disable(",dr,")}",ot,".",Tt,"=",Nr,";"),Ve(Ur),re("if(",Nr,"!==",ot,".",Tt,"){",Ur,"}")}),Object.keys(ar).forEach(function(Tt){var dr=ar[Tt],Nr=Lr[Tt],Ur,nn,Br=Se.block();if(Br($e,".",dr,"("),ua(Nr)){var Cn=Nr.length;Ur=Se.global.def(Ne,".",Tt),nn=Se.global.def(ot,".",Tt),Br(He(Cn,function(fn){return Ur+"["+fn+"]"}),");",He(Cn,function(fn){return nn+"["+fn+"]="+Ur+"["+fn+"];"}).join("")),re("if(",He(Cn,function(fn){return Ur+"["+fn+"]!=="+nn+"["+fn+"]"}).join("||"),"){",Br,"}")}else Ur=ft.def(Ne,".",Tt),nn=ft.def(ot,".",Tt),Br(Ur,");",ot,".",Tt,"=",Ur,";"),re("if(",Ur,"!==",nn,"){",Br,"}");Ve(Br)}),Se.compile()}(),compile:Ni}}function Fd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Bd=34918,Nd=34919,yp=35007,zd=function(B,me){if(!me.ext_disjoint_timer_query)return null;var Ue=[];function Nt(){return Ue.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function or(Cr){Ue.push(Cr)}var Ft=[];function Ye(Cr){var zr=Nt();me.ext_disjoint_timer_query.beginQueryEXT(yp,zr),Ft.push(zr),xr(Ft.length-1,Ft.length,Cr)}function pr(){me.ext_disjoint_timer_query.endQueryEXT(yp)}function De(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Sr=[];function Or(){return Sr.pop()||new De}function Rr(Cr){Sr.push(Cr)}var Zr=[];function xr(Cr,zr,hr){var Lr=Or();Lr.startQueryIndex=Cr,Lr.endQueryIndex=zr,Lr.sum=0,Lr.stats=hr,Zr.push(Lr)}var Pr=[],ct=[];function Vt(){var Cr,zr,hr=Ft.length;if(hr!==0){ct.length=Math.max(ct.length,hr+1),Pr.length=Math.max(Pr.length,hr+1),Pr[0]=0,ct[0]=0;var Lr=0;for(Cr=0,zr=0;zr<Ft.length;++zr){var Kr=Ft[zr];me.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Nd)?(Lr+=me.ext_disjoint_timer_query.getQueryObjectEXT(Kr,Bd),or(Kr)):Ft[Cr++]=Kr,Pr[zr+1]=Lr,ct[zr+1]=Cr}for(Ft.length=Cr,Cr=0,zr=0;zr<Zr.length;++zr){var Bn=Zr[zr],rr=Bn.startQueryIndex,ar=Bn.endQueryIndex;Bn.sum+=Pr[ar]-Pr[rr];var _n=ct[rr],Gr=ct[ar];Gr===_n?(Bn.stats.gpuTime+=Bn.sum/1e6,Rr(Bn)):(Bn.startQueryIndex=_n,Bn.endQueryIndex=Gr,Zr[Cr++]=Bn)}Zr.length=Cr}}return{beginQuery:Ye,endQuery:pr,pushScopeStats:xr,update:Vt,getNumPendingQueries:function(){return Ft.length},clear:function(){Ue.push.apply(Ue,Ft);for(var Cr=0;Cr<Ue.length;Cr++)me.ext_disjoint_timer_query.deleteQueryEXT(Ue[Cr]);Ft.length=0,Ue.length=0},restore:function(){Ft.length=0,Ue.length=0}}},Lf=16384,sh=256,rd=1024,nd=34962,uh="webglcontextlost",Aa="webglcontextrestored",Uh=1,Yl=2,kf=3;function Zh(B,me){for(var Ue=0;Ue<B.length;++Ue)if(B[Ue]===me)return Ue;return-1}function id(B){var me=ge(B);if(!me)return null;var Ue=me.gl,Nt=Ue.getContextAttributes(),or=Ue.isContextLost(),Ft=Ie(Ue,me);if(!Ft)return null;var Ye=ls(),pr=Fd(),De=Ft.extensions,Sr=zd(Ue,De),Or=Wa(),Rr=Ue.drawingBufferWidth,Zr=Ue.drawingBufferHeight,xr={tick:0,time:0,viewportWidth:Rr,viewportHeight:Zr,framebufferWidth:Rr,framebufferHeight:Zr,drawingBufferWidth:Rr,drawingBufferHeight:Zr,pixelRatio:me.pixelRatio},Pr={},ct={elements:null,primitive:4,count:-1,offset:0,instances:-1},Vt=Ic(Ue,De),Cr=F(Ue,pr,me,Lr),zr=Ju(Ue,De,Cr,pr),hr=bt(Ue,De,Vt,pr,Cr,zr,ct);function Lr(hn){return hr.destroyBuffer(hn)}var Kr=lr(Ue,Ye,pr,me),Bn=hs(Ue,De,Vt,function(){_n.procs.poll()},xr,pr,me),rr=ol(Ue,De,Vt,pr,me),ar=Le(Ue,De,Vt,Bn,rr,pr),_n=td(Ue,Ye,De,Vt,Cr,zr,Bn,ar,Pr,hr,Kr,ct,xr,Sr,me),Gr=Fn(Ue,ar,_n.procs.poll,xr,Nt,De,Vt),Ar=_n.next,$r=Ue.canvas,Jr=[],di=[],ni=[],Wr=[me.onDestroy],on=null;function Qn(){if(Jr.length===0){Sr&&Sr.update(),on=null;return}on=Ai.next(Qn),ao();for(var hn=Jr.length-1;hn>=0;--hn){var mi=Jr[hn];mi&&mi(xr,null,0)}Ue.flush(),Sr&&Sr.update()}function fi(){!on&&Jr.length>0&&(on=Ai.next(Qn))}function Fi(){on&&(Ai.cancel(Qn),on=null)}function Ya(hn){hn.preventDefault(),or=!0,Fi(),di.forEach(function(mi){mi()})}function io(hn){Ue.getError(),or=!1,Ft.restore(),Kr.restore(),Cr.restore(),Bn.restore(),rr.restore(),ar.restore(),hr.restore(),Sr&&Sr.restore(),_n.procs.refresh(),fi(),ni.forEach(function(mi){mi()})}var Bi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Bi&&$r&&($r.addEventListener(uh,Ya,!1),$r.addEventListener(Aa,io,!1));function as(){Jr.length=0,Fi(),!Bi&&$r&&($r.removeEventListener(uh,Ya),$r.removeEventListener(Aa,io)),Kr.clear(),ar.clear(),rr.clear(),hr.clear(),Bn.clear(),zr.clear(),Cr.clear(),Sr&&Sr.clear(),Wr.forEach(function(hn){hn()})}function Ba(hn){de(!!hn,"invalid args to regl({...})"),de.type(hn,"object","invalid args to regl({...})");function mi($e){var Ne=m({},$e);delete Ne.uniforms,delete Ne.attributes,delete Ne.context,delete Ne.vao,"stencil"in Ne&&Ne.stencil.op&&(Ne.stencil.opBack=Ne.stencil.opFront=Ne.stencil.op,delete Ne.stencil.op);function ot(_e){if(_e in Ne){var je=Ne[_e];delete Ne[_e],Object.keys(je).forEach(function(Ae){Ne[_e+"."+Ae]=je[Ae]})}}return ot("blend"),ot("depth"),ot("cull"),ot("stencil"),ot("polygonOffset"),ot("scissor"),ot("sample"),"vao"in $e&&(Ne.vao=$e.vao),Ne}function ca($e,Ne){var ot={},_e={};return Object.keys($e).forEach(function(je){var Ae=$e[je];if(an.isDynamic(Ae)){_e[je]=an.unbox(Ae,je);return}else if(Ne&&Array.isArray(Ae)){for(var dt=0;dt<Ae.length;++dt)if(an.isDynamic(Ae[dt])){_e[je]=an.unbox(Ae,je);return}}ot[je]=Ae}),{dynamic:_e,static:ot}}var xo=ca(hn.context||{},!0),pl=ca(hn.uniforms||{},!0),Me=ca(hn.attributes||{},!1),Ut=ca(mi(hn),!1),wt={gpuTime:0,cpuTime:0,count:0},cn=_n.compile(Ut,Me,pl,xo,wt),Ni=cn.draw,Se=cn.batch,re=cn.scope,Ve=[];function ft($e){for(;Ve.length<$e;)Ve.push(null);return Ve}function kt($e,Ne){var ot;if(or&&de.raise("context lost"),typeof $e=="function")return re.call(this,null,$e,0);if(typeof Ne=="function")if(typeof $e=="number")for(ot=0;ot<$e;++ot)re.call(this,null,Ne,ot);else if(Array.isArray($e))for(ot=0;ot<$e.length;++ot)re.call(this,$e[ot],Ne,ot);else return re.call(this,$e,Ne,0);else if(typeof $e=="number"){if($e>0)return Se.call(this,ft($e|0),$e|0)}else if(Array.isArray($e)){if($e.length)return Se.call(this,$e,$e.length)}else return Ni.call(this,$e)}return m(kt,{stats:wt,destroy:function(){cn.destroy()}})}var Zo=ar.setFBO=Ba({framebuffer:an.define.call(null,Uh,"framebuffer")});function _o(hn,mi){var ca=0;_n.procs.poll();var xo=mi.color;xo&&(Ue.clearColor(+xo[0]||0,+xo[1]||0,+xo[2]||0,+xo[3]||0),ca|=Lf),"depth"in mi&&(Ue.clearDepth(+mi.depth),ca|=sh),"stencil"in mi&&(Ue.clearStencil(mi.stencil|0),ca|=rd),de(!!ca,"called regl.clear with no buffer specified"),Ue.clear(ca)}function jo(hn){if(de(typeof hn=="object"&&hn,"regl.clear() takes an object as input"),"framebuffer"in hn)if(hn.framebuffer&&hn.framebuffer_reglType==="framebufferCube")for(var mi=0;mi<6;++mi)Zo(m({framebuffer:hn.framebuffer.faces[mi]},hn),_o);else Zo(hn,_o);else _o(null,hn)}function Po(hn){de.type(hn,"function","regl.frame() callback must be a function"),Jr.push(hn);function mi(){var ca=Zh(Jr,hn);de(ca>=0,"cannot cancel a frame twice");function xo(){var pl=Zh(Jr,xo);Jr[pl]=Jr[Jr.length-1],Jr.length-=1,Jr.length<=0&&Fi()}Jr[ca]=xo}return fi(),{cancel:mi}}function vs(){var hn=Ar.viewport,mi=Ar.scissor_box;hn[0]=hn[1]=mi[0]=mi[1]=0,xr.viewportWidth=xr.framebufferWidth=xr.drawingBufferWidth=hn[2]=mi[2]=Ue.drawingBufferWidth,xr.viewportHeight=xr.framebufferHeight=xr.drawingBufferHeight=hn[3]=mi[3]=Ue.drawingBufferHeight}function ao(){xr.tick+=1,xr.time=Io(),vs(),_n.procs.poll()}function vi(){Bn.refresh(),vs(),_n.procs.refresh(),Sr&&Sr.update()}function Io(){return(Wa()-Or)/1e3}vi();function ji(hn,mi){de.type(mi,"function","listener callback must be a function");var ca;switch(hn){case"frame":return Po(mi);case"lost":ca=di;break;case"restore":ca=ni;break;case"destroy":ca=Wr;break;default:de.raise("invalid event, must be one of frame,lost,restore,destroy")}return ca.push(mi),{cancel:function(){for(var xo=0;xo<ca.length;++xo)if(ca[xo]===mi){ca[xo]=ca[ca.length-1],ca.pop();return}}}}var os=m(Ba,{clear:jo,prop:an.define.bind(null,Uh),context:an.define.bind(null,Yl),this:an.define.bind(null,kf),draw:Ba({}),buffer:function(hn){return Cr.create(hn,nd,!1,!1)},elements:function(hn){return zr.create(hn,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:rr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:hr.createVAO,attributes:Nt,frame:Po,on:ji,limits:Vt,hasExtension:function(hn){return Vt.extensions.indexOf(hn.toLowerCase())>=0},read:Gr,destroy:as,_gl:Ue,_refresh:vi,poll:function(){ao(),Sr&&Sr.update()},now:Io,stats:pr});return me.onDone(null,os),os}return id})},77412:function(Ot){function J(N,le){for(var ye=-1,m=N==null?0:N.length;++ye<m&&le(N[ye],ye,N)!==!1;);return N}Ot.exports=J},47443:function(Ot,J,N){var le=N(42118);function ye(m,ve){var j=m==null?0:m.length;return!!j&&le(m,ve,0)>-1}Ot.exports=ye},1196:function(Ot){function J(N,le,ye){for(var m=-1,ve=N==null?0:N.length;++m<ve;)if(ye(le,N[m]))return!0;return!1}Ot.exports=J},62663:function(Ot){function J(N,le,ye,m){var ve=-1,j=N==null?0:N.length;for(m&&j&&(ye=N[++ve]);++ve<j;)ye=le(ye,N[ve],ve,N);return ye}Ot.exports=J},49029:function(Ot){var J=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function N(le){return le.match(J)||[]}Ot.exports=N},44037:function(Ot,J,N){var le=N(98363),ye=N(3674);function m(ve,j){return ve&&le(j,ye(j),ve)}Ot.exports=m},63886:function(Ot,J,N){var le=N(98363),ye=N(81704);function m(ve,j){return ve&&le(j,ye(j),ve)}Ot.exports=m},29750:function(Ot){function J(N,le,ye){return N===N&&(ye!==void 0&&(N=N<=ye?N:ye),le!==void 0&&(N=N>=le?N:le)),N}Ot.exports=J},85990:function(Ot,J,N){var le=N(46384),ye=N(77412),m=N(34865),ve=N(44037),j=N(63886),ce=N(64626),ue=N(278),ze=N(18805),ae=N(1911),nt=N(58234),ke=N(46904),st=N(64160),Gt=N(43824),sr=N(29148),Pt=N(38517),er=N(1469),Lt=N(44144),ht=N(56688),mt=N(13218),tr=N(72928),q=N(3674),Jt=N(81704),_t=1,rt=2,At=4,tt="[object Arguments]",$t="[object Array]",br="[object Boolean]",Fr="[object Date]",en="[object Error]",Te="[object Function]",Ke="[object GeneratorFunction]",Fe="[object Map]",Mt="[object Number]",gt="[object Object]",Zt="[object RegExp]",qt="[object Set]",Er="[object String]",Kn="[object Symbol]",pn="[object WeakMap]",Wi="[object ArrayBuffer]",Zn="[object DataView]",Gn="[object Float32Array]",pi="[object Float64Array]",$n="[object Int8Array]",ui="[object Int16Array]",Ji="[object Int32Array]",Ii="[object Uint8Array]",Ei="[object Uint8ClampedArray]",zi="[object Uint16Array]",na="[object Uint32Array]",Si={};Si[tt]=Si[$t]=Si[Wi]=Si[Zn]=Si[br]=Si[Fr]=Si[Gn]=Si[pi]=Si[$n]=Si[ui]=Si[Ji]=Si[Fe]=Si[Mt]=Si[gt]=Si[Zt]=Si[qt]=Si[Er]=Si[Kn]=Si[Ii]=Si[Ei]=Si[zi]=Si[na]=!0,Si[en]=Si[Te]=Si[pn]=!1;function ya(wn,_i,ki,Xi,za,de){var Nn,Ua=_i&_t,us=_i&rt,jt=_i&At;if(ki&&(Nn=za?ki(wn,Xi,za,de):ki(wn)),Nn!==void 0)return Nn;if(!mt(wn))return wn;var ir=er(wn);if(ir){if(Nn=Gt(wn),!Ua)return ue(wn,Nn)}else{var Tr=st(wn),I=Tr==Te||Tr==Ke;if(Lt(wn))return ce(wn,Ua);if(Tr==gt||Tr==tt||I&&!za){if(Nn=us||I?{}:Pt(wn),!Ua)return us?ae(wn,j(Nn,wn)):ze(wn,ve(Nn,wn))}else{if(!Si[Tr])return za?wn:{};Nn=sr(wn,Tr,Ua)}}de||(de=new le);var nr=de.get(wn);if(nr)return nr;de.set(wn,Nn),tr(wn)?wn.forEach(function(Hn){Nn.add(ya(Hn,_i,ki,Hn,wn,de))}):ht(wn)&&wn.forEach(function(Hn,an){Nn.set(an,ya(Hn,_i,ki,an,wn,de))});var Dn=jt?us?ke:nt:us?Jt:q,li=ir?void 0:Dn(wn);return ye(li||wn,function(Hn,an){li&&(an=Hn,Hn=wn[an]),m(Nn,an,ya(Hn,_i,ki,an,wn,de))}),Nn}Ot.exports=ya},41848:function(Ot){function J(N,le,ye,m){for(var ve=N.length,j=ye+(m?1:-1);m?j--:++j<ve;)if(le(N[j],j,N))return j;return-1}Ot.exports=J},42118:function(Ot,J,N){var le=N(41848),ye=N(62722),m=N(42351);function ve(j,ce,ue){return ce===ce?m(j,ce,ue):le(j,ye,ue)}Ot.exports=ve},25588:function(Ot,J,N){var le=N(64160),ye=N(37005),m="[object Map]";function ve(j){return ye(j)&&le(j)==m}Ot.exports=ve},62722:function(Ot){function J(N){return N!==N}Ot.exports=J},29221:function(Ot,J,N){var le=N(64160),ye=N(37005),m="[object Set]";function ve(j){return ye(j)&&le(j)==m}Ot.exports=ve},40371:function(Ot){function J(N){return function(le){return le==null?void 0:le[N]}}Ot.exports=J},18674:function(Ot){function J(N){return function(le){return N==null?void 0:N[le]}}Ot.exports=J},45652:function(Ot,J,N){var le=N(88668),ye=N(47443),m=N(1196),ve=N(74757),j=N(23593),ce=N(21814),ue=200;function ze(ae,nt,ke){var st=-1,Gt=ye,sr=ae.length,Pt=!0,er=[],Lt=er;if(ke)Pt=!1,Gt=m;else if(sr>=ue){var ht=nt?null:j(ae);if(ht)return ce(ht);Pt=!1,Gt=ve,Lt=new le}else Lt=nt?[]:er;e:for(;++st<sr;){var mt=ae[st],tr=nt?nt(mt):mt;if(mt=ke||mt!==0?mt:0,Pt&&tr===tr){for(var q=Lt.length;q--;)if(Lt[q]===tr)continue e;nt&&Lt.push(tr),er.push(mt)}else Gt(Lt,tr,ke)||(Lt!==er&&Lt.push(tr),er.push(mt))}return er}Ot.exports=ze},57157:function(Ot,J,N){var le=N(74318);function ye(m,ve){var j=ve?le(m.buffer):m.buffer;return new m.constructor(j,m.byteOffset,m.byteLength)}Ot.exports=ye},93147:function(Ot){var J=/\w*$/;function N(le){var ye=new le.constructor(le.source,J.exec(le));return ye.lastIndex=le.lastIndex,ye}Ot.exports=N},40419:function(Ot,J,N){var le=N(62705),ye=le?le.prototype:void 0,m=ye?ye.valueOf:void 0;function ve(j){return m?Object(m.call(j)):{}}Ot.exports=ve},18805:function(Ot,J,N){var le=N(98363),ye=N(99551);function m(ve,j){return le(ve,ye(ve),j)}Ot.exports=m},1911:function(Ot,J,N){var le=N(98363),ye=N(51442);function m(ve,j){return le(ve,ye(ve),j)}Ot.exports=m},98805:function(Ot,J,N){var le=N(40180),ye=N(62689),m=N(83140),ve=N(79833);function j(ce){return function(ue){ue=ve(ue);var ze=ye(ue)?m(ue):void 0,ae=ze?ze[0]:ue.charAt(0),nt=ze?le(ze,1).join(""):ue.slice(1);return ae[ce]()+nt}}Ot.exports=j},35393:function(Ot,J,N){var le=N(62663),ye=N(53816),m=N(58748),ve="['\u2019]",j=RegExp(ve,"g");function ce(ue){return function(ze){return le(m(ye(ze).replace(j,"")),ue,"")}}Ot.exports=ce},23593:function(Ot,J,N){var le=N(58525),ye=N(50308),m=N(21814),ve=1/0,j=le&&1/m(new le([,-0]))[1]==ve?function(ce){return new le(ce)}:ye;Ot.exports=j},69389:function(Ot,J,N){var le=N(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=le(ye);Ot.exports=m},46904:function(Ot,J,N){var le=N(68866),ye=N(51442),m=N(81704);function ve(j){return le(j,m,ye)}Ot.exports=ve},51442:function(Ot,J,N){var le=N(62488),ye=N(85924),m=N(99551),ve=N(70479),j=Object.getOwnPropertySymbols,ce=j?function(ue){for(var ze=[];ue;)le(ze,m(ue)),ue=ye(ue);return ze}:ve;Ot.exports=ce},93157:function(Ot){var J=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function N(le){return J.test(le)}Ot.exports=N},43824:function(Ot){var J=Object.prototype,N=J.hasOwnProperty;function le(ye){var m=ye.length,ve=new ye.constructor(m);return m&&typeof ye[0]=="string"&&N.call(ye,"index")&&(ve.index=ye.index,ve.input=ye.input),ve}Ot.exports=le},29148:function(Ot,J,N){var le=N(74318),ye=N(57157),m=N(93147),ve=N(40419),j=N(77133),ce="[object Boolean]",ue="[object Date]",ze="[object Map]",ae="[object Number]",nt="[object RegExp]",ke="[object Set]",st="[object String]",Gt="[object Symbol]",sr="[object ArrayBuffer]",Pt="[object DataView]",er="[object Float32Array]",Lt="[object Float64Array]",ht="[object Int8Array]",mt="[object Int16Array]",tr="[object Int32Array]",q="[object Uint8Array]",Jt="[object Uint8ClampedArray]",_t="[object Uint16Array]",rt="[object Uint32Array]";function At(tt,$t,br){var Fr=tt.constructor;switch($t){case sr:return le(tt);case ce:case ue:return new Fr(+tt);case Pt:return ye(tt,br);case er:case Lt:case ht:case mt:case tr:case q:case Jt:case _t:case rt:return j(tt,br);case ze:return new Fr;case ae:case st:return new Fr(tt);case nt:return m(tt);case ke:return new Fr;case Gt:return ve(tt)}}Ot.exports=At},42351:function(Ot){function J(N,le,ye){for(var m=ye-1,ve=N.length;++m<ve;)if(N[m]===le)return m;return-1}Ot.exports=J},2757:function(Ot){var J="\\ud800-\\udfff",N="\\u0300-\\u036f",le="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",m=N+le+ye,ve="\\u2700-\\u27bf",j="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",ue="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2000-\\u206f",ae=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nt="A-Z\\xc0-\\xd6\\xd8-\\xde",ke="\\ufe0e\\ufe0f",st=ce+ue+ze+ae,Gt="['\u2019]",sr="["+st+"]",Pt="["+m+"]",er="\\d+",Lt="["+ve+"]",ht="["+j+"]",mt="[^"+J+st+er+ve+j+nt+"]",tr="\\ud83c[\\udffb-\\udfff]",q="(?:"+Pt+"|"+tr+")",Jt="[^"+J+"]",_t="(?:\\ud83c[\\udde6-\\uddff]){2}",rt="[\\ud800-\\udbff][\\udc00-\\udfff]",At="["+nt+"]",tt="\\u200d",$t="(?:"+ht+"|"+mt+")",br="(?:"+At+"|"+mt+")",Fr="(?:"+Gt+"(?:d|ll|m|re|s|t|ve))?",en="(?:"+Gt+"(?:D|LL|M|RE|S|T|VE))?",Te=q+"?",Ke="["+ke+"]?",Fe="(?:"+tt+"(?:"+[Jt,_t,rt].join("|")+")"+Ke+Te+")*",Mt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Zt=Ke+Te+Fe,qt="(?:"+[Lt,_t,rt].join("|")+")"+Zt,Er=RegExp([At+"?"+ht+"+"+Fr+"(?="+[sr,At,"$"].join("|")+")",br+"+"+en+"(?="+[sr,At+$t,"$"].join("|")+")",At+"?"+$t+"+"+Fr,At+"+"+en,gt,Mt,er,qt].join("|"),"g");function Kn(pn){return pn.match(Er)||[]}Ot.exports=Kn},68929:function(Ot,J,N){var le=N(48403),ye=N(35393),m=ye(function(ve,j,ce){return j=j.toLowerCase(),ve+(ce?le(j):j)});Ot.exports=m},48403:function(Ot,J,N){var le=N(79833),ye=N(11700);function m(ve){return ye(le(ve).toLowerCase())}Ot.exports=m},74691:function(Ot,J,N){var le=N(29750),ye=N(14841);function m(ve,j,ce){return ce===void 0&&(ce=j,j=void 0),ce!==void 0&&(ce=ye(ce),ce=ce===ce?ce:0),j!==void 0&&(j=ye(j),j=j===j?j:0),le(ye(ve),j,ce)}Ot.exports=m},50361:function(Ot,J,N){var le=N(85990),ye=1,m=4;function ve(j){return le(j,ye|m)}Ot.exports=ve},53816:function(Ot,J,N){var le=N(69389),ye=N(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve="\\u0300-\\u036f",j="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",ue=ve+j+ce,ze="["+ue+"]",ae=RegExp(ze,"g");function nt(ke){return ke=ye(ke),ke&&ke.replace(m,le).replace(ae,"")}Ot.exports=nt},56688:function(Ot,J,N){var le=N(25588),ye=N(7518),m=N(31167),ve=m&&m.isMap,j=ve?ye(ve):le;Ot.exports=j},14293:function(Ot){function J(N){return N==null}Ot.exports=J},81763:function(Ot,J,N){var le=N(44239),ye=N(37005),m="[object Number]";function ve(j){return typeof j=="number"||ye(j)&&le(j)==m}Ot.exports=ve},72928:function(Ot,J,N){var le=N(29221),ye=N(7518),m=N(31167),ve=m&&m.isSet,j=ve?ye(ve):le;Ot.exports=j},47037:function(Ot,J,N){var le=N(44239),ye=N(1469),m=N(37005),ve="[object String]";function j(ce){return typeof ce=="string"||!ye(ce)&&m(ce)&&le(ce)==ve}Ot.exports=j},52353:function(Ot){function J(N){return N===void 0}Ot.exports=J},30236:function(Ot,J,N){var le=N(42980),ye=N(21463),m=ye(function(ve,j,ce,ue){le(ve,j,ce,ue)});Ot.exports=m},50308:function(Ot){function J(){}Ot.exports=J},44908:function(Ot,J,N){var le=N(45652);function ye(m){return m&&m.length?le(m):[]}Ot.exports=ye},11700:function(Ot,J,N){var le=N(98805),ye=le("toUpperCase");Ot.exports=ye},58748:function(Ot,J,N){var le=N(49029),ye=N(93157),m=N(79833),ve=N(2757);function j(ce,ue,ze){return ce=m(ce),ue=ze?void 0:ue,ue===void 0?ye(ce)?ve(ce):le(ce):ce.match(ue)||[]}Ot.exports=j},6158:function(Ot){(function(J,N){Ot.exports=N()})(this,function(){"use strict";var J,N,le;function ye(m,ve){if(!J)J=ve;else if(!N)N=ve;else{var j="var sharedChunk = {}; ("+J+")(sharedChunk); ("+N+")(sharedChunk);",ce={};J(ce),le=ve(ce),typeof window!="undefined"&&(le.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}return ye(["exports"],function(m){"use strict";function ve(t,o){return t(o={exports:{}},o.exports),o.exports}var j=ce;function ce(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,o){var u,p,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var P=this.sampleCurveDerivativeX(y);if(Math.abs(P)<1e-6)break;y-=b/P}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},ce.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ue=ze;function ze(t,o){this.x=t,this.y=o}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(t){return t instanceof ze?t:Array.isArray(t)?new ze(t[0],t[1]):t};var ae=typeof self!="undefined"?self:{},nt=Math.pow(2,53)-1;function ke(t,o,u,p){var y=new j(t,o,u,p);return function(b){return y.solve(b)}}var st=ke(.25,.1,.25,1);function Gt(t,o,u){return Math.min(u,Math.max(o,t))}function sr(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function Pt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}var er=1;function Lt(){return er++}function ht(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function mt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function tr(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function q(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Jt(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function _t(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function rt(t){return Array.isArray(t)?t.map(rt):typeof t=="object"&&t?Jt(t,rt):t}var At={};function tt(t){At[t]||(typeof console!="undefined"&&console.warn(t),At[t]=!0)}function $t(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function br(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,S=void 0;u<p;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Fr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function en(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,S){var P=b||S;return o[y]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Te=null;function Ke(t){if(Te==null){var o=t.navigator?t.navigator.userAgent:null;Te=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Te}function Fe(t){try{var o=ae[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var Mt,gt,Zt,qt,Er=ae.performance&&ae.performance.now?ae.performance.now.bind(ae.performance):Date.now.bind(Date),Kn=ae.requestAnimationFrame||ae.mozRequestAnimationFrame||ae.webkitRequestAnimationFrame||ae.msRequestAnimationFrame,pn=ae.cancelAnimationFrame||ae.mozCancelAnimationFrame||ae.webkitCancelAnimationFrame||ae.msCancelAnimationFrame,Wi={now:Er,frame:function(t){var o=Kn(t);return{cancel:function(){return pn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ae.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return Mt||(Mt=ae.document.createElement("a")),Mt.href=t,Mt.href},hardwareConcurrency:ae.navigator&&ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(gt==null&&(gt=ae.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Gn={supported:!1,testSupport:function(t){!pi&&qt&&($n?ui(t):Zt=t)}},pi=!1,$n=!1;function ui(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;Gn.supported=!0}catch(u){}t.deleteTexture(o),pi=!0}ae.document&&((qt=ae.document.createElement("img")).onload=function(){Zt&&ui(Zt),Zt=null,$n=!0},qt.onerror=function(){pi=!0,Zt=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ji="01",Ii=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ei(t){return t.indexOf("mapbox:")===0}Ii.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ji,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ii.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ii.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Ii.prototype.normalizeStyleURL=function(t,o){if(!Ei(t))return t;var u=ya(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ii.prototype.normalizeGlyphsURL=function(t,o){if(!Ei(t))return t;var u=ya(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ii.prototype.normalizeSourceURL=function(t,o){if(!Ei(t))return t;var u=ya(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ii.prototype.normalizeSpriteURL=function(t,o,u,p){var y=ya(t);return Ei(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,wn(y))},Ii.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ei(t))return t;var u=ya(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Wi.devicePixelRatio>=2||o===512?"@2x":"")+(Gn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var P=S[b].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ii.prototype.canonicalizeTileURL=function(t,o){var u=ya(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Ii.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ei(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];na(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Ii.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=ya(Zn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!Zn.REQUIRE_ACCESS_TOKEN)return wn(t);if(!(o=o||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),wn(t)};var zi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function na(t){return zi.test(t)}var Si=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ya(t){var o=t.match(Si);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function wn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function _i(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ae.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ki=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ki.prototype.getStorageKey=function(t){var o,u=_i(Zn.ACCESS_TOKEN);return o=u&&u.u?ae.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):Zn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ki.prototype.fetchEventData=function(){var t=Fe("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=ae.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=ae.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){tt("Unable to read from LocalStorage")}},ki.prototype.saveEventData=function(){var t=Fe("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ae.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){tt("Unable to write to LocalStorage")}},ki.prototype.processRequests=function(t){},ki.prototype.postEvent=function(t,o,u,p){var y=this;if(Zn.EVENTS_URL){var b=ya(Zn.EVENTS_URL);b.params.push("access_token="+(p||Zn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ji,userId:this.anonId},P=o?Pt(S,o):S,k={url:wn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=ba(k,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(p)})}},ki.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Xi,za,de=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(Zn.EVENTS_URL&&b||Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ei(S)||na(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),mt(this.anonId)||(this.anonId=ht()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||b&&(p.success[b]=!0)},u))}},o}(ki),Nn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ei(y)||na(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=_i(Zn.ACCESS_TOKEN),b=y?y.u:Zn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;mt(this.anonId)||(this.anonId=ht(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(P),Z=(P-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(H){H||(p.eventData.lastSuccess=P,p.eventData.tokenU=b)},u)}},o}(ki)),Ua=Nn.postTurnstileEvent.bind(Nn),us=new de,jt=us.postMapLoadEvent.bind(us),ir=500,Tr=50;function I(){ae.caches&&!Xi&&(Xi=ae.caches.open("mapbox-tiles"))}function nr(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Dn,li=1/0;function Hn(){return Dn==null&&(Dn=ae.OffscreenCanvas&&new ae.OffscreenCanvas(1,1).getContext("2d")&&typeof ae.createImageBitmap=="function"),Dn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var Ai=function(t){function o(u,p,y){p===401&&na(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),wi=Fr()?function(){return self.worker&&self.worker.referrer}:function(){return(ae.location.protocol==="blob:"?ae.parent:ae).location.href},Wa,ls,fa=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(wi())&&!/^\w+:/.test(u))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,S=new ae.AbortController,P=new ae.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:wi(),signal:S.signal}),k=!1,z=!1,Z=(b=P.url).indexOf("sku=")>0&&na(b);p.type==="json"&&P.headers.set("Accept","application/json");var H=function(ie,Pe,Re){if(!z){if(ie&&ie.message!=="SecurityError"&&tt(ie),Pe&&Re)return ee(Pe);var Qe=Date.now();ae.fetch(P).then(function(Ce){if(Ce.ok){var Ge=Z?Ce.clone():null;return ee(Ce,Ge,Qe)}return y(new Ai(Ce.statusText,Ce.status,p.url))}).catch(function(Ce){Ce.code!==20&&y(new Error(Ce.message))})}},ee=function(ie,Pe,Re){(p.type==="arrayBuffer"?ie.arrayBuffer():p.type==="json"?ie.json():ie.text()).then(function(Qe){z||(Pe&&Re&&function(Ce,Ge,Ct){if(I(),Xi){var Xt={status:Ge.status,statusText:Ge.statusText,headers:new ae.Headers};Ge.headers.forEach(function(fr,kr){return Xt.headers.set(kr,fr)});var Yt=en(Ge.headers.get("Cache-Control")||"");Yt["no-store"]||(Yt["max-age"]&&Xt.headers.set("Expires",new Date(Ct+1e3*Yt["max-age"]).toUTCString()),new Date(Xt.headers.get("Expires")).getTime()-Ct<42e4||function(fr,kr){if(za===void 0)try{new Response(new ReadableStream),za=!0}catch(Qr){za=!1}za?kr(fr.body):fr.blob().then(kr)}(Ge,function(fr){var kr=new ae.Response(fr,Xt);I(),Xi&&Xi.then(function(Qr){return Qr.put(nr(Ce.url),kr)}).catch(function(Qr){return tt(Qr.message)})}))}}(P,Pe,Re),k=!0,y(null,Qe,ie.headers.get("Cache-Control"),ie.headers.get("Expires")))}).catch(function(Qe){z||y(new Error(Qe.message))})};return Z?function(ie,Pe){if(I(),!Xi)return Pe(null);var Re=nr(ie.url);Xi.then(function(Qe){Qe.match(Re).then(function(Ce){var Ge=function(Ct){if(!Ct)return!1;var Xt=new Date(Ct.headers.get("Expires")||0),Yt=en(Ct.headers.get("Cache-Control")||"");return Xt>Date.now()&&!Yt["no-cache"]}(Ce);Qe.delete(Re),Ge&&Qe.put(Re,Ce.clone()),Pe(null,Ce,Ge)}).catch(Pe)}).catch(Pe)}(P,H):H(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,o);if(Fr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new ae.XMLHttpRequest;for(var S in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var P=b.response;if(p.type==="json")try{P=JSON.parse(b.response)}catch(k){return y(k)}y(null,P,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Ai(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},wa=function(t,o){return fa(Pt(t,{type:"arrayBuffer"}),o)},ba=function(t,o){return fa(Pt(t,{method:"POST"}),o)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wa=[],ls=0;var $=function(t,o){if(Gn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ls>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wa.push(u),u}ls++;var p=!1,y=function(){if(!p)for(p=!0,ls--;Wa.length&&ls<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Wa.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=wa(t,function(S,P,k,z){y(),S?o(S):P&&(Hn()?function(Z,H){var ee=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});ae.createImageBitmap(ee).then(function(ie){H(null,ie)}).catch(function(ie){H(new Error("Could not load image because of "+ie.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(Z,H,ee,ie){var Pe=new ae.Image,Re=ae.URL;Pe.onload=function(){H(null,Pe),Re.revokeObjectURL(Pe.src),Pe.onload=null,ae.requestAnimationFrame(function(){Pe.src=G})},Pe.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Qe=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});Pe.cacheControl=ee,Pe.expires=ie,Pe.src=Z.byteLength?Re.createObjectURL(Qe):G}(P,o,k,z))});return{cancel:function(){b.cancel(),y()}}};function ne(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Ie=function(t,o){o===void 0&&(o={}),Pt(this,o),this.type=t},He=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",Pt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ie),at=function(){};at.prototype.on=function(t,o){return this._listeners=this._listeners||{},ne(t,o,this._listeners),this},at.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},at.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},ne(t,o,this._oneTimeListeners),this},at.prototype.fire=function(t,o){typeof t=="string"&&(t=new Ie(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var P=S[b];ge(u,P,this._oneTimeListeners),P.call(this,t)}var k=this._eventedParent;k&&(Pt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof He&&console.error(t.error);return this},at.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},at.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Be=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function yt(t){var o=t.value;return o?[new Be(t.key,o,"constants have been deprecated as of v8")]:[]}function vr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}function Bt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=zt(t[u]);return o}return Bt(t)}var gr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),bn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};bn.prototype.concat=function(t){return new bn(this,t)},bn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},bn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ln={kind:"null"},Rt={kind:"number"},un={kind:"string"},jr={kind:"boolean"},Hr={kind:"color"},ai={kind:"object"},rn={kind:"value"},Ci={kind:"collator"},$i={kind:"formatted"},yi={kind:"resolvedImage"};function Ti(t,o){return{kind:"array",itemType:t,N:o}}function xi(t){if(t.kind==="array"){var o=xi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ei=[ln,Rt,un,jr,Hr,$i,ai,Ti(rn),yi];function Gi(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Gi(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ei;u<p.length;u+=1)if(!Gi(p[u],o))return null}}return"Expected "+xi(t)+" but found "+xi(o)+" instead."}function Ta(t,o){return o.some(function(u){return u.kind===t.kind})}function ea(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Mi=ve(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(P){return(P=Math.round(P))<0?0:P>255?255:P}function y(P){return p(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function b(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function S(P,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?P+(k-P)*z*6:2*z<1?k:3*z<2?P+(k-P)*(2/3-z)*6:P}try{o.parseCSSColor=function(P){var k,z=P.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var Z=z.indexOf("("),H=z.indexOf(")");if(Z!==-1&&H+1===z.length){var ee=z.substr(0,Z),ie=z.substr(Z+1,H-(Z+1)).split(","),Pe=1;switch(ee){case"rgba":if(ie.length!==4)return null;Pe=b(ie.pop());case"rgb":return ie.length!==3?null:[y(ie[0]),y(ie[1]),y(ie[2]),Pe];case"hsla":if(ie.length!==4)return null;Pe=b(ie.pop());case"hsl":if(ie.length!==3)return null;var Re=(parseFloat(ie[0])%360+360)%360/360,Qe=b(ie[1]),Ce=b(ie[2]),Ge=Ce<=.5?Ce*(Qe+1):Ce+Qe-Ce*Qe,Ct=2*Ce-Ge;return[p(255*S(Ct,Ge,Re+1/3)),p(255*S(Ct,Ge,Re)),p(255*S(Ct,Ge,Re-1/3)),Pe];default:return null}}return null}}catch(P){}}).parseCSSColor,Ui=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};Ui.parse=function(t){if(t){if(t instanceof Ui)return t;if(typeof t=="string"){var o=Mi(t);if(o)return new Ui(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Ui.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},Ui.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Ui.black=new Ui(0,0,0,1),Ui.white=new Ui(1,1,1,1),Ui.transparent=new Ui(0,0,0,0),Ui.red=new Ui(1,0,0,1);var Oa=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Oa.prototype.compare=function(t,o){return this.collator.compare(t,o)},Oa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var au=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},Ea=function(t){this.sections=t};Ea.fromString=function(t){return new Ea([new au(t,null,null,null,null)])},Ea.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Ea.factory=function(t){return t instanceof Ea?t:Ea.fromString(t)},Ea.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Ea.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var Sa=function(t){this.name=t.name,this.available=t.available};function _s(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function cs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ui||t instanceof Oa||t instanceof Ea||t instanceof Sa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!cs(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!cs(t[p]))return!1;return!0}return!1}function Qi(t){if(t===null)return ln;if(typeof t=="string")return un;if(typeof t=="boolean")return jr;if(typeof t=="number")return Rt;if(t instanceof Ui)return Hr;if(t instanceof Oa)return Ci;if(t instanceof Ea)return $i;if(t instanceof Sa)return yi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=Qi(y[p]);if(o){if(o===b)continue;o=rn;break}o=b}return Ti(o||rn,u)}return ai}function Yu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Ui||t instanceof Ea||t instanceof Sa?t.toString():JSON.stringify(t)}Sa.prototype.toString=function(){return this.name},Sa.fromString=function(t){return t?new Sa({name:t,available:!1}):null},Sa.prototype.serialize=function(){return["image",this.name]};var co=function(t,o){this.type=t,this.value=o};co.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!cs(t[1]))return o.error("invalid value");var u=t[1],p=Qi(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new co(p,u)},co.prototype.evaluate=function(){return this.value},co.prototype.eachChild=function(){},co.prototype.outputDefined=function(){return!0},co.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ui?["rgba"].concat(this.value.toArray()):this.value instanceof Ea?this.value.serialize():this.value};var Ra=function(t){this.name="ExpressionEvaluationError",this.message=t};Ra.prototype.toJSON=function(){return this.message};var $a={string:un,number:Rt,boolean:jr,object:ai},Yi=function(t,o){this.type=t,this.args=o};Yi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in $a)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=$a[P],p++}else b=rn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Ti(b,S)}else u=$a[y];for(var k=[];p<t.length;p++){var z=o.parse(t[p],p,rn);if(!z)return null;k.push(z)}return new Yi(u,k)},Yi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Gi(this.type,Qi(u)))return u;if(o===this.args.length-1)throw new Ra("Expected value to be of type "+xi(this.type)+", but found "+xi(Qi(u))+" instead.")}return null},Yi.prototype.eachChild=function(t){this.args.forEach(t)},Yi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Yi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ho=function(t){this.type=$i,this.sections=t};Ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,Rt)))return null;var k=null;if(S["text-font"]&&!(k=o.parse(S["text-font"],1,Ti(un))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Hr)))return null;var Z=p[p.length-1];Z.scale=P,Z.font=k,Z.textColor=z}else{var H=o.parse(t[b],1,rn);if(!H)return null;var ee=H.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:H,scale:null,font:null,textColor:null})}}return new Ho(p)},Ho.prototype.evaluate=function(t){return new Ea(this.sections.map(function(o){var u=o.content.evaluate(t);return Qi(u)===yi?new au("",u,null,null,null):new au(Yu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ho.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var Wo=function(t){this.type=yi,this.input=t};Wo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,un);return u?new Wo(u):o.error("No image name provided.")},Wo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Sa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Wo.prototype.eachChild=function(t){t(this.input)},Wo.prototype.outputDefined=function(){return!1},Wo.prototype.serialize=function(){return["image",this.input.serialize()]};var qu={"to-boolean":jr,"to-color":Hr,"to-number":Rt,"to-string":un},po=function(t,o){this.type=t,this.args=o};po.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=qu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,rn);if(!S)return null;y.push(S)}return new po(p,y)},po.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof Ui)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":_s(o[0],o[1],o[2],o[3])))return new Ui(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ra(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,k=this.args;P<k.length;P+=1){if((S=k[P].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ra("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Ea.fromString(Yu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Sa.fromString(Yu(this.args[0].evaluate(t))):Yu(this.args[0].evaluate(t))},po.prototype.eachChild=function(t){this.args.forEach(t)},po.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},po.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Xo=["Unknown","Point","LineString","Polygon"],ha=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ha.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ha.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null},ha.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ha.prototype.canonicalID=function(){return this.canonical},ha.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ha.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ui.parse(t)),o};var fo=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};fo.prototype.evaluate=function(t){return this._evaluate(t,this.args)},fo.prototype.eachChild=function(t){this.args.forEach(t)},fo.prototype.outputDefined=function(){return!1},fo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},fo.parse=function(t,o){var u,p=t[0],y=fo.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=S.filter(function(jn){var gn=jn[0];return!Array.isArray(gn)||gn.length===t.length-1}),k=null,z=0,Z=P;z<Z.length;z+=1){var H=Z[z],ee=H[0],ie=H[1];k=new Ys(o.registry,o.path,null,o.scope);for(var Pe=[],Re=!1,Qe=1;Qe<t.length;Qe++){var Ce=t[Qe],Ge=Array.isArray(ee)?ee[Qe-1]:ee.type,Ct=k.parse(Ce,1+Pe.length,Ge);if(!Ct){Re=!0;break}Pe.push(Ct)}if(!Re)if(Array.isArray(ee)&&ee.length!==Pe.length)k.error("Expected "+ee.length+" arguments, but found "+Pe.length+" instead.");else{for(var Xt=0;Xt<Pe.length;Xt++){var Yt=Array.isArray(ee)?ee[Xt]:ee.type,fr=Pe[Xt];k.concat(Xt+1).checkSubtype(Yt,fr.type)}if(k.errors.length===0)return new fo(p,b,ie,Pe)}}if(P.length===1)(u=o.errors).push.apply(u,k.errors);else{for(var kr=(P.length?P:S).map(function(jn){var gn;return gn=jn[0],Array.isArray(gn)?"("+gn.map(xi).join(", ")+")":"("+xi(gn.type)+"...)"}).join(" | "),Qr=[],zn=1;zn<t.length;zn++){var vn=o.parse(t[zn],1+Qr.length);if(!vn)return null;Qr.push(xi(vn.type))}o.error("Expected arguments of type "+kr+", but found ("+Qr.join(", ")+") instead.")}return null},fo.register=function(t,o){for(var u in fo.definitions=o,o)t[u]=fo};var Yo=function(t,o,u){this.type=Ci,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Qa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function ou(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Ic(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function ks(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function Q(t,o){for(var u,p,y,b,S,P,k,z=!1,Z=0,H=o.length;Z<H;Z++)for(var ee=o[Z],ie=0,Pe=ee.length;ie<Pe-1;ie++){if((b=(u=t)[0]-(p=ee[ie])[0])*(k=u[1]-(y=ee[ie+1])[1])-(P=u[0]-y[0])*(S=u[1]-p[1])==0&&b*P<=0&&S*k<=0)return!1;ks(t,ee[ie],ee[ie+1])&&(z=!z)}return z}function be(t,o){for(var u=0;u<o.length;u++)if(Q(t,o[u]))return!0;return!1}function et(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),P=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function Dt(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],S=0;S<b.length-1;++S)if((H=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(ee=[(k=o)[0]-(P=t)[0],k[1]-P[1]])[1]-H[1]*ee[0]!=0&&et(P,k,z,Z)&&et(z,Z,P,k))return!0;var P,k,z,Z,H,ee;return!1}function Dr(t,o){for(var u=0;u<t.length;++u)if(!Q(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Dt(t[p],t[p+1],o))return!1;return!0}function ut(t,o){for(var u=0;u<o.length;u++)if(Dr(t,o[u]))return!0;return!1}function St(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var P=Ic(t[y][S],u);Qa(o,P),b.push(P)}p.push(b)}return p}function Ja(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=St(t[y],o,u);p.push(b)}return p}function qi(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}Qa(o,t)}function Za(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],S=[],P=0,k=t;P<k.length;P+=1)for(var z=0,Z=k[P];z<Z.length;z+=1){var H=Z[z],ee=[H.x+b[0],H.y+b[1]];qi(ee,o,u,y),S.push(ee)}return S}function qo(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],P=[],k=0,z=t;k<z.length;k+=1){for(var Z=[],H=0,ee=z[k];H<ee.length;H+=1){var ie=ee[H],Pe=[ie.x+S[0],ie.y+S[1]];Qa(o,Pe),Z.push(Pe)}P.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Re=0,Qe=P;Re<Qe.length;Re+=1)for(var Ce=0,Ge=Qe[Re];Ce<Ge.length;Ce+=1)qi(Ge[Ce],o,u,b)}return P}Yo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,jr);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,jr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,un))?null:new Yo(p,y,b)},Yo.prototype.evaluate=function(t){return new Oa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Yo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Yr=function(t,o){this.type=jr,this.geojson=t,this.geometries=o};function Vr(t){if(t instanceof fo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Yr)return!1;var o=!0;return t.eachChild(function(u){o&&!Vr(u)&&(o=!1)}),o}function It(t){if(t instanceof fo&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!It(u)&&(o=!1)}),o}function ko(t,o){if(t instanceof fo&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!ko(p,o)&&(u=!1)}),u}Yr.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(cs(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Yr(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Yr(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Yr(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Yr.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=St(u.coordinates,y,b),P=Za(o.geometry(),p,y,b);if(!ou(p,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Q(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=Ja(u.coordinates,y,b),H=Za(o.geometry(),p,y,b);if(!ou(p,y))return!1;for(var ee=0,ie=H;ee<ie.length;ee+=1)if(!be(ie[ee],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=St(u.coordinates,y,b),P=qo(o.geometry(),p,y,b);if(!ou(p,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Dr(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=Ja(u.coordinates,y,b),H=qo(o.geometry(),p,y,b);if(!ou(p,y))return!1;for(var ee=0,ie=H;ee<ie.length;ee+=1)if(!ut(ie[ee],Z))return!1}return!0}(t,this.geometries)}return!1},Yr.prototype.eachChild=function(){},Yr.prototype.outputDefined=function(){return!0},Yr.prototype.serialize=function(){return["within",this.geojson]};var oe=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};oe.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new oe(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},oe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},oe.prototype.eachChild=function(){},oe.prototype.outputDefined=function(){return!1},oe.prototype.serialize=function(){return["var",this.name]};var Ys=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new bn),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function su(t,o){for(var u,p=t.length-1,y=0,b=p,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===p||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ra("Input is not a number.");b=S-1}return 0}Ys.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Ys.prototype._parse=function(t,o){function u(z,Z,H){return H==="assert"?new Yi(Z,[z]):H==="coerce"?new po(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof co)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof oe)return z(Z.boundExpression);if(Z instanceof fo&&Z.name==="error"||Z instanceof Yo||Z instanceof Yr)return!1;var H=Z instanceof po||Z instanceof Yi,ee=!0;return Z.eachChild(function(ie){ee=H?ee&&z(ie):ee&&ie instanceof co}),!!ee&&Vr(Z)&&ko(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var k=new ha;try{b=new co(b.type,b.evaluate(k))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ys.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Ys(this.registry,p,o||null,y,this.errors)},Ys.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new gr(p,t))},Ys.prototype.checkSubtype=function(t,o){var u=Gi(t,o);return u&&this.error(u),u};var fs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ta(t,o,u){return t*(1-u)+o*u}fs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Rt);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],P=t[b+1],k=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var Z=o.parse(P,z,y);if(!Z)return null;y=y||Z.type,p.push([S,Z])}return new fs(y,u,p)},fs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[su(o,p)].evaluate(t)},fs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},fs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},fs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var ho=Object.freeze({__proto__:null,number:ta,color:function(t,o,u){return new Ui(ta(t.r,o.r,u),ta(t.g,o.g,u),ta(t.b,o.b,u),ta(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ta(p,o[y],u)})}}),ic=6/29*3*(6/29),Oc=Math.PI/180,Ku=180/Math.PI;function Rc(t){return t>.008856451679035631?Math.pow(t,1/3):t/ic+4/29}function Rl(t){return t>6/29?t*t*t:ic*(t-4/29)}function $u(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function uu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qu(t){var o=uu(t.r),u=uu(t.g),p=uu(t.b),y=Rc((.4124564*o+.3575761*u+.1804375*p)/.95047),b=Rc((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Rc((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*Rl(o),u=.95047*Rl(u),p=1.08883*Rl(p),new Ui($u(3.2404542*u-1.5371385*o-.4985314*p),$u(-.969266*u+1.8760108*o+.041556*p),$u(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function T(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var F={forward:Qu,reverse:_,interpolate:function(t,o,u){return{l:ta(t.l,o.l,u),a:ta(t.a,o.a,u),b:ta(t.b,o.b,u),alpha:ta(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=Qu(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*Ku;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*Oc,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:ta(t.c,o.c,u),l:ta(t.l,o.l,u),alpha:ta(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:F,hcl:R}),xe=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var P=S[b],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function qe(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=qe(o,t.base,u,p);else if(t.name==="linear")y=qe(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new j(b[0],b[1],b[2],b[3]).solve(qe(o,1,u,p))}return y},xe.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var P=p.slice(1);if(P.length!==4||P.some(function(Qe){return typeof Qe!="number"||Qe<0||Qe>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Rt)))return null;var k=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var H=b[Z],ee=b[Z+1],ie=Z+3,Pe=Z+4;if(typeof H!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(k.length&&k[k.length-1][0]>=H)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);var Re=o.parse(ee,Pe,z);if(!Re)return null;z=z||Re.type,k.push([H,Re])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new xe(z,u,p,y,k):o.error("Type "+xi(z)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=su(o,p),S=xe.interpolationFactor(this.interpolation,p,o[b],o[b+1]),P=u[b].evaluate(t),k=u[b+1].evaluate(t);return this.operator==="interpolate"?ho[this.type.kind.toLowerCase()](P,k,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(k),S)):F.reverse(F.interpolate(F.forward(P),F.forward(k),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var pt=function(t,o){this.type=t,this.args=o};pt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var P=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,y.push(P)}var k=p&&y.some(function(z){return Gi(p,z.type)});return new pt(k?rn:u,y)},pt.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof Sa&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},pt.prototype.eachChild=function(t){this.args.forEach(t)},pt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},pt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var vt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};vt.prototype.evaluate=function(t){return this.result.evaluate(t)},vt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},vt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new vt(u,S):null},vt.prototype.outputDefined=function(){return this.result.outputDefined()},vt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var cr=function(t,o,u){this.type=t,this.index=o,this.input=u};cr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Rt),p=o.parse(t[2],2,Ti(o.expectedType||rn));return u&&p?new cr(p.type.itemType,u,p):null},cr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ra("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ra("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ra("Array index must be an integer, but found "+o+" instead.");return u[o]},cr.prototype.eachChild=function(t){t(this.index),t(this.input)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var _r=function(t,o){this.type=jr,this.needle=t,this.haystack=o};_r.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,rn);return u&&p?Ta(u.type,[jr,un,Rt,ln,rn])?new _r(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead"):null},_r.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!ea(o,["boolean","string","number","null"]))throw new Ra("Expected first argument to be of type boolean, string, number or null, but found "+xi(Qi(o))+" instead.");if(!ea(u,["string","array"]))throw new Ra("Expected second argument to be of type array or string, but found "+xi(Qi(u))+" instead.");return u.indexOf(o)>=0},_r.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},_r.prototype.outputDefined=function(){return!0},_r.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Pn=function(t,o,u){this.type=Rt,this.needle=t,this.haystack=o,this.fromIndex=u};Pn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,rn);if(!u||!p)return null;if(!Ta(u.type,[jr,un,Rt,ln,rn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Rt);return y?new Pn(u,p,y):null}return new Pn(u,p)},Pn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!ea(o,["boolean","string","number","null"]))throw new Ra("Expected first argument to be of type boolean, string, number or null, but found "+xi(Qi(o))+" instead.");if(!ea(u,["string","array"]))throw new Ra("Expected second argument to be of type array or string, but found "+xi(Qi(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ci=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};ci.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var P=t[S],k=t[S+1];Array.isArray(P)||(P=[P]);var z=o.concat(S);if(P.length===0)return z.error("Expected at least one branch label.");for(var Z=0,H=P;Z<H.length;Z+=1){var ee=H[Z];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,Qi(ee)))return null}else u=Qi(ee);if(y[String(ee)]!==void 0)return z.error("Branch labels must be unique.");y[String(ee)]=b.length}var ie=o.parse(k,S,p);if(!ie)return null;p=p||ie.type,b.push(ie)}var Pe=o.parse(t[1],1,rn);if(!Pe)return null;var Re=o.parse(t[t.length-1],t.length-1,p);return Re?Pe.type.kind!=="value"&&o.concat(1).checkSubtype(u,Pe.type)?null:new ci(u,p,Pe,y,b,Re):null},ci.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(Qi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ci.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ci.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(H=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[H][1].push(S)}for(var P=function(ie){return t.inputType.kind==="number"?Number(ie):ie},k=0,z=u;k<z.length;k+=1){var Z=z[k],H=Z[0],ee=Z[1];o.push(ee.length===1?P(ee[0]):ee.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Jn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Jn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,jr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;p.push([b,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new Jn(u,p,P):null},Jn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Jn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},Jn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Jn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Hi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function sa(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(t,o,u,p){return p.compare(o,u)===0}function Zi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,S,P){this.type=jr,this.lhs=b,this.rhs=S,this.collator=P,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var P=b[0],k=S.parse(b[1],1,rn);if(!k)return null;if(!sa(P,k.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+xi(k.type)+"'.");var z=S.parse(b[2],2,rn);if(!z)return null;if(!sa(P,z.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+xi(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+xi(k.type)+"' and '"+xi(z.type)+"'.");p&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new Yi(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new Yi(k.type,[z])));var Z=null;if(b.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,Ci)))return null}return new y(k,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),P=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var k=Qi(S),z=Qi(P);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new Ra('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var Z=Qi(S),H=Qi(P);if(Z.kind!=="string"||H.kind!=="string")return o(b,S,P)}return this.collator?u(b,S,P,this.collator.evaluate(b)):o(b,S,P)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Hi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,Rt);if(!u||!p)return null;if(!Ta(u.type,[Ti(rn),un,rn]))return o.error("Expected first argument to be of type array or string, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Rt);return y?new Hi(u.type,u,p,y):null}return new Hi(u.type,u,p)},Hi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!ea(o,["string","array"]))throw new Ra("Expected first argument to be of type array or string, but found "+xi(Qi(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Hi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Hi.prototype.outputDefined=function(){return!1},Hi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Co=Zi("==",function(t,o,u){return o===u},Ca),xs=Zi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!Ca(0,o,u,p)}),gl=Zi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),af=Zi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),Ju=Zi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Lc=Zi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Ou=function(t,o,u,p,y){this.type=un,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Ou.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Rt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,un)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,un)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,Rt)))return null;var P=null;return p["max-fraction-digits"]&&!(P=o.parse(p["max-fraction-digits"],1,Rt))?null:new Ou(u,y,b,S,P)},Ou.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ou.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ou.prototype.outputDefined=function(){return!1},Ou.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var yu=function(t){this.type=Rt,this.input=t};yu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+xi(u.type)+" instead."):new yu(u):null},yu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ra("Expected value to be of type string or array, but found "+xi(Qi(o))+" instead.")},yu.prototype.eachChild=function(t){t(this.input)},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var vo={"==":Co,"!=":xs,">":af,"<":gl,">=":Lc,"<=":Ju,array:Yi,at:cr,boolean:Yi,case:Jn,coalesce:pt,collator:Yo,format:Ho,image:Wo,in:_r,"index-of":Pn,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:yu,let:vt,literal:co,match:ci,number:Yi,"number-format":Ou,object:Yi,slice:Hi,step:fs,string:Yi,"to-boolean":po,"to-color":po,"to-number":po,"to-string":po,var:oe,within:Yr};function ua(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,P=_s(u,p,y,S);if(P)throw new Ra(P);return new Ui(u/255*S,p/255*S,y/255*S,S)}function Eh(t,o){return t in o}function Sh(t,o){var u=o[t];return u===void 0?null:u}function ro(t){return{type:t}}function Xf(t){return{result:"success",value:t}}function _u(t){return{result:"error",value:t}}function Ds(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function kc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function yl(t){return!!t.expression&&t.expression.interpolated}function _a(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ll(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ac(t){return t}function ts(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Yf(t,o,u,p,y){return ts(typeof u===y?p[u]:void 0,t.default,o.default)}function Ch(t,o,u){if(_a(u)!=="number")return ts(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=su(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ah(t,o,u){var p=t.base!==void 0?t.base:1;if(_a(u)!=="number")return ts(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=su(t.stops.map(function(H){return H[0]}),u),S=function(H,ee,ie,Pe){var Re=Pe-ie,Qe=H-ie;return Re===0?0:ee===1?Qe/Re:(Math.pow(ee,Qe)-1)/(Math.pow(ee,Re)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),P=t.stops[b][1],k=t.stops[b+1][1],z=ho[o.type]||ac;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=K[t.colorSpace];z=function(H,ee){return Z.reverse(Z.interpolate(Z.forward(H),Z.forward(ee),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var H=[],ee=arguments.length;ee--;)H[ee]=arguments[ee];var ie=P.evaluate.apply(void 0,H),Pe=k.evaluate.apply(void 0,H);if(ie!==void 0&&Pe!==void 0)return z(ie,Pe,S)}}:z(P,k,S)}function of(t,o,u){return o.type==="color"?u=Ui.parse(u):o.type==="formatted"?u=Ea.fromString(u.toString()):o.type==="resolvedImage"?u=Sa.fromString(u.toString()):_a(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),ts(u,t.default,o.default)}fo.register(vo,{error:[{kind:"error"},[un],function(t,o){throw new Ra(o[0].evaluate(t))}],typeof:[un,[rn],function(t,o){return xi(Qi(o[0].evaluate(t)))}],"to-rgba":[Ti(Rt,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[Rt,Rt,Rt],ua],rgba:[Hr,[Rt,Rt,Rt,Rt],ua],has:{type:jr,overloads:[[[un],function(t,o){return Eh(o[0].evaluate(t),t.properties())}],[[un,ai],function(t,o){var u=o[1];return Eh(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:rn,overloads:[[[un],function(t,o){return Sh(o[0].evaluate(t),t.properties())}],[[un,ai],function(t,o){var u=o[1];return Sh(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[rn,[un],function(t,o){return Sh(o[0].evaluate(t),t.featureState||{})}],properties:[ai,[],function(t){return t.properties()}],"geometry-type":[un,[],function(t){return t.geometryType()}],id:[rn,[],function(t){return t.id()}],zoom:[Rt,[],function(t){return t.globals.zoom}],"heatmap-density":[Rt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Rt,[],function(t){return t.globals.lineProgress||0}],accumulated:[rn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Rt,ro(Rt),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Rt,ro(Rt),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Rt,overloads:[[[Rt,Rt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Rt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Rt,[Rt,Rt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Rt,[Rt,Rt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Rt,[],function(){return Math.LN2}],pi:[Rt,[],function(){return Math.PI}],e:[Rt,[],function(){return Math.E}],"^":[Rt,[Rt,Rt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Rt,[Rt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Rt,[Rt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Rt,[Rt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Rt,[Rt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Rt,[Rt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Rt,[Rt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Rt,[Rt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Rt,[Rt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Rt,[Rt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Rt,[Rt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Rt,ro(Rt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Rt,ro(Rt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Rt,[Rt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Rt,[Rt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Rt,[Rt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Rt,[Rt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[jr,[un,rn],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[jr,[rn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[jr,[un],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[jr,[un,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[jr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[jr,[un,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[jr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[jr,[un,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[jr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[jr,[un,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[jr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[jr,[rn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[jr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[jr,[Ti(un)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[jr,[Ti(rn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[jr,[un,Ti(rn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[jr,[un,Ti(rn)],function(t,o){var u=o[0],p=o[1];return function(y,b,S,P){for(;S<=P;){var k=S+P>>1;if(b[k]===y)return!0;b[k]>y?P=k-1:S=k+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:jr,overloads:[[[jr,jr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[ro(jr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:jr,overloads:[[[jr,jr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[ro(jr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[jr,[jr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[jr,[un],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[un,[un],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[un,[un],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[un,ro(rn),function(t,o){return o.map(function(u){return Yu(u.evaluate(t))}).join("")}],"resolved-locale":[un,[Ci],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var _l=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ha,this._defaultValue=o?function(u){return u.type==="color"&&Ll(u.default)?new Ui(0,0,0,0):u.type==="color"?Ui.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Do(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in vo}function Ru(t,o){var u=new Ys(vo,[],o?function(y){var b={color:Hr,string:un,number:Rt,enum:un,boolean:jr,formatted:$i,resolvedImage:yi};return y.type==="array"?Ti(b[y.value]||rn,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Xf(new _l(p,o)):_u(u.errors)}_l.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},_l.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ra("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var el=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!It(o.expression)};el.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},el.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var Fo=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!It(o.expression),this.interpolationType=p};function kl(t,o){if((t=Ru(t,o)).result==="error")return t;var u=t.value.expression,p=Vr(u);if(!p&&!Ds(o))return _u([new gr("","data expressions not supported")]);var y=ko(u,["zoom"]);if(!y&&!kc(o))return _u([new gr("","zoom expressions not supported")]);var b=function S(P){var k=null;if(P instanceof vt)k=S(P.result);else if(P instanceof pt)for(var z=0,Z=P.args;z<Z.length&&!(k=S(Z[z]));z+=1);else(P instanceof fs||P instanceof xe)&&P.input instanceof fo&&P.input.name==="zoom"&&(k=P);return k instanceof gr||P.eachChild(function(H){var ee=S(H);ee instanceof gr?k=ee:!k&&ee?k=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ee&&k!==ee&&(k=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return b||y?b instanceof gr?_u([b]):b instanceof xe&&!yl(o)?_u([new gr("",'"interpolate" expressions cannot be used with this property')]):Xf(b?new Fo(p?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new el(p?"constant":"source",t.value)):_u([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Fo.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Fo.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},Fo.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var tl=function(t,o){this._parameters=t,this._specification=o,vr(this,function u(p,y){var b,S,P,k=y.type==="color",z=p.stops&&typeof p.stops[0][0]=="object",Z=z||!(z||p.property!==void 0),H=p.type||(yl(y)?"exponential":"interval");if(k&&((p=vr({},p)).stops&&(p.stops=p.stops.map(function(vn){return[vn[0],Ui.parse(vn[1])]})),p.default=Ui.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(H==="exponential")b=Ah;else if(H==="interval")b=Ch;else if(H==="categorical"){b=Yf,S=Object.create(null);for(var ee=0,ie=p.stops;ee<ie.length;ee+=1){var Pe=ie[ee];S[Pe[0]]=Pe[1]}P=typeof p.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');b=of}if(z){for(var Re={},Qe=[],Ce=0;Ce<p.stops.length;Ce++){var Ge=p.stops[Ce],Ct=Ge[0].zoom;Re[Ct]===void 0&&(Re[Ct]={zoom:Ct,type:p.type,property:p.property,default:p.default,stops:[]},Qe.push(Ct)),Re[Ct].stops.push([Ge[0].value,Ge[1]])}for(var Xt=[],Yt=0,fr=Qe;Yt<fr.length;Yt+=1){var kr=fr[Yt];Xt.push([Re[kr].zoom,u(Re[kr],y)])}var Qr={name:"linear"};return{kind:"composite",interpolationType:Qr,interpolationFactor:xe.interpolationFactor.bind(void 0,Qr),zoomStops:Xt.map(function(vn){return vn[0]}),evaluate:function(vn,jn){var gn=vn.zoom;return Ah({stops:Xt,base:p.base},y,gn).evaluate(gn,jn)}}}if(Z){var zn=H==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:zn,interpolationFactor:xe.interpolationFactor.bind(void 0,zn),zoomStops:p.stops.map(function(vn){return vn[0]}),evaluate:function(vn){return b(p,y,vn.zoom,S,P)}}}return{kind:"source",evaluate:function(vn,jn){var gn=jn&&jn.properties?jn.properties[p.property]:void 0;return gn===void 0?ts(p.default,y.default):b(p,y,gn,S,P)}}}(this._parameters,this._specification))};function qs(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,P=[],k=_a(u);if(k!=="object")return[new Be(o,u,"object expected, "+k+" found")];for(var z in u){var Z=z.split(".")[0],H=p[Z]||p["*"],ee=void 0;if(y[Z])ee=y[Z];else if(p[Z])ee=Li;else if(y["*"])ee=y["*"];else{if(!p["*"]){P.push(new Be(o,u[z],'unknown property "'+z+'"'));continue}ee=Li}P=P.concat(ee({key:(o&&o+".")+z,value:u[z],valueSpec:H,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ie in p)y[ie]||p[ie].required&&p[ie].default===void 0&&u[ie]===void 0&&P.push(new Be(o,u,'missing required property "'+ie+'"'));return P}function sf(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Li;if(_a(o)!=="array")return[new Be(b,o,"array expected, "+_a(o)+" found")];if(u.length&&o.length!==u.length)return[new Be(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Be(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),_a(u.value)==="object"&&(P=u.value);for(var k=[],z=0;z<o.length;z++)k=k.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:P,style:p,styleSpec:y,key:b+"["+z+"]"}));return k}function uf(t){var o=t.key,u=t.value,p=t.valueSpec,y=_a(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Be(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new Be(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Be(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function lf(t){var o,u,p,y=t.valueSpec,b=Bt(t.value.type),S={},P=b!=="categorical"&&t.value.property===void 0,k=!P,z=_a(t.value.stops)==="array"&&_a(t.value.stops[0])==="array"&&_a(t.value.stops[0][0])==="object",Z=qs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ie){if(b==="identity")return[new Be(ie.key,ie.value,'identity function may not have a "stops" property')];var Pe=[],Re=ie.value;return Pe=Pe.concat(sf({key:ie.key,value:Re,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:H})),_a(Re)==="array"&&Re.length===0&&Pe.push(new Be(ie.key,Re,"array must have at least one stop")),Pe},default:function(ie){return Li({key:ie.key,value:ie.value,valueSpec:y,style:ie.style,styleSpec:ie.styleSpec})}}});return b==="identity"&&P&&Z.push(new Be(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Be(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!yl(t.valueSpec)&&Z.push(new Be(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Ds(t.valueSpec)?Z.push(new Be(t.key,t.value,"property functions not supported")):P&&!kc(t.valueSpec)&&Z.push(new Be(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new Be(t.key,t.value,'"property" property is required')),Z;function H(ie){var Pe=[],Re=ie.value,Qe=ie.key;if(_a(Re)!=="array")return[new Be(Qe,Re,"array expected, "+_a(Re)+" found")];if(Re.length!==2)return[new Be(Qe,Re,"array length 2 expected, length "+Re.length+" found")];if(z){if(_a(Re[0])!=="object")return[new Be(Qe,Re,"object expected, "+_a(Re[0])+" found")];if(Re[0].zoom===void 0)return[new Be(Qe,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new Be(Qe,Re,"object stop key must have value")];if(p&&p>Bt(Re[0].zoom))return[new Be(Qe,Re[0].zoom,"stop zoom values must appear in ascending order")];Bt(Re[0].zoom)!==p&&(p=Bt(Re[0].zoom),u=void 0,S={}),Pe=Pe.concat(qs({key:Qe+"[0]",value:Re[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:uf,value:ee}}))}else Pe=Pe.concat(ee({key:Qe+"[0]",value:Re[0],valueSpec:{},style:ie.style,styleSpec:ie.styleSpec},Re));return Do(zt(Re[1]))?Pe.concat([new Be(Qe+"[1]",Re[1],"expressions are not allowed in function stops.")]):Pe.concat(Li({key:Qe+"[1]",value:Re[1],valueSpec:y,style:ie.style,styleSpec:ie.styleSpec}))}function ee(ie,Pe){var Re=_a(ie.value),Qe=Bt(ie.value),Ce=ie.value!==null?ie.value:Pe;if(o){if(Re!==o)return[new Be(ie.key,Ce,Re+" stop domain type must match previous stop domain type "+o)]}else o=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean")return[new Be(ie.key,Ce,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&b!=="categorical"){var Ge="number expected, "+Re+" found";return Ds(y)&&b===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(ie.key,Ce,Ge)]}return b!=="categorical"||Re!=="number"||isFinite(Qe)&&Math.floor(Qe)===Qe?b!=="categorical"&&Re==="number"&&u!==void 0&&Qe<u?[new Be(ie.key,Ce,"stop domain values must appear in ascending order")]:(u=Qe,b==="categorical"&&Qe in S?[new Be(ie.key,Ce,"stop domain values must be unique")]:(S[Qe]=!0,[])):[new Be(ie.key,Ce,"integer expected, found "+Qe)]}}function rl(t){var o=(t.expressionContext==="property"?kl:Ru)(zt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Be(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Be(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!It(u))return[new Be(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!It(u))return[new Be(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ko(u,["zoom","feature-state"]))return[new Be(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Vr(u))return[new Be(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Bt(u))===-1&&y.push(new Be(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Bt(u))===-1&&y.push(new Be(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Dc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Dc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}tl.deserialize=function(t){return new tl(t._parameters,t._specification)},tl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var cf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Dc(t)||(t=Bc(t));var o=Ru(t,cf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function wh(t,o){return t<o?-1:t>o?1:0}function Bc(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?xl(t[1],t[2],"=="):u==="!="?Lu(xl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?xl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Bc))):u==="all"?["all"].concat(t.slice(1).map(Bc)):u==="none"?["all"].concat(t.slice(1).map(Bc).map(Lu)):u==="in"?ff(t[1],t.slice(2)):u==="!in"?Lu(ff(t[1],t.slice(2))):u==="has"?hf(t[1]):u==="!has"?Lu(hf(t[1])):u!=="within"||t}function xl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function ff(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(wh)]]:["filter-in-small",t,["literal",o]]}}function hf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Lu(t){return["!",t]}function pf(t){return Dc(zt(t.value))?rl(vr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(_a(p)!=="array")return[new Be(y,p,"array expected, "+_a(p)+" found")];var b,S=u.styleSpec,P=[];if(p.length<1)return[new Be(y,p,"filter array must have at least 1 element")];switch(P=P.concat(oc({key:y+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Bt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Bt(p[1])==="$type"&&P.push(new Be(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&P.push(new Be(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=_a(p[1]))!=="string"&&P.push(new Be(y+"[1]",p[1],"string expected, "+b+" found"));for(var k=2;k<p.length;k++)b=_a(p[k]),Bt(p[1])==="$type"?P=P.concat(oc({key:y+"["+k+"]",value:p[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&P.push(new Be(y+"["+k+"]",p[k],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<p.length;z++)P=P.concat(o({key:y+"["+z+"]",value:p[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=_a(p[1]),p.length!==2?P.push(new Be(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&P.push(new Be(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=_a(p[1]),p.length!==2?P.push(new Be(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&P.push(new Be(y+"[1]",p[1],"object expected, "+b+" found"))}return P}(t)}function qf(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,P=y[o+"_"+t.layerType];if(!P)return[];var k=S.match(/^(.*)-transition$/);if(o==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return Li({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var z,Z=t.valueSpec||P[S];if(!Z)return[new Be(u,b,'unknown property "'+S+'"')];if(_a(b)==="string"&&Ds(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Be(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var H=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&H.push(new Be(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ll(zt(b))&&Bt(b.type)==="identity"&&H.push(new Be(u,b,'"text-font" does not support identity functions'))),H.concat(Li({key:t.key,value:b,valueSpec:Z,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Th(t){return qf(t,"paint")}function Dl(t){return qf(t,"layout")}function sp(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Be(p,u,'either "type" or "ref" is required'));var S,P=Bt(u.type),k=Bt(u.ref);if(u.id)for(var z=Bt(u.id),Z=0;Z<t.arrayIndex;Z++){var H=y.layers[Z];Bt(H.id)===z&&o.push(new Be(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+H.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Pe){Pe in u&&o.push(new Be(p,u[Pe],'"'+Pe+'" is prohibited for ref layers'))}),y.layers.forEach(function(Pe){Bt(Pe.id)===k&&(S=Pe)}),S?S.ref?o.push(new Be(p,u.ref,"ref cannot reference another ref layer")):P=Bt(S.type):o.push(new Be(p,u.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],ie=ee&&Bt(ee.type);ee?ie==="vector"&&P==="raster"?o.push(new Be(p,u.source,'layer "'+u.id+'" requires a raster source')):ie==="raster"&&P!=="raster"?o.push(new Be(p,u.source,'layer "'+u.id+'" requires a vector source')):ie!=="vector"||u["source-layer"]?ie==="raster-dem"&&P!=="hillshade"?o.push(new Be(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ie==="geojson"&&ee.lineMetrics||o.push(new Be(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Be(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Be(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Be(p,u,'missing required property "source"'));return o=o.concat(qs({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Li({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:pf,layout:function(Pe){return qs({layer:u,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(Re){return Dl(vr({layerType:P},Re))}}})},paint:function(Pe){return qs({layer:u,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(Re){return Th(vr({layerType:P},Re))}}})}}}))}function rs(t){var o=t.value,u=t.key,p=_a(o);return p!=="string"?[new Be(u,o,"string expected, "+p+" found")]:[]}var ja={promoteId:function(t){var o=t.key,u=t.value;if(_a(u)==="string")return rs({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,rs({key:o+"."+y,value:u[y]}));return p}};function sc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new Be(u,o,'"type" is required')];var b,S=Bt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return qs({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:ja});case"geojson":if(b=qs({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:ja}),o.cluster)for(var P in o.clusterProperties){var k=o.clusterProperties[P],z=k[0],Z=typeof z=="string"?[z,["accumulated"],["get",P]]:z;b.push.apply(b,rl({key:u+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),b.push.apply(b,rl({key:u+"."+P+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return qs({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return qs({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new Be(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function Fl(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],S=_a(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Be("light",o,"object expected, "+S+" found")]);for(var P in o){var k=P.match(/^(.*)-transition$/);b=b.concat(k&&p[k[1]]&&p[k[1]].transition?Li({key:P,value:o[P],valueSpec:u.transition,style:y,styleSpec:u}):p[P]?Li({key:P,value:o[P],valueSpec:p[P],style:y,styleSpec:u}):[new Be(P,o[P],'unknown property "'+P+'"')])}return b}var lu={"*":function(){return[]},array:sf,boolean:function(t){var o=t.value,u=t.key,p=_a(o);return p!=="boolean"?[new Be(u,o,"boolean expected, "+p+" found")]:[]},number:uf,color:function(t){var o=t.key,u=t.value,p=_a(u);return p!=="string"?[new Be(o,u,"color expected, "+p+" found")]:Mi(u)===null?[new Be(o,u,'color expected, "'+u+'" found')]:[]},constants:yt,enum:oc,filter:pf,function:lf,layer:sp,object:qs,source:sc,light:Fl,string:rs,formatted:function(t){return rs(t).length===0?[]:rl(t)},resolvedImage:function(t){return rs(t).length===0?[]:rl(t)}};function Li(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&Ll(Bt(o))?lf(t):u.expression&&Do(zt(o))?rl(t):u.type&&lu[u.type]?lu[u.type](t):qs(vr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,p=rs(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Be(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Be(u,o,'"glyphs" url must include a "{range}" token'))),p}function Fs(t,o){o===void 0&&(o=fe);var u=[];return u=u.concat(Li({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(yt({key:"constants",value:t.constants,style:t,styleSpec:o}))),df(u)}function df(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function bl(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return df(t.apply(this,o))}}Fs.source=bl(sc),Fs.light=bl(Fl),Fs.layer=bl(sp),Fs.filter=bl(pf),Fs.paintProperty=bl(Th),Fs.layoutProperty=bl(Dl);var vf=Fs,up=vf.light,lp=vf.paintProperty,Nc=vf.layoutProperty;function uc(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new He(new Error(y[p].message))),u=!0;return u}var nl=Ao;function Ao(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],P=y[3+b+1];p.push(S===P?null:y.subarray(S,P))}var k=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}Ao.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},Ao.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ao.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},Ao.prototype.query=function(t,o,u,p,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,p,this._queryCell,P,{},y),P},Ao.prototype._queryCell=function(t,o,u,p,y,b,S,P){var k=this.cells[y];if(k!==null)for(var z=this.keys,Z=this.bboxes,H=0;H<k.length;H++){var ee=k[H];if(S[ee]===void 0){var ie=4*ee;(P?P(Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3]):t<=Z[ie+2]&&o<=Z[ie+3]&&u>=Z[ie+0]&&p>=Z[ie+1])?(S[ee]=!0,b.push(z[ee])):S[ee]=!1}}},Ao.prototype._forEachCell=function(t,o,u,p,y,b,S,P){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),H=this._convertToCellCoord(p),ee=k;ee<=Z;ee++)for(var ie=z;ie<=H;ie++){var Pe=this.d*ie+ee;if((!P||P(this._convertFromCellCoord(ee),this._convertFromCellCoord(ie),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(ie+1)))&&y.call(this,t,o,u,p,Pe,b,S,P))return}},Ao.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ao.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ao.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var P=t[S];y[3+S]=b,y.set(P,b),b+=P.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var lc=ae.ImageData,cc=ae.ImageBitmap,Xa={};function mn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Xa[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var eo in mn("Object",Object),nl.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},nl.deserialize=function(t){return new nl(t.buffer)},mn("Grid",nl),mn("Color",Ui),mn("Error",Error),mn("ResolvedImage",Sa),mn("StylePropertyFunction",tl),mn("StyleExpression",_l,{omit:["_evaluator"]}),mn("ZoomDependentExpression",Fo),mn("ZoomConstantExpression",el),mn("CompoundExpression",fo,{omit:["_evaluate"]}),vo)vo[eo]._classRegistryKey||mn("Expression_"+eo,vo[eo]);function il(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function al(t){return cc&&t instanceof cc}function xu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(il(t)||al(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof lc)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(xu(b[y],o));return p}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(Xa[P].omit.indexOf(z)>=0)){var Z=t[z];k[z]=Xa[P].shallow.indexOf(z)>=0?Z:xu(Z,o)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof t)}function Bs(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||il(t)||al(t)||ArrayBuffer.isView(t)||t instanceof lc)return t;if(Array.isArray(t))return t.map(Bs);if(typeof t=="object"){var o=t.$name||"Object",u=Xa[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var P=t[S];p[S]=Xa[o].shallow.indexOf(S)>=0?P:Bs(P)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Kf=function(){this.first=!0};Kf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var qr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function mf(t){for(var o=0,u=t;o<u.length;o+=1)if($f(u[o].charCodeAt(0)))return!0;return!1}function $f(t){return!(t!==746&&t!==747&&(t<4352||!(qr["Bopomofo Extended"](t)||qr.Bopomofo(t)||qr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||qr["CJK Compatibility Ideographs"](t)||qr["CJK Compatibility"](t)||qr["CJK Radicals Supplement"](t)||qr["CJK Strokes"](t)||!(!qr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||qr["CJK Unified Ideographs Extension A"](t)||qr["CJK Unified Ideographs"](t)||qr["Enclosed CJK Letters and Months"](t)||qr["Hangul Compatibility Jamo"](t)||qr["Hangul Jamo Extended-A"](t)||qr["Hangul Jamo Extended-B"](t)||qr["Hangul Jamo"](t)||qr["Hangul Syllables"](t)||qr.Hiragana(t)||qr["Ideographic Description Characters"](t)||qr.Kanbun(t)||qr["Kangxi Radicals"](t)||qr["Katakana Phonetic Extensions"](t)||qr.Katakana(t)&&t!==12540||!(!qr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!qr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||qr["Unified Canadian Aboriginal Syllabics"](t)||qr["Unified Canadian Aboriginal Syllabics Extended"](t)||qr["Vertical Forms"](t)||qr["Yijing Hexagram Symbols"](t)||qr["Yi Syllables"](t)||qr["Yi Radicals"](t))))}function ku(t){return!($f(t)||function(o){return!!(qr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||qr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||qr["Letterlike Symbols"](o)||qr["Number Forms"](o)||qr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||qr["Control Pictures"](o)&&o!==9251||qr["Optical Character Recognition"](o)||qr["Enclosed Alphanumerics"](o)||qr["Geometric Shapes"](o)||qr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||qr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||qr["CJK Symbols and Punctuation"](o)||qr.Katakana(o)||qr["Private Use Area"](o)||qr["CJK Compatibility Forms"](o)||qr["Small Form Variants"](o)||qr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Fa(t){return t>=1424&&t<=2303||qr["Arabic Presentation Forms-A"](t)||qr["Arabic Presentation Forms-B"](t)}function Ns(t,o){return!(!o&&Fa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||qr.Khmer(t))}function gf(t){for(var o=0,u=t;o<u.length;o+=1)if(Fa(u[o].charCodeAt(0)))return!0;return!1}var Du=null,ws="unavailable",mo=null,Mh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ws="error"),Du&&Du(t)};function pa(){Qf.fire(new Ie("pluginStateChange",{pluginStatus:ws,pluginURL:mo}))}var Qf=new at,Ph=function(){return ws},Ks=function(){if(ws!=="deferred"||!mo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws="loading",pa(),mo&&wa({url:mo},function(t){t?Mh(t):(ws="loaded",pa())})},Ts={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ws==="loaded"||Ts.applyArabicShaping!=null},isLoading:function(){return ws==="loading"},setState:function(t){ws=t.pluginStatus,mo=t.pluginURL},isParsed:function(){return Ts.applyArabicShaping!=null&&Ts.processBidirectionalText!=null&&Ts.processStyledBidirectionalText!=null},getPluginURL:function(){return mo}},Pi=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kf,this.transition={})};Pi.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!Ns(y[p].charCodeAt(0),u))return!1;return!0}(t,Ts.isLoaded())},Pi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Pi.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var bu=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(Ll(u))return new tl(u,p);if(Do(u)){var y=kl(u,p);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=Ui.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};bu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},bu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var la=function(t){this.property=t,this.value=new bu(t,void 0)};la.prototype.transitioned=function(t,o){return new zs(this.property,this.value,o,Pt({},t.transition,this.transition),t.now)},la.prototype.untransitioned=function(){return new zs(this.property,this.value,null,{},0)};var no=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};no.prototype.getValue=function(t){return rt(this._values[t].value.value)},no.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new la(this._values[t].property)),this._values[t].value=new bu(this._values[t].property,o===null?void 0:rt(o))},no.prototype.getTransition=function(t){return rt(this._values[t].transition)},no.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new la(this._values[t].property)),this._values[t].transition=rt(o)||void 0},no.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},no.prototype.transitioned=function(t,o){for(var u=new cu(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},no.prototype.untransitioned=function(){for(var t=new cu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var zs=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};zs.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,z=k*P;return 4*(P<.5?z:3*(P-k)+z-.75)}(S))}return y};var cu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};cu.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Zs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},cu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Us=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Us.prototype.getValue=function(t){return rt(this._values[t].value)},Us.prototype.setValue=function(t,o){this._values[t]=new bu(this._values[t].property,o===null?void 0:rt(o))},Us.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Us.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Zs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var hs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};hs.prototype.isConstant=function(){return this.value.kind==="constant"},hs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},hs.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var Zs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Zs.prototype.get=function(t){return this._values[t]};var In=function(t){this.specification=t};In.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},In.prototype.interpolate=function(t,o,u){var p=ho[this.specification.type];return p?p(t,o,u):t};var An=function(t,o){this.specification=t,this.overrides=o};An.prototype.possiblyEvaluate=function(t,o,u,p){return new hs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},An.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new hs(this,{kind:"constant",value:void 0},t.parameters);var p=ho[this.specification.type];return p?new hs(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},An.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new hs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},y,b),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(P,P,P,p);return new hs(this,{kind:"constant",value:k},p)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new hs(this,{kind:"constant",value:z},p)}return new hs(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,S,P){if(u.kind==="source"){var k=u.evaluate(p,y,b,S,P);return this._calculate(k,k,k,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(An),ps=function(t){this.specification=t};ps.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Pi(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Pi(Math.floor(o.zoom),o)),t.expression.evaluate(new Pi(Math.floor(o.zoom+1),o)),o)}},ps.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},ps.prototype.interpolate=function(t){return t};var Eu=function(t){this.specification=t};Eu.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},Eu.prototype.interpolate=function(){return!1};var Ko=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new bu(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new la(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};mn("DataDrivenProperty",An),mn("DataConstantProperty",In),mn("CrossFadedDataDrivenProperty",fc),mn("CrossFadedProperty",ps),mn("ColorRampProperty",Eu);var xa=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Us(p.layout)),p.paint)){for(var y in this._transitionablePaint=new no(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zs(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(Nc,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return q(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(lp,"layers."+this.id+".paint."+u,u,p,y))return!1;if(q(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",P=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,k,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),_t(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&uc(this,u.call(vf,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof hs&&Ds(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(at),yf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},zc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ia=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function La(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=yf[y.type].BYTES_PER_ELEMENT,S=u=Jf(u,Math.max(o,b)),P=y.components||1;return p=Math.max(p,b),u+=b*P,{name:y.name,type:y.type,components:P,offset:S}}),size:Jf(u,Math.max(p,o)),alignment:o}}function Jf(t,o){return Math.ceil(t/o)*o}ia.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ia.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ia.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ia.prototype.clear=function(){this.length=0},ia.prototype.resize=function(t){this.reserve(t),this.length=t},ia.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ia.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ol=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(ia);ol.prototype.bytesPerElement=4,mn("StructArrayLayout2i4",ol);var $s=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=4*u;return this.int16[P+0]=p,this.int16[P+1]=y,this.int16[P+2]=b,this.int16[P+3]=S,u},o}(ia);$s.prototype.bytesPerElement=8,mn("StructArrayLayout4i8",$s);var Su=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(ia);Su.prototype.bytesPerElement=12,mn("StructArrayLayout2i4i12",Su);var wo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=4*u,Z=8*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=P,this.uint8[Z+7]=k,u},o}(ia);wo.prototype.bytesPerElement=8,mn("StructArrayLayout2i4ub8",wo);var sl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(ia);sl.prototype.bytesPerElement=8,mn("StructArrayLayout2f8",sl);var Cu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,Z,H){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,b,S,P,k,z,Z,H)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,Z,H,ee){var ie=10*u;return this.uint16[ie+0]=p,this.uint16[ie+1]=y,this.uint16[ie+2]=b,this.uint16[ie+3]=S,this.uint16[ie+4]=P,this.uint16[ie+5]=k,this.uint16[ie+6]=z,this.uint16[ie+7]=Z,this.uint16[ie+8]=H,this.uint16[ie+9]=ee,u},o}(ia);Cu.prototype.bytesPerElement=20,mn("StructArrayLayout10ui20",Cu);var El=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,Z,H,ee,ie){var Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,u,p,y,b,S,P,k,z,Z,H,ee,ie)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe){var Re=12*u;return this.int16[Re+0]=p,this.int16[Re+1]=y,this.int16[Re+2]=b,this.int16[Re+3]=S,this.uint16[Re+4]=P,this.uint16[Re+5]=k,this.uint16[Re+6]=z,this.uint16[Re+7]=Z,this.int16[Re+8]=H,this.int16[Re+9]=ee,this.int16[Re+10]=ie,this.int16[Re+11]=Pe,u},o}(ia);El.prototype.bytesPerElement=24,mn("StructArrayLayout4i4ui4i24",El);var ul=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ia);ul.prototype.bytesPerElement=12,mn("StructArrayLayout3f12",ul);var hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ia);hc.prototype.bytesPerElement=4,mn("StructArrayLayout1ul4",hc);var _f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,Z){var H=this.length;return this.resize(H+1),this.emplace(H,u,p,y,b,S,P,k,z,Z)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,Z,H){var ee=10*u,ie=5*u;return this.int16[ee+0]=p,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=P,this.int16[ee+5]=k,this.uint32[ie+3]=z,this.uint16[ee+8]=Z,this.uint16[ee+9]=H,u},o}(ia);_f.prototype.bytesPerElement=20,mn("StructArrayLayout6i1ul2ui20",_f);var Sl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,p,y,b,S,P)},o.prototype.emplace=function(u,p,y,b,S,P,k){var z=6*u;return this.int16[z+0]=p,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(ia);Sl.prototype.bytesPerElement=12,mn("StructArrayLayout2i2i2i12",Sl);var Cl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,p,y,b,S)},o.prototype.emplace=function(u,p,y,b,S,P){var k=4*u,z=8*u;return this.float32[k+0]=p,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[z+6]=S,this.int16[z+7]=P,u},o}(ia);Cl.prototype.bytesPerElement=16,mn("StructArrayLayout2f1f2i16",Cl);var Ih=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=12*u,k=3*u;return this.uint8[P+0]=p,this.uint8[P+1]=y,this.float32[k+1]=b,this.float32[k+2]=S,u},o}(ia);Ih.prototype.bytesPerElement=12,mn("StructArrayLayout2ub2f12",Ih);var Al=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ia);Al.prototype.bytesPerElement=6,mn("StructArrayLayout3ui6",Al);var Bl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge){var Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge,Ct){var Xt=24*u,Yt=12*u,fr=48*u;return this.int16[Xt+0]=p,this.int16[Xt+1]=y,this.uint16[Xt+2]=b,this.uint16[Xt+3]=S,this.uint32[Yt+2]=P,this.uint32[Yt+3]=k,this.uint32[Yt+4]=z,this.uint16[Xt+10]=Z,this.uint16[Xt+11]=H,this.uint16[Xt+12]=ee,this.float32[Yt+7]=ie,this.float32[Yt+8]=Pe,this.uint8[fr+36]=Re,this.uint8[fr+37]=Qe,this.uint8[fr+38]=Ce,this.uint32[Yt+10]=Ge,this.int16[Xt+22]=Ct,u},o}(ia);Bl.prototype.bytesPerElement=48,mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bl);var xf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge,Ct,Xt,Yt,fr,kr,Qr,zn,vn,jn,gn,Ri){var ii=this.length;return this.resize(ii+1),this.emplace(ii,u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge,Ct,Xt,Yt,fr,kr,Qr,zn,vn,jn,gn,Ri)},o.prototype.emplace=function(u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re,Qe,Ce,Ge,Ct,Xt,Yt,fr,kr,Qr,zn,vn,jn,gn,Ri,ii){var Mn=34*u,Vi=17*u;return this.int16[Mn+0]=p,this.int16[Mn+1]=y,this.int16[Mn+2]=b,this.int16[Mn+3]=S,this.int16[Mn+4]=P,this.int16[Mn+5]=k,this.int16[Mn+6]=z,this.int16[Mn+7]=Z,this.uint16[Mn+8]=H,this.uint16[Mn+9]=ee,this.uint16[Mn+10]=ie,this.uint16[Mn+11]=Pe,this.uint16[Mn+12]=Re,this.uint16[Mn+13]=Qe,this.uint16[Mn+14]=Ce,this.uint16[Mn+15]=Ge,this.uint16[Mn+16]=Ct,this.uint16[Mn+17]=Xt,this.uint16[Mn+18]=Yt,this.uint16[Mn+19]=fr,this.uint16[Mn+20]=kr,this.uint16[Mn+21]=Qr,this.uint16[Mn+22]=zn,this.uint32[Vi+12]=vn,this.float32[Vi+13]=jn,this.float32[Vi+14]=gn,this.float32[Vi+15]=Ri,this.float32[Vi+16]=ii,u},o}(ia);xf.prototype.bytesPerElement=68,mn("StructArrayLayout8i15ui1ul4f68",xf);var Fu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ia);Fu.prototype.bytesPerElement=4,mn("StructArrayLayout1f4",Fu);var bs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ia);bs.prototype.bytesPerElement=6,mn("StructArrayLayout3i6",bs);var bf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ia);bf.prototype.bytesPerElement=8,mn("StructArrayLayout1ul2ui8",bf);var pc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(ia);pc.prototype.bytesPerElement=4,mn("StructArrayLayout2ui4",pc);var Oh=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ia);Oh.prototype.bytesPerElement=2,mn("StructArrayLayout1ui2",Oh);var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var P=4*u;return this.float32[P+0]=p,this.float32[P+1]=y,this.float32[P+2]=b,this.float32[P+3]=S,u},o}(ia);Nl.prototype.bytesPerElement=16,mn("StructArrayLayout4f16",Nl);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ue(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(zc);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(_f);mn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(zc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Bl);mn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(zc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(xf);mn("SymbolInstanceArray",w);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Fu);mn("GlyphOffsetArray",M);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(bs);mn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(zc);U.prototype.size=8;var X=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(bf);mn("FeatureIndexArray",X);var se=La([{name:"a_pos",components:2,type:"Int16"}],4).members,he=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,o){return 256*(t=Gt(Math.floor(t),0,255))+Gt(Math.floor(o),0,255)}he.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>he.MAX_VERTEX_ARRAY_LENGTH&&tt("Max vertices per segment is "+he.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>he.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},he.prototype.get=function(){return this.segments},he.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},he.simpleSegment=function(t,o,u,p){return new he([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},he.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mn("SegmentVector",he);var Le=La([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Oe=ve(function(t){t.exports=function(o,u){var p,y,b,S,P,k,z,Z;for(y=o.length-(p=3&o.length),b=u,P=3432918353,k=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,p){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),We=ve(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,S=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),we=Oe,Xe=We;we.murmur3=Oe,we.murmur2=Xe;var it=function(){this.ids=[],this.positions=[],this.indexed=!1};it.prototype.add=function(t,o,u,p){this.ids.push(Ht(t)),this.positions.push(o,u,p)},it.prototype.getPositions=function(t){for(var o=Ht(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},it.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,S,P,k){for(;P<k;){for(var z=b[P+k>>1],Z=P-1,H=k+1;;){do Z++;while(b[Z]<z);do H--;while(b[H]>z);if(Z>=H)break;Wt(b,Z,H),Wt(S,3*Z,3*H),Wt(S,3*Z+1,3*H+1),Wt(S,3*Z+2,3*H+2)}H-P<k-H?(y(b,S,P,H),P=H+1):(y(b,S,H+1,k),k=H)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},it.deserialize=function(t){var o=new it;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var bt=Math.pow(2,53)-1;function Ht(t){var o=+t;return!isNaN(o)&&o<=bt?o:we(String(t))}function Wt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}mn("FeaturePositionMap",it);var Qt=function(t,o){this.gl=t.gl,this.location=o},mr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Qt),lr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Qt),Mr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Qt),tn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Qt),Ln=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Qt),kn=function(t){function o(u,p){t.call(this,u,p),this.current=Ui.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Qt),Fn=new Float32Array(16),Oi=function(t){function o(u,p){t.call(this,u,p),this.current=Fn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Qt);function wr(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var Yn=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};Yn.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},Yn.prototype.getBinding=function(t,o,u){return this.type==="color"?new kn(t,o):new lr(t,o)};var ti=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ti.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},ti.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},ti.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Ln(t,o):new lr(t,o)};var ri=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ri.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Pi(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ri.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},ri.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=wr(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ri.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Wn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Wn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new Pi(this.zoom),o,{},p,[],y),S=this.expression.evaluate(new Pi(this.zoom+1),o,{},p,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,b,S)},Wn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Wn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=wr(u),b=wr(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Wn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Wn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Gt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Wn.prototype.getBinding=function(t,o,u){return new lr(t,o)};var oi=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};oi.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},oi.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},oi.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],S=p[u.max];if(y&&b&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},oi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Le.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Le.members,this.expression.isStateDependent))},oi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var On=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof hs&&Ds(b.property.specification)){var S=go(y,t.type),P=b.value,k=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],H=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=H?new ti(P.value,S):new Yn(P.value,S,k),p.push("/u_"+y);else if(P.kind==="source"||H){var ee=Xn(y,k,"source");this.binders[y]=H?new oi(P,k,z,o,ee,t.id):new ri(P,S,k,ee),p.push("/a_"+y)}else{var ie=Xn(y,k,"composite");this.binders[y]=new Wn(P,S,k,z,o,ie),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};On.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ri||o instanceof Wn?o.maxValue:0},On.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ri||S instanceof Wn||S instanceof oi)&&S.populatePaintArray(t,o,u,p,y)}},On.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof ti&&p.setConstantPatternPositions(t,o)}},On.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var S in t)for(var P=0,k=o.getPositions(S);P<k.length;P+=1){var z=k[P],Z=u.feature(z.index);for(var H in this.binders){var ee=this.binders[H];if((ee instanceof ri||ee instanceof Wn||ee instanceof oi)&&ee.expression.isStateDependent===!0){var ie=p.paint.get(H);ee.expression=ie.value,ee.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},On.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof Yn||u instanceof ti)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},On.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ri||u instanceof Wn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof oi)for(var y=0;y<Le.members.length;y++)t.push(Le.members[y].name)}return t},On.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Yn||u instanceof ti||u instanceof Wn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},On.prototype.getPaintVertexBuffers=function(){return this._buffers},On.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof Yn||y instanceof ti||y instanceof Wn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var P=S[b];if(o[P]){var k=y.getBinding(t,o[P],P);u.push({name:P,property:p,binding:k})}}}return u},On.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],P=S.name,k=S.property;this.binders[k].setUniform(S.binding,p,u.get(k),P)}},On.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof oi){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ri||u instanceof Wn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},On.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ri||u instanceof Wn||u instanceof oi)&&u.upload(t)}this.updatePaintBuffers()},On.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ri||o instanceof Wn||o instanceof oi)&&o.destroy()}};var Sn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new On(b,o,u)}this.needsUpload=!1,this._featureMap=new it,this._bufferOffset=0};function go(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Xn(t,o,u){var p={color:{source:sl,composite:Nl},number:{source:Fu,composite:sl}},y=function(b){return{"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu}}[b]}(t);return y&&y[u]||p[o][u]}Sn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Sn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},Sn.prototype.get=function(t){return this.programConfigurations[t]},Sn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Sn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},mn("ConstantBinder",Yn),mn("CrossFadedConstantBinder",ti),mn("SourceExpressionBinder",ri),mn("CrossFadedCompositeBinder",oi),mn("CompositeExpressionBinder",Wn),mn("ProgramConfiguration",On,{omit:["_buffers"]}),mn("ProgramConfigurationSet",Sn);var Bo=Math.pow(2,14)-1,To=-Bo-1;function Va(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var S=y[b],P=Math.round(S.x*o),k=Math.round(S.y*o);S.x=Gt(P,To,Bo),S.y=Gt(k,To,Bo),(P<S.x||P>S.x+1||k<S.y||k>S.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function Ga(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Va(t):[]}}function Ms(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var ds=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ol,this.indexArray=new Al,this.segments=new he,this.programConfigurations=new Sn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Au(t,o){for(var u=0;u<t.length;u++)if(Qs(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(Qs(t,o[p]))return!0;return!!zl(t,o)}function $o(t,o,u){return!!Qs(t,o)||!!Bu(o,t,u)}function Ps(t,o){if(t.length===1)return jl(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(Qs(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(jl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(zl(t,o[S]))return!0;return!1}function fu(t,o,u){if(t.length>1){if(zl(t,o))return!0;for(var p=0;p<o.length;p++)if(Bu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(Bu(t[y],o,u))return!0;return!1}function zl(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Ul(p,y,o[b],o[b+1]))return!0;return!1}function Ul(t,o,u,p){return $t(t,u,p)!==$t(o,u,p)&&$t(t,o,u)!==$t(t,o,p)}function Bu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(Zl(t,o[y-1],o[y])<p)return!0;return!1}function Zl(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function jl(t,o){for(var u,p,y,b=!1,S=0;S<t.length;S++)for(var P=0,k=(u=t[S]).length-1;P<u.length;k=P++)(p=u[P]).y>o.y!=(y=u[k]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function Qs(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Vl(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=$t(t,o,u[0]);return b!==$t(t,o,u[1])||b!==$t(t,o,u[2])||b!==$t(t,o,u[3])}function wu(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function yo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Nu(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=ue.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(b));return S}ds.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var k=P[S],z=k.feature,Z=k.id,H=k.index,ee=k.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,Pe=Ga(z,ie);if(this.layers[0]._featureFilter.filter(new Pi(this.zoom),Pe,u)){var Re=b?b.evaluate(Pe,{},u):void 0,Qe={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:H,geometry:ie?Pe.geometry:Va(z),patterns:{},sortKey:Re};y.push(Qe)}}b&&y.sort(function(Qr,zn){return Qr.sortKey-zn.sortKey});for(var Ce=0,Ge=y;Ce<Ge.length;Ce+=1){var Ct=Ge[Ce],Xt=Ct.geometry,Yt=Ct.index,fr=Ct.sourceLayerIndex,kr=t[Yt].feature;this.addFeature(Ct,Xt,Yt,u),o.featureIndex.insert(kr,Xt,Yt,fr,this.index)}},ds.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ds.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,se),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ds.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,P=b[y];S<P.length;S+=1){var k=P[S],z=k.x,Z=k.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=H.vertexLength;Ms(this.layoutVertexArray,z,Z,-1,-1),Ms(this.layoutVertexArray,z,Z,1,-1),Ms(this.layoutVertexArray,z,Z,1,1),Ms(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},mn("CircleBucket",ds,{omit:["layers"]});var Qo=new Ko({"circle-sort-key":new An(fe.layout_circle["circle-sort-key"])}),zu={paint:new Ko({"circle-radius":new An(fe.paint_circle["circle-radius"]),"circle-color":new An(fe.paint_circle["circle-color"]),"circle-blur":new An(fe.paint_circle["circle-blur"]),"circle-opacity":new An(fe.paint_circle["circle-opacity"]),"circle-translate":new In(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new In(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(fe.paint_circle["circle-stroke-opacity"])}),layout:Qo},Di=typeof Float32Array!="undefined"?Float32Array:Array;function js(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ns(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],H=o[8],ee=o[9],ie=o[10],Pe=o[11],Re=o[12],Qe=o[13],Ce=o[14],Ge=o[15],Ct=u[0],Xt=u[1],Yt=u[2],fr=u[3];return t[0]=Ct*p+Xt*P+Yt*H+fr*Re,t[1]=Ct*y+Xt*k+Yt*ee+fr*Qe,t[2]=Ct*b+Xt*z+Yt*ie+fr*Ce,t[3]=Ct*S+Xt*Z+Yt*Pe+fr*Ge,t[4]=(Ct=u[4])*p+(Xt=u[5])*P+(Yt=u[6])*H+(fr=u[7])*Re,t[5]=Ct*y+Xt*k+Yt*ee+fr*Qe,t[6]=Ct*b+Xt*z+Yt*ie+fr*Ce,t[7]=Ct*S+Xt*Z+Yt*Pe+fr*Ge,t[8]=(Ct=u[8])*p+(Xt=u[9])*P+(Yt=u[10])*H+(fr=u[11])*Re,t[9]=Ct*y+Xt*k+Yt*ee+fr*Qe,t[10]=Ct*b+Xt*z+Yt*ie+fr*Ce,t[11]=Ct*S+Xt*Z+Yt*Pe+fr*Ge,t[12]=(Ct=u[12])*p+(Xt=u[13])*P+(Yt=u[14])*H+(fr=u[15])*Re,t[13]=Ct*y+Xt*k+Yt*ee+fr*Qe,t[14]=Ct*b+Xt*z+Yt*ie+fr*Ce,t[15]=Ct*S+Xt*Z+Yt*Pe+fr*Ge,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var Uu,Gl=ns;function Uc(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*S,t}Uu=new Di(3),Di!=Float32Array&&(Uu[0]=0,Uu[1]=0,Uu[2]=0),function(){var t=new Di(4);Di!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Ef=(function(){var t=new Di(2);Di!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,zu)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ds(u)},o.prototype.queryRadius=function(u){var p=u;return wu("circle-radius",this,p)+wu("circle-stroke-width",this,p)+yo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k,z){for(var Z=Nu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),H=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),ee=this.paint.get("circle-pitch-alignment")==="map",ie=ee?Z:function(kr,Qr){return kr.map(function(zn){return Js(zn,Qr)})}(Z,z),Pe=ee?H*k:H,Re=0,Qe=b;Re<Qe.length;Re+=1)for(var Ce=0,Ge=Qe[Re];Ce<Ge.length;Ce+=1){var Ct=Ge[Ce],Xt=ee?Ct:Js(Ct,z),Yt=Pe,fr=Uc([],[Ct.x,Ct.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Yt*=fr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Yt*=P.cameraToCenterDistance/fr[3]),$o(ie,Xt,Yt))return!0}return!1},o}(xa));function Js(t,o){var u=Uc([],[t.x,t.y,0,1],o);return new ue(u[0]/u[3],u[1]/u[3])}var Hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ds);function hu(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function wl(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=hu({},{width:p,height:y},u);dc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function dc(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,k=0;k<y.height;k++)for(var z=((u.y+k)*t.width+u.x)*b,Z=((p.y+k)*o.width+p.x)*b,H=0;H<y.width*b;H++)P[Z+H]=S[z+H];return o}mn("HeatmapBucket",Hl,{omit:["layers"]});var eu=function(t,o){hu(this,t,1,o)};eu.prototype.resize=function(t){wl(this,t,1)},eu.prototype.clone=function(){return new eu({width:this.width,height:this.height},new Uint8Array(this.data))},eu.copy=function(t,o,u,p,y){dc(t,o,u,p,y,1)};var No=function(t,o){hu(this,t,4,o)};No.prototype.resize=function(t){wl(this,t,4)},No.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},No.prototype.clone=function(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))},No.copy=function(t,o,u,p,y){dc(t,o,u,p,y,4)},mn("AlphaImage",eu),mn("RGBAImage",No);var Zc={paint:new Ko({"heatmap-radius":new An(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eu(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(fe.paint_heatmap["heatmap-opacity"])})};function eh(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new No({width:u,height:p}),b=function(Pe,Re,Qe){o[t.evaluationKey]=Qe;var Ce=t.expression.evaluate(o);y.data[Pe+Re+0]=Math.floor(255*Ce.r/Ce.a),y.data[Pe+Re+1]=Math.floor(255*Ce.g/Ce.a),y.data[Pe+Re+2]=Math.floor(255*Ce.b/Ce.a),y.data[Pe+Re+3]=Math.floor(255*Ce.a)};if(t.clips)for(var S=0,P=0;S<p;++S,P+=4*u)for(var k=0,z=0;k<u;k++,z+=4){var Z=k/(u-1),H=t.clips[S];b(P,z,H.start*(1-Z)+H.end*Z)}else for(var ee=0,ie=0;ee<u;ee++,ie+=4)b(0,ie,ee/(u-1));return y}var Rh=function(t){function o(u){t.call(this,u,Zc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Hl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=eh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(xa),th={paint:new Ko({"hillshade-illumination-direction":new In(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(fe.paint_hillshade["hillshade-accent-color"])})},cp=function(t){function o(u){t.call(this,u,th)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(xa),Tu=La([{name:"a_pos",components:2,type:"Int16"}],4).members,vc=Lh,Zu=Lh;function Lh(t,o,u){u=u||2;var p,y,b,S,P,k,z,Z=o&&o.length,H=Z?o[0]*u:t.length,ee=jc(t,0,H,u,!0),ie=[];if(!ee||ee.next===ee.prev)return ie;if(Z&&(ee=function(Re,Qe,Ce,Ge){var Ct,Xt,Yt,fr=[];for(Ct=0,Xt=Qe.length;Ct<Xt;Ct++)(Yt=jc(Re,Qe[Ct]*Ge,Ct<Xt-1?Qe[Ct+1]*Ge:Re.length,Ge,!1))===Yt.next&&(Yt.steiner=!0),fr.push(wv(Yt));for(fr.sort(is),Ct=0;Ct<fr.length;Ct++)kh(fr[Ct],Ce),Ce=ll(Ce,Ce.next);return Ce}(t,o,ee,u)),t.length>80*u){p=b=t[0],y=S=t[1];for(var Pe=u;Pe<H;Pe+=u)(P=t[Pe])<p&&(p=P),(k=t[Pe+1])<y&&(y=k),P>b&&(b=P),k>S&&(S=k);z=(z=Math.max(b-p,S-y))!==0?1/z:0}return Sf(ee,ie,u,p,y,z),ie}function jc(t,o,u,p,y){var b,S;if(y===Af(t,o,u,p)>0)for(b=o;b<u;b+=p)S=Vc(b,t[b],t[b+1],S);else for(b=u-p;b>=o;b-=p)S=Vc(b,t[b],t[b+1],S);return S&&nh(S,S.next)&&(cl(S),S=S.next),S}function ll(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!nh(p,p.next)&&Uo(p.prev,p,p.next)!==0)p=p.next;else{if(cl(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Sf(t,o,u,p,y,b,S){if(t){!S&&b&&function(Z,H,ee,ie){var Pe=Z;do Pe.z===null&&(Pe.z=mc(Pe.x,Pe.y,H,ee,ie)),Pe.prevZ=Pe.prev,Pe.nextZ=Pe.next,Pe=Pe.next;while(Pe!==Z);Pe.prevZ.nextZ=null,Pe.prevZ=null,function(Re){var Qe,Ce,Ge,Ct,Xt,Yt,fr,kr,Qr=1;do{for(Ce=Re,Re=null,Xt=null,Yt=0;Ce;){for(Yt++,Ge=Ce,fr=0,Qe=0;Qe<Qr&&(fr++,Ge=Ge.nextZ);Qe++);for(kr=Qr;fr>0||kr>0&&Ge;)fr!==0&&(kr===0||!Ge||Ce.z<=Ge.z)?(Ct=Ce,Ce=Ce.nextZ,fr--):(Ct=Ge,Ge=Ge.nextZ,kr--),Xt?Xt.nextZ=Ct:Re=Ct,Ct.prevZ=Xt,Xt=Ct;Ce=Ge}Xt.nextZ=null,Qr*=2}while(Yt>1)}(Pe)}(t,p,y,b);for(var P,k,z=t;t.prev!==t.next;)if(P=t.prev,k=t.next,b?kd(t,p,y,b):qp(t))o.push(P.i/u),o.push(t.i/u),o.push(k.i/u),cl(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?Sf(t=Cf(ll(t),o,u),o,u,p,y,b,2):S===2&&zo(t,o,u,p,y,b):Sf(ll(t),o,u,p,y,b,1);break}}}function qp(t){var o=t.prev,u=t,p=t.next;if(Uo(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(rh(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Uo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function kd(t,o,u,p){var y=t.prev,b=t,S=t.next;if(Uo(y,b,S)>=0)return!1;for(var P=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,k=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=mc(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,p),Z=mc(P,k,o,u,p),H=t.prevZ,ee=t.nextZ;H&&H.z>=z&&ee&&ee.z<=Z;){if(H!==t.prev&&H!==t.next&&rh(y.x,y.y,b.x,b.y,S.x,S.y,H.x,H.y)&&Uo(H.prev,H,H.next)>=0||(H=H.prevZ,ee!==t.prev&&ee!==t.next&&rh(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Uo(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;H&&H.z>=z;){if(H!==t.prev&&H!==t.next&&rh(y.x,y.y,b.x,b.y,S.x,S.y,H.x,H.y)&&Uo(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;ee&&ee.z<=Z;){if(ee!==t.prev&&ee!==t.next&&rh(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Uo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Cf(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!nh(y,b)&&ju(y,p,p.next,b)&&Dh(y,b)&&Dh(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),cl(p),cl(p.next),p=t=b),p=p.next}while(p!==t);return ll(p)}function zo(t,o,u,p,y,b){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&Tv(S,P)){var k=Wl(S,P);return S=ll(S,S.next),k=ll(k,k.next),Sf(S,o,u,p,y,b),void Sf(k,o,u,p,y,b)}P=P.next}S=S.next}while(S!==t)}function is(t,o){return t.x-o.x}function kh(t,o){if(o=function(p,y){var b,S=y,P=p.x,k=p.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var Z=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=P&&Z>z){if(z=Z,Z===P){if(k===S.y)return S;if(k===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(P===z)return b;var H,ee=b,ie=b.x,Pe=b.y,Re=1/0;S=b;do P>=S.x&&S.x>=ie&&P!==S.x&&rh(k<Pe?P:z,k,ie,Pe,k<Pe?z:P,k,S.x,S.y)&&(H=Math.abs(k-S.y)/(P-S.x),Dh(S,p)&&(H<Re||H===Re&&(S.x>b.x||S.x===b.x&&fp(b,S)))&&(b=S,Re=H)),S=S.next;while(S!==ee);return b}(t,o)){var u=Wl(o,t);ll(o,o.next),ll(u,u.next)}}function fp(t,o){return Uo(t.prev,t,o.prev)<0&&Uo(o.next,t,t.next)<0}function mc(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function wv(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function rh(t,o,u,p,y,b,S,P){return(y-S)*(o-P)-(t-S)*(b-P)>=0&&(t-S)*(p-P)-(u-S)*(o-P)>=0&&(u-S)*(b-P)-(y-S)*(p-P)>=0}function Tv(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&ju(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Dh(t,o)&&Dh(o,t)&&function(u,p){var y=u,b=!1,S=(u.x+p.x)/2,P=(u.y+p.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&S<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Uo(t.prev,t,o.prev)||Uo(t,o.prev,o))||nh(t,o)&&Uo(t.prev,t,t.next)>0&&Uo(o.prev,o,o.next)>0)}function Uo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function nh(t,o){return t.x===o.x&&t.y===o.y}function ju(t,o,u,p){var y=pp(Uo(t,o,u)),b=pp(Uo(t,o,p)),S=pp(Uo(u,p,t)),P=pp(Uo(u,p,o));return y!==b&&S!==P||!(y!==0||!hp(t,u,o))||!(b!==0||!hp(t,p,o))||!(S!==0||!hp(u,t,p))||!(P!==0||!hp(u,o,p))}function hp(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function pp(t){return t>0?1:t<0?-1:0}function Dh(t,o){return Uo(t.prev,t,t.next)<0?Uo(t,o,t.next)>=0&&Uo(t,t.prev,o)>=0:Uo(t,o,t.prev)<0||Uo(t,t.next,o)<0}function Wl(t,o){var u=new Gc(t.i,t.x,t.y),p=new Gc(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function Vc(t,o,u,p){var y=new Gc(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function cl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gc(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Af(t,o,u,p){for(var y=0,b=o,S=u-p;b<u;b+=p)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Hc(t,o,u,p,y){(function b(S,P,k,z,Z){for(;z>k;){if(z-k>600){var H=z-k+1,ee=P-k+1,ie=Math.log(H),Pe=.5*Math.exp(2*ie/3),Re=.5*Math.sqrt(ie*Pe*(H-Pe)/H)*(ee-H/2<0?-1:1);b(S,P,Math.max(k,Math.floor(P-ee*Pe/H+Re)),Math.min(z,Math.floor(P+(H-ee)*Pe/H+Re)),Z)}var Qe=S[P],Ce=k,Ge=z;for(fl(S,k,P),Z(S[z],Qe)>0&&fl(S,k,z);Ce<Ge;){for(fl(S,Ce,Ge),Ce++,Ge--;Z(S[Ce],Qe)<0;)Ce++;for(;Z(S[Ge],Qe)>0;)Ge--}Z(S[k],Qe)===0?fl(S,k,Ge):fl(S,++Ge,z),Ge<=P&&(k=Ge+1),P<=Ge&&(z=Ge-1)}})(t,o,u||0,p||t.length-1,y||ih)}function fl(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function ih(t,o){return t<o?-1:t>o?1:0}function wf(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],S=0;S<u;S++){var P=br(t[S]);P!==0&&(t[S].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(p&&b.push(p),p=[t[S]]):p.push(t[S]))}if(p&&b.push(p),o>1)for(var k=0;k<b.length;k++)b[k].length<=o||(Hc(b[k],o,1,b[k].length-1,Tf),b[k]=b[k].slice(0,o));return b}function Tf(t,o){return o.area-t.area}function Wc(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var P=S[b].paint.get(t+"-pattern");P.isConstant()||(y=!0);var k=P.constantOr(null);k&&(y=!0,p[k.to]=!0,p[k.from]=!0)}return y}function Mf(t,o,u,p,y){for(var b=y.patternDependencies,S=0,P=o;S<P.length;S+=1){var k=P[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:p-1},u,{},y.availableImages),H=z.evaluate({zoom:p},u,{},y.availableImages),ee=z.evaluate({zoom:p+1},u,{},y.availableImages);H=H&&H.name?H.name:H,ee=ee&&ee.name?ee.name:ee,b[Z=Z&&Z.name?Z.name:Z]=!0,b[H]=!0,b[ee]=!0,u.patterns[k.id]={min:Z,mid:H,max:ee}}}return u}Lh.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs(Af(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,P=o.length;S<P;S++)b-=Math.abs(Af(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var k=0;for(S=0;S<p.length;S+=3){var z=p[S]*u,Z=p[S+1]*u,H=p[S+2]*u;k+=Math.abs((t[z]-t[H])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[H+1]-t[z+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},Lh.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(p+=t[y-1].length)}return u},vc.default=Zu;var Vs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ol,this.indexArray=new Al,this.indexArray2=new pc,this.programConfigurations=new Sn(t.layers,t.zoom),this.segments=new he,this.segments2=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Vs.prototype.populate=function(t,o,u){this.hasPattern=Wc("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,H=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ie=Ga(k,ee);if(this.layers[0]._featureFilter.filter(new Pi(this.zoom),ie,u)){var Pe=p?p.evaluate(ie,{},u,o.availableImages):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:Z,geometry:ee?ie.geometry:Va(k),patterns:{},sortKey:Pe};y.push(Re)}}p&&y.sort(function(kr,Qr){return kr.sortKey-Qr.sortKey});for(var Qe=0,Ce=y;Qe<Ce.length;Qe+=1){var Ge=Ce[Qe],Ct=Ge.geometry,Xt=Ge.index,Yt=Ge.sourceLayerIndex;if(this.hasPattern){var fr=Mf("fill",this.layers,Ge,this.zoom,o);this.patternFeatures.push(fr)}else this.addFeature(Ge,Ct,Xt,u,{});o.featureIndex.insert(t[Xt].feature,Ct,Xt,Yt,this.index)}},Vs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Vs.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},Vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Vs.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=wf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ee=H.vertexLength,ie=[],Pe=[],Re=0,Qe=P;Re<Qe.length;Re+=1){var Ce=Qe[Re];if(Ce.length!==0){Ce!==P[0]&&Pe.push(ie.length/2);var Ge=this.segments2.prepareSegment(Ce.length,this.layoutVertexArray,this.indexArray2),Ct=Ge.vertexLength;this.layoutVertexArray.emplaceBack(Ce[0].x,Ce[0].y),this.indexArray2.emplaceBack(Ct+Ce.length-1,Ct),ie.push(Ce[0].x),ie.push(Ce[0].y);for(var Xt=1;Xt<Ce.length;Xt++)this.layoutVertexArray.emplaceBack(Ce[Xt].x,Ce[Xt].y),this.indexArray2.emplaceBack(Ct+Xt-1,Ct+Xt),ie.push(Ce[Xt].x),ie.push(Ce[Xt].y);Ge.vertexLength+=Ce.length,Ge.primitiveLength+=Ce.length}}for(var Yt=vc(ie,Pe),fr=0;fr<Yt.length;fr+=3)this.indexArray.emplaceBack(ee+Yt[fr],ee+Yt[fr+1],ee+Yt[fr+2]);H.vertexLength+=k,H.primitiveLength+=Yt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},mn("FillBucket",Vs,{omit:["layers","patternFeatures"]});var pu=new Ko({"fill-sort-key":new An(fe.layout_fill["fill-sort-key"])}),Pf={paint:new Ko({"fill-antialias":new In(fe.paint_fill["fill-antialias"]),"fill-opacity":new An(fe.paint_fill["fill-opacity"]),"fill-color":new An(fe.paint_fill["fill-color"]),"fill-outline-color":new An(fe.paint_fill["fill-outline-color"]),"fill-translate":new In(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new In(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new fc(fe.paint_fill["fill-pattern"])}),layout:pu},ah=function(t){function o(u){t.call(this,u,Pf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Vs(u)},o.prototype.queryRadius=function(){return yo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k){return Ps(Nu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),b)},o.prototype.isTileClipped=function(){return!0},o}(xa),oh=La([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Fh=Tl;function Tl(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(Xc,this,o)}function Xc(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var S=y._keys[p.readVarint()],P=y._values[p.readVarint()];y.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Kp(t){for(var o,u,p=0,y=0,b=t.length,S=b-1;y<b;S=y++)p+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return p}Tl.types=["Unknown","Point","LineString","Polygon"],Tl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,S=0,P=[];t.pos<u;){if(y<=0){var k=t.readVarint();p=7&k,y=k>>3}if(y--,p===1||p===2)b+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&P.push(o),o=[]),o.push(new ue(b,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&P.push(o),P},Tl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,S=1/0,P=-1/0,k=1/0,z=-1/0;t.pos<o;){if(p<=0){var Z=t.readVarint();u=7&Z,p=Z>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>P&&(P=y),(b+=t.readSVarint())<k&&(k=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,P,z]},Tl.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,k=this.loadGeometry(),z=Tl.types[this.type];function Z(ie){for(var Pe=0;Pe<ie.length;Pe++){var Re=ie[Pe];ie[Pe]=[360*(Re.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+P)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(p=0;p<k.length;p++)H[p]=k[p][0];Z(k=H);break;case 2:for(p=0;p<k.length;p++)Z(k[p]);break;case 3:for(k=function(ie){var Pe=ie.length;if(Pe<=1)return[ie];for(var Re,Qe,Ce=[],Ge=0;Ge<Pe;Ge++){var Ct=Kp(ie[Ge]);Ct!==0&&(Qe===void 0&&(Qe=Ct<0),Qe===Ct<0?(Re&&Ce.push(Re),Re=[ie[Ge]]):Re.push(ie[Ge]))}return Re&&Ce.push(Re),Ce}(k),p=0;p<k.length;p++)for(y=0;y<k[p].length;y++)Z(k[p][y])}k.length===1?k=k[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var If=$p;function $p(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Qp,this,o),this.length=this._features.length}function Qp(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(u))}function Jp(t,o,u){if(t===3){var p=new If(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}$p.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Fh(this._pbf,o,this.extent,this._keys,this._values)};var du={VectorTile:function(t,o){this.layers=t.readFields(Jp,{},o)},VectorTileFeature:Fh,VectorTileLayer:If},dp=du.VectorTileFeature.types,Bh=Math.pow(2,13);function Of(t,o,u,p,y,b,S,P){t.emplaceBack(o,u,2*Math.floor(p*Bh)+S,y*Bh*2,b*Bh*2,Math.round(P))}var hl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Su,this.indexArray=new Al,this.programConfigurations=new Sn(t.layers,t.zoom),this.segments=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function vp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}hl.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Wc("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],S=b.feature,P=b.id,k=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,H=Ga(S,Z);if(this.layers[0]._featureFilter.filter(new Pi(this.zoom),H,u)){var ee={id:P,sourceLayerIndex:z,index:k,geometry:Z?H.geometry:Va(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Mf("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,k,u,{}),o.featureIndex.insert(S,ee.geometry,k,z,this.index,!0)}}},hl.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},hl.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},hl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},hl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hl.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=wf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,ie=P;ee<ie.length;ee+=1){var Pe=ie[ee];if(Pe.length!==0&&!((Vi=Pe).every(function(bi){return bi.x<0})||Vi.every(function(bi){return bi.x>8192})||Vi.every(function(bi){return bi.y<0})||Vi.every(function(bi){return bi.y>8192})))for(var Re=0,Qe=0;Qe<Pe.length;Qe++){var Ce=Pe[Qe];if(Qe>=1){var Ge=Pe[Qe-1];if(!vp(Ce,Ge)){H.vertexLength+4>he.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ct=Ce.sub(Ge)._perp()._unit(),Xt=Ge.dist(Ce);Re+Xt>32768&&(Re=0),Of(this.layoutVertexArray,Ce.x,Ce.y,Ct.x,Ct.y,0,0,Re),Of(this.layoutVertexArray,Ce.x,Ce.y,Ct.x,Ct.y,0,1,Re),Of(this.layoutVertexArray,Ge.x,Ge.y,Ct.x,Ct.y,0,0,Re+=Xt),Of(this.layoutVertexArray,Ge.x,Ge.y,Ct.x,Ct.y,0,1,Re);var Yt=H.vertexLength;this.indexArray.emplaceBack(Yt,Yt+2,Yt+1),this.indexArray.emplaceBack(Yt+1,Yt+2,Yt+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+k>he.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),dp[t.type]==="Polygon"){for(var fr=[],kr=[],Qr=H.vertexLength,zn=0,vn=P;zn<vn.length;zn+=1){var jn=vn[zn];if(jn.length!==0){jn!==P[0]&&kr.push(fr.length/2);for(var gn=0;gn<jn.length;gn++){var Ri=jn[gn];Of(this.layoutVertexArray,Ri.x,Ri.y,0,0,1,1,0),fr.push(Ri.x),fr.push(Ri.y)}}}for(var ii=vc(fr,kr),Mn=0;Mn<ii.length;Mn+=3)this.indexArray.emplaceBack(Qr+ii[Mn],Qr+ii[Mn+2],Qr+ii[Mn+1]);H.primitiveLength+=ii.length/3,H.vertexLength+=k}}var Vi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},mn("FillExtrusionBucket",hl,{omit:["layers","features"]});var Dd={paint:new Ko({"fill-extrusion-opacity":new In(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fc(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ml=function(t){function o(u){t.call(this,u,Dd)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new hl(u)},o.prototype.queryRadius=function(){return yo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k,z){var Z=Nu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),H=this.paint.get("fill-extrusion-height").evaluate(p,y),ee=this.paint.get("fill-extrusion-base").evaluate(p,y),ie=function(Re,Qe,Ce,Ge){for(var Ct=[],Xt=0,Yt=Re;Xt<Yt.length;Xt+=1){var fr=Yt[Xt],kr=[fr.x,fr.y,0,1];Uc(kr,kr,Qe),Ct.push(new ue(kr[0]/kr[3],kr[1]/kr[3]))}return Ct}(Z,z),Pe=function(Re,Qe,Ce,Ge){for(var Ct=[],Xt=[],Yt=Ge[8]*Qe,fr=Ge[9]*Qe,kr=Ge[10]*Qe,Qr=Ge[11]*Qe,zn=Ge[8]*Ce,vn=Ge[9]*Ce,jn=Ge[10]*Ce,gn=Ge[11]*Ce,Ri=0,ii=Re;Ri<ii.length;Ri+=1){for(var Mn=[],Vi=[],bi=0,ra=ii[Ri];bi<ra.length;bi+=1){var Vn=ra[bi],ma=Vn.x,oo=Vn.y,Oo=Ge[0]*ma+Ge[4]*oo+Ge[12],bo=Ge[1]*ma+Ge[5]*oo+Ge[13],so=Ge[2]*ma+Ge[6]*oo+Ge[14],Ro=Ge[3]*ma+Ge[7]*oo+Ge[15],gs=so+kr,ys=Ro+Qr,tu=Oo+zn,Es=bo+vn,Ss=so+jn,Vo=Ro+gn,Cs=new ue((Oo+Yt)/ys,(bo+fr)/ys);Cs.z=gs/ys,Mn.push(Cs);var Ki=new ue(tu/Vo,Es/Vo);Ki.z=Ss/Vo,Vi.push(Ki)}Ct.push(Mn),Xt.push(Vi)}return[Ct,Xt]}(b,ee,H,z);return function(Re,Qe,Ce){var Ge=1/0;Ps(Ce,Qe)&&(Ge=gc(Ce,Qe[0]));for(var Ct=0;Ct<Qe.length;Ct++)for(var Xt=Qe[Ct],Yt=Re[Ct],fr=0;fr<Xt.length-1;fr++){var kr=Xt[fr],Qr=[kr,Xt[fr+1],Yt[fr+1],Yt[fr],kr];Au(Ce,Qr)&&(Ge=Math.min(Ge,gc(Ce,Qr)))}return Ge!==1/0&&Ge}(Pe[0],Pe[1],ie)},o}(xa);function Rf(t,o){return t.x*o.x+t.y*o.y}function gc(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],S=t[0],P=u.sub(y),k=b.sub(y),z=S.sub(y),Z=Rf(P,P),H=Rf(P,k),ee=Rf(k,k),ie=Rf(z,P),Pe=Rf(z,k),Re=Z*ee-H*H,Qe=(ee*ie-H*Pe)/Re,Ce=(Z*Pe-H*ie)/Re,Ge=y.z*(1-Qe-Ce)+u.z*Qe+b.z*Ce;if(isFinite(Ge))return Ge}return 1/0}for(var Ct=1/0,Xt=0,Yt=o;Xt<Yt.length;Xt+=1)Ct=Math.min(Ct,Yt[Xt].z);return Ct}var Vu=La([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ed=La([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,mp=du.VectorTileFeature.types,Nh=Math.cos(Math.PI/180*37.5),gp=Math.pow(2,14)/.5,da=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new wo,this.layoutVertexArray2=new sl,this.indexArray=new Al,this.programConfigurations=new Sn(t.layers,t.zoom),this.segments=new he,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};da.prototype.populate=function(t,o,u){this.hasPattern=Wc("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,H=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ie=Ga(k,ee);if(this.layers[0]._featureFilter.filter(new Pi(this.zoom),ie,u)){var Pe=p?p.evaluate(ie,{},u):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:Z,geometry:ee?ie.geometry:Va(k),patterns:{},sortKey:Pe};y.push(Re)}}p&&y.sort(function(kr,Qr){return kr.sortKey-Qr.sortKey});for(var Qe=0,Ce=y;Qe<Ce.length;Qe+=1){var Ge=Ce[Qe],Ct=Ge.geometry,Xt=Ge.index,Yt=Ge.sourceLayerIndex;if(this.hasPattern){var fr=Mf("line",this.layers,Ge,this.zoom,o);this.patternFeatures.push(fr)}else this.addFeature(Ge,Ct,Xt,u,{});o.featureIndex.insert(t[Xt].feature,Ct,Xt,Yt,this.index)}},da.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},da.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},da.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},da.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},da.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ed)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},da.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},da.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},da.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),P=b.get("line-cap"),k=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,H=o;Z<H.length;Z+=1)this.addLine(H[Z],t,S,P,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},da.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=mp[o.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(P?3:2))){u==="bevel"&&(y=1.05);var Z,H=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ie=void 0,Pe=void 0,Re=void 0,Qe=void 0;this.e1=this.e2=-1,P&&(Qe=t[z].sub(Z=t[k-2])._unit()._perp());for(var Ce=z;Ce<k;Ce++)if(!(Pe=Ce===k-1?P?t[z+1]:void 0:t[Ce+1])||!t[Ce].equals(Pe)){Qe&&(Re=Qe),Z&&(ie=Z),Z=t[Ce],Qe=Pe?Pe.sub(Z)._unit()._perp():Re;var Ge=(Re=Re||Qe).add(Qe);Ge.x===0&&Ge.y===0||Ge._unit();var Ct=Re.x*Qe.x+Re.y*Qe.y,Xt=Ge.x*Qe.x+Ge.y*Qe.y,Yt=Xt!==0?1/Xt:1/0,fr=2*Math.sqrt(2-2*Xt),kr=Xt<Nh&&ie&&Pe,Qr=Re.x*Qe.y-Re.y*Qe.x>0;if(kr&&Ce>z){var zn=Z.dist(ie);if(zn>2*H){var vn=Z.sub(Z.sub(ie)._mult(H/zn)._round());this.updateDistance(ie,vn),this.addCurrentVertex(vn,Re,0,0,ee),ie=vn}}var jn=ie&&Pe,gn=jn?u:P?"butt":p;if(jn&&gn==="round"&&(Yt<b?gn="miter":Yt<=2&&(gn="fakeround")),gn==="miter"&&Yt>y&&(gn="bevel"),gn==="bevel"&&(Yt>2&&(gn="flipbevel"),Yt<y&&(gn="miter")),ie&&this.updateDistance(ie,Z),gn==="miter")Ge._mult(Yt),this.addCurrentVertex(Z,Ge,0,0,ee);else if(gn==="flipbevel"){if(Yt>100)Ge=Qe.mult(-1);else{var Ri=Yt*Re.add(Qe).mag()/Re.sub(Qe).mag();Ge._perp()._mult(Ri*(Qr?-1:1))}this.addCurrentVertex(Z,Ge,0,0,ee),this.addCurrentVertex(Z,Ge.mult(-1),0,0,ee)}else if(gn==="bevel"||gn==="fakeround"){var ii=-Math.sqrt(Yt*Yt-1),Mn=Qr?ii:0,Vi=Qr?0:ii;if(ie&&this.addCurrentVertex(Z,Re,Mn,Vi,ee),gn==="fakeround")for(var bi=Math.round(180*fr/Math.PI/20),ra=1;ra<bi;ra++){var Vn=ra/bi;if(Vn!==.5){var ma=Vn-.5;Vn+=Vn*ma*(Vn-1)*((1.0904+Ct*(Ct*(3.55645-1.43519*Ct)-3.2452))*ma*ma+(.848013+Ct*(.215638*Ct-1.06021)))}var oo=Qe.sub(Re)._mult(Vn)._add(Re)._unit()._mult(Qr?-1:1);this.addHalfVertex(Z,oo.x,oo.y,!1,Qr,0,ee)}Pe&&this.addCurrentVertex(Z,Qe,-Mn,-Vi,ee)}else if(gn==="butt")this.addCurrentVertex(Z,Ge,0,0,ee);else if(gn==="square"){var Oo=ie?1:-1;this.addCurrentVertex(Z,Ge,Oo,Oo,ee)}else gn==="round"&&(ie&&(this.addCurrentVertex(Z,Re,0,0,ee),this.addCurrentVertex(Z,Re,1,1,ee,!0)),Pe&&(this.addCurrentVertex(Z,Qe,-1,-1,ee,!0),this.addCurrentVertex(Z,Qe,0,0,ee)));if(kr&&Ce<k-1){var bo=Z.dist(Pe);if(bo>2*H){var so=Z.add(Pe.sub(Z)._mult(H/bo)._round());this.updateDistance(Z,so),this.addCurrentVertex(so,Qe,0,0,ee),Z=so}}}}},da.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var S=o.y*p-o.x,P=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,P,b,!0,-p,y),this.distance>gp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},da.prototype.addHalfVertex=function(t,o,u,p,y,b,S){var P=.5*(this.lineClips?this.scaledDistance*(gp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),y?this.e2=k:this.e1=k},da.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},da.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},mn("LineBucket",da,{omit:["layers","patternFeatures"]});var Xl=new Ko({"line-cap":new In(fe.layout_line["line-cap"]),"line-join":new An(fe.layout_line["line-join"]),"line-miter-limit":new In(fe.layout_line["line-miter-limit"]),"line-round-limit":new In(fe.layout_line["line-round-limit"]),"line-sort-key":new An(fe.layout_line["line-sort-key"])}),Mo={paint:new Ko({"line-opacity":new An(fe.paint_line["line-opacity"]),"line-color":new An(fe.paint_line["line-color"]),"line-translate":new In(fe.paint_line["line-translate"]),"line-translate-anchor":new In(fe.paint_line["line-translate-anchor"]),"line-width":new An(fe.paint_line["line-width"]),"line-gap-width":new An(fe.paint_line["line-gap-width"]),"line-offset":new An(fe.paint_line["line-offset"]),"line-blur":new An(fe.paint_line["line-blur"]),"line-dasharray":new ps(fe.paint_line["line-dasharray"]),"line-pattern":new fc(fe.paint_line["line-pattern"]),"line-gradient":new Eu(fe.paint_line["line-gradient"])}),layout:Xl},Gs=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Pi(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=Pt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(An))(Mo.paint.properties["line-width"].specification);Gs.useIntegerZoom=!0;var zh=function(t){function o(u){t.call(this,u,Mo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof fs,this.gradientVersion=(this.gradientVersion+1)%nt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Gs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new da(u)},o.prototype.queryRadius=function(u){var p=u,y=td(wu("line-width",this,p),wu("line-gap-width",this,p)),b=wu("line-offset",this,p);return y/2+Math.abs(b)+yo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,P,k){var z=Nu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),Z=k/2*td(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),H=this.paint.get("line-offset").evaluate(p,y);return H&&(b=function(ee,ie){for(var Pe=[],Re=new ue(0,0),Qe=0;Qe<ee.length;Qe++){for(var Ce=ee[Qe],Ge=[],Ct=0;Ct<Ce.length;Ct++){var Xt=Ce[Ct],Yt=Ce[Ct+1],fr=Ct===0?Re:Xt.sub(Ce[Ct-1])._unit()._perp(),kr=Ct===Ce.length-1?Re:Yt.sub(Xt)._unit()._perp(),Qr=fr._add(kr)._unit();Qr._mult(1/(Qr.x*kr.x+Qr.y*kr.y)),Ge.push(Qr._mult(ie)._add(Xt))}Pe.push(Ge)}return Pe}(b,H*k)),function(ee,ie,Pe){for(var Re=0;Re<ie.length;Re++){var Qe=ie[Re];if(ee.length>=3){for(var Ce=0;Ce<Qe.length;Ce++)if(Qs(ee,Qe[Ce]))return!0}if(fu(ee,Qe,Pe))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(xa);function td(t,o){return o>0?o+2*t:t}var Fd=La([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bd=La([{name:"a_projected_pos",components:3,type:"Float32"}],4),Nd=(La([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),La([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),yp=(La([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),La([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),zd=La([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lf(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,S){var P=b.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),Ts.applyArabicShaping&&(y=Ts.applyArabicShaping(y)),y}(p.text,o,u)}),t}La([{name:"triangle",components:3,type:"Uint16"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),La([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),La([{type:"Float32",name:"offsetX"}]),La([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var sh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},rd=function(t,o,u,p,y){var b,S,P=8*y-p-1,k=(1<<P)-1,z=k>>1,Z=-7,H=u?y-1:0,ee=u?-1:1,ie=t[o+H];for(H+=ee,b=ie&(1<<-Z)-1,ie>>=-Z,Z+=P;Z>0;b=256*b+t[o+H],H+=ee,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=p;Z>0;S=256*S+t[o+H],H+=ee,Z-=8);if(b===0)b=1-z;else{if(b===k)return S?NaN:1/0*(ie?-1:1);S+=Math.pow(2,p),b-=z}return(ie?-1:1)*S*Math.pow(2,b-p)},nd=function(t,o,u,p,y,b){var S,P,k,z=8*b-y-1,Z=(1<<z)-1,H=Z>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ie=p?0:b-1,Pe=p?1:-1,Re=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-S))<1&&(S--,k*=2),(o+=S+H>=1?ee/k:ee*Math.pow(2,1-H))*k>=2&&(S++,k/=2),S+H>=Z?(P=0,S=Z):S+H>=1?(P=(o*k-1)*Math.pow(2,y),S+=H):(P=o*Math.pow(2,H-1)*Math.pow(2,y),S=0));y>=8;t[u+ie]=255&P,ie+=Pe,P/=256,y-=8);for(S=S<<y|P,z+=y;z>0;t[u+ie]=255&S,ie+=Pe,S/=256,z-=8);t[u+ie-Pe]|=128*Re},uh=Aa;function Aa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Aa.Varint=0,Aa.Fixed64=1,Aa.Bytes=2,Aa.Fixed32=5;var Uh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Yl(t){return t.type===Aa.Bytes?t.readVarint()+t.pos:t.pos+1}function kf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Zh(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function id(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function me(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Ue(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Nt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function or(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Ft(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Ye(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function pr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function De(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function Sr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Or(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Rr(t,o,u){t===1&&u.readMessage(Zr,o)}function Zr(t,o,u){if(t===3){var p=u.readMessage(xr,{}),y=p.width,b=p.height,S=p.left,P=p.top,k=p.advance;o.push({id:p.id,bitmap:new eu({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:S,top:P,advance:k}})}}function xr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Pr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Re,Qe){return Qe.h-Re.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,k=0,z=0,Z=t;z<Z.length;z+=1)for(var H=Z[z],ee=S.length-1;ee>=0;ee--){var ie=S[ee];if(!(H.w>ie.w||H.h>ie.h)){if(H.x=ie.x,H.y=ie.y,k=Math.max(k,H.y+H.h),P=Math.max(P,H.x+H.w),H.w===ie.w&&H.h===ie.h){var Pe=S.pop();ee<S.length&&(S[ee]=Pe)}else H.h===ie.h?(ie.x+=H.w,ie.w-=H.w):H.w===ie.w?(ie.y+=H.h,ie.h-=H.h):(S.push({x:ie.x+H.w,y:ie.y,w:ie.w-H.w,h:H.h}),ie.y+=H.h,ie.h-=H.h);break}}return{w:P,h:k,fill:o/(P*k)||0}}Aa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=De(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Or(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=De(this.buf,this.pos)+4294967296*De(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=De(this.buf,this.pos)+4294967296*Or(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=rd(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=rd(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,S){var P,k,z=S.buf;if(P=(112&(k=z[S.pos++]))>>4,k<128||(P|=(127&(k=z[S.pos++]))<<3,k<128)||(P|=(127&(k=z[S.pos++]))<<10,k<128)||(P|=(127&(k=z[S.pos++]))<<17,k<128)||(P|=(127&(k=z[S.pos++]))<<24,k<128)||(P|=(1&(k=z[S.pos++]))<<31,k<128))return kf(y,P,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Uh?function(u,p,y){return Uh.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",S=p;S<y;){var P,k,z,Z=u[S],H=null,ee=Z>239?4:Z>223?3:Z>191?2:1;if(S+ee>y)break;ee===1?Z<128&&(H=Z):ee===2?(192&(P=u[S+1]))==128&&(H=(31&Z)<<6|63&P)<=127&&(H=null):ee===3?(k=u[S+2],(192&(P=u[S+1]))==128&&(192&k)==128&&((H=(15&Z)<<12|(63&P)<<6|63&k)<=2047||H>=55296&&H<=57343)&&(H=null)):ee===4&&(k=u[S+2],z=u[S+3],(192&(P=u[S+1]))==128&&(192&k)==128&&(192&z)==128&&((H=(15&Z)<<18|(63&P)<<12|(63&k)<<6|63&z)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,ee=1):H>65535&&(H-=65536,b+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),b+=String.fromCharCode(H),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Aa.Bytes)return t.push(this.readVarint(o));var u=Yl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSVarint());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Aa.Bytes)return t.push(this.readBoolean());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFloat());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Aa.Bytes)return t.push(this.readDouble());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFixed32());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSFixed32());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Aa.Bytes)return t.push(this.readFixed64());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Aa.Bytes)return t.push(this.readSFixed64());var o=Yl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Aa.Varint)for(;this.buf[this.pos++]>127;);else if(o===Aa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Aa.Fixed32)this.pos+=4;else{if(o!==Aa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sr(this.buf,-1&t,this.pos),Sr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sr(this.buf,-1&t,this.pos),Sr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,P){P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,P.buf[P.pos]=127&(b>>>=7)}(p,0,u),function(b,S){var P=(7&b)<<4;S.buf[S.pos++]|=P|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var S,P,k=0;k<y.length;k++){if((S=y.charCodeAt(k))>55295&&S<57344){if(!P){S>56319||k+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):P=S;continue}if(S<56320){p[b++]=239,p[b++]=191,p[b++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(p[b++]=239,p[b++]=191,p[b++]=189,P=null);S<128?p[b++]=S:(S<2048?p[b++]=S>>6|192:(S<65536?p[b++]=S>>12|224:(p[b++]=S>>18|240,p[b++]=S>>12&63|128),p[b++]=S>>6&63|128),p[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&Zh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),nd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),nd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&Zh(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,Aa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,id,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Nt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,me,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Ue,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,or,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Ft,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Ye,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,pr,o)},writeBytesField:function(t,o){this.writeTag(t,Aa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Aa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Aa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Aa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Aa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Aa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ct=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=p},Vt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Vt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Vt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Vt.tlbr.get=function(){return this.tl.concat(this.br)},Vt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ct.prototype,Vt);var Cr=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Pr(y),S=new No({width:b.w||1,height:b.h||1});for(var P in t){var k=t[P],z=u[P].paddedRect;No.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var Z in o){var H=o[Z],ee=p[Z].paddedRect,ie=ee.x+1,Pe=ee.y+1,Re=H.data.width,Qe=H.data.height;No.copy(H.data,S,{x:0,y:0},{x:ie,y:Pe},H.data),No.copy(H.data,S,{x:0,y:Qe-1},{x:ie,y:Pe-1},{width:Re,height:1}),No.copy(H.data,S,{x:0,y:0},{x:ie,y:Pe+Qe},{width:Re,height:1}),No.copy(H.data,S,{x:Re-1,y:0},{x:ie-1,y:Pe},{width:1,height:Qe}),No.copy(H.data,S,{x:0,y:0},{x:ie+Re,y:Pe},{width:1,height:Qe})}this.image=S,this.iconPositions=u,this.patternPositions=p};Cr.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new ct(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Cr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},Cr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},mn("ImagePosition",ct),mn("ImageAtlas",Cr);var zr={horizontal:1,vertical:2,horizontalOnly:3},hr=function(){this.scale=1,this.fontStack="",this.imageName=null};hr.forText=function(t,o){var u=new hr;return u.scale=t||1,u.fontStack=o,u},hr.forImage=function(t){var o=new hr;return o.imageName=t,o};var Lr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Kr(t,o,u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re){var Qe,Ce=Lr.fromFeature(t,y);H===zr.vertical&&Ce.verticalizePunctuation();var Ge=Ts.processBidirectionalText,Ct=Ts.processStyledBidirectionalText;if(Ge&&Ce.sections.length===1){Qe=[];for(var Xt=0,Yt=Ge(Ce.toString(),$r(Ce,z,b,o,p,ie,Pe));Xt<Yt.length;Xt+=1){var fr=Yt[Xt],kr=new Lr;kr.text=fr,kr.sections=Ce.sections;for(var Qr=0;Qr<fr.length;Qr++)kr.sectionIndex.push(0);Qe.push(kr)}}else if(Ct){Qe=[];for(var zn=0,vn=Ct(Ce.text,Ce.sectionIndex,$r(Ce,z,b,o,p,ie,Pe));zn<vn.length;zn+=1){var jn=vn[zn],gn=new Lr;gn.text=jn[0],gn.sectionIndex=jn[1],gn.sections=Ce.sections,Qe.push(gn)}}else Qe=function(Mn,Vi){for(var bi=[],ra=Mn.text,Vn=0,ma=0,oo=Vi;ma<oo.length;ma+=1){var Oo=oo[ma];bi.push(Mn.substring(Vn,Oo)),Vn=Oo}return Vn<ra.length&&bi.push(Mn.substring(Vn,ra.length)),bi}(Ce,$r(Ce,z,b,o,p,ie,Pe));var Ri=[],ii={positionedLines:Ri,text:Ce.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(Mn,Vi,bi,ra,Vn,ma,oo,Oo,bo,so,Ro,gs){for(var ys=0,tu=-17,Es=0,Ss=0,Vo=Oo==="right"?1:Oo==="left"?0:.5,Cs=0,Ki=0,Na=Vn;Ki<Na.length;Ki+=1){var Pa=Na[Ki];Pa.trim();var oa=Pa.getMaxScale(),vu=24*(oa-1),Hs={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[Cs]=Hs;var to=Hs.positionedGlyphs,es=0;if(Pa.length()){for(var Ws=0;Ws<Pa.length();Ws++){var ga=Pa.getSection(Ws),Kc=Pa.getSectionIndex(Ws),mu=Pa.getCharCode(Ws),_c=0,Eo=null,Kl=null,Os=null,Il=24,Ff=!(bo===zr.horizontal||!Ro&&!$f(mu)||Ro&&(Bn[mu]||(Lo=mu,qr.Arabic(Lo)||qr["Arabic Supplement"](Lo)||qr["Arabic Extended-A"](Lo)||qr["Arabic Presentation Forms-A"](Lo)||qr["Arabic Presentation Forms-B"](Lo))));if(ga.imageName){var ch=ra[ga.imageName];if(!ch)continue;Os=ga.imageName,Mn.iconsInText=Mn.iconsInText||!0,Kl=ch.paddedRect;var xc=ch.displaySize;ga.scale=24*ga.scale/gs,_c=vu+(24-xc[1]*ga.scale),Il=(Eo={width:xc[0],height:xc[1],left:1,top:-3,advance:Ff?xc[1]:xc[0]}).advance;var Bf=Ff?xc[0]*ga.scale-24*oa:xc[1]*ga.scale-24*oa;Bf>0&&Bf>es&&(es=Bf)}else{var bp=bi[ga.fontStack],jh=bp&&bp[mu];if(jh&&jh.rect)Kl=jh.rect,Eo=jh.metrics;else{var Ep=Vi[ga.fontStack],ud=Ep&&Ep[mu];if(!ud)continue;Eo=ud.metrics}_c=24*(oa-ga.scale)}Ff?(Mn.verticalizable=!0,to.push({glyph:mu,imageName:Os,x:ys,y:tu+_c,vertical:Ff,scale:ga.scale,fontStack:ga.fontStack,sectionIndex:Kc,metrics:Eo,rect:Kl}),ys+=Il*ga.scale+so):(to.push({glyph:mu,imageName:Os,x:ys,y:tu+_c,vertical:Ff,scale:ga.scale,fontStack:ga.fontStack,sectionIndex:Kc,metrics:Eo,rect:Kl}),ys+=Eo.advance*ga.scale+so)}to.length!==0&&(Es=Math.max(ys-so,Es),di(to,0,to.length-1,Vo,es)),ys=0;var Nf=ma*oa+es;Hs.lineOffset=Math.max(es,vu),tu+=Nf,Ss=Math.max(Nf,Ss),++Cs}else tu+=ma,++Cs}var Lo,Vh=tu- -17,fh=Jr(oo),$c=fh.horizontalAlign,zf=fh.verticalAlign;(function(Sp,ld,Cp,Ap,cd,wp,Tp,Mp,W){var hh,Pp=(ld-Cp)*cd;hh=wp!==Tp?-Mp*Ap- -17:(-Ap*W+.5)*Tp;for(var ph=0,Gh=Sp;ph<Gh.length;ph+=1)for(var Uf=0,Hh=Gh[ph].positionedGlyphs;Uf<Hh.length;Uf+=1){var dh=Hh[Uf];dh.x+=Pp,dh.y+=hh}})(Mn.positionedLines,Vo,$c,zf,Es,Ss,ma,Vh,Vn.length),Mn.top+=-zf*Vh,Mn.bottom=Mn.top+Vh,Mn.left+=-$c*Es,Mn.right=Mn.left+Es}(ii,o,u,p,Qe,S,P,k,H,z,ee,Re),!function(Mn){for(var Vi=0,bi=Mn;Vi<bi.length;Vi+=1)if(bi[Vi].positionedGlyphs.length!==0)return!1;return!0}(Ri)&&ii}Lr.fromFeature=function(t,o){for(var u=new Lr,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Lr.prototype.length=function(){return this.text.length},Lr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Lr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Lr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Lr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&ku(p)&&!sh[t[u+1]]||y&&ku(y)&&!sh[t[u-1]]||!sh[t[u]]?t[u]:sh[t[u]]}return o}(this.text)},Lr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&Bn[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Lr.prototype.substring=function(t,o){var u=new Lr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Lr.prototype.toString=function(){return this.text},Lr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Lr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(hr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Lr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(hr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}else tt("Can't add FormattedSection with an empty image.")},Lr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rr={};function ar(t,o,u,p,y,b){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var P=u[o.fontStack],k=P&&P[t];return k?k.metrics.advance*o.scale+y:0}function _n(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Gr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Ar(t,o,u,p,y,b){for(var S=null,P=_n(o,u,y,b),k=0,z=p;k<z.length;k+=1){var Z=z[k],H=_n(o-Z.x,u,y,b)+Z.badness;H<=P&&(S=Z,P=H)}return{index:t,x:o,priorBreak:S,badness:P}}function $r(t,o,u,p,y,b,S){if(b!=="point")return[];if(!t)return[];for(var P,k=[],z=function(Qe,Ce,Ge,Ct,Xt,Yt){for(var fr=0,kr=0;kr<Qe.length();kr++){var Qr=Qe.getSection(kr);fr+=ar(Qe.getCharCode(kr),Qr,Ct,Xt,Ce,Yt)}return fr/Math.max(1,Math.ceil(fr/Ge))}(t,o,u,p,y,S),Z=t.text.indexOf("\u200B")>=0,H=0,ee=0;ee<t.length();ee++){var ie=t.getSection(ee),Pe=t.getCharCode(ee);if(Bn[Pe]||(H+=ar(Pe,ie,p,y,o,S)),ee<t.length()-1){var Re=!((P=Pe)<11904||!(qr["Bopomofo Extended"](P)||qr.Bopomofo(P)||qr["CJK Compatibility Forms"](P)||qr["CJK Compatibility Ideographs"](P)||qr["CJK Compatibility"](P)||qr["CJK Radicals Supplement"](P)||qr["CJK Strokes"](P)||qr["CJK Symbols and Punctuation"](P)||qr["CJK Unified Ideographs Extension A"](P)||qr["CJK Unified Ideographs"](P)||qr["Enclosed CJK Letters and Months"](P)||qr["Halfwidth and Fullwidth Forms"](P)||qr.Hiragana(P)||qr["Ideographic Description Characters"](P)||qr["Kangxi Radicals"](P)||qr["Katakana Phonetic Extensions"](P)||qr.Katakana(P)||qr["Vertical Forms"](P)||qr["Yi Radicals"](P)||qr["Yi Syllables"](P)));(rr[Pe]||Re||ie.imageName)&&k.push(Ar(ee+1,H,z,k,Gr(Pe,t.getCharCode(ee+1),Re&&Z),!1))}}return function Qe(Ce){return Ce?Qe(Ce.priorBreak).concat(Ce.index):[]}(Ar(t.length(),H,z,k,0,!0))}function Jr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function di(t,o,u,p,y){if(p||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*p,P=o;P<=u;P++)t[P].x-=S,t[P].y+=y}function ni(t,o,u,p,y,b){var S,P=t.image;if(P.content){var k=P.content,z=P.pixelRatio||1;S=[k[0]/z,k[1]/z,P.displaySize[0]-k[2]/z,P.displaySize[1]-k[3]/z]}var Z,H,ee,ie,Pe=o.left*b,Re=o.right*b;u==="width"||u==="both"?(ie=y[0]+Pe-p[3],H=y[0]+Re+p[1]):H=(ie=y[0]+(Pe+Re-P.displaySize[0])/2)+P.displaySize[0];var Qe=o.top*b,Ce=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+Qe-p[0],ee=y[1]+Ce+p[2]):ee=(Z=y[1]+(Qe+Ce-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Z,right:H,bottom:ee,left:ie,collisionPadding:S}}rr[10]=!0,rr[32]=!0,rr[38]=!0,rr[40]=!0,rr[41]=!0,rr[43]=!0,rr[45]=!0,rr[47]=!0,rr[173]=!0,rr[183]=!0,rr[8203]=!0,rr[8208]=!0,rr[8211]=!0,rr[8231]=!0;var Wr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ue);function on(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Pi(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var P=p[b],k=p[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:k,minSize:u.evaluate(new Pi(P)),maxSize:u.evaluate(new Pi(k)),interpolationType:y}}function Qn(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ta(y/128,u.upperSize/128,o.uSizeT):p}function fi(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Gt(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ta(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}mn("Anchor",Wr);var Fi=Object.freeze({__proto__:null,getSizeData:on,evaluateSizeForFeature:Qn,evaluateSizeForZoom:fi,SIZE_PACK_FACTOR:128});function Ya(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(b),b=t[S]}P+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;P<u/2;){var Z=t[S],H=t[S+1];if(!H)return!1;var ee=t[S-1].angleTo(Z)-Z.angleTo(H);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:ee}),z+=ee;P-k[0].distance>p;)z-=k.shift().angleDelta;if(z>y)return!1;S++,P+=Z.dist(H)}return!0}function io(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Bi(t,o,u){return t?.6*o*u:0}function as(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ba(t,o,u,p,y,b){for(var S=Bi(u,y,b),P=as(u,p)*b,k=0,z=io(t)/2,Z=0;Z<t.length-1;Z++){var H=t[Z],ee=t[Z+1],ie=H.dist(ee);if(k+ie>z){var Pe=(z-k)/ie,Re=ta(H.x,ee.x,Pe),Qe=ta(H.y,ee.y,Pe),Ce=new Wr(Re,Qe,ee.angleTo(H),Z);return Ce._round(),!S||Ya(t,Ce,P,S,o)?Ce:void 0}k+=ie}}function Zo(t,o,u,p,y,b,S,P,k){var z=Bi(p,b,S),Z=as(p,y),H=Z*S,ee=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return o-H<o/4&&(o=H+o/4),function ie(Pe,Re,Qe,Ce,Ge,Ct,Xt,Yt,fr){for(var kr=Ct/2,Qr=io(Pe),zn=0,vn=Re-Qe,jn=[],gn=0;gn<Pe.length-1;gn++){for(var Ri=Pe[gn],ii=Pe[gn+1],Mn=Ri.dist(ii),Vi=ii.angleTo(Ri);vn+Qe<zn+Mn;){var bi=((vn+=Qe)-zn)/Mn,ra=ta(Ri.x,ii.x,bi),Vn=ta(Ri.y,ii.y,bi);if(ra>=0&&ra<fr&&Vn>=0&&Vn<fr&&vn-kr>=0&&vn+kr<=Qr){var ma=new Wr(ra,Vn,Vi,gn);ma._round(),Ce&&!Ya(Pe,ma,Ct,Ce,Ge)||jn.push(ma)}}zn+=Mn}return Yt||jn.length||Xt||(jn=ie(Pe,zn/2,Qe,Ce,Ge,Ct,Xt,!0,fr)),jn}(t,ee?o/2*P%o:(Z/2+2*b)*S*P%o,o,z,u,H,ee,!1,k)}function _o(t,o,u,p,y){for(var b=[],S=0;S<t.length;S++)for(var P=t[S],k=void 0,z=0;z<P.length-1;z++){var Z=P[z],H=P[z+1];Z.x<o&&H.x<o||(Z.x<o?Z=new ue(o,Z.y+(o-Z.x)/(H.x-Z.x)*(H.y-Z.y))._round():H.x<o&&(H=new ue(o,Z.y+(o-Z.x)/(H.x-Z.x)*(H.y-Z.y))._round()),Z.y<u&&H.y<u||(Z.y<u?Z=new ue(Z.x+(u-Z.y)/(H.y-Z.y)*(H.x-Z.x),u)._round():H.y<u&&(H=new ue(Z.x+(u-Z.y)/(H.y-Z.y)*(H.x-Z.x),u)._round()),Z.x>=p&&H.x>=p||(Z.x>=p?Z=new ue(p,Z.y+(p-Z.x)/(H.x-Z.x)*(H.y-Z.y))._round():H.x>=p&&(H=new ue(p,Z.y+(p-Z.x)/(H.x-Z.x)*(H.y-Z.y))._round()),Z.y>=y&&H.y>=y||(Z.y>=y?Z=new ue(Z.x+(y-Z.y)/(H.y-Z.y)*(H.x-Z.x),y)._round():H.y>=y&&(H=new ue(Z.x+(y-Z.y)/(H.y-Z.y)*(H.x-Z.x),y)._round()),k&&Z.equals(k[k.length-1])||b.push(k=[Z]),k.push(H)))))}return b}function jo(t,o,u,p){var y=[],b=t.image,S=b.pixelRatio,P=b.paddedRect.w-2,k=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,H=b.stretchX||[[0,P]],ee=b.stretchY||[[0,k]],ie=function(ra,Vn){return ra+Vn[1]-Vn[0]},Pe=H.reduce(ie,0),Re=ee.reduce(ie,0),Qe=P-Pe,Ce=k-Re,Ge=0,Ct=Pe,Xt=0,Yt=Re,fr=0,kr=Qe,Qr=0,zn=Ce;if(b.content&&p){var vn=b.content;Ge=Po(H,0,vn[0]),Xt=Po(ee,0,vn[1]),Ct=Po(H,vn[0],vn[2]),Yt=Po(ee,vn[1],vn[3]),fr=vn[0]-Ge,Qr=vn[1]-Xt,kr=vn[2]-vn[0]-Ct,zn=vn[3]-vn[1]-Yt}var jn=function(ra,Vn,ma,oo){var Oo=ao(ra.stretch-Ge,Ct,z,t.left),bo=vi(ra.fixed-fr,kr,ra.stretch,Pe),so=ao(Vn.stretch-Xt,Yt,Z,t.top),Ro=vi(Vn.fixed-Qr,zn,Vn.stretch,Re),gs=ao(ma.stretch-Ge,Ct,z,t.left),ys=vi(ma.fixed-fr,kr,ma.stretch,Pe),tu=ao(oo.stretch-Xt,Yt,Z,t.top),Es=vi(oo.fixed-Qr,zn,oo.stretch,Re),Ss=new ue(Oo,so),Vo=new ue(gs,so),Cs=new ue(gs,tu),Ki=new ue(Oo,tu),Na=new ue(bo/S,Ro/S),Pa=new ue(ys/S,Es/S),oa=o*Math.PI/180;if(oa){var vu=Math.sin(oa),Hs=Math.cos(oa),to=[Hs,-vu,vu,Hs];Ss._matMult(to),Vo._matMult(to),Ki._matMult(to),Cs._matMult(to)}var es=ra.stretch+ra.fixed,Ws=Vn.stretch+Vn.fixed;return{tl:Ss,tr:Vo,bl:Ki,br:Cs,tex:{x:b.paddedRect.x+1+es,y:b.paddedRect.y+1+Ws,w:ma.stretch+ma.fixed-es,h:oo.stretch+oo.fixed-Ws},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Na,pixelOffsetBR:Pa,minFontScaleX:kr/S/z,minFontScaleY:zn/S/Z,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var gn=vs(H,Qe,Pe),Ri=vs(ee,Ce,Re),ii=0;ii<gn.length-1;ii++)for(var Mn=gn[ii],Vi=gn[ii+1],bi=0;bi<Ri.length-1;bi++)y.push(jn(Mn,Ri[bi],Vi,Ri[bi+1]));else y.push(jn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return y}function Po(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var S=b[y];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function vs(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],P=S[0],k=S[1],z=p[p.length-1];p.push({fixed:P-z.stretch,stretch:z.stretch}),p.push({fixed:P-z.stretch,stretch:z.stretch+(k-P)})}return p.push({fixed:o+1,stretch:u}),p}function ao(t,o,u,p){return t/o*u+p}function vi(t,o,u,p){return t-o*u/p}var Io=function(t,o,u,p,y,b,S,P,k,z){if(this.boxStartIndex=t.length,k){var Z=b.top,H=b.bottom,ee=b.collisionPadding;ee&&(Z-=ee[1],H+=ee[3]);var ie=H-Z;ie>0&&(ie=Math.max(10,ie),this.circleDiameter=ie)}else{var Pe=b.top*S-P,Re=b.bottom*S+P,Qe=b.left*S-P,Ce=b.right*S+P,Ge=b.collisionPadding;if(Ge&&(Qe-=Ge[0]*S,Pe-=Ge[1]*S,Ce+=Ge[2]*S,Re+=Ge[3]*S),z){var Ct=new ue(Qe,Pe),Xt=new ue(Ce,Pe),Yt=new ue(Qe,Re),fr=new ue(Ce,Re),kr=z*Math.PI/180;Ct._rotate(kr),Xt._rotate(kr),Yt._rotate(kr),fr._rotate(kr),Qe=Math.min(Ct.x,Xt.x,Yt.x,fr.x),Ce=Math.max(Ct.x,Xt.x,Yt.x,fr.x),Pe=Math.min(Ct.y,Xt.y,Yt.y,fr.y),Re=Math.max(Ct.y,Xt.y,Yt.y,fr.y)}t.emplaceBack(o.x,o.y,Qe,Pe,Ce,Re,u,p,y)}this.boxEndIndex=t.length},ji=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=os),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function os(t,o){return t<o?-1:t>o?1:0}function hn(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,S=-1/0,P=t[0],k=0;k<P.length;k++){var z=P[k];(!k||z.x<p)&&(p=z.x),(!k||z.y<y)&&(y=z.y),(!k||z.x>b)&&(b=z.x),(!k||z.y>S)&&(S=z.y)}var Z=Math.min(b-p,S-y),H=Z/2,ee=new ji([],mi);if(Z===0)return new ue(p,y);for(var ie=p;ie<b;ie+=Z)for(var Pe=y;Pe<S;Pe+=Z)ee.push(new ca(ie+H,Pe+H,H,t));for(var Re=function(Ge){for(var Ct=0,Xt=0,Yt=0,fr=Ge[0],kr=0,Qr=fr.length,zn=Qr-1;kr<Qr;zn=kr++){var vn=fr[kr],jn=fr[zn],gn=vn.x*jn.y-jn.x*vn.y;Xt+=(vn.x+jn.x)*gn,Yt+=(vn.y+jn.y)*gn,Ct+=3*gn}return new ca(Xt/Ct,Yt/Ct,0,Ge)}(t),Qe=ee.length;ee.length;){var Ce=ee.pop();(Ce.d>Re.d||!Re.d)&&(Re=Ce,u&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,Qe)),Ce.max-Re.d<=o||(ee.push(new ca(Ce.p.x-(H=Ce.h/2),Ce.p.y-H,H,t)),ee.push(new ca(Ce.p.x+H,Ce.p.y-H,H,t)),ee.push(new ca(Ce.p.x-H,Ce.p.y+H,H,t)),ee.push(new ca(Ce.p.x+H,Ce.p.y+H,H,t)),Qe+=4)}return u&&(console.log("num probes: "+Qe),console.log("best distance: "+Re.d)),Re.p}function mi(t,o){return o.max-t.max}function ca(t,o,u,p){this.p=new ue(t,o),this.h=u,this.d=function(y,b){for(var S=!1,P=1/0,k=0;k<b.length;k++)for(var z=b[k],Z=0,H=z.length,ee=H-1;Z<H;ee=Z++){var ie=z[Z],Pe=z[ee];ie.y>y.y!=Pe.y>y.y&&y.x<(Pe.x-ie.x)*(y.y-ie.y)/(Pe.y-ie.y)+ie.x&&(S=!S),P=Math.min(P,Zl(y,ie,Pe))}return(S?1:-1)*Math.sqrt(P)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}ji.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ji.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ji.prototype.peek=function(){return this.data[0]},ji.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},ji.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),S=o[b],P=b+1;if(P<this.length&&u(o[P],S)<0&&(b=P,S=o[P]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var xo=Number.POSITIVE_INFINITY;function pl(t,o){return o[1]!==xo?function(u,p,y){var b=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,S]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function Me(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ut(t,o,u,p,y,b,S,P,k,z,Z,H,ee,ie,Pe){var Re=function(Xt,Yt,fr,kr,Qr,zn,vn,jn){for(var gn=kr.layout.get("text-rotate").evaluate(zn,{})*Math.PI/180,Ri=[],ii=0,Mn=Yt.positionedLines;ii<Mn.length;ii+=1)for(var Vi=Mn[ii],bi=0,ra=Vi.positionedGlyphs;bi<ra.length;bi+=1){var Vn=ra[bi];if(Vn.rect){var ma=Vn.rect||{},oo=4,Oo=!0,bo=1,so=0,Ro=(Qr||jn)&&Vn.vertical,gs=Vn.metrics.advance*Vn.scale/2;if(jn&&Yt.verticalizable&&(so=Vi.lineOffset/2-(Vn.imageName?-(24-Vn.metrics.width*Vn.scale)/2:24*(Vn.scale-1))),Vn.imageName){var ys=vn[Vn.imageName];Oo=ys.sdf,oo=1/(bo=ys.pixelRatio)}var tu=Qr?[Vn.x+gs,Vn.y]:[0,0],Es=Qr?[0,0]:[Vn.x+gs+fr[0],Vn.y+fr[1]-so],Ss=[0,0];Ro&&(Ss=Es,Es=[0,0]);var Vo=(Vn.metrics.left-oo)*Vn.scale-gs+Es[0],Cs=(-Vn.metrics.top-oo)*Vn.scale+Es[1],Ki=Vo+ma.w*Vn.scale/bo,Na=Cs+ma.h*Vn.scale/bo,Pa=new ue(Vo,Cs),oa=new ue(Ki,Cs),vu=new ue(Vo,Na),Hs=new ue(Ki,Na);if(Ro){var to=new ue(-gs,gs- -17),es=-Math.PI/2,Ws=12-gs,ga=new ue(22-Ws,-(Vn.imageName?Ws:0)),Kc=new(Function.prototype.bind.apply(ue,[null].concat(Ss)));Pa._rotateAround(es,to)._add(ga)._add(Kc),oa._rotateAround(es,to)._add(ga)._add(Kc),vu._rotateAround(es,to)._add(ga)._add(Kc),Hs._rotateAround(es,to)._add(ga)._add(Kc)}if(gn){var mu=Math.sin(gn),_c=Math.cos(gn),Eo=[_c,-mu,mu,_c];Pa._matMult(Eo),oa._matMult(Eo),vu._matMult(Eo),Hs._matMult(Eo)}var Kl=new ue(0,0),Os=new ue(0,0);Ri.push({tl:Pa,tr:oa,bl:vu,br:Hs,tex:ma,writingMode:Yt.writingMode,glyphOffset:tu,sectionIndex:Vn.sectionIndex,isSDF:Oo,pixelOffsetTL:Kl,pixelOffsetBR:Os,minFontScaleX:0,minFontScaleY:0})}}return Ri}(0,u,P,y,b,S,p,t.allowVerticalPlacement),Qe=t.textSizeData,Ce=null;Qe.kind==="source"?(Ce=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&tt(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Qe.kind==="composite"&&((Ce=[128*ie.compositeTextSizes[0].evaluate(S,{},Pe),128*ie.compositeTextSizes[1].evaluate(S,{},Pe)])[0]>32640||Ce[1]>32640)&&tt(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Re,Ce,P,b,S,z,o,k.lineStartIndex,k.lineLength,ee,Pe);for(var Ge=0,Ct=Z;Ge<Ct.length;Ge+=1)H[Ct[Ge]]=t.text.placedSymbolArray.length-1;return 4*Re.length}function wt(t){for(var o in t)return t[o];return null}function cn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(p.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Ni=du.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function re(t,o,u,p,y,b,S,P,k,z,Z,H,ee){var ie=P?Math.min(32640,Math.round(P[0])):0,Pe=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,S,(ie<<1)+(k?1:0),Pe,16*z,16*Z,256*H,256*ee)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ft(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(gf(u[o].text))return!0;return!1}var kt=function(t){this.layoutVertexArray=new El,this.indexArray=new Al,this.programConfigurations=t,this.segments=new he,this.dynamicLayoutVertexArray=new ul,this.opacityVertexArray=new hc,this.placedSymbolArray=new d};kt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},kt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},kt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},mn("SymbolBuffers",kt);var $e=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new he,this.collisionVertexArray=new Ih};$e.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Nd.members,!0)},$e.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},mn("CollisionBuffers",$e);var Ne=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=js([]),this.placementViewportMatrix=js([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=on(this.zoom,o["text-size"]),this.iconSizeData=on(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return zr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Ne.prototype.createArrays=function(){this.text=new kt(new Sn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new kt(new Sn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new L,this.symbolInstances=new w},Ne.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var S=sh[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Ne.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),S=y.get("text-field"),P=y.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof Ea&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],k||z){for(var H=o.iconDependencies,ee=o.glyphDependencies,ie=o.availableImages,Pe=new Pi(this.zoom),Re=0,Qe=t;Re<Qe.length;Re+=1){var Ce=Qe[Re],Ge=Ce.feature,Ct=Ce.id,Xt=Ce.index,Yt=Ce.sourceLayerIndex,fr=p._featureFilter.needGeometry,kr=Ga(Ge,fr);if(p._featureFilter.filter(Pe,kr,u)){fr||(kr.geometry=Va(Ge));var Qr=void 0;if(k){var zn=p.getValueAndResolveTokens("text-field",kr,u,ie),vn=Ea.factory(zn);ft(vn)&&(this.hasRTLText=!0),(!this.hasRTLText||Ph()==="unavailable"||this.hasRTLText&&Ts.isParsed())&&(Qr=Lf(vn,p,kr))}var jn=void 0;if(z){var gn=p.getValueAndResolveTokens("icon-image",kr,u,ie);jn=gn instanceof Sa?gn:Sa.fromString(gn)}if(Qr||jn){var Ri=this.sortFeaturesByKey?Z.evaluate(kr,{},u):void 0;if(this.features.push({id:Ct,text:Qr,icon:jn,index:Xt,sourceLayerIndex:Yt,geometry:kr.geometry,properties:Ge.properties,type:Ni[Ge.type],sortKey:Ri}),jn&&(H[jn.name]=!0),Qr){var ii=b.evaluate(kr,{},u).join(","),Mn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(var Vi=0,bi=Qr.sections;Vi<bi.length;Vi+=1){var ra=bi[Vi];if(ra.image)H[ra.image.name]=!0;else{var Vn=mf(Qr.toString()),ma=ra.fontStack||ii,oo=ee[ma]=ee[ma]||{};this.calculateGlyphDependencies(ra.text,oo,Mn,this.allowVerticalPlacement,Vn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Oo){var bo={},so={},Ro=[],gs=0;function ys(to){Ro.push(Oo[to]),gs++}function tu(to,es,Ws){var ga=so[to];return delete so[to],so[es]=ga,Ro[ga].geometry[0].pop(),Ro[ga].geometry[0]=Ro[ga].geometry[0].concat(Ws[0]),ga}function Es(to,es,Ws){var ga=bo[es];return delete bo[es],bo[to]=ga,Ro[ga].geometry[0].shift(),Ro[ga].geometry[0]=Ws[0].concat(Ro[ga].geometry[0]),ga}function Ss(to,es,Ws){var ga=Ws?es[0][es[0].length-1]:es[0][0];return to+":"+ga.x+":"+ga.y}for(var Vo=0;Vo<Oo.length;Vo++){var Cs=Oo[Vo],Ki=Cs.geometry,Na=Cs.text?Cs.text.toString():null;if(Na){var Pa=Ss(Na,Ki),oa=Ss(Na,Ki,!0);if(Pa in so&&oa in bo&&so[Pa]!==bo[oa]){var vu=Es(Pa,oa,Ki),Hs=tu(Pa,oa,Ro[vu].geometry);delete bo[Pa],delete so[oa],so[Ss(Na,Ro[Hs].geometry,!0)]=Hs,Ro[vu].geometry=null}else Pa in so?tu(Pa,oa,Ki):oa in bo?Es(Pa,oa,Ki):(ys(Vo),bo[Pa]=gs-1,so[oa]=gs-1)}else ys(Vo)}return Ro.filter(function(to){return to.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Oo,bo){return Oo.sortKey-bo.sortKey})}},Ne.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Ne.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ne.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ne.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ne.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ne.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ne.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)b[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=o[P-1].dist(o[P]));for(var k=0;k<o.length;k++){var z=b[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Ne.prototype.addSymbols=function(t,o,u,p,y,b,S,P,k,z,Z,H){for(var ee=t.indexArray,ie=t.layoutVertexArray,Pe=t.segments.prepareSegment(4*o.length,ie,ee,this.canOverlap?b.sortKey:void 0),Re=this.glyphOffsetArray.length,Qe=Pe.vertexLength,Ce=this.allowVerticalPlacement&&S===zr.vertical?Math.PI/2:0,Ge=b.text&&b.text.sections,Ct=0;Ct<o.length;Ct++){var Xt=o[Ct],Yt=Xt.tl,fr=Xt.tr,kr=Xt.bl,Qr=Xt.br,zn=Xt.tex,vn=Xt.pixelOffsetTL,jn=Xt.pixelOffsetBR,gn=Xt.minFontScaleX,Ri=Xt.minFontScaleY,ii=Xt.glyphOffset,Mn=Xt.isSDF,Vi=Xt.sectionIndex,bi=Pe.vertexLength,ra=ii[1];re(ie,P.x,P.y,Yt.x,ra+Yt.y,zn.x,zn.y,u,Mn,vn.x,vn.y,gn,Ri),re(ie,P.x,P.y,fr.x,ra+fr.y,zn.x+zn.w,zn.y,u,Mn,jn.x,vn.y,gn,Ri),re(ie,P.x,P.y,kr.x,ra+kr.y,zn.x,zn.y+zn.h,u,Mn,vn.x,jn.y,gn,Ri),re(ie,P.x,P.y,Qr.x,ra+Qr.y,zn.x+zn.w,zn.y+zn.h,u,Mn,jn.x,jn.y,gn,Ri),Ve(t.dynamicLayoutVertexArray,P,Ce),ee.emplaceBack(bi,bi+1,bi+2),ee.emplaceBack(bi+1,bi+2,bi+3),Pe.vertexLength+=4,Pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),Ct!==o.length-1&&Vi===o[Ct+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},H,Ge&&Ge[Vi])}t.placedSymbolArray.emplaceBack(P.x,P.y,Re,this.glyphOffsetArray.length-Re,Qe,k,z,P.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,Z)},Ne.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},Ne.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,S){var P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=P.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,H=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,Z,b,H,ee,new ue(t,o)),this._addCollisionDebugVertex(z,Z,b,H,ee,new ue(u,o)),this._addCollisionDebugVertex(z,Z,b,H,ee,new ue(u,p)),this._addCollisionDebugVertex(z,Z,b,H,ee,new ue(t,p)),P.vertexLength+=4;var ie=y.indexArray;ie.emplaceBack(k,k+1),ie.emplaceBack(k+1,k+2),ie.emplaceBack(k+2,k+3),ie.emplaceBack(k+3,k),P.primitiveLength+=4},Ne.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Ne.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $e(Sl,yp.members,pc),this.iconCollisionBox=new $e(Sl,yp.members,pc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Ne.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,S,P,k){for(var z={},Z=o;Z<u;Z++){var H=t.get(Z);z.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},z.textFeatureIndex=H.featureIndex;break}for(var ee=p;ee<y;ee++){var ie=t.get(ee);z.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},z.verticalTextFeatureIndex=ie.featureIndex;break}for(var Pe=b;Pe<S;Pe++){var Re=t.get(Pe);z.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,anchorPointX:Re.anchorPointX,anchorPointY:Re.anchorPointY},z.iconFeatureIndex=Re.featureIndex;break}for(var Qe=P;Qe<k;Qe++){var Ce=t.get(Qe);z.verticalIconBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},z.verticalIconFeatureIndex=Ce.featureIndex;break}return z},Ne.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Ne.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ne.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ne.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ne.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ne.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ne.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Ne.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var P=this.symbolInstances.get(S);p.push(0|Math.round(o*P.anchorX+u*P.anchorY)),y.push(P.featureIndex)}return b.sort(function(k,z){return p[k]-p[z]||y[z]-y[k]}),b},Ne.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Ne.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,P){b>=0&&P.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},mn("SymbolBucket",Ne,{omit:["layers","collisionBoxArray","features","compareText"]}),Ne.MAX_GLYPHS=65535,Ne.addDynamicAttributes=Ve;var ot=new Ko({"symbol-placement":new In(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new In(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new In(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(fe.layout_symbol["icon-size"]),"icon-text-fit":new In(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(fe.layout_symbol["icon-image"]),"icon-rotate":new An(fe.layout_symbol["icon-rotate"]),"icon-padding":new In(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new In(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new An(fe.layout_symbol["icon-offset"]),"icon-anchor":new An(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(fe.layout_symbol["text-rotation-alignment"]),"text-field":new An(fe.layout_symbol["text-field"]),"text-font":new An(fe.layout_symbol["text-font"]),"text-size":new An(fe.layout_symbol["text-size"]),"text-max-width":new An(fe.layout_symbol["text-max-width"]),"text-line-height":new In(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new An(fe.layout_symbol["text-letter-spacing"]),"text-justify":new An(fe.layout_symbol["text-justify"]),"text-radial-offset":new An(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new An(fe.layout_symbol["text-anchor"]),"text-max-angle":new In(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new In(fe.layout_symbol["text-writing-mode"]),"text-rotate":new An(fe.layout_symbol["text-rotate"]),"text-padding":new In(fe.layout_symbol["text-padding"]),"text-keep-upright":new In(fe.layout_symbol["text-keep-upright"]),"text-transform":new An(fe.layout_symbol["text-transform"]),"text-offset":new An(fe.layout_symbol["text-offset"]),"text-allow-overlap":new In(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new In(fe.layout_symbol["text-ignore-placement"]),"text-optional":new In(fe.layout_symbol["text-optional"])}),_e={paint:new Ko({"icon-opacity":new An(fe.paint_symbol["icon-opacity"]),"icon-color":new An(fe.paint_symbol["icon-color"]),"icon-halo-color":new An(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new In(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(fe.paint_symbol["text-opacity"]),"text-color":new An(fe.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new An(fe.paint_symbol["text-halo-color"]),"text-halo-width":new An(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new An(fe.paint_symbol["text-halo-blur"]),"text-translate":new In(fe.paint_symbol["text-translate"]),"text-translate-anchor":new In(fe.paint_symbol["text-translate-anchor"])}),layout:ot},je=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ln,this.defaultValue=t};je.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},je.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return null},mn("FormatSectionOverride",je,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,P=y;S<P.length;S+=1){var k=P[S];b.indexOf(k)<0&&b.push(k)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var S=this.layout.get(u).evaluate(p,{},y,b),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||Do(P.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(Z,H){return H in k?String(k[H]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Ne(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=_e.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),P=new je(S),k=new _l(P,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new el("source",k):new Fo("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new hs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=_e.paint.properties[p],S=!1,P=function(Z){for(var H=0,ee=Z;H<ee.length;H+=1)if(b.overrides&&b.overrides.hasOverride(ee[H]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Ea)P(y.value.value.sections);else if(y.value.kind==="source"){var k=function(Z){S||(Z instanceof co&&Qi(Z.value)===$i?P(Z.value.sections):Z instanceof Ho?P(Z.sections):Z.eachChild(k))},z=y.value;z._styleExpression&&k(z._styleExpression.expression)}return S},o}(xa),dt={paint:new Ko({"background-color":new In(fe.paint_background["background-color"]),"background-pattern":new ps(fe.paint_background["background-pattern"]),"background-opacity":new In(fe.paint_background["background-opacity"])})},Tt=function(t){function o(u){t.call(this,u,dt)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(xa),dr={paint:new Ko({"raster-opacity":new In(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new In(fe.paint_raster["raster-saturation"]),"raster-contrast":new In(fe.paint_raster["raster-contrast"]),"raster-resampling":new In(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new In(fe.paint_raster["raster-fade-duration"])})},Nr=function(t){function o(u){t.call(this,u,dr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(xa),Ur=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(xa),nn={circle:Ef,heatmap:Rh,hillshade:cp,fill:ah,"fill-extrusion":Ml,line:zh,symbol:Ae,background:Tt,raster:Nr},Br=ae.HTMLImageElement,Cn=ae.HTMLCanvasElement,fn=ae.HTMLVideoElement,En=ae.ImageData,xn=ae.ImageBitmap,dn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};dn.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Br||t instanceof Cn||t instanceof fn||t instanceof En||xn&&t instanceof xn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,p,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},z=k.x,Z=k.y;t instanceof Br||t instanceof Cn||t instanceof fn||t instanceof En||xn&&t instanceof xn?P.texSubImage2D(P.TEXTURE_2D,0,z,Z,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,z,Z,p,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},dn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},dn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},dn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var qn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};qn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},qn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var va=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},tr(["receive","process"],this),this.invoker=new qn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fr()?t:ae};function ss(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}va.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=Ke(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:xu(o,P)},P),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},va.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Fr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},va.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},va.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(Bs(o.error)):p(null,Bs(o.data)))}else{var y=!1,b=Ke(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,H){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?xu(Z):null,data:xu(H,b)},b)}:function(Z){y=!0},P=null,k=Bs(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+o.type));!y&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},va.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ka=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};ka.prototype.setNorthEast=function(t){return this._ne=t instanceof aa?new aa(t.lng,t.lat):aa.convert(t),this},ka.prototype.setSouthWest=function(t){return this._sw=t instanceof aa?new aa(t.lng,t.lat):aa.convert(t),this},ka.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof aa)o=t,u=t;else{if(!(t instanceof ka))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ka.convert(t)):this.extend(aa.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new aa(o.lng,o.lat),this._ne=new aa(u.lng,u.lat)),this},ka.prototype.getCenter=function(){return new aa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ka.prototype.getSouthWest=function(){return this._sw},ka.prototype.getNorthEast=function(){return this._ne},ka.prototype.getNorthWest=function(){return new aa(this.getWest(),this.getNorth())},ka.prototype.getSouthEast=function(){return new aa(this.getEast(),this.getSouth())},ka.prototype.getWest=function(){return this._sw.lng},ka.prototype.getSouth=function(){return this._sw.lat},ka.prototype.getEast=function(){return this._ne.lng},ka.prototype.getNorth=function(){return this._ne.lat},ka.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ka.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ka.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ka.prototype.contains=function(t){var o=aa.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},ka.convert=function(t){return!t||t instanceof ka?t:new ka(t)};var aa=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};aa.prototype.wrap=function(){return new aa(sr(this.lng,-180,180),this.lat)},aa.prototype.toArray=function(){return[this.lng,this.lat]},aa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},aa.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},aa.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new ka(new aa(this.lng-u,this.lat-o),new aa(this.lng+u,this.lat+o))},aa.convert=function(t){if(t instanceof aa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new aa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new aa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Pl=2*Math.PI*63710088e-1;function Is(t){return Pl*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function Mu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function _p(t,o){return t/Is(o)}function Pu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var yc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};yc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=aa.convert(t);return new yc(dl(u.lng),Mu(u.lat),_p(o,u.lat))},yc.prototype.toLngLat=function(){return new aa(360*this.x-180,Pu(this.y))},yc.prototype.toAltitude=function(){return this.z*Is(Pu(this.y))},yc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Pl*(t=Pu(this.y),1/Math.cos(t*Math.PI/180));var t};var Df=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=xp(0,t,t,o,u)};Df.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Df.prototype.url=function(t,o){var u,p,y,b,S,P=(p=this.y,y=this.z,b=ss(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),S=ss(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),k=function(z,Z,H){for(var ee,ie="",Pe=z;Pe>0;Pe--)ie+=(Z&(ee=1<<Pe-1)?1:0)+(H&ee?2:0);return ie}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},Df.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ue(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Df.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Mv=function(t,o){this.wrap=t,this.canonical=o,this.key=xp(t,o.z,o.z,o.x,o.y)},Jo=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Df(u,+p,+y),this.key=xp(o,t,u,p,y)};function xp(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}Jo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Jo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Jo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Jo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?xp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):xp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Jo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Jo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Jo(o,this.wrap,o,u,p),new Jo(o,this.wrap,o,u+1,p),new Jo(o,this.wrap,o,u,p+1),new Jo(o,this.wrap,o,u+1,p+1)]},Jo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Jo.prototype.wrapped=function(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Jo.prototype.unwrapTo=function(t){return new Jo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Jo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Jo.prototype.toUnwrapped=function(){return new Mv(this.wrap,this.canonical)},Jo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Jo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new yc(t.x-this.wrap,t.y))},mn("CanonicalTileID",Df),mn("OverscaledTileID",Jo,{omit:["posMatrix"]});var ql=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return tt('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};ql.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},ql.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},ql.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},ql.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},ql.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},ql.prototype.getPixels=function(){return new No({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},ql.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var P=-o*this.dim,k=-u*this.dim,z=b;z<S;z++)for(var Z=p;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+P,z+k)]},mn("DEMData",ql);var ad=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};ad.prototype.encode=function(t){return this._stringToNumber[t]},ad.prototype.decode=function(t){return this._numberToString[t]};var od=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},sd={geometry:{configurable:!0}};sd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},sd.geometry.set=function(t){this._geometry=t},od.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(od.prototype,sd);var lh=function(){this.state={},this.stateChanges={},this.deletedStates={}};lh.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Pt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},lh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},lh.prototype.getState=function(t,o){var u=String(o),p=Pt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},lh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},lh.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Pt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var k in this.state[S])P[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,H=Object.keys(this.deletedStates[S][z]);Z<H.length;Z+=1)delete this.state[S][z][H[Z]];P[z]=this.state[S][z]}u[S]=u[S]||{},Pt(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var Yc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new nl(8192,16,0),this.grid3D=new nl(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function Ud(t,o,u,p,y){return Jt(t,function(b,S){var P=o instanceof Zs?o.get(S):null;return P&&P.evaluate?P.evaluate(u,p,y):P})}function Zd(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var P=S[b];o=Math.min(o,P.x),u=Math.min(u,P.y),p=Math.max(p,P.x),y=Math.max(y,P.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function k0(t,o){return o-t}Yc.prototype.insert=function(t,o,u,p,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var P=b?this.grid3D:this.grid,k=0;k<o.length;k++){for(var z=o[k],Z=[1/0,1/0,-1/0,-1/0],H=0;H<z.length;H++){var ee=z[H];Z[0]=Math.min(Z[0],ee.x),Z[1]=Math.min(Z[1],ee.y),Z[2]=Math.max(Z[2],ee.x),Z[3]=Math.max(Z[3],ee.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&P.insert(S,Z[0],Z[1],Z[2],Z[3])}},Yc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new du.VectorTile(new uh(this.rawTileData)).layers,this.sourceLayerCoder=new ad(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Yc.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,P=Fc(b.filter),k=t.queryGeometry,z=t.queryPadding*S,Z=Zd(k),H=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),ee=Zd(t.cameraQueryGeometry),ie=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Xt,Yt,fr,kr){return function(Qr,zn,vn,jn,gn){for(var Ri=0,ii=Qr;Ri<ii.length;Ri+=1){var Mn=ii[Ri];if(zn<=Mn.x&&vn<=Mn.y&&jn>=Mn.x&&gn>=Mn.y)return!0}var Vi=[new ue(zn,vn),new ue(zn,gn),new ue(jn,gn),new ue(jn,vn)];if(Qr.length>2){for(var bi=0,ra=Vi;bi<ra.length;bi+=1)if(Qs(Qr,ra[bi]))return!0}for(var Vn=0;Vn<Qr.length-1;Vn++)if(Vl(Qr[Vn],Qr[Vn+1],Vi))return!0;return!1}(t.cameraQueryGeometry,Xt-z,Yt-z,fr+z,kr+z)}),Pe=0,Re=ie;Pe<Re.length;Pe+=1)H.push(Re[Pe]);H.sort(k0);for(var Qe,Ce={},Ge=function(Xt){var Yt=H[Xt];if(Yt!==Qe){Qe=Yt;var fr=y.featureIndexArray.get(Yt),kr=null;y.loadMatchingFeature(Ce,fr.bucketIndex,fr.sourceLayerIndex,fr.featureIndex,P,b.layers,b.availableImages,o,u,p,function(Qr,zn,vn){return kr||(kr=Va(Qr)),zn.queryIntersectsFeature(k,Qr,vn,kr,y.z,t.transform,S,t.pixelPosMatrix)})}},Ct=0;Ct<H.length;Ct++)Ge(Ct);return Ce},Yc.prototype.loadMatchingFeature=function(t,o,u,p,y,b,S,P,k,z,Z){var H=this.bucketLayerIDs[o];if(!b||function(Qr,zn){for(var vn=0;vn<Qr.length;vn++)if(zn.indexOf(Qr[vn])>=0)return!0;return!1}(b,H)){var ee=this.sourceLayerCoder.decode(u),ie=this.vtLayers[ee].feature(p);if(y.needGeometry){var Pe=Ga(ie,!0);if(!y.filter(new Pi(this.tileID.overscaledZ),Pe,this.tileID.canonical))return}else if(!y.filter(new Pi(this.tileID.overscaledZ),ie))return;for(var Re=this.getId(ie,ee),Qe=0;Qe<H.length;Qe++){var Ce=H[Qe];if(!(b&&b.indexOf(Ce)<0)){var Ge=P[Ce];if(Ge){var Ct={};Re!==void 0&&z&&(Ct=z.getState(Ge.sourceLayer||"_geojsonTileLayer",Re));var Xt=Pt({},k[Ce]);Xt.paint=Ud(Xt.paint,Ge.paint,ie,Ct,S),Xt.layout=Ud(Xt.layout,Ge.layout,ie,Ct,S);var Yt=!Z||Z(ie,Ge,Ct);if(Yt){var fr=new od(ie,this.z,this.x,this.y,Re);fr.layer=Xt;var kr=t[Ce];kr===void 0&&(kr=t[Ce]=[]),kr.push({featureIndex:p,feature:fr,intersectionZ:Yt})}}}}}},Yc.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,S,P){var k={};this.loadVTLayers();for(var z=Fc(y),Z=0,H=t;Z<H.length;Z+=1)this.loadMatchingFeature(k,u,p,H[Z],z,b,S,P,o);return k},Yc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Yc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},mn("FeatureIndex",Yc,{omit:["rawTileData","sourceLayerCoder"]});var ms=function(t,o){this.tileID=t,this.uid=Lt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ms.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Wi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ms.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ms.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var H={};if(!Z)return H;for(var ee=function(){var Re=Pe[ie],Qe=Re.layerIds.map(function(Ct){return Z.getLayer(Ct)}).filter(Boolean);if(Qe.length!==0){Re.layers=Qe,Re.stateDependentLayerIds&&(Re.stateDependentLayers=Re.stateDependentLayerIds.map(function(Ct){return Qe.filter(function(Xt){return Xt.id===Ct})[0]}));for(var Ce=0,Ge=Qe;Ce<Ge.length;Ce+=1)H[Ge[Ce].id]=Re}},ie=0,Pe=z;ie<Pe.length;ie+=1)ee();return H}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof Ne){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Ne&&S.hasRTLText){this.hasRTLText=!0,Ts.isLoading()||Ts.isLoaded()||Ph()!=="deferred"||Ks();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},ms.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ms.prototype.getBucket=function(t){return this.buckets[t.id]},ms.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},ms.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ms.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,S,P,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:S,queryPadding:this.queryPadding*k},t,o,u):{}},ms.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var S=Fc(o&&o.filter),P=this.tileID.canonical,k=P.z,z=P.x,Z=P.y,H={z:k,x:z,y:Z},ee=0;ee<b.length;ee++){var ie=b.feature(ee);if(S.needGeometry){var Pe=Ga(ie,!0);if(!S.filter(new Pi(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!S.filter(new Pi(this.tileID.overscaledZ),ie))continue;var Re=u.getId(ie,y),Qe=new od(ie,k,z,Z,Re);Qe.tile=H,t.push(Qe)}}},ms.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ms.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ms.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=en(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ms.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ms.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],P=t[b];if(S&&P&&Object.keys(P).length!==0){y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=o&&o.style&&o.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}}},ms.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ms.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Wi.now()},ms.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ms.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Wi.now()+t},ms.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},ms.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var qc=ae.performance,Pv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},qc.mark(this._marks.start)};Pv.prototype.finish=function(){qc.mark(this._marks.end);var t=qc.getEntriesByName(this._marks.measure);return t.length===0&&(qc.measure(this._marks.measure,this._marks.start,this._marks.end),t=qc.getEntriesByName(this._marks.measure),qc.clearMarks(this._marks.start),qc.clearMarks(this._marks.end),qc.clearMeasures(this._marks.measure)),t},m.Actor=va,m.AlphaImage=eu,m.CanonicalTileID=Df,m.CollisionBoxArray=h,m.Color=Ui,m.DEMData=ql,m.DataConstantProperty=In,m.DictionaryCoder=ad,m.EXTENT=8192,m.ErrorEvent=He,m.EvaluationParameters=Pi,m.Event=Ie,m.Evented=at,m.FeatureIndex=Yc,m.FillBucket=Vs,m.FillExtrusionBucket=hl,m.ImageAtlas=Cr,m.ImagePosition=ct,m.LineBucket=da,m.LngLat=aa,m.LngLatBounds=ka,m.MercatorCoordinate=yc,m.ONE_EM=24,m.OverscaledTileID=Jo,m.Point=ue,m.Point$1=ue,m.Properties=Ko,m.Protobuf=uh,m.RGBAImage=No,m.RequestManager=Ii,m.RequestPerformance=Pv,m.ResourceType=an,m.SegmentVector=he,m.SourceFeatureState=lh,m.StructArrayLayout1ui2=Oh,m.StructArrayLayout2f1f2i16=Cl,m.StructArrayLayout2i4=ol,m.StructArrayLayout3ui6=Al,m.StructArrayLayout4i8=$s,m.SymbolBucket=Ne,m.Texture=dn,m.Tile=ms,m.Transitionable=no,m.Uniform1f=lr,m.Uniform1i=mr,m.Uniform2f=Mr,m.Uniform3f=tn,m.Uniform4f=Ln,m.UniformColor=kn,m.UniformMatrix4f=Oi,m.UnwrappedTileID=Mv,m.ValidationError=Be,m.WritingMode=zr,m.ZoomHistory=Kf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ve,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(S,P){o(S,function(k,z){k&&(b=k),y[P]=z,--p==0&&u(b,y)})})},m.bezier=ke,m.bindAll=tr,m.browser=Wi,m.cacheEntryPossiblyAdded=function(t){++li>Tr&&(t.getActor().send("enforceCacheSizeLimit",ir),li=0)},m.clamp=Gt,m.clearTileCache=function(t){var o=ae.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=_o,m.clone=function(t){var o=new Di(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=rt,m.clone$2=function(t){var o=new Di(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=zd,m.config=Zn,m.create=function(){var t=new Di(16);return Di!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new Di(9);return Di!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new Di(4);return Di!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=ve,m.createExpression=Ru,m.createLayout=La,m.createStyleLayer=function(t){return t.type==="custom"?new Ur(t):new nn[t.type](t)},m.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=u[0],P=u[1],k=u[2];return t[0]=y*k-b*P,t[1]=b*S-p*k,t[2]=p*P-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=st,m.emitValidationErrors=uc,m.endsWith=q,m.enforceCacheSizeLimit=function(t){I(),Xi&&Xi.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},m.evaluateSizeForFeature=Qn,m.evaluateSizeForZoom=fi,m.evaluateVariableOffset=pl,m.evented=Qf,m.extend=Pt,m.featureFilter=Fc,m.filterObject=_t,m.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Jr,m.getAnchorJustification=Me,m.getArrayBuffer=wa,m.getImage=$,m.getJSON=function(t,o){return fa(Pt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Ph,m.getReferrer=wi,m.getVideo=function(t,o){var u,p,y=ae.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=ae.document.createElement("source");u=t[b],p=void 0,(p=ae.document.createElement("a")).href=u,(p.protocol!==ae.document.location.protocol||p.host!==ae.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=js,m.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],S=o[4],P=o[5],k=o[6],z=o[7],Z=o[8],H=o[9],ee=o[10],ie=o[11],Pe=o[12],Re=o[13],Qe=o[14],Ce=o[15],Ge=u*P-p*S,Ct=u*k-y*S,Xt=u*z-b*S,Yt=p*k-y*P,fr=p*z-b*P,kr=y*z-b*k,Qr=Z*Re-H*Pe,zn=Z*Qe-ee*Pe,vn=Z*Ce-ie*Pe,jn=H*Qe-ee*Re,gn=H*Ce-ie*Re,Ri=ee*Ce-ie*Qe,ii=Ge*Ri-Ct*gn+Xt*jn+Yt*vn-fr*zn+kr*Qr;return ii?(t[0]=(P*Ri-k*gn+z*jn)*(ii=1/ii),t[1]=(y*gn-p*Ri-b*jn)*ii,t[2]=(Re*kr-Qe*fr+Ce*Yt)*ii,t[3]=(ee*fr-H*kr-ie*Yt)*ii,t[4]=(k*vn-S*Ri-z*zn)*ii,t[5]=(u*Ri-y*vn+b*zn)*ii,t[6]=(Qe*Xt-Pe*kr-Ce*Ct)*ii,t[7]=(Z*kr-ee*Xt+ie*Ct)*ii,t[8]=(S*gn-P*vn+z*Qr)*ii,t[9]=(p*vn-u*gn-b*Qr)*ii,t[10]=(Pe*fr-Re*Xt+Ce*Ge)*ii,t[11]=(H*Xt-Z*fr-ie*Ge)*ii,t[12]=(P*zn-S*jn-k*Qr)*ii,t[13]=(u*jn-p*zn+y*Qr)*ii,t[14]=(Re*Ct-Pe*Yt-Qe*Ge)*ii,t[15]=(Z*Yt-H*Ct+ee*Ge)*ii,t):null},m.isChar=qr,m.isMapboxURL=Ei,m.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},m.makeRequest=fa,m.mapObject=Jt,m.mercatorXfromLng=dl,m.mercatorYfromLat=Mu,m.mercatorZfromAltitude=_p,m.mul=Gl,m.multiply=ns,m.mvt=du,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ta,m.offscreenCanvasSupported=Hn,m.ortho=function(t,o,u,p,y,b,S){var P=1/(o-u),k=1/(p-y),z=1/(b-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*P,t[13]=(y+p)*k,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new uh(t).readFields(Rr,[])},m.pbf=uh,m.performSymbolLayout=function(t,o,u,p,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,H=Z.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Pi(Z.minZoom),S),k["text-size"].possiblyEvaluate(new Pi(H),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,ie=ee.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Pi(ee.minZoom),S),k["icon-size"].possiblyEvaluate(new Pi(ie),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new Pi(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new Pi(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new Pi(18));for(var Pe=24*P.get("text-line-height"),Re=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Qe=P.get("text-keep-upright"),Ce=P.get("text-size"),Ge=function(){var Yt=Xt[Ct],fr=P.get("text-font").evaluate(Yt,{},S).join(","),kr=Ce.evaluate(Yt,{},S),Qr=z.layoutTextSize.evaluate(Yt,{},S),zn=z.layoutIconSize.evaluate(Yt,{},S),vn={horizontal:{},vertical:void 0},jn=Yt.text,gn=[0,0];if(jn){var Ri=jn.toString(),ii=24*P.get("text-letter-spacing").evaluate(Yt,{},S),Mn=function(Ki){for(var Na=0,Pa=Ki;Na<Pa.length;Na+=1)if(oa=Pa[Na].charCodeAt(0),qr.Arabic(oa)||qr["Arabic Supplement"](oa)||qr["Arabic Extended-A"](oa)||qr["Arabic Presentation Forms-A"](oa)||qr["Arabic Presentation Forms-B"](oa))return!1;var oa;return!0}(Ri)?ii:0,Vi=P.get("text-anchor").evaluate(Yt,{},S),bi=P.get("text-variable-anchor");if(!bi){var ra=P.get("text-radial-offset").evaluate(Yt,{},S);gn=ra?pl(Vi,[24*ra,xo]):P.get("text-offset").evaluate(Yt,{},S).map(function(Ki){return 24*Ki})}var Vn=Re?"center":P.get("text-justify").evaluate(Yt,{},S),ma=P.get("symbol-placement"),oo=ma==="point"?24*P.get("text-max-width").evaluate(Yt,{},S):0,Oo=function(){t.allowVerticalPlacement&&mf(Ri)&&(vn.vertical=Kr(jn,o,u,y,fr,oo,Pe,Vi,"left",Mn,gn,zr.vertical,!0,ma,Qr,kr))};if(!Re&&bi){for(var bo=Vn==="auto"?bi.map(function(Ki){return Me(Ki)}):[Vn],so=!1,Ro=0;Ro<bo.length;Ro++){var gs=bo[Ro];if(!vn.horizontal[gs])if(so)vn.horizontal[gs]=vn.horizontal[0];else{var ys=Kr(jn,o,u,y,fr,oo,Pe,"center",gs,Mn,gn,zr.horizontal,!1,ma,Qr,kr);ys&&(vn.horizontal[gs]=ys,so=ys.positionedLines.length===1)}}Oo()}else{Vn==="auto"&&(Vn=Me(Vi));var tu=Kr(jn,o,u,y,fr,oo,Pe,Vi,Vn,Mn,gn,zr.horizontal,!1,ma,Qr,kr);tu&&(vn.horizontal[Vn]=tu),Oo(),mf(Ri)&&Re&&Qe&&(vn.vertical=Kr(jn,o,u,y,fr,oo,Pe,Vi,Vn,Mn,gn,zr.vertical,!1,ma,Qr,kr))}}var Es=void 0,Ss=!1;if(Yt.icon&&Yt.icon.name){var Vo=p[Yt.icon.name];Vo&&(Es=function(Ki,Na,Pa){var oa=Jr(Pa),vu=Na[0]-Ki.displaySize[0]*oa.horizontalAlign,Hs=Na[1]-Ki.displaySize[1]*oa.verticalAlign;return{image:Ki,top:Hs,bottom:Hs+Ki.displaySize[1],left:vu,right:vu+Ki.displaySize[0]}}(y[Yt.icon.name],P.get("icon-offset").evaluate(Yt,{},S),P.get("icon-anchor").evaluate(Yt,{},S)),Ss=Vo.sdf,t.sdfIcons===void 0?t.sdfIcons=Vo.sdf:t.sdfIcons!==Vo.sdf&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Vo.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Cs=wt(vn.horizontal)||vn.vertical;t.iconsInText=!!Cs&&Cs.iconsInText,(Cs||Es)&&function(Ki,Na,Pa,oa,vu,Hs,to,es,Ws,ga,Kc){var mu=Hs.textMaxSize.evaluate(Na,{});mu===void 0&&(mu=to);var _c,Eo=Ki.layers[0].layout,Kl=Eo.get("icon-offset").evaluate(Na,{},Kc),Os=wt(Pa.horizontal),Il=to/24,Ff=Ki.tilePixelRatio*Il,ch=Ki.tilePixelRatio*mu/24,xc=Ki.tilePixelRatio*es,Bf=Ki.tilePixelRatio*Eo.get("symbol-spacing"),bp=Eo.get("text-padding")*Ki.tilePixelRatio,jh=Eo.get("icon-padding")*Ki.tilePixelRatio,Ep=Eo.get("text-max-angle")/180*Math.PI,ud=Eo.get("text-rotation-alignment")==="map"&&Eo.get("symbol-placement")!=="point",Nf=Eo.get("icon-rotation-alignment")==="map"&&Eo.get("symbol-placement")!=="point",Lo=Eo.get("symbol-placement"),Vh=Bf/2,fh=Eo.get("icon-text-fit");oa&&fh!=="none"&&(Ki.allowVerticalPlacement&&Pa.vertical&&(_c=ni(oa,Pa.vertical,fh,Eo.get("icon-text-fit-padding"),Kl,Il)),Os&&(oa=ni(oa,Os,fh,Eo.get("icon-text-fit-padding"),Kl,Il)));var $c=function(Iv,Wh){Wh.x<0||Wh.x>=8192||Wh.y<0||Wh.y>=8192||function(uo,$l,D0,Jc,pd,Gd,Ip,Ql,Zf,Xh,Op,Rp,Hd,Ov,Yh,Rv,vh,Lv,bc,kv,Gu,dd,qh,Jl,Dv){var Wd,ef,mh,gh,tf,Lp=uo.addToLineVertexArray($l,D0),Fv=0,Bv=0,Xd=0,Nv=0,vd=-1,md=-1,Ec={},Yd=we(""),gd=0,yd=0;if(Ql._unevaluatedLayout.getValue("text-radial-offset")===void 0?(gd=(Wd=Ql.layout.get("text-offset").evaluate(Gu,{},Jl).map(function($h){return 24*$h}))[0],yd=Wd[1]):(gd=24*Ql.layout.get("text-radial-offset").evaluate(Gu,{},Jl),yd=xo),uo.allowVerticalPlacement&&Jc.vertical){var qd=Ql.layout.get("text-rotate").evaluate(Gu,{},Jl)+90;gh=new Io(Zf,$l,Xh,Op,Rp,Jc.vertical,Hd,Ov,Yh,qd),Ip&&(tf=new Io(Zf,$l,Xh,Op,Rp,Ip,vh,Lv,Yh,qd))}if(pd){var _d=Ql.layout.get("icon-rotate").evaluate(Gu,{}),Kd=Ql.layout.get("icon-text-fit")!=="none",$d=jo(pd,_d,qh,Kd),xd=Ip?jo(Ip,_d,qh,Kd):void 0;mh=new Io(Zf,$l,Xh,Op,Rp,pd,vh,Lv,!1,_d),Fv=4*$d.length;var Qd=uo.iconSizeData,Kh=null;Qd.kind==="source"?(Kh=[128*Ql.layout.get("icon-size").evaluate(Gu,{})])[0]>32640&&tt(uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Qd.kind==="composite"&&((Kh=[128*dd.compositeIconSizes[0].evaluate(Gu,{},Jl),128*dd.compositeIconSizes[1].evaluate(Gu,{},Jl)])[0]>32640||Kh[1]>32640)&&tt(uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),uo.addSymbols(uo.icon,$d,Kh,kv,bc,Gu,!1,$l,Lp.lineStartIndex,Lp.lineLength,-1,Jl),vd=uo.icon.placedSymbolArray.length-1,xd&&(Bv=4*xd.length,uo.addSymbols(uo.icon,xd,Kh,kv,bc,Gu,zr.vertical,$l,Lp.lineStartIndex,Lp.lineLength,-1,Jl),md=uo.icon.placedSymbolArray.length-1)}for(var Jd in Jc.horizontal){var kp=Jc.horizontal[Jd];if(!ef){Yd=we(kp.text);var zv=Ql.layout.get("text-rotate").evaluate(Gu,{},Jl);ef=new Io(Zf,$l,Xh,Op,Rp,kp,Hd,Ov,Yh,zv)}var ev=kp.positionedLines.length===1;if(Xd+=Ut(uo,$l,kp,Gd,Ql,Yh,Gu,Rv,Lp,Jc.vertical?zr.horizontal:zr.horizontalOnly,ev?Object.keys(Jc.horizontal):[Jd],Ec,vd,dd,Jl),ev)break}Jc.vertical&&(Nv+=Ut(uo,$l,Jc.vertical,Gd,Ql,Yh,Gu,Rv,Lp,zr.vertical,["vertical"],Ec,md,dd,Jl));var ru=ef?ef.boxStartIndex:uo.collisionBoxArray.length,Uv=ef?ef.boxEndIndex:uo.collisionBoxArray.length,Zv=gh?gh.boxStartIndex:uo.collisionBoxArray.length,jv=gh?gh.boxEndIndex:uo.collisionBoxArray.length,Vv=mh?mh.boxStartIndex:uo.collisionBoxArray.length,Gv=mh?mh.boxEndIndex:uo.collisionBoxArray.length,Hv=tf?tf.boxStartIndex:uo.collisionBoxArray.length,Wv=tf?tf.boxEndIndex:uo.collisionBoxArray.length,ec=-1,Dp=function($h,rv){return $h&&$h.circleDiameter?Math.max($h.circleDiameter,rv):rv};ec=Dp(ef,ec),ec=Dp(gh,ec),ec=Dp(mh,ec);var tv=(ec=Dp(tf,ec))>-1?1:0;tv&&(ec*=Dv/24),uo.glyphOffsetArray.length>=Ne.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gu.sortKey!==void 0&&uo.addToSortKeyRanges(uo.symbolInstances.length,Gu.sortKey),uo.symbolInstances.emplaceBack($l.x,$l.y,Ec.right>=0?Ec.right:-1,Ec.center>=0?Ec.center:-1,Ec.left>=0?Ec.left:-1,Ec.vertical||-1,vd,md,Yd,ru,Uv,Zv,jv,Vv,Gv,Hv,Wv,Xh,Xd,Nv,Fv,Bv,tv,0,Hd,gd,yd,ec)}(Ki,Wh,Iv,Pa,oa,vu,_c,Ki.layers[0],Ki.collisionBoxArray,Na.index,Na.sourceLayerIndex,Ki.index,Ff,bp,ud,Ws,xc,jh,Nf,Kl,Na,Hs,ga,Kc,to)};if(Lo==="line")for(var zf=0,Sp=_o(Na.geometry,0,0,8192,8192);zf<Sp.length;zf+=1)for(var ld=Sp[zf],Cp=0,Ap=Zo(ld,Bf,Ep,Pa.vertical||Os,oa,24,ch,Ki.overscaling,8192);Cp<Ap.length;Cp+=1){var cd=Ap[Cp];Os&&cn(Ki,Os.text,Vh,cd)||$c(ld,cd)}else if(Lo==="line-center")for(var wp=0,Tp=Na.geometry;wp<Tp.length;wp+=1){var Mp=Tp[wp];if(Mp.length>1){var W=Ba(Mp,Ep,Pa.vertical||Os,oa,24,ch);W&&$c(Mp,W)}}else if(Na.type==="Polygon")for(var hh=0,Pp=wf(Na.geometry,0);hh<Pp.length;hh+=1){var ph=Pp[hh],Gh=hn(ph,16);$c(ph[0],new Wr(Gh.x,Gh.y,0))}else if(Na.type==="LineString")for(var Uf=0,Hh=Na.geometry;Uf<Hh.length;Uf+=1){var dh=Hh[Uf];$c(dh,new Wr(dh[0].x,dh[0].y,0))}else if(Na.type==="Point")for(var Qc=0,jd=Na.geometry;Qc<jd.length;Qc+=1)for(var fd=0,Vd=jd[Qc];fd<Vd.length;fd+=1){var hd=Vd[fd];$c([hd],new Wr(hd.x,hd.y,0))}}(t,Yt,vn,Es,p,z,Qr,zn,gn,Ss,S)},Ct=0,Xt=t.features;Ct<Xt.length;Ct+=1)Ge();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,p,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},m.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},m.plugin=Ts,m.polygonIntersectsPolygon=Au,m.postMapLoadEvent=jt,m.postTurnstileEvent=Ua,m.potpack=Pr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=mn,m.registerForPluginStateChange=function(t){return t({pluginStatus:ws,pluginURL:mo}),Qf.on("pluginStateChange",t),t},m.renderColorRamp=eh,m.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],P=Math.sin(u),k=Math.cos(u);return t[0]=p*k+b*P,t[1]=y*k+S*P,t[2]=p*-P+b*k,t[3]=y*-P+S*k,t},m.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],P=o[6],k=o[7],z=o[8],Z=o[9],H=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*p,t[5]=S*y+Z*p,t[6]=P*y+H*p,t[7]=k*y+ee*p,t[8]=z*y-b*p,t[9]=Z*y-S*p,t[10]=H*y-P*p,t[11]=ee*y-k*p,t},m.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],P=o[2],k=o[3],z=o[4],Z=o[5],H=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*p,t[1]=S*y+Z*p,t[2]=P*y+H*p,t[3]=k*y+ee*p,t[4]=z*y-b*p,t[5]=Z*y-S*p,t[6]=H*y-P*p,t[7]=ee*y-k*p,t},m.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){ir=t,Tr=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),ws==="deferred"||ws==="loading"||ws==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");mo=Wi.resolveURL(t),ws="deferred",Du=o,pa(),u||Ks()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=fe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Fi,m.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Uc,m.translate=function(t,o,u){var p,y,b,S,P,k,z,Z,H,ee,ie,Pe,Re=u[0],Qe=u[1],Ce=u[2];return o===t?(t[12]=o[0]*Re+o[4]*Qe+o[8]*Ce+o[12],t[13]=o[1]*Re+o[5]*Qe+o[9]*Ce+o[13],t[14]=o[2]*Re+o[6]*Qe+o[10]*Ce+o[14],t[15]=o[3]*Re+o[7]*Qe+o[11]*Ce+o[15]):(y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],H=o[8],ee=o[9],ie=o[10],Pe=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=P,t[5]=k,t[6]=z,t[7]=Z,t[8]=H,t[9]=ee,t[10]=ie,t[11]=Pe,t[12]=p*Re+P*Qe+H*Ce+o[12],t[13]=y*Re+k*Qe+ee*Ce+o[13],t[14]=b*Re+z*Qe+ie*Ce+o[14],t[15]=S*Re+Z*Qe+Pe*Ce+o[15]),t},m.triggerPluginCompletionEvent=Mh,m.uniqueId=Lt,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=up,m.validateStyle=vf,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=du,m.version="1.13.2",m.warnOnce=tt,m.webpSupported=Gn,m.window=ae,m.wrap=sr}),ye(["./shared"],function(m){"use strict";function ve(G){var $=typeof G;if($==="number"||$==="boolean"||$==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ne="[",ge=0,Ie=G;ge<Ie.length;ge+=1)ne+=ve(Ie[ge])+",";return ne+"]"}for(var He=Object.keys(G).sort(),at="{",fe=0;fe<He.length;fe++)at+=JSON.stringify(He[fe])+":"+ve(G[He[fe]])+",";return at+"}"}function j(G){for(var $="",ne=0,ge=m.refProperties;ne<ge.length;ne+=1)$+="/"+ve(G[ge[ne]]);return $}var ce=function(G){this.keyCache={},G&&this.replace(G)};ce.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},ce.prototype.update=function(G,$){for(var ne=this,ge=0,Ie=G;ge<Ie.length;ge+=1){var He=Ie[ge];this._layerConfigs[He.id]=He;var at=this._layers[He.id]=m.createStyleLayer(He);at._featureFilter=m.featureFilter(at.filter),this.keyCache[He.id]&&delete this.keyCache[He.id]}for(var fe=0,Be=$;fe<Be.length;fe+=1){var yt=Be[fe];delete this.keyCache[yt],delete this._layerConfigs[yt],delete this._layers[yt]}this.familiesBySource={};for(var vr=0,Bt=function(jr,Hr){for(var ai={},rn=0;rn<jr.length;rn++){var Ci=Hr&&Hr[jr[rn].id]||j(jr[rn]);Hr&&(Hr[jr[rn].id]=Ci);var $i=ai[Ci];$i||($i=ai[Ci]=[]),$i.push(jr[rn])}var yi=[];for(var Ti in ai)yi.push(ai[Ti]);return yi}(m.values(this._layerConfigs),this.keyCache);vr<Bt.length;vr+=1){var zt=Bt[vr].map(function(jr){return ne._layers[jr.id]}),gr=zt[0];if(gr.visibility!=="none"){var bn=gr.source||"",ln=this.familiesBySource[bn];ln||(ln=this.familiesBySource[bn]={});var Rt=gr.sourceLayer||"_geojsonTileLayer",un=ln[Rt];un||(un=ln[Rt]=[]),un.push(zt)}}};var ue=function(G){var $={},ne=[];for(var ge in G){var Ie=G[ge],He=$[ge]={};for(var at in Ie){var fe=Ie[+at];if(fe&&fe.bitmap.width!==0&&fe.bitmap.height!==0){var Be={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};ne.push(Be),He[at]={rect:Be,metrics:fe.metrics}}}}var yt=m.potpack(ne),vr=new m.AlphaImage({width:yt.w||1,height:yt.h||1});for(var Bt in G){var zt=G[Bt];for(var gr in zt){var bn=zt[+gr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var ln=$[Bt][gr].rect;m.AlphaImage.copy(bn.bitmap,vr,{x:0,y:0},{x:ln.x+1,y:ln.y+1},bn.bitmap)}}}this.image=vr,this.positions=$};m.register("GlyphAtlas",ue);var ze=function(G){this.tileID=new m.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ae(G,$,ne){for(var ge=new m.EvaluationParameters($),Ie=0,He=G;Ie<He.length;Ie+=1)He[Ie].recalculate(ge,ne)}function nt(G,$){var ne=m.getArrayBuffer(G.request,function(ge,Ie,He,at){ge?$(ge):Ie&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Ie)),rawData:Ie,cacheControl:He,expires:at})});return function(){ne.cancel(),$()}}ze.prototype.parse=function(G,$,ne,ge,Ie){var He=this;this.status="parsing",this.data=G,this.collisionBoxArray=new m.CollisionBoxArray;var at=new m.DictionaryCoder(Object.keys(G.layers).sort()),fe=new m.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];var Be,yt,vr,Bt,zt={},gr={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},bn=$.familiesBySource[this.source];for(var ln in bn){var Rt=G.layers[ln];if(Rt){Rt.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var un=at.encode(ln),jr=[],Hr=0;Hr<Rt.length;Hr++){var ai=Rt.feature(Hr),rn=fe.getId(ai,ln);jr.push({feature:ai,id:rn,index:Hr,sourceLayerIndex:un})}for(var Ci=0,$i=bn[ln];Ci<$i.length;Ci+=1){var yi=$i[Ci],Ti=yi[0];Ti.minzoom&&this.zoom<Math.floor(Ti.minzoom)||Ti.maxzoom&&this.zoom>=Ti.maxzoom||Ti.visibility!=="none"&&(ae(yi,this.zoom,ne),(zt[Ti.id]=Ti.createBucket({index:fe.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source})).populate(jr,gr,this.tileID.canonical),fe.bucketLayerIDs.push(yi.map(function(ea){return ea.id})))}}}var xi=m.mapObject(gr.glyphDependencies,function(ea){return Object.keys(ea).map(Number)});Object.keys(xi).length?ge.send("getGlyphs",{uid:this.uid,stacks:xi},function(ea,Mi){Be||(Be=ea,yt=Mi,Ta.call(He))}):yt={};var ei=Object.keys(gr.iconDependencies);ei.length?ge.send("getImages",{icons:ei,source:this.source,tileID:this.tileID,type:"icons"},function(ea,Mi){Be||(Be=ea,vr=Mi,Ta.call(He))}):vr={};var Gi=Object.keys(gr.patternDependencies);function Ta(){if(Be)return Ie(Be);if(yt&&vr&&Bt){var ea=new ue(yt),Mi=new m.ImageAtlas(vr,Bt);for(var Ui in zt){var Oa=zt[Ui];Oa instanceof m.SymbolBucket?(ae(Oa.layers,this.zoom,ne),m.performSymbolLayout(Oa,yt,ea.positions,vr,Mi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Oa.hasPattern&&(Oa instanceof m.LineBucket||Oa instanceof m.FillBucket||Oa instanceof m.FillExtrusionBucket)&&(ae(Oa.layers,this.zoom,ne),Oa.addFeatures(gr,this.tileID.canonical,Mi.patternPositions))}this.status="done",Ie(null,{buckets:m.values(zt).filter(function(au){return!au.isEmpty()}),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ea.image,imageAtlas:Mi,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?vr:null,glyphPositions:this.returnDependencies?ea.positions:null})}}Gi.length?ge.send("getImages",{icons:Gi,source:this.source,tileID:this.tileID,type:"patterns"},function(ea,Mi){Be||(Be=ea,Bt=Mi,Ta.call(He))}):Bt={},Ta.call(this)};var ke=function(G,$,ne,ge){this.actor=G,this.layerIndex=$,this.availableImages=ne,this.loadVectorData=ge||nt,this.loading={},this.loaded={}};ke.prototype.loadTile=function(G,$){var ne=this,ge=G.uid;this.loading||(this.loading={});var Ie=!!(G&&G.request&&G.request.collectResourceTiming)&&new m.RequestPerformance(G.request),He=this.loading[ge]=new ze(G);He.abort=this.loadVectorData(G,function(at,fe){if(delete ne.loading[ge],at||!fe)return He.status="done",ne.loaded[ge]=He,$(at);var Be=fe.rawData,yt={};fe.expires&&(yt.expires=fe.expires),fe.cacheControl&&(yt.cacheControl=fe.cacheControl);var vr={};if(Ie){var Bt=Ie.finish();Bt&&(vr.resourceTiming=JSON.parse(JSON.stringify(Bt)))}He.vectorTile=fe.vectorTile,He.parse(fe.vectorTile,ne.layerIndex,ne.availableImages,ne.actor,function(zt,gr){if(zt||!gr)return $(zt);$(null,m.extend({rawTileData:Be.slice(0)},gr,yt,vr))}),ne.loaded=ne.loaded||{},ne.loaded[ge]=He})},ke.prototype.reloadTile=function(G,$){var ne=this,ge=this.loaded,Ie=G.uid,He=this;if(ge&&ge[Ie]){var at=ge[Ie];at.showCollisionBoxes=G.showCollisionBoxes;var fe=function(Be,yt){var vr=at.reloadCallback;vr&&(delete at.reloadCallback,at.parse(at.vectorTile,He.layerIndex,ne.availableImages,He.actor,vr)),$(Be,yt)};at.status==="parsing"?at.reloadCallback=fe:at.status==="done"&&(at.vectorTile?at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}},ke.prototype.abortTile=function(G,$){var ne=this.loading,ge=G.uid;ne&&ne[ge]&&ne[ge].abort&&(ne[ge].abort(),delete ne[ge]),$()},ke.prototype.removeTile=function(G,$){var ne=this.loaded,ge=G.uid;ne&&ne[ge]&&delete ne[ge],$()};var st=m.window.ImageBitmap,Gt=function(){this.loaded={}};function sr(G,$){if(G.length!==0){Pt(G[0],$);for(var ne=1;ne<G.length;ne++)Pt(G[ne],!$)}}function Pt(G,$){for(var ne=0,ge=0,Ie=G.length,He=Ie-1;ge<Ie;He=ge++)ne+=(G[ge][0]-G[He][0])*(G[He][1]+G[ge][1]);ne>=0!=!!$&&G.reverse()}Gt.prototype.loadTile=function(G,$){var ne=G.uid,ge=G.encoding,Ie=G.rawImageData,He=st&&Ie instanceof st?this.getImageData(Ie):Ie,at=new m.DEMData(ne,He,ge);this.loaded=this.loaded||{},this.loaded[ne]=at,$(null,at)},Gt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},Gt.prototype.removeTile=function(G){var $=this.loaded,ne=G.uid;$&&$[ne]&&delete $[ne]};var er=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Lt=function(G){this._feature=G,this.extent=m.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Lt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],$=0,ne=this._feature.geometry;$<ne.length;$+=1){var ge=ne[$];G.push([new m.Point$1(ge[0],ge[1])])}return G}for(var Ie=[],He=0,at=this._feature.geometry;He<at.length;He+=1){for(var fe=[],Be=0,yt=at[He];Be<yt.length;Be+=1){var vr=yt[Be];fe.push(new m.Point$1(vr[0],vr[1]))}Ie.push(fe)}return Ie},Lt.prototype.toGeoJSON=function(G,$,ne){return er.call(this,G,$,ne)};var ht=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=G.length,this._features=G};ht.prototype.feature=function(G){return new Lt(this._features[G])};var mt=m.vectorTile.VectorTileFeature,tr=q;function q(G,$){this.options=$||{},this.features=G,this.length=G.length}function Jt(G,$){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=$||4096}q.prototype.feature=function(G){return new Jt(this.features[G],this.options.extent)},Jt.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var $=0;$<G.length;$++){for(var ne=G[$],ge=[],Ie=0;Ie<ne.length;Ie++)ge.push(new m.Point$1(ne[Ie][0],ne[Ie][1]));this.geometry.push(ge)}return this.geometry},Jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,$=1/0,ne=-1/0,ge=1/0,Ie=-1/0,He=0;He<G.length;He++)for(var at=G[He],fe=0;fe<at.length;fe++){var Be=at[fe];$=Math.min($,Be.x),ne=Math.max(ne,Be.x),ge=Math.min(ge,Be.y),Ie=Math.max(Ie,Be.y)}return[$,ge,ne,Ie]},Jt.prototype.toGeoJSON=mt.prototype.toGeoJSON;var _t=At,rt=tr;function At(G){var $=new m.pbf;return function(ne,ge){for(var Ie in ne.layers)ge.writeMessage(3,tt,ne.layers[Ie])}(G,$),$.finish()}function tt(G,$){var ne;$.writeVarintField(15,G.version||1),$.writeStringField(1,G.name||""),$.writeVarintField(5,G.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<G.length;ne++)ge.feature=G.feature(ne),$.writeMessage(2,$t,ge);var Ie=ge.keys;for(ne=0;ne<Ie.length;ne++)$.writeStringField(3,Ie[ne]);var He=ge.values;for(ne=0;ne<He.length;ne++)$.writeMessage(4,Ke,He[ne])}function $t(G,$){var ne=G.feature;ne.id!==void 0&&$.writeVarintField(1,ne.id),$.writeMessage(2,br,G),$.writeVarintField(3,ne.type),$.writeMessage(4,Te,ne)}function br(G,$){var ne=G.feature,ge=G.keys,Ie=G.values,He=G.keycache,at=G.valuecache;for(var fe in ne.properties){var Be=He[fe];Be===void 0&&(ge.push(fe),He[fe]=Be=ge.length-1),$.writeVarint(Be);var yt=ne.properties[fe],vr=typeof yt;vr!=="string"&&vr!=="boolean"&&vr!=="number"&&(yt=JSON.stringify(yt));var Bt=vr+":"+yt,zt=at[Bt];zt===void 0&&(Ie.push(yt),at[Bt]=zt=Ie.length-1),$.writeVarint(zt)}}function Fr(G,$){return($<<3)+(7&G)}function en(G){return G<<1^G>>31}function Te(G,$){for(var ne=G.loadGeometry(),ge=G.type,Ie=0,He=0,at=ne.length,fe=0;fe<at;fe++){var Be=ne[fe],yt=1;ge===1&&(yt=Be.length),$.writeVarint(Fr(1,yt));for(var vr=ge===3?Be.length-1:Be.length,Bt=0;Bt<vr;Bt++){Bt===1&&ge!==1&&$.writeVarint(Fr(2,vr-1));var zt=Be[Bt].x-Ie,gr=Be[Bt].y-He;$.writeVarint(en(zt)),$.writeVarint(en(gr)),Ie+=zt,He+=gr}ge===3&&$.writeVarint(Fr(7,1))}}function Ke(G,$){var ne=typeof G;ne==="string"?$.writeStringField(1,G):ne==="boolean"?$.writeBooleanField(7,G):ne==="number"&&(G%1!=0?$.writeDoubleField(3,G):G<0?$.writeSVarintField(6,G):$.writeVarintField(5,G))}function Fe(G,$,ne,ge){Mt(G,ne,ge),Mt($,2*ne,2*ge),Mt($,2*ne+1,2*ge+1)}function Mt(G,$,ne){var ge=G[$];G[$]=G[ne],G[ne]=ge}function gt(G,$,ne,ge){var Ie=G-ne,He=$-ge;return Ie*Ie+He*He}_t.fromVectorTileJs=At,_t.fromGeojsonVt=function(G,$){$=$||{};var ne={};for(var ge in G)ne[ge]=new tr(G[ge].features,$),ne[ge].name=ge,ne[ge].version=$.version,ne[ge].extent=$.extent;return At({layers:ne})},_t.GeoJSONWrapper=rt;var Zt=function(G){return G[0]},qt=function(G){return G[1]},Er=function(G,$,ne,ge,Ie){$===void 0&&($=Zt),ne===void 0&&(ne=qt),ge===void 0&&(ge=64),Ie===void 0&&(Ie=Float64Array),this.nodeSize=ge,this.points=G;for(var He=G.length<65536?Uint16Array:Uint32Array,at=this.ids=new He(G.length),fe=this.coords=new Ie(2*G.length),Be=0;Be<G.length;Be++)at[Be]=Be,fe[2*Be]=$(G[Be]),fe[2*Be+1]=ne(G[Be]);(function yt(vr,Bt,zt,gr,bn,ln){if(!(bn-gr<=zt)){var Rt=gr+bn>>1;(function un(jr,Hr,ai,rn,Ci,$i){for(;Ci>rn;){if(Ci-rn>600){var yi=Ci-rn+1,Ti=ai-rn+1,xi=Math.log(yi),ei=.5*Math.exp(2*xi/3),Gi=.5*Math.sqrt(xi*ei*(yi-ei)/yi)*(Ti-yi/2<0?-1:1);un(jr,Hr,ai,Math.max(rn,Math.floor(ai-Ti*ei/yi+Gi)),Math.min(Ci,Math.floor(ai+(yi-Ti)*ei/yi+Gi)),$i)}var Ta=Hr[2*ai+$i],ea=rn,Mi=Ci;for(Fe(jr,Hr,rn,ai),Hr[2*Ci+$i]>Ta&&Fe(jr,Hr,rn,Ci);ea<Mi;){for(Fe(jr,Hr,ea,Mi),ea++,Mi--;Hr[2*ea+$i]<Ta;)ea++;for(;Hr[2*Mi+$i]>Ta;)Mi--}Hr[2*rn+$i]===Ta?Fe(jr,Hr,rn,Mi):Fe(jr,Hr,++Mi,Ci),Mi<=ai&&(rn=Mi+1),ai<=Mi&&(Ci=Mi-1)}})(vr,Bt,Rt,gr,bn,ln%2),yt(vr,Bt,zt,gr,Rt-1,ln+1),yt(vr,Bt,zt,Rt+1,bn,ln+1)}})(at,fe,ge,0,at.length-1,0)};Er.prototype.range=function(G,$,ne,ge){return function(Ie,He,at,fe,Be,yt,vr){for(var Bt,zt,gr=[0,Ie.length-1,0],bn=[];gr.length;){var ln=gr.pop(),Rt=gr.pop(),un=gr.pop();if(Rt-un<=vr)for(var jr=un;jr<=Rt;jr++)zt=He[2*jr+1],(Bt=He[2*jr])>=at&&Bt<=Be&&zt>=fe&&zt<=yt&&bn.push(Ie[jr]);else{var Hr=Math.floor((un+Rt)/2);zt=He[2*Hr+1],(Bt=He[2*Hr])>=at&&Bt<=Be&&zt>=fe&&zt<=yt&&bn.push(Ie[Hr]);var ai=(ln+1)%2;(ln===0?at<=Bt:fe<=zt)&&(gr.push(un),gr.push(Hr-1),gr.push(ai)),(ln===0?Be>=Bt:yt>=zt)&&(gr.push(Hr+1),gr.push(Rt),gr.push(ai))}}return bn}(this.ids,this.coords,G,$,ne,ge,this.nodeSize)},Er.prototype.within=function(G,$,ne){return function(ge,Ie,He,at,fe,Be){for(var yt=[0,ge.length-1,0],vr=[],Bt=fe*fe;yt.length;){var zt=yt.pop(),gr=yt.pop(),bn=yt.pop();if(gr-bn<=Be)for(var ln=bn;ln<=gr;ln++)gt(Ie[2*ln],Ie[2*ln+1],He,at)<=Bt&&vr.push(ge[ln]);else{var Rt=Math.floor((bn+gr)/2),un=Ie[2*Rt],jr=Ie[2*Rt+1];gt(un,jr,He,at)<=Bt&&vr.push(ge[Rt]);var Hr=(zt+1)%2;(zt===0?He-fe<=un:at-fe<=jr)&&(yt.push(bn),yt.push(Rt-1),yt.push(Hr)),(zt===0?He+fe>=un:at+fe>=jr)&&(yt.push(Rt+1),yt.push(gr),yt.push(Hr))}}return vr}(this.ids,this.coords,G,$,ne,this.nodeSize)};var Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},pn=function(G){this.options=Ji(Object.create(Kn),G),this.trees=new Array(this.options.maxZoom+1)};function Wi(G,$,ne,ge,Ie){return{x:G,y:$,zoom:1/0,id:ne,parentId:-1,numPoints:ge,properties:Ie}}function Zn(G,$){var ne=G.geometry.coordinates,ge=ne[1];return{x:$n(ne[0]),y:ui(ge),zoom:1/0,index:$,parentId:-1}}function Gn(G){return{type:"Feature",id:G.id,properties:pi(G),geometry:{type:"Point",coordinates:[(ge=G.x,360*(ge-.5)),($=G.y,ne=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(ne))/Math.PI-90)]}};var $,ne,ge}function pi(G){var $=G.numPoints,ne=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return Ji(Ji({},G.properties),{cluster:!0,cluster_id:G.id,point_count:$,point_count_abbreviated:ne})}function $n(G){return G/360+.5}function ui(G){var $=Math.sin(G*Math.PI/180),ne=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return ne<0?0:ne>1?1:ne}function Ji(G,$){for(var ne in $)G[ne]=$[ne];return G}function Ii(G){return G.x}function Ei(G){return G.y}function zi(G,$,ne,ge,Ie,He){var at=Ie-ne,fe=He-ge;if(at!==0||fe!==0){var Be=((G-ne)*at+($-ge)*fe)/(at*at+fe*fe);Be>1?(ne=Ie,ge=He):Be>0&&(ne+=at*Be,ge+=fe*Be)}return(at=G-ne)*at+(fe=$-ge)*fe}function na(G,$,ne,ge){var Ie={id:G===void 0?null:G,type:$,geometry:ne,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(He){var at=He.geometry,fe=He.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Si(He,at);else if(fe==="Polygon"||fe==="MultiLineString")for(var Be=0;Be<at.length;Be++)Si(He,at[Be]);else if(fe==="MultiPolygon")for(Be=0;Be<at.length;Be++)for(var yt=0;yt<at[Be].length;yt++)Si(He,at[Be][yt])}(Ie),Ie}function Si(G,$){for(var ne=0;ne<$.length;ne+=3)G.minX=Math.min(G.minX,$[ne]),G.minY=Math.min(G.minY,$[ne+1]),G.maxX=Math.max(G.maxX,$[ne]),G.maxY=Math.max(G.maxY,$[ne+1])}function ya(G,$,ne,ge){if($.geometry){var Ie=$.geometry.coordinates,He=$.geometry.type,at=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),fe=[],Be=$.id;if(ne.promoteId?Be=$.properties[ne.promoteId]:ne.generateId&&(Be=ge||0),He==="Point")wn(Ie,fe);else if(He==="MultiPoint")for(var yt=0;yt<Ie.length;yt++)wn(Ie[yt],fe);else if(He==="LineString")_i(Ie,fe,at,!1);else if(He==="MultiLineString"){if(ne.lineMetrics){for(yt=0;yt<Ie.length;yt++)_i(Ie[yt],fe=[],at,!1),G.push(na(Be,"LineString",fe,$.properties));return}ki(Ie,fe,at,!1)}else if(He==="Polygon")ki(Ie,fe,at,!0);else{if(He!=="MultiPolygon"){if(He==="GeometryCollection"){for(yt=0;yt<$.geometry.geometries.length;yt++)ya(G,{id:Be,geometry:$.geometry.geometries[yt],properties:$.properties},ne,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(yt=0;yt<Ie.length;yt++){var vr=[];ki(Ie[yt],vr,at,!0),fe.push(vr)}}G.push(na(Be,He,fe,$.properties))}}function wn(G,$){$.push(Xi(G[0])),$.push(za(G[1])),$.push(0)}function _i(G,$,ne,ge){for(var Ie,He,at=0,fe=0;fe<G.length;fe++){var Be=Xi(G[fe][0]),yt=za(G[fe][1]);$.push(Be),$.push(yt),$.push(0),fe>0&&(at+=ge?(Ie*yt-Be*He)/2:Math.sqrt(Math.pow(Be-Ie,2)+Math.pow(yt-He,2))),Ie=Be,He=yt}var vr=$.length-3;$[2]=1,function Bt(zt,gr,bn,ln){for(var Rt,un=ln,jr=bn-gr>>1,Hr=bn-gr,ai=zt[gr],rn=zt[gr+1],Ci=zt[bn],$i=zt[bn+1],yi=gr+3;yi<bn;yi+=3){var Ti=zi(zt[yi],zt[yi+1],ai,rn,Ci,$i);if(Ti>un)Rt=yi,un=Ti;else if(Ti===un){var xi=Math.abs(yi-jr);xi<Hr&&(Rt=yi,Hr=xi)}}un>ln&&(Rt-gr>3&&Bt(zt,gr,Rt,ln),zt[Rt+2]=un,bn-Rt>3&&Bt(zt,Rt,bn,ln))}($,0,vr,ne),$[vr+2]=1,$.size=Math.abs(at),$.start=0,$.end=$.size}function ki(G,$,ne,ge){for(var Ie=0;Ie<G.length;Ie++){var He=[];_i(G[Ie],He,ne,ge),$.push(He)}}function Xi(G){return G/360+.5}function za(G){var $=Math.sin(G*Math.PI/180),ne=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return ne<0?0:ne>1?1:ne}function de(G,$,ne,ge,Ie,He,at,fe){if(ge/=$,He>=(ne/=$)&&at<ge)return G;if(at<ne||He>=ge)return null;for(var Be=[],yt=0;yt<G.length;yt++){var vr=G[yt],Bt=vr.geometry,zt=vr.type,gr=Ie===0?vr.minX:vr.minY,bn=Ie===0?vr.maxX:vr.maxY;if(gr>=ne&&bn<ge)Be.push(vr);else if(!(bn<ne||gr>=ge)){var ln=[];if(zt==="Point"||zt==="MultiPoint")Nn(Bt,ln,ne,ge,Ie);else if(zt==="LineString")Ua(Bt,ln,ne,ge,Ie,!1,fe.lineMetrics);else if(zt==="MultiLineString")jt(Bt,ln,ne,ge,Ie,!1);else if(zt==="Polygon")jt(Bt,ln,ne,ge,Ie,!0);else if(zt==="MultiPolygon")for(var Rt=0;Rt<Bt.length;Rt++){var un=[];jt(Bt[Rt],un,ne,ge,Ie,!0),un.length&&ln.push(un)}if(ln.length){if(fe.lineMetrics&&zt==="LineString"){for(Rt=0;Rt<ln.length;Rt++)Be.push(na(vr.id,zt,ln[Rt],vr.tags));continue}zt!=="LineString"&&zt!=="MultiLineString"||(ln.length===1?(zt="LineString",ln=ln[0]):zt="MultiLineString"),zt!=="Point"&&zt!=="MultiPoint"||(zt=ln.length===3?"Point":"MultiPoint"),Be.push(na(vr.id,zt,ln,vr.tags))}}}return Be.length?Be:null}function Nn(G,$,ne,ge,Ie){for(var He=0;He<G.length;He+=3){var at=G[He+Ie];at>=ne&&at<=ge&&($.push(G[He]),$.push(G[He+1]),$.push(G[He+2]))}}function Ua(G,$,ne,ge,Ie,He,at){for(var fe,Be,yt=us(G),vr=Ie===0?Tr:I,Bt=G.start,zt=0;zt<G.length-3;zt+=3){var gr=G[zt],bn=G[zt+1],ln=G[zt+2],Rt=G[zt+3],un=G[zt+4],jr=Ie===0?gr:bn,Hr=Ie===0?Rt:un,ai=!1;at&&(fe=Math.sqrt(Math.pow(gr-Rt,2)+Math.pow(bn-un,2))),jr<ne?Hr>ne&&(Be=vr(yt,gr,bn,Rt,un,ne),at&&(yt.start=Bt+fe*Be)):jr>ge?Hr<ge&&(Be=vr(yt,gr,bn,Rt,un,ge),at&&(yt.start=Bt+fe*Be)):ir(yt,gr,bn,ln),Hr<ne&&jr>=ne&&(Be=vr(yt,gr,bn,Rt,un,ne),ai=!0),Hr>ge&&jr<=ge&&(Be=vr(yt,gr,bn,Rt,un,ge),ai=!0),!He&&ai&&(at&&(yt.end=Bt+fe*Be),$.push(yt),yt=us(G)),at&&(Bt+=fe)}var rn=G.length-3;gr=G[rn],bn=G[rn+1],ln=G[rn+2],(jr=Ie===0?gr:bn)>=ne&&jr<=ge&&ir(yt,gr,bn,ln),rn=yt.length-3,He&&rn>=3&&(yt[rn]!==yt[0]||yt[rn+1]!==yt[1])&&ir(yt,yt[0],yt[1],yt[2]),yt.length&&$.push(yt)}function us(G){var $=[];return $.size=G.size,$.start=G.start,$.end=G.end,$}function jt(G,$,ne,ge,Ie,He){for(var at=0;at<G.length;at++)Ua(G[at],$,ne,ge,Ie,He,!1)}function ir(G,$,ne,ge){G.push($),G.push(ne),G.push(ge)}function Tr(G,$,ne,ge,Ie,He){var at=(He-$)/(ge-$);return G.push(He),G.push(ne+(Ie-ne)*at),G.push(1),at}function I(G,$,ne,ge,Ie,He){var at=(He-ne)/(Ie-ne);return G.push($+(ge-$)*at),G.push(He),G.push(1),at}function nr(G,$){for(var ne=[],ge=0;ge<G.length;ge++){var Ie,He=G[ge],at=He.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")Ie=Dn(He.geometry,$);else if(at==="MultiLineString"||at==="Polygon"){Ie=[];for(var fe=0;fe<He.geometry.length;fe++)Ie.push(Dn(He.geometry[fe],$))}else if(at==="MultiPolygon")for(Ie=[],fe=0;fe<He.geometry.length;fe++){for(var Be=[],yt=0;yt<He.geometry[fe].length;yt++)Be.push(Dn(He.geometry[fe][yt],$));Ie.push(Be)}ne.push(na(He.id,at,Ie,He.tags))}return ne}function Dn(G,$){var ne=[];ne.size=G.size,G.start!==void 0&&(ne.start=G.start,ne.end=G.end);for(var ge=0;ge<G.length;ge+=3)ne.push(G[ge]+$,G[ge+1],G[ge+2]);return ne}function li(G,$){if(G.transformed)return G;var ne,ge,Ie,He=1<<G.z,at=G.x,fe=G.y;for(ne=0;ne<G.features.length;ne++){var Be=G.features[ne],yt=Be.geometry,vr=Be.type;if(Be.geometry=[],vr===1)for(ge=0;ge<yt.length;ge+=2)Be.geometry.push(Hn(yt[ge],yt[ge+1],$,He,at,fe));else for(ge=0;ge<yt.length;ge++){var Bt=[];for(Ie=0;Ie<yt[ge].length;Ie+=2)Bt.push(Hn(yt[ge][Ie],yt[ge][Ie+1],$,He,at,fe));Be.geometry.push(Bt)}}return G.transformed=!0,G}function Hn(G,$,ne,ge,Ie,He){return[Math.round(ne*(G*ge-Ie)),Math.round(ne*($*ge-He))]}function an(G,$,ne,ge,Ie){for(var He=$===Ie.maxZoom?0:Ie.tolerance/((1<<$)*Ie.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:ge,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<G.length;fe++){at.numFeatures++,Ai(at,G[fe],He,Ie);var Be=G[fe].minX,yt=G[fe].minY,vr=G[fe].maxX,Bt=G[fe].maxY;Be<at.minX&&(at.minX=Be),yt<at.minY&&(at.minY=yt),vr>at.maxX&&(at.maxX=vr),Bt>at.maxY&&(at.maxY=Bt)}return at}function Ai(G,$,ne,ge){var Ie=$.geometry,He=$.type,at=[];if(He==="Point"||He==="MultiPoint")for(var fe=0;fe<Ie.length;fe+=3)at.push(Ie[fe]),at.push(Ie[fe+1]),G.numPoints++,G.numSimplified++;else if(He==="LineString")wi(at,Ie,G,ne,!1,!1);else if(He==="MultiLineString"||He==="Polygon")for(fe=0;fe<Ie.length;fe++)wi(at,Ie[fe],G,ne,He==="Polygon",fe===0);else if(He==="MultiPolygon")for(var Be=0;Be<Ie.length;Be++){var yt=Ie[Be];for(fe=0;fe<yt.length;fe++)wi(at,yt[fe],G,ne,!0,fe===0)}if(at.length){var vr=$.tags||null;if(He==="LineString"&&ge.lineMetrics){for(var Bt in vr={},$.tags)vr[Bt]=$.tags[Bt];vr.mapbox_clip_start=Ie.start/Ie.size,vr.mapbox_clip_end=Ie.end/Ie.size}var zt={geometry:at,type:He==="Polygon"||He==="MultiPolygon"?3:He==="LineString"||He==="MultiLineString"?2:1,tags:vr};$.id!==null&&(zt.id=$.id),G.features.push(zt)}}function wi(G,$,ne,ge,Ie,He){var at=ge*ge;if(ge>0&&$.size<(Ie?at:ge))ne.numPoints+=$.length/3;else{for(var fe=[],Be=0;Be<$.length;Be+=3)(ge===0||$[Be+2]>at)&&(ne.numSimplified++,fe.push($[Be]),fe.push($[Be+1])),ne.numPoints++;Ie&&function(yt,vr){for(var Bt=0,zt=0,gr=yt.length,bn=gr-2;zt<gr;bn=zt,zt+=2)Bt+=(yt[zt]-yt[bn])*(yt[zt+1]+yt[bn+1]);if(Bt>0===vr)for(zt=0,gr=yt.length;zt<gr/2;zt+=2){var ln=yt[zt],Rt=yt[zt+1];yt[zt]=yt[gr-2-zt],yt[zt+1]=yt[gr-1-zt],yt[gr-2-zt]=ln,yt[gr-1-zt]=Rt}}(fe,He),G.push(fe)}}function Wa(G,$){var ne=($=this.options=function(Ie,He){for(var at in He)Ie[at]=He[at];return Ie}(Object.create(this.options),$)).debug;if(ne&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Ie,He){var at=[];if(Ie.type==="FeatureCollection")for(var fe=0;fe<Ie.features.length;fe++)ya(at,Ie.features[fe],He,fe);else ya(at,Ie.type==="Feature"?Ie:{geometry:Ie},He);return at}(G,$);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Ie,He){var at=He.buffer/He.extent,fe=Ie,Be=de(Ie,1,-1-at,at,0,-1,2,He),yt=de(Ie,1,1-at,2+at,0,-1,2,He);return(Be||yt)&&(fe=de(Ie,1,-at,1+at,0,-1,2,He)||[],Be&&(fe=nr(Be,1).concat(fe)),yt&&(fe=fe.concat(nr(yt,-1)))),fe}(ge,$)).length&&this.splitTile(ge,0,0,0),ne&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ls(G,$,ne){return 32*((1<<G)*ne+$)+G}function fa(G,$){var ne=G.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var ge=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!ge)return $(null,null);var Ie=new ht(ge.features),He=_t(Ie);He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),$(null,{vectorTile:Ie,rawData:He.buffer})}pn.prototype.load=function(G){var $=this.options,ne=$.log,ge=$.minZoom,Ie=$.maxZoom,He=$.nodeSize;ne&&console.time("total time");var at="prepare "+G.length+" points";ne&&console.time(at),this.points=G;for(var fe=[],Be=0;Be<G.length;Be++)G[Be].geometry&&fe.push(Zn(G[Be],Be));this.trees[Ie+1]=new Er(fe,Ii,Ei,He,Float32Array),ne&&console.timeEnd(at);for(var yt=Ie;yt>=ge;yt--){var vr=+Date.now();fe=this._cluster(fe,yt),this.trees[yt]=new Er(fe,Ii,Ei,He,Float32Array),ne&&console.log("z%d: %d clusters in %dms",yt,fe.length,+Date.now()-vr)}return ne&&console.timeEnd("total time"),this},pn.prototype.getClusters=function(G,$){var ne=((G[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,G[1])),Ie=G[2]===180?180:((G[2]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ne=-180,Ie=180;else if(ne>Ie){var at=this.getClusters([ne,ge,180,He],$),fe=this.getClusters([-180,ge,Ie,He],$);return at.concat(fe)}for(var Be=this.trees[this._limitZoom($)],yt=[],vr=0,Bt=Be.range($n(ne),ui(He),$n(Ie),ui(ge));vr<Bt.length;vr+=1){var zt=Be.points[Bt[vr]];yt.push(zt.numPoints?Gn(zt):this.points[zt.index])}return yt},pn.prototype.getChildren=function(G){var $=this._getOriginId(G),ne=this._getOriginZoom(G),ge="No cluster with the specified id.",Ie=this.trees[ne];if(!Ie)throw new Error(ge);var He=Ie.points[$];if(!He)throw new Error(ge);for(var at=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),fe=[],Be=0,yt=Ie.within(He.x,He.y,at);Be<yt.length;Be+=1){var vr=Ie.points[yt[Be]];vr.parentId===G&&fe.push(vr.numPoints?Gn(vr):this.points[vr.index])}if(fe.length===0)throw new Error(ge);return fe},pn.prototype.getLeaves=function(G,$,ne){var ge=[];return this._appendLeaves(ge,G,$=$||10,ne=ne||0,0),ge},pn.prototype.getTile=function(G,$,ne){var ge=this.trees[this._limitZoom(G)],Ie=Math.pow(2,G),He=this.options,at=He.radius/He.extent,fe=(ne-at)/Ie,Be=(ne+1+at)/Ie,yt={features:[]};return this._addTileFeatures(ge.range(($-at)/Ie,fe,($+1+at)/Ie,Be),ge.points,$,ne,Ie,yt),$===0&&this._addTileFeatures(ge.range(1-at/Ie,fe,1,Be),ge.points,Ie,ne,Ie,yt),$===Ie-1&&this._addTileFeatures(ge.range(0,fe,at/Ie,Be),ge.points,-1,ne,Ie,yt),yt.features.length?yt:null},pn.prototype.getClusterExpansionZoom=function(G){for(var $=this._getOriginZoom(G)-1;$<=this.options.maxZoom;){var ne=this.getChildren(G);if($++,ne.length!==1)break;G=ne[0].properties.cluster_id}return $},pn.prototype._appendLeaves=function(G,$,ne,ge,Ie){for(var He=0,at=this.getChildren($);He<at.length;He+=1){var fe=at[He],Be=fe.properties;if(Be&&Be.cluster?Ie+Be.point_count<=ge?Ie+=Be.point_count:Ie=this._appendLeaves(G,Be.cluster_id,ne,ge,Ie):Ie<ge?Ie++:G.push(fe),G.length===ne)break}return Ie},pn.prototype._addTileFeatures=function(G,$,ne,ge,Ie,He){for(var at=0,fe=G;at<fe.length;at+=1){var Be=$[fe[at]],yt=Be.numPoints,vr={type:1,geometry:[[Math.round(this.options.extent*(Be.x*Ie-ne)),Math.round(this.options.extent*(Be.y*Ie-ge))]],tags:yt?pi(Be):this.points[Be.index].properties},Bt=void 0;yt?Bt=Be.id:this.options.generateId?Bt=Be.index:this.points[Be.index].id&&(Bt=this.points[Be.index].id),Bt!==void 0&&(vr.id=Bt),He.features.push(vr)}},pn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},pn.prototype._cluster=function(G,$){for(var ne=[],ge=this.options,Ie=ge.reduce,He=ge.minPoints,at=ge.radius/(ge.extent*Math.pow(2,$)),fe=0;fe<G.length;fe++){var Be=G[fe];if(!(Be.zoom<=$)){Be.zoom=$;for(var yt=this.trees[$+1],vr=yt.within(Be.x,Be.y,at),Bt=Be.numPoints||1,zt=Bt,gr=0,bn=vr;gr<bn.length;gr+=1){var ln=yt.points[bn[gr]];ln.zoom>$&&(zt+=ln.numPoints||1)}if(zt>=He){for(var Rt=Be.x*Bt,un=Be.y*Bt,jr=Ie&&Bt>1?this._map(Be,!0):null,Hr=(fe<<5)+($+1)+this.points.length,ai=0,rn=vr;ai<rn.length;ai+=1){var Ci=yt.points[rn[ai]];if(!(Ci.zoom<=$)){Ci.zoom=$;var $i=Ci.numPoints||1;Rt+=Ci.x*$i,un+=Ci.y*$i,Ci.parentId=Hr,Ie&&(jr||(jr=this._map(Be,!0)),Ie(jr,this._map(Ci)))}}Be.parentId=Hr,ne.push(Wi(Rt/zt,un/zt,Hr,zt,jr))}else if(ne.push(Be),zt>1)for(var yi=0,Ti=vr;yi<Ti.length;yi+=1){var xi=yt.points[Ti[yi]];xi.zoom<=$||(xi.zoom=$,ne.push(xi))}}}return ne},pn.prototype._getOriginId=function(G){return G-this.points.length>>5},pn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},pn.prototype._map=function(G,$){if(G.numPoints)return $?Ji({},G.properties):G.properties;var ne=this.points[G.index].properties,ge=this.options.map(ne);return $&&ge===ne?Ji({},ge):ge},Wa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wa.prototype.splitTile=function(G,$,ne,ge,Ie,He,at){for(var fe=[G,$,ne,ge],Be=this.options,yt=Be.debug;fe.length;){ge=fe.pop(),ne=fe.pop(),$=fe.pop(),G=fe.pop();var vr=1<<$,Bt=ls($,ne,ge),zt=this.tiles[Bt];if(!zt&&(yt>1&&console.time("creation"),zt=this.tiles[Bt]=an(G,$,ne,ge,Be),this.tileCoords.push({z:$,x:ne,y:ge}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,ne,ge,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));var gr="z"+$;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(zt.source=G,Ie){if($===Be.maxZoom||$===Ie)continue;var bn=1<<Ie-$;if(ne!==Math.floor(He/bn)||ge!==Math.floor(at/bn))continue}else if($===Be.indexMaxZoom||zt.numPoints<=Be.indexMaxPoints)continue;if(zt.source=null,G.length!==0){yt>1&&console.time("clipping");var ln,Rt,un,jr,Hr,ai,rn=.5*Be.buffer/Be.extent,Ci=.5-rn,$i=.5+rn,yi=1+rn;ln=Rt=un=jr=null,Hr=de(G,vr,ne-rn,ne+$i,0,zt.minX,zt.maxX,Be),ai=de(G,vr,ne+Ci,ne+yi,0,zt.minX,zt.maxX,Be),G=null,Hr&&(ln=de(Hr,vr,ge-rn,ge+$i,1,zt.minY,zt.maxY,Be),Rt=de(Hr,vr,ge+Ci,ge+yi,1,zt.minY,zt.maxY,Be),Hr=null),ai&&(un=de(ai,vr,ge-rn,ge+$i,1,zt.minY,zt.maxY,Be),jr=de(ai,vr,ge+Ci,ge+yi,1,zt.minY,zt.maxY,Be),ai=null),yt>1&&console.timeEnd("clipping"),fe.push(ln||[],$+1,2*ne,2*ge),fe.push(Rt||[],$+1,2*ne,2*ge+1),fe.push(un||[],$+1,2*ne+1,2*ge),fe.push(jr||[],$+1,2*ne+1,2*ge+1)}}},Wa.prototype.getTile=function(G,$,ne){var ge=this.options,Ie=ge.extent,He=ge.debug;if(G<0||G>24)return null;var at=1<<G,fe=ls(G,$=($%at+at)%at,ne);if(this.tiles[fe])return li(this.tiles[fe],Ie);He>1&&console.log("drilling down to z%d-%d-%d",G,$,ne);for(var Be,yt=G,vr=$,Bt=ne;!Be&&yt>0;)yt--,vr=Math.floor(vr/2),Bt=Math.floor(Bt/2),Be=this.tiles[ls(yt,vr,Bt)];return Be&&Be.source?(He>1&&console.log("found parent tile z%d-%d-%d",yt,vr,Bt),He>1&&console.time("drilling down"),this.splitTile(Be.source,yt,vr,Bt,G,$,ne),He>1&&console.timeEnd("drilling down"),this.tiles[fe]?li(this.tiles[fe],Ie):null):null};var wa=function(G){function $(ne,ge,Ie,He){G.call(this,ne,ge,Ie,fa),He&&(this.loadGeoJSON=He)}return G&&($.__proto__=G),($.prototype=Object.create(G&&G.prototype)).constructor=$,$.prototype.loadData=function(ne,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=ne,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var ne=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var He=!!(Ie&&Ie.request&&Ie.request.collectResourceTiming)&&new m.RequestPerformance(Ie.request);this.loadGeoJSON(Ie,function(at,fe){if(at||!fe)return ge(at);if(typeof fe!="object")return ge(new Error("Input data given to '"+Ie.source+"' is not a valid GeoJSON object."));(function zt(gr,bn){var ln,Rt=gr&&gr.type;if(Rt==="FeatureCollection")for(ln=0;ln<gr.features.length;ln++)zt(gr.features[ln],bn);else if(Rt==="GeometryCollection")for(ln=0;ln<gr.geometries.length;ln++)zt(gr.geometries[ln],bn);else if(Rt==="Feature")zt(gr.geometry,bn);else if(Rt==="Polygon")sr(gr.coordinates,bn);else if(Rt==="MultiPolygon")for(ln=0;ln<gr.coordinates.length;ln++)sr(gr.coordinates[ln],bn);return gr})(fe,!0);try{if(Ie.filter){var Be=m.createExpression(Ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(function(zt){return zt.key+": "+zt.message}).join(", "));var yt=fe.features.filter(function(zt){return Be.value.evaluate({zoom:0},zt)});fe={type:"FeatureCollection",features:yt}}ne._geoJSONIndex=Ie.cluster?new pn(function(zt){var gr=zt.superclusterOptions,bn=zt.clusterProperties;if(!bn||!gr)return gr;for(var ln={},Rt={},un={accumulated:null,zoom:0},jr={properties:null},Hr=Object.keys(bn),ai=0,rn=Hr;ai<rn.length;ai+=1){var Ci=rn[ai],$i=bn[Ci],yi=$i[0],Ti=m.createExpression($i[1]),xi=m.createExpression(typeof yi=="string"?[yi,["accumulated"],["get",Ci]]:yi);ln[Ci]=Ti.value,Rt[Ci]=xi.value}return gr.map=function(ei){jr.properties=ei;for(var Gi={},Ta=0,ea=Hr;Ta<ea.length;Ta+=1){var Mi=ea[Ta];Gi[Mi]=ln[Mi].evaluate(un,jr)}return Gi},gr.reduce=function(ei,Gi){jr.properties=Gi;for(var Ta=0,ea=Hr;Ta<ea.length;Ta+=1){var Mi=ea[Ta];un.accumulated=ei[Mi],ei[Mi]=Rt[Mi].evaluate(un,jr)}},gr}(Ie)).load(fe.features):function(zt,gr){return new Wa(zt,gr)}(fe,Ie.geojsonVtOptions)}catch(zt){return ge(zt)}ne.loaded={};var vr={};if(He){var Bt=He.finish();Bt&&(vr.resourceTiming={},vr.resourceTiming[Ie.source]=JSON.parse(JSON.stringify(Bt)))}ge(null,vr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(ne,ge){var Ie=this.loaded;return Ie&&Ie[ne.uid]?G.prototype.reloadTile.call(this,ne,ge):this.loadTile(ne,ge)},$.prototype.loadGeoJSON=function(ne,ge){if(ne.request)m.getJSON(ne.request,ge);else{if(typeof ne.data!="string")return ge(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(ne.data))}catch(Ie){return ge(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(ne,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},$.prototype.getClusterExpansionZoom=function(ne,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Ie){ge(Ie)}},$.prototype.getClusterChildren=function(ne,ge){try{ge(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Ie){ge(Ie)}},$.prototype.getClusterLeaves=function(ne,ge){try{ge(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Ie){ge(Ie)}},$}(ke),ba=function(G){var $=this;this.self=G,this.actor=new m.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ke,geojson:wa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ne,ge){if($.workerSourceTypes[ne])throw new Error('Worker source with name "'+ne+'" already registered.');$.workerSourceTypes[ne]=ge},this.self.registerRTLTextPlugin=function(ne){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=ne.applyArabicShaping,m.plugin.processBidirectionalText=ne.processBidirectionalText,m.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}};return ba.prototype.setReferrer=function(G,$){this.referrer=$},ba.prototype.setImages=function(G,$,ne){for(var ge in this.availableImages[G]=$,this.workerSources[G]){var Ie=this.workerSources[G][ge];for(var He in Ie)Ie[He].availableImages=$}ne()},ba.prototype.setLayers=function(G,$,ne){this.getLayerIndex(G).replace($),ne()},ba.prototype.updateLayers=function(G,$,ne){this.getLayerIndex(G).update($.layers,$.removedIds),ne()},ba.prototype.loadTile=function(G,$,ne){this.getWorkerSource(G,$.type,$.source).loadTile($,ne)},ba.prototype.loadDEMTile=function(G,$,ne){this.getDEMWorkerSource(G,$.source).loadTile($,ne)},ba.prototype.reloadTile=function(G,$,ne){this.getWorkerSource(G,$.type,$.source).reloadTile($,ne)},ba.prototype.abortTile=function(G,$,ne){this.getWorkerSource(G,$.type,$.source).abortTile($,ne)},ba.prototype.removeTile=function(G,$,ne){this.getWorkerSource(G,$.type,$.source).removeTile($,ne)},ba.prototype.removeDEMTile=function(G,$){this.getDEMWorkerSource(G,$.source).removeTile($)},ba.prototype.removeSource=function(G,$,ne){if(this.workerSources[G]&&this.workerSources[G][$.type]&&this.workerSources[G][$.type][$.source]){var ge=this.workerSources[G][$.type][$.source];delete this.workerSources[G][$.type][$.source],ge.removeSource!==void 0?ge.removeSource($,ne):ne()}},ba.prototype.loadWorkerSource=function(G,$,ne){try{this.self.importScripts($.url),ne()}catch(ge){ne(ge.toString())}},ba.prototype.syncRTLPluginState=function(G,$,ne){try{m.plugin.setState($);var ge=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Ie=m.plugin.isParsed();ne(Ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Ie)}}catch(He){ne(He.toString())}},ba.prototype.getAvailableImages=function(G){var $=this.availableImages[G];return $||($=[]),$},ba.prototype.getLayerIndex=function(G){var $=this.layerIndexes[G];return $||($=this.layerIndexes[G]=new ce),$},ba.prototype.getWorkerSource=function(G,$,ne){var ge=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][$]||(this.workerSources[G][$]={}),this.workerSources[G][$][ne]||(this.workerSources[G][$][ne]=new this.workerSourceTypes[$]({send:function(Ie,He,at){ge.actor.send(Ie,He,at,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][$][ne]},ba.prototype.getDEMWorkerSource=function(G,$){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][$]||(this.demWorkerSources[G][$]=new Gt),this.demWorkerSources[G][$]},ba.prototype.enforceCacheSizeLimit=function(G,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),ye(["./shared"],function(m){"use strict";var ve=m.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,U=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(U);try{L=new Worker(X),M=!0}catch(se){M=!1}return L&&L.terminate(),URL.revokeObjectURL(X),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(M){var L=function(X){var se=document.createElement("canvas"),he=Object.create(h.webGLContextAttributes);return he.failIfMajorPerformanceCaveat=X,se.probablySupportsContext?se.probablySupportsContext("webgl",he)||se.probablySupportsContext("experimental-webgl",he):se.supportsContext?se.supportsContext("webgl",he)||se.supportsContext("experimental-webgl",he):se.getContext("webgl",he)||se.getContext("experimental-webgl",he)}(M);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),j={create:function(l,h,c){var d=m.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return m.window.document.createElementNS(l,h)}},ce=m.window.document&&m.window.document.documentElement.style;function ue(l){if(!ce)return l[0];for(var h=0;h<l.length;h++)if(l[h]in ce)return l[h];return l[0]}var ze,ae=ue(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);j.disableDrag=function(){ce&&ae&&(ze=ce[ae],ce[ae]="none")},j.enableDrag=function(){ce&&ae&&(ce[ae]=ze)};var nt=ue(["transform","WebkitTransform"]);j.setTransform=function(l,h){l.style[nt]=h};var ke=!1;try{var st=Object.defineProperty({},"passive",{get:function(){ke=!0}});m.window.addEventListener("test",st,st),m.window.removeEventListener("test",st,st)}catch(l){ke=!1}j.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&ke?d:d.capture)},j.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&ke?d:d.capture)};var Gt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Gt,!0)};function sr(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}j.suppressClick=function(){m.window.addEventListener("click",Gt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Gt,!0)},0)},j.mousePos=function(l,h){var c=l.getBoundingClientRect();return new m.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},j.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new m.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},j.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},j.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Pt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,M=c;w<M.length;w+=1){var L=M[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,M=c;w<M.length;w+=1)this.images[M[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,M=c;w<M.length;w+=1){var L=M[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,M=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:M||1}),this.patterns){var X=this.patterns[U].bin,se=X.x+1,he=X.y+1,pe=this.images[U].data,Le=pe.width,Oe=pe.height;m.RGBAImage.copy(pe,L,{x:0,y:0},{x:se,y:he},{width:Le,height:Oe}),m.RGBAImage.copy(pe,L,{x:0,y:Oe-1},{x:se,y:he-1},{width:Le,height:1}),m.RGBAImage.copy(pe,L,{x:0,y:0},{x:se,y:he+Oe},{width:Le,height:1}),m.RGBAImage.copy(pe,L,{x:Le-1,y:0},{x:se-1,y:he},{width:1,height:Oe}),m.RGBAImage.copy(pe,L,{x:0,y:0},{x:se+Le,y:he},{width:1,height:Oe})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var M=this.images[w];sr(M)&&this.updateImage(w,M)}}},h}(m.Evented),er=mt,Lt=mt,ht=1e20;function mt(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function tr(l,h,c,d,E,w,M){for(var L=0;L<h;L++){for(var U=0;U<c;U++)d[U]=l[U*h+L];for(q(d,E,w,M,c),U=0;U<c;U++)l[U*h+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<h;L++)d[L]=l[U*h+L];for(q(d,E,w,M,h),L=0;L<h;L++)l[U*h+L]=Math.sqrt(E[L])}}function q(l,h,c,d,E){c[0]=0,d[0]=-ht,d[1]=+ht;for(var w=1,M=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);L<=d[M];)M--,L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);c[++M]=w,d[M]=L,d[M+1]=+ht}for(w=0,M=0;w<E;w++){for(;d[M+1]<w;)M++;h[w]=(w-c[M])*(w-c[M])+l[c[M]]}}mt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ht:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ht:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(tr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),tr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},er.default=Lt;var Jt=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};Jt.prototype.setURL=function(l){this.url=l},Jt.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,M=l[E];w<M.length;w+=1)d.push({stack:E,id:M[w]});m.asyncAll(d,function(L,U){var X=L.stack,se=L.id,he=c.entries[X];he||(he=c.entries[X]={glyphs:{},requests:{},ranges:{}});var pe=he.glyphs[se];if(pe===void 0){if(pe=c._tinySDF(he,X,se))return he.glyphs[se]=pe,void U(null,{stack:X,id:se,glyph:pe});var Le=Math.floor(se/256);if(256*Le>65535)U(new Error("glyphs > 65535 not supported"));else if(he.ranges[Le])U(null,{stack:X,id:se,glyph:pe});else{var Oe=he.requests[Le];Oe||(Oe=he.requests[Le]=[],Jt.loadGlyphRange(X,Le,c.url,c.requestManager,function(We,we){if(we){for(var Xe in we)c._doesCharSupportLocalGlyph(+Xe)||(he.glyphs[+Xe]=we[+Xe]);he.ranges[Le]=!0}for(var it=0,bt=Oe;it<bt.length;it+=1)(0,bt[it])(We,we);delete he.requests[Le]})),Oe.push(function(We,we){We?U(We):we&&U(null,{stack:X,id:se,glyph:we[se]||null})})}}else U(null,{stack:X,id:se,glyph:pe})},function(L,U){if(L)h(L);else if(U){for(var X={},se=0,he=U;se<he.length;se+=1){var pe=he[se],Le=pe.stack,Oe=pe.id,We=pe.glyph;(X[Le]||(X[Le]={}))[Oe]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}h(null,X)}})},Jt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Jt.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new Jt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Jt.loadGlyphRange=function(l,h,c,d,E){var w=256*h,M=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+M),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,X){if(U)E(U);else if(X){for(var se={},he=0,pe=m.parseGlyphPBF(X);he<pe.length;he+=1){var Le=pe[he];se[Le.id]=Le}E(null,se)}})},Jt.TinySDF=er;var _t=function(){this.specification=m.styleSpec.light.position};_t.prototype.possiblyEvaluate=function(l,h){return m.sphericalToCartesian(l.expression.evaluate(h))},_t.prototype.interpolate=function(l,h,c){return{x:m.number(l.x,h.x,c),y:m.number(l.y,h.y,c),z:m.number(l.z,h.z,c)}};var rt=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new _t,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),At=function(l){function h(c){l.call(this),this._transitionable=new m.Transitionable(rt),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},h}(m.Evented),tt=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};tt.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},tt.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,M=!0;d.push({left:E,right:w,isDash:M,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var X=l[U];d.push({left:E=L*c,right:w=(L+=X)*c,isDash:M=!M,zeroLength:X===0})}return d},tt.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),M=0,L=l[M],U=0;U<this.width;U++){U/L.right>1&&(L=l[++M]);var X=Math.abs(U-L.left),se=Math.abs(U-L.right),he=Math.min(X,se),pe=void 0,Le=E/c*(d+1);if(L.isDash){var Oe=d-Math.abs(Le);pe=Math.sqrt(he*he+Oe*Oe)}else pe=d-Math.sqrt(he*he+Le*Le);this.data[w+U]=Math.max(0,Math.min(255,pe+128))}},tt.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var M=this.width*this.nextRow,L=0,U=l[L],X=0;X<this.width;X++){X/U.right>1&&(U=l[++L]);var se=Math.abs(X-U.left),he=Math.abs(X-U.right),pe=Math.min(se,he);this.data[M+X]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},tt.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var M=this.width/E,L=this.getDashRanges(l,this.width,M);h?this.addRoundDash(L,M,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},tt.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var $t=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function br(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var M=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(M.vectorLayers=w.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(L){return L.id})),M.tiles=h.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?m.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}$t.prototype.broadcast=function(l,h,c){m.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},$t.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},$t.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},$t.Actor=m.Actor;var Fr=function(l,h,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};Fr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Fr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var en=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,M.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Te=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,X=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Ke=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(M,L){M&&(c.state="errored",d(M)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,X={};return X[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(X[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(X[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),X},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(Te),Fe=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(M,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Mt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,M){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var L=1/0,U=1/0,X=-1/0,se=-1/0,he=0,pe=M;he<pe.length;he+=1){var Le=pe[he];L=Math.min(L,Le.x),U=Math.min(U,Le.y),X=Math.max(X,Le.x),se=Math.max(se,Le.y)}var Oe=Math.max(X-L,se-U),We=Math.max(0,Math.floor(-Math.log(Oe)/Math.LN2)),we=Math.pow(2,We);return new m.CanonicalTileID(We,Math.floor((L+X)/2*we),Math.floor((U+se)/2*we))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Zt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(M,L){c._loaded=!0,M?c.fire(new m.ErrorEvent(M)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(gt),qt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(gt),Er={vector:en,raster:Te,"raster-dem":Ke,geojson:Fe,video:Zt,image:gt,canvas:qt};function Kn(l,h){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function pn(l,h,c,d,E,w){var M=function(We,we,Xe){if(We)for(var it=0,bt=We;it<bt.length;it+=1){var Ht=we[bt[it]];if(Ht&&Ht.source===Xe&&Ht.type==="fill-extrusion")return!0}else for(var Wt in we){var Qt=we[Wt];if(Qt.source===Xe&&Qt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,M);U.sort(Wi);for(var X=[],se=0,he=U;se<he.length;se+=1){var pe=he[se];X.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(h,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,E,w,L,Kn(l.transform,pe.tileID))})}var Le=function(We){for(var we={},Xe={},it=0,bt=We;it<bt.length;it+=1){var Ht=bt[it],Wt=Ht.queryResults,Qt=Ht.wrappedTileID,mr=Xe[Qt]=Xe[Qt]||{};for(var lr in Wt)for(var Mr=Wt[lr],tn=mr[lr]=mr[lr]||{},Ln=we[lr]=we[lr]||[],kn=0,Fn=Mr;kn<Fn.length;kn+=1){var Oi=Fn[kn];tn[Oi.featureIndex]||(tn[Oi.featureIndex]=!0,Ln.push(Oi))}}return we}(X);for(var Oe in Le)Le[Oe].forEach(function(We){var we=We.feature,Xe=l.getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Xe});return Le}function Wi(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Zn=function(l,h){this.max=l,this.onRemove=h,this.reset()};Zn.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Zn.prototype.has=function(l){return l.wrapped().key in this.data},Zn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},Zn.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},Zn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Zn.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Zn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Zn.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var M=0,L=h;M<L.length;M+=1){var U=L[M];this.remove(U.value.tileID,U)}};var Gn=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Gn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var pi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},$n=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};$n.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},$n.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},$n.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},$n.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[pi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},$n.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ui=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ui.prototype.get=function(){return this.current},ui.prototype.set=function(l){},ui.prototype.getDefault=function(){return this.default},ui.prototype.setDefault=function(){this.set(this.default)};var Ji=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ui),Ii=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(ui),Ei=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(ui),zi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ui),na=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(ui),Si=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(ui),ya=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(ui),wn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(ui),_i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(ui),ki=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ui),Xi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(ui),za=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(ui),de=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(ui),Nn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(ui),Ua=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(ui),us=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(ui),jt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(ui),ir=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(ui),Tr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(ui),I=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(ui),nr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(ui),Dn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(ui),li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(ui),Hn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(ui),an=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(ui),Ai=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(ui),wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(ui),Wa=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(ui),ls=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(ui),fa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(ui),wa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(ui),ba=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(ui),G=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(ba),$=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(ba),ne=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,E),d&&(this.depthAttachment=new $(l,E))};ne.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,h,c){this.func=l,this.mask=h,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Ie=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Ie.disabled=new Ie({func:519,mask:0},0,0,7680,7680,7680);var He=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};He.disabled=new He(He.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,m.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],m.Color.transparent,[!0,!0,!0,!0]);var at=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};at.disabled=new at(!1,1029,2305),at.backCCW=new at(!0,1029,2305);var fe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ji(this),this.clearDepth=new Ii(this),this.clearStencil=new Ei(this),this.colorMask=new zi(this),this.depthMask=new na(this),this.stencilMask=new Si(this),this.stencilFunc=new ya(this),this.stencilOp=new wn(this),this.stencilTest=new _i(this),this.depthRange=new ki(this),this.depthTest=new Xi(this),this.depthFunc=new za(this),this.blend=new de(this),this.blendFunc=new Nn(this),this.blendColor=new Ua(this),this.blendEquation=new us(this),this.cullFace=new jt(this),this.cullFaceSide=new ir(this),this.frontFace=new Tr(this),this.program=new I(this),this.activeTexture=new nr(this),this.viewport=new Dn(this),this.bindFramebuffer=new li(this),this.bindRenderbuffer=new Hn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new Ai(this),this.bindElementBuffer=new wi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wa(this),this.pixelStoreUnpack=new ls(this),this.pixelStoreUnpackPremultiplyAlpha=new fa(this),this.pixelStoreUnpackFlipY=new wa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},fe.prototype.createIndexBuffer=function(l,h){return new Gn(this,l,h)},fe.prototype.createVertexBuffer=function(l,h,c){return new $n(this,l,h,c)},fe.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},fe.prototype.createFramebuffer=function(l,h,c){return new ne(this,l,h,c)},fe.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},fe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},fe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},fe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},fe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Be=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(M,L,U,X){var se=new Er[L.type](M,L,U,X);if(se.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+se.id);return m.bindAll(["load","abort","unload","serialize","prepare"],se),se}(c,d,E,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(yt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(M,L){var U=M.tileID,X=L.tileID,se=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),he=new m.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-X.overscaledZ||he.y-se.y||he.x-se.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(yt).map(function(M){return M.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var M=this.getTileByID(w);L(c,M),L(M,c)}}function L(U,X){U.needsHillshadePrepare=!0;var se=X.tileID.canonical.x-U.tileID.canonical.x,he=X.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Le=X.tileID.key;se===0&&he===0||Math.abs(he)>1||(Math.abs(se)>1&&(Math.abs(se+pe)===1?se+=pe:Math.abs(se-pe)===1&&(se-=pe)),X.dem&&U.dem&&(U.dem.backfillBorder(X.dem,se,he),U.neighboringTiles&&U.neighboringTiles[Le]&&(U.neighboringTiles[Le].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var M in this._tiles){var L=this._tiles[M];if(!(w[M]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(U=X)}for(var se=U;se.overscaledZ>d;)if(c[(se=se.scaledTo(se.overscaledZ-1)).key]){w[U.key]=U;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var M=c.scaledTo(w),L=this._getLoadedTile(M);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(mr){return new m.OverscaledTileID(mr.canonical.z,mr.wrap,mr.canonical.z,mr.canonical.x,mr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(mr){return d._source.hasTile(mr)}))):E=[];var w=c.coveringZoomLevel(this._source),M=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(vr(this._source.type)){for(var X={},se={},he=0,pe=Object.keys(U);he<pe.length;he+=1){var Le=pe[he],Oe=U[Le],We=this._tiles[Le];if(We&&!(We.fadeEndTime&&We.fadeEndTime<=m.browser.now())){var we=this.findLoadedParent(Oe,M);we&&(this._addTile(we.tileID),X[we.tileID.key]=we.tileID),se[Le]=Oe}}for(var Xe in this._retainLoadedChildren(se,w,L,U),X)U[Xe]||(this._coveredTiles[Xe]=!0,U[Xe]=X[Xe])}for(var it in U)this._tiles[it].clearFadeHold();for(var bt=0,Ht=m.keysDifference(this._tiles,U);bt<Ht.length;bt+=1){var Wt=Ht[bt],Qt=this._tiles[Wt];Qt.hasSymbolBuckets&&!Qt.holdingForFade()?Qt.setHoldDuration(this.map._fadeDuration):Qt.hasSymbolBuckets&&!Qt.symbolFadeFinished()||this._removeTile(Wt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},M=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),U={},X=0,se=c;X<se.length;X+=1){var he=se[X],pe=this._addTile(he);E[he.key]=he,pe.hasData()||d<this._source.maxzoom&&(U[he.key]=he)}this._retainLoadedChildren(U,d,L,E);for(var Le=0,Oe=c;Le<Oe.length;Le+=1){var We=Oe[Le],we=this._tiles[We.key];if(!we.hasData()){if(d+1>this._source.maxzoom){var Xe=We.children(this._source.maxzoom)[0],it=this.getTile(Xe);if(it&&it.hasData()){E[Xe.key]=Xe;continue}}else{var bt=We.children(this._source.maxzoom);if(E[bt[0].key]&&E[bt[1].key]&&E[bt[2].key]&&E[bt[3].key])continue}for(var Ht=we.wasRequested(),Wt=We.overscaledZ-1;Wt>=M;--Wt){var Qt=We.scaledTo(Wt);if(w[Qt.key]||(w[Qt.key]=!0,!(we=this.getTile(Qt))&&Ht&&(we=this._addTile(Qt)),we&&(E[Qt.key]=Qt,Ht=we.wasRequested(),we.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var M=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(M))break;w=M}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,M=[],L=this.transform;if(!L)return M;for(var U=E?L.getCameraQueryGeometry(c):c,X=c.map(function(Wt){return L.pointCoordinate(Wt)}),se=U.map(function(Wt){return L.pointCoordinate(Wt)}),he=this.getIds(),pe=1/0,Le=1/0,Oe=-1/0,We=-1/0,we=0,Xe=se;we<Xe.length;we+=1){var it=Xe[we];pe=Math.min(pe,it.x),Le=Math.min(Le,it.y),Oe=Math.max(Oe,it.x),We=Math.max(We,it.y)}for(var bt=function(Wt){var Qt=w._tiles[he[Wt]];if(!Qt.holdingForFade()){var mr=Qt.tileID,lr=Math.pow(2,L.zoom-Qt.tileID.overscaledZ),Mr=d*Qt.queryPadding*m.EXTENT/Qt.tileSize/lr,tn=[mr.getTilePoint(new m.MercatorCoordinate(pe,Le)),mr.getTilePoint(new m.MercatorCoordinate(Oe,We))];if(tn[0].x-Mr<m.EXTENT&&tn[0].y-Mr<m.EXTENT&&tn[1].x+Mr>=0&&tn[1].y+Mr>=0){var Ln=X.map(function(Fn){return mr.getTilePoint(Fn)}),kn=se.map(function(Fn){return mr.getTilePoint(Fn)});M.push({tile:Qt,tileID:mr,queryGeometry:Ln,cameraQueryGeometry:kn,scale:lr})}}},Ht=0;Ht<he.length;Ht++)bt(Ht);return M},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,M=E;w<M.length;w+=1){var L=M[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(vr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(m.Evented);function yt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function vr(l){return l==="raster"||l==="image"||l==="video"}function Bt(){return new m.window.Worker(Nl.workerUrl)}Be.maxOverzooming=10,Be.maxUnderzooming=3;var zt="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Bt);return this.active[l]=!0,this.workers.slice()},gr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[zt]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,ln=Math.floor(m.browser.hardwareConcurrency/2);function Rt(){return bn||(bn=new gr),bn}function un(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function jr(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=un(l[d],h[l[d].ref]));return l}gr.workerCount=Math.max(Math.min(ln,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ai(l,h,c){c.push({command:Hr.addSource,args:[l,h[l]]})}function rn(l,h,c){h.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function Ci(l,h,c,d){rn(l,c,d),ai(l,h,c)}function $i(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;return!0}function yi(l,h,c,d,E,w){var M;for(M in h=h||{},l=l||{})l.hasOwnProperty(M)&&(m.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}));for(M in h)h.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(m.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}))}function Ti(l){return l.id}function xi(l,h){return l[h.id]=h,l}var ei=function(l,h){this.reset(l,h)};ei.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ei.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],M=c-w,L=M>0?(d-w)/M:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var Gi=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Ta(l,h,c,d,E){var w=m.create();return h?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function ea(l,h,c,d,E){if(h){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Mi(l,h){var c=[l.x,l.y,0,1];Ra(c,c,h);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Ui(l,h){return .5+l/h*.5}function Oa(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function au(l,h,c,d,E,w,M,L){var U=d?l.textSizeData:l.iconSizeData,X=m.evaluateSizeForZoom(U,c.transform.zoom),se=[256/c.width*2+1,256/c.height*2+1],he=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;he.clear();for(var pe=l.lineVertexArray,Le=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Oe=c.transform.width/c.transform.height,We=!1,we=0;we<Le.length;we++){var Xe=Le.get(we);if(Xe.hidden||Xe.writingMode===m.WritingMode.vertical&&!We)co(Xe.numGlyphs,he);else{We=!1;var it=[Xe.anchorX,Xe.anchorY,0,1];if(m.transformMat4(it,it,h),Oa(it,se)){var bt=Ui(c.transform.cameraToCenterDistance,it[3]),Ht=m.evaluateSizeForFeature(U,X,Xe),Wt=M?Ht/bt:Ht*bt,Qt=new m.Point(Xe.anchorX,Xe.anchorY),mr=Mi(Qt,E).point,lr={},Mr=_s(Xe,Wt,!1,L,h,E,w,l.glyphOffsetArray,pe,he,mr,Qt,lr,Oe);We=Mr.useVertical,(Mr.notEnoughRoom||We||Mr.needsFlipping&&_s(Xe,Wt,!0,L,h,E,w,l.glyphOffsetArray,pe,he,mr,Qt,lr,Oe).notEnoughRoom)&&co(Xe.numGlyphs,he)}else co(Xe.numGlyphs,he)}}d?l.text.dynamicLayoutVertexBuffer.updateData(he):l.icon.dynamicLayoutVertexBuffer.updateData(he)}function Ea(l,h,c,d,E,w,M,L,U,X,se){var he=L.glyphStartIndex+L.numGlyphs,pe=L.lineStartIndex,Le=L.lineStartIndex+L.lineLength,Oe=h.getoffsetX(L.glyphStartIndex),We=h.getoffsetX(he-1),we=Qi(l*Oe,c,d,E,w,M,L.segment,pe,Le,U,X,se);if(!we)return null;var Xe=Qi(l*We,c,d,E,w,M,L.segment,pe,Le,U,X,se);return Xe?{first:we,last:Xe}:null}function Sa(l,h,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function _s(l,h,c,d,E,w,M,L,U,X,se,he,pe,Le){var Oe,We=h/24,we=l.lineOffsetX*We,Xe=l.lineOffsetY*We;if(l.numGlyphs>1){var it=l.glyphStartIndex+l.numGlyphs,bt=l.lineStartIndex,Ht=l.lineStartIndex+l.lineLength,Wt=Ea(We,L,we,Xe,c,se,he,l,U,w,pe);if(!Wt)return{notEnoughRoom:!0};var Qt=Mi(Wt.first.point,M).point,mr=Mi(Wt.last.point,M).point;if(d&&!c){var lr=Sa(l.writingMode,Qt,mr,Le);if(lr)return lr}Oe=[Wt.first];for(var Mr=l.glyphStartIndex+1;Mr<it-1;Mr++)Oe.push(Qi(We*L.getoffsetX(Mr),we,Xe,c,se,he,l.segment,bt,Ht,U,w,pe));Oe.push(Wt.last)}else{if(d&&!c){var tn=Mi(he,E).point,Ln=l.lineStartIndex+l.segment+1,kn=new m.Point(U.getx(Ln),U.gety(Ln)),Fn=Mi(kn,E),Oi=Fn.signedDistanceFromCamera>0?Fn.point:cs(he,kn,tn,1,E),wr=Sa(l.writingMode,tn,Oi,Le);if(wr)return wr}var Yn=Qi(We*L.getoffsetX(l.glyphStartIndex),we,Xe,c,se,he,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,pe);if(!Yn)return{notEnoughRoom:!0};Oe=[Yn]}for(var ti=0,ri=Oe;ti<ri.length;ti+=1){var Wn=ri[ti];m.addDynamicAttributes(X,Wn.point,Wn.angle)}return{}}function cs(l,h,c,d,E){var w=Mi(l.add(l.sub(h)._unit()),E).point,M=c.sub(w);return c.add(M._mult(d/M.mag()))}function Qi(l,h,c,d,E,w,M,L,U,X,se,he){var pe=d?l-h:l+h,Le=pe>0?1:-1,Oe=0;d&&(Le*=-1,Oe=Math.PI),Le<0&&(Oe+=Math.PI);for(var We=Le>0?L+M:L+M+1,we=E,Xe=E,it=0,bt=0,Ht=Math.abs(pe),Wt=[];it+bt<=Ht;){if((We+=Le)<L||We>=U)return null;if(Xe=we,Wt.push(we),(we=he[We])===void 0){var Qt=new m.Point(X.getx(We),X.gety(We)),mr=Mi(Qt,se);if(mr.signedDistanceFromCamera>0)we=he[We]=mr.point;else{var lr=We-Le;we=cs(it===0?w:new m.Point(X.getx(lr),X.gety(lr)),Qt,Xe,Ht-it+1,se)}}it+=bt,bt=Xe.dist(we)}var Mr=(Ht-it)/bt,tn=we.sub(Xe),Ln=tn.mult(Mr)._add(Xe);Ln._add(tn._unit()._perp()._mult(c*Le));var kn=Oe+Math.atan2(we.y-Xe.y,we.x-Xe.x);return Wt.push(Ln),{point:Ln,angle:kn,path:Wt}}Gi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Gi.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Gi.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Gi.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},Gi.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},Gi.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var M=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var X=this.circles[3*U],se=this.circles[3*U+1],he=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:X-he,y1:se-he,x2:X+he,y2:se+he})}return w?M.filter(w):M}return this._forEachCell(l,h,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?M.length>0:M},Gi.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,M=l+c,L=h-c,U=h+c;if(M<0||w>this.width||U<0||L>this.height)return!d&&[];var X=[];return this._forEachCell(w,L,M,U,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?X.length>0:X},Gi.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},Gi.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},Gi.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Gi.prototype._queryCell=function(l,h,c,d,E,w,M,L){var U=M.seenUids,X=this.boxCells[E];if(X!==null)for(var se=this.bboxes,he=0,pe=X;he<pe.length;he+=1){var Le=pe[he];if(!U.box[Le]){U.box[Le]=!0;var Oe=4*Le;if(l<=se[Oe+2]&&h<=se[Oe+3]&&c>=se[Oe+0]&&d>=se[Oe+1]&&(!L||L(this.boxKeys[Le]))){if(M.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Le],x1:se[Oe],y1:se[Oe+1],x2:se[Oe+2],y2:se[Oe+3]})}}}var We=this.circleCells[E];if(We!==null)for(var we=this.circles,Xe=0,it=We;Xe<it.length;Xe+=1){var bt=it[Xe];if(!U.circle[bt]){U.circle[bt]=!0;var Ht=3*bt;if(this._circleAndRectCollide(we[Ht],we[Ht+1],we[Ht+2],l,h,c,d)&&(!L||L(this.circleKeys[bt]))){if(M.hitTest)return w.push(!0),!0;var Wt=we[Ht],Qt=we[Ht+1],mr=we[Ht+2];w.push({key:this.circleKeys[bt],x1:Wt-mr,y1:Qt-mr,x2:Wt+mr,y2:Qt+mr})}}}},Gi.prototype._queryCellCircle=function(l,h,c,d,E,w,M,L){var U=M.circle,X=M.seenUids,se=this.boxCells[E];if(se!==null)for(var he=this.bboxes,pe=0,Le=se;pe<Le.length;pe+=1){var Oe=Le[pe];if(!X.box[Oe]){X.box[Oe]=!0;var We=4*Oe;if(this._circleAndRectCollide(U.x,U.y,U.radius,he[We+0],he[We+1],he[We+2],he[We+3])&&(!L||L(this.boxKeys[Oe])))return w.push(!0),!0}}var we=this.circleCells[E];if(we!==null)for(var Xe=this.circles,it=0,bt=we;it<bt.length;it+=1){var Ht=bt[it];if(!X.circle[Ht]){X.circle[Ht]=!0;var Wt=3*Ht;if(this._circlesCollide(Xe[Wt],Xe[Wt+1],Xe[Wt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Ht])))return w.push(!0),!0}}},Gi.prototype._forEachCell=function(l,h,c,d,E,w,M,L){for(var U=this._convertToXCellCoord(l),X=this._convertToYCellCoord(h),se=this._convertToXCellCoord(c),he=this._convertToYCellCoord(d),pe=U;pe<=se;pe++)for(var Le=X;Le<=he;Le++)if(E.call(this,l,h,c,d,this.xCellCount*Le+pe,w,M,L))return},Gi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Gi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Gi.prototype._circlesCollide=function(l,h,c,d,E,w){var M=d-l,L=E-h,U=c+w;return U*U>M*M+L*L},Gi.prototype._circleAndRectCollide=function(l,h,c,d,E,w,M){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var X=(M-E)/2,se=Math.abs(h-(E+X));if(se>X+c)return!1;if(U<=L||se<=X)return!0;var he=U-L,pe=se-X;return he*he+pe*pe<=c*c};var Yu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function co(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(Yu,3*d)}}function Ra(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var $a=function(l,h,c){h===void 0&&(h=new Gi(l.width+200,l.height+200,25)),c===void 0&&(c=new Gi(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Yi(l,h,c){return h*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}$a.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*w.perspectiveRatio,L=l.x1*M+w.point.x,U=l.y1*M+w.point.y,X=l.x2*M+w.point.x,se=l.y2*M+w.point.y;return!this.isInsideGrid(L,U,X,se)||!h&&this.grid.hitTest(L,U,X,se,E)?{box:[],offscreen:!1}:{box:[L,U,X,se],offscreen:this.isOffscreen(L,U,X,se)}},$a.prototype.placeCollisionCircles=function(l,h,c,d,E,w,M,L,U,X,se,he,pe){var Le=[],Oe=new m.Point(h.anchorX,h.anchorY),We=Mi(Oe,w),we=Ui(this.transform.cameraToCenterDistance,We.signedDistanceFromCamera),Xe=(X?E/we:E*we)/m.ONE_EM,it=Mi(Oe,M).point,bt=Ea(Xe,d,h.lineOffsetX*Xe,h.lineOffsetY*Xe,!1,it,Oe,h,c,M,{}),Ht=!1,Wt=!1,Qt=!0;if(bt){for(var mr=.5*he*we+pe,lr=new m.Point(-100,-100),Mr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),tn=new ei,Ln=bt.first,kn=bt.last,Fn=[],Oi=Ln.path.length-1;Oi>=1;Oi--)Fn.push(Ln.path[Oi]);for(var wr=1;wr<kn.path.length;wr++)Fn.push(kn.path[wr]);var Yn=2.5*mr;if(L){var ti=Fn.map(function(fu){return Mi(fu,L)});Fn=ti.some(function(fu){return fu.signedDistanceFromCamera<=0})?[]:ti.map(function(fu){return fu.point})}var ri=[];if(Fn.length>0){for(var Wn=Fn[0].clone(),oi=Fn[0].clone(),On=1;On<Fn.length;On++)Wn.x=Math.min(Wn.x,Fn[On].x),Wn.y=Math.min(Wn.y,Fn[On].y),oi.x=Math.max(oi.x,Fn[On].x),oi.y=Math.max(oi.y,Fn[On].y);ri=Wn.x>=lr.x&&oi.x<=Mr.x&&Wn.y>=lr.y&&oi.y<=Mr.y?[Fn]:oi.x<lr.x||Wn.x>Mr.x||oi.y<lr.y||Wn.y>Mr.y?[]:m.clipLine([Fn],lr.x,lr.y,Mr.x,Mr.y)}for(var Sn=0,go=ri;Sn<go.length;Sn+=1){var Xn;tn.reset(go[Sn],.25*mr),Xn=tn.length<=.5*mr?1:Math.ceil(tn.paddedLength/Yn)+1;for(var Bo=0;Bo<Xn;Bo++){var To=Bo/Math.max(Xn-1,1),Va=tn.lerp(To),Ga=Va.x+100,Ms=Va.y+100;Le.push(Ga,Ms,mr,0);var ds=Ga-mr,Au=Ms-mr,$o=Ga+mr,Ps=Ms+mr;if(Qt=Qt&&this.isOffscreen(ds,Au,$o,Ps),Wt=Wt||this.isInsideGrid(ds,Au,$o,Ps),!l&&this.grid.hitTestCircle(Ga,Ms,mr,se)&&(Ht=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ht}}}}return{circles:!U&&Ht||!Wt?[]:Le,offscreen:Qt,collisionDetected:Ht}},$a.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,M=0,L=l;M<L.length;M+=1){var U=L[M],X=new m.Point(U.x+100,U.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),E=Math.max(E,X.x),w=Math.max(w,X.y),h.push(X)}for(var se={},he={},pe=0,Le=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));pe<Le.length;pe+=1){var Oe=Le[pe],We=Oe.key;if(se[We.bucketInstanceId]===void 0&&(se[We.bucketInstanceId]={}),!se[We.bucketInstanceId][We.featureIndex]){var we=[new m.Point(Oe.x1,Oe.y1),new m.Point(Oe.x2,Oe.y1),new m.Point(Oe.x2,Oe.y2),new m.Point(Oe.x1,Oe.y2)];m.polygonIntersectsPolygon(h,we)&&(se[We.bucketInstanceId][We.featureIndex]=!0,he[We.bucketInstanceId]===void 0&&(he[We.bucketInstanceId]=[]),he[We.bucketInstanceId].push(We.featureIndex))}}return he},$a.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},$a.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(M,l[L],l[L+1],l[L+2])},$a.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return Ra(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},$a.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},$a.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},$a.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Ho=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Ho.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wo=function(l,h,c,d,E){this.text=new Ho(l?l.text:null,h,c,E),this.icon=new Ho(l?l.icon:null,h,d,E)};Wo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var qu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},po=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Xo=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},ha=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function fo(l,h,c,d,E){var w=m.getAnchorAlignment(l),M=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(M+U[0]*E,L+U[1]*E)}function Yo(l,h,c,d,E,w){var M=l.x1,L=l.x2,U=l.y1,X=l.y2,se=l.anchorPointX,he=l.anchorPointY,pe=new m.Point(h,c);return d&&pe._rotate(E?w:-w),{x1:M+pe.x,y1:U+pe.y,x2:L+pe.x,y2:X+pe.y,anchorPointX:se,anchorPointY:he}}ha.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var Qa=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new $a(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ha(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ou(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}Qa.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var M=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/m.EXTENT,se=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),he=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",Le=Yi(c,1,this.transform.zoom),Oe=Ta(se,he,pe,this.transform,Le),We=null;if(he){var we=ea(se,he,pe,this.transform,Le);We=m.multiply([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[E.bucketInstanceId]=new Xo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Xe={bucket:E,layout:L,posMatrix:se,textLabelPlaneMatrix:Oe,labelToScreenMatrix:We,scale:U,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var it=0,bt=E.sortKeyRanges;it<bt.length;it+=1){var Ht=bt[it];l.push({sortKey:Ht.sortKey,symbolInstanceStart:Ht.symbolInstanceStart,symbolInstanceEnd:Ht.symbolInstanceEnd,parameters:Xe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Xe})}},Qa.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,M,L,U,X,se,he,pe,Le,Oe){var We,we=[he.textOffset0,he.textOffset1],Xe=fo(l,c,d,we,E),it=this.collisionIndex.placeCollisionBox(Yo(h,Xe.x,Xe.y,w,M,this.transform.angle),se,L,U,X.predicate);if(!Oe||this.collisionIndex.placeCollisionBox(Yo(Oe,Xe.x,Xe.y,w,M,this.transform.angle),se,L,U,X.predicate).box.length!==0)return it.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID].text&&(We=this.prevPlacement.variableOffsets[he.crossTileID].anchor),this.variableOffsets[he.crossTileID]={textOffset:we,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:We},this.markUsedJustification(pe,l,he,Le),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Le,he),this.placedOrientations[he.crossTileID]=Le),{shift:Xe,placedGlyphBoxes:it}):void 0},Qa.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,M=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,X=E.labelToScreenMatrix,se=E.textPixelRatio,he=E.holdingForFade,pe=E.collisionBoxArray,Le=E.partiallyEvaluatedTextSize,Oe=E.collisionGroup,We=M.get("text-optional"),we=M.get("icon-optional"),Xe=M.get("text-allow-overlap"),it=M.get("icon-allow-overlap"),bt=M.get("text-rotation-alignment")==="map",Ht=M.get("text-pitch-alignment")==="map",Wt=M.get("icon-text-fit")!=="none",Qt=M.get("symbol-z-order")==="viewport-y",mr=Xe&&(it||!w.hasIconData()||we),lr=it&&(Xe||!w.hasTextData()||We);!w.collisionArrays&&pe&&w.deserializeCollisionBoxes(pe);var Mr=function(wr,Yn){if(!h[wr.crossTileID])if(he)d.placements[wr.crossTileID]=new qu(!1,!1,!1);else{var ti,ri=!1,Wn=!1,oi=!0,On=null,Sn={box:null,offscreen:null},go={box:null,offscreen:null},Xn=null,Bo=null,To=0,Va=0,Ga=0;Yn.textFeatureIndex?To=Yn.textFeatureIndex:wr.useRuntimeCollisionCircles&&(To=wr.featureIndex),Yn.verticalTextFeatureIndex&&(Va=Yn.verticalTextFeatureIndex);var Ms=Yn.textBox;if(Ms){var ds=function(Di){var js=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Di&&d.prevPlacement){var ns=d.prevPlacement.placedOrientations[wr.crossTileID];ns&&(d.placedOrientations[wr.crossTileID]=ns,d.markUsedOrientation(w,js=ns,wr))}return js},Au=function(Di,js){if(w.allowVerticalPlacement&&wr.numVerticalGlyphVertices>0&&Yn.verticalTextBox)for(var ns=0,Uu=w.writingModes;ns<Uu.length&&(Uu[ns]===m.WritingMode.vertical?(Sn=js(),go=Sn):Sn=Di(),!(Sn&&Sn.box&&Sn.box.length));ns+=1);else Sn=Di()};if(M.get("text-variable-anchor")){var $o=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[wr.crossTileID]){var Ps=d.prevPlacement.variableOffsets[wr.crossTileID];$o.indexOf(Ps.anchor)>0&&($o=$o.filter(function(Di){return Di!==Ps.anchor})).unshift(Ps.anchor)}var fu=function(Di,js,ns){for(var Uu=Di.x2-Di.x1,Gl=Di.y2-Di.y1,Uc=wr.textBoxScale,Ef=Wt&&!it?js:null,Js={box:[],offscreen:!1},Hl=Xe?2*$o.length:$o.length,hu=0;hu<Hl;++hu){var wl=d.attemptAnchorPlacement($o[hu%$o.length],Di,Uu,Gl,Uc,bt,Ht,se,L,Oe,hu>=$o.length,wr,w,ns,Ef);if(wl&&(Js=wl.placedGlyphBoxes)&&Js.box&&Js.box.length){ri=!0,On=wl.shift;break}}return Js};Au(function(){return fu(Ms,Yn.iconBox,m.WritingMode.horizontal)},function(){var Di=Yn.verticalTextBox;return w.allowVerticalPlacement&&!(Sn&&Sn.box&&Sn.box.length)&&wr.numVerticalGlyphVertices>0&&Di?fu(Di,Yn.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Sn&&(ri=Sn.box,oi=Sn.offscreen);var zl=ds(Sn&&Sn.box);if(!ri&&d.prevPlacement){var Ul=d.prevPlacement.variableOffsets[wr.crossTileID];Ul&&(d.variableOffsets[wr.crossTileID]=Ul,d.markUsedJustification(w,Ul.anchor,wr,zl))}}else{var Bu=function(Di,js){var ns=d.collisionIndex.placeCollisionBox(Di,Xe,se,L,Oe.predicate);return ns&&ns.box&&ns.box.length&&(d.markUsedOrientation(w,js,wr),d.placedOrientations[wr.crossTileID]=js),ns};Au(function(){return Bu(Ms,m.WritingMode.horizontal)},function(){var Di=Yn.verticalTextBox;return w.allowVerticalPlacement&&wr.numVerticalGlyphVertices>0&&Di?Bu(Di,m.WritingMode.vertical):{box:null,offscreen:null}}),ds(Sn&&Sn.box&&Sn.box.length)}}if(ri=(ti=Sn)&&ti.box&&ti.box.length>0,oi=ti&&ti.offscreen,wr.useRuntimeCollisionCircles){var Zl=w.text.placedSymbolArray.get(wr.centerJustifiedTextSymbolIndex),jl=m.evaluateSizeForFeature(w.textSizeData,Le,Zl),Qs=M.get("text-padding");Xn=d.collisionIndex.placeCollisionCircles(Xe,Zl,w.lineVertexArray,w.glyphOffsetArray,jl,L,U,X,c,Ht,Oe.predicate,wr.collisionCircleDiameter,Qs),ri=Xe||Xn.circles.length>0&&!Xn.collisionDetected,oi=oi&&Xn.offscreen}if(Yn.iconFeatureIndex&&(Ga=Yn.iconFeatureIndex),Yn.iconBox){var Vl=function(Di){var js=Wt&&On?Yo(Di,On.x,On.y,bt,Ht,d.transform.angle):Di;return d.collisionIndex.placeCollisionBox(js,it,se,L,Oe.predicate)};Wn=go&&go.box&&go.box.length&&Yn.verticalIconBox?(Bo=Vl(Yn.verticalIconBox)).box.length>0:(Bo=Vl(Yn.iconBox)).box.length>0,oi=oi&&Bo.offscreen}var wu=We||wr.numHorizontalGlyphVertices===0&&wr.numVerticalGlyphVertices===0,yo=we||wr.numIconVertices===0;if(wu||yo?yo?wu||(Wn=Wn&&ri):ri=Wn&&ri:Wn=ri=Wn&&ri,ri&&ti&&ti.box&&d.collisionIndex.insertCollisionBox(ti.box,M.get("text-ignore-placement"),w.bucketInstanceId,go&&go.box&&Va?Va:To,Oe.ID),Wn&&Bo&&d.collisionIndex.insertCollisionBox(Bo.box,M.get("icon-ignore-placement"),w.bucketInstanceId,Ga,Oe.ID),Xn&&(ri&&d.collisionIndex.insertCollisionCircles(Xn.circles,M.get("text-ignore-placement"),w.bucketInstanceId,To,Oe.ID),c)){var Nu=w.bucketInstanceId,Qo=d.collisionCircleArrays[Nu];Qo===void 0&&(Qo=d.collisionCircleArrays[Nu]=new po);for(var zu=0;zu<Xn.circles.length;zu+=4)Qo.circles.push(Xn.circles[zu+0]),Qo.circles.push(Xn.circles[zu+1]),Qo.circles.push(Xn.circles[zu+2]),Qo.circles.push(Xn.collisionDetected?1:0)}d.placements[wr.crossTileID]=new qu(ri||mr,Wn||lr,oi||w.justReloaded),h[wr.crossTileID]=!0}};if(Qt)for(var tn=w.getSortedSymbolIndexes(this.transform.angle),Ln=tn.length-1;Ln>=0;--Ln){var kn=tn[Ln];Mr(w.symbolInstances.get(kn),w.collisionArrays[kn])}else for(var Fn=l.symbolInstanceStart;Fn<l.symbolInstanceEnd;Fn++)Mr(w.symbolInstances.get(Fn),w.collisionArrays[Fn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Oi=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Oi.invProjMatrix,L),Oi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Qa.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(h)];for(var w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<M.length;w+=1){var L=M[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Qa.prototype.markUsedOrientation=function(l,h,c){for(var d=h===m.WritingMode.horizontal||h===m.WritingMode.horizontalOnly?h:0,E=h===m.WritingMode.vertical?h:0,w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<M.length;w+=1)l.text.placedSymbolArray.get(M[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Qa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],X=E[L];X?(this.opacities[L]=new Wo(X,d,U.text,U.icon),c=c||U.text!==X.text.placed||U.icon!==X.icon.placed):(this.opacities[L]=new Wo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var se in E){var he=E[se];if(!this.opacities[se]){var pe=new Wo(he,d,!1,!1);pe.isHidden()||(this.opacities[se]=pe,c=c||he.text.placed||he.icon.placed)}}for(var Le in w)this.variableOffsets[Le]||!this.opacities[Le]||this.opacities[Le].isHidden()||(this.variableOffsets[Le]=w[Le]);for(var Oe in M)this.placedOrientations[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.placedOrientations[Oe]=M[Oe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},Qa.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],M=w.getBucket(l);M&&w.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,w.collisionBoxArray)}},Qa.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Wo(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),X=E.get("text-rotation-alignment")==="map",se=E.get("text-pitch-alignment")==="map",he=E.get("icon-text-fit")!=="none",pe=new Wo(null,0,M&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Le=function(Xe,it,bt){for(var Ht=0;Ht<it/4;Ht++)Xe.opacityVertexArray.emplaceBack(bt)},Oe=function(Xe){var it=l.symbolInstances.get(Xe),bt=it.numHorizontalGlyphVertices,Ht=it.numVerticalGlyphVertices,Wt=it.crossTileID,Qt=d.opacities[Wt];h[Wt]?Qt=w:Qt||(d.opacities[Wt]=Qt=pe),h[Wt]=!0;var mr=it.numIconVertices>0,lr=d.placedOrientations[it.crossTileID],Mr=lr===m.WritingMode.vertical,tn=lr===m.WritingMode.horizontal||lr===m.WritingMode.horizontalOnly;if(bt>0||Ht>0){var Ln=ut(Qt.text);Le(l.text,bt,Mr?St:Ln),Le(l.text,Ht,tn?St:Ln);var kn=Qt.text.isHidden();[it.rightJustifiedTextSymbolIndex,it.centerJustifiedTextSymbolIndex,it.leftJustifiedTextSymbolIndex].forEach(function(Sn){Sn>=0&&(l.text.placedSymbolArray.get(Sn).hidden=kn||Mr?1:0)}),it.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(it.verticalPlacedTextSymbolIndex).hidden=kn||tn?1:0);var Fn=d.variableOffsets[it.crossTileID];Fn&&d.markUsedJustification(l,Fn.anchor,it,lr);var Oi=d.placedOrientations[it.crossTileID];Oi&&(d.markUsedJustification(l,"left",it,Oi),d.markUsedOrientation(l,Oi,it))}if(mr){var wr=ut(Qt.icon),Yn=!(he&&it.verticalPlacedIconSymbolIndex&&Mr);it.placedIconSymbolIndex>=0&&(Le(l.icon,it.numIconVertices,Yn?wr:St),l.icon.placedSymbolArray.get(it.placedIconSymbolIndex).hidden=Qt.icon.isHidden()),it.verticalPlacedIconSymbolIndex>=0&&(Le(l.icon,it.numVerticalIconVertices,Yn?St:wr),l.icon.placedSymbolArray.get(it.verticalPlacedIconSymbolIndex).hidden=Qt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ti=l.collisionArrays[Xe];if(ti){var ri=new m.Point(0,0);if(ti.textBox||ti.verticalTextBox){var Wn=!0;if(U){var oi=d.variableOffsets[Wt];oi?(ri=fo(oi.anchor,oi.width,oi.height,oi.textOffset,oi.textBoxScale),X&&ri._rotate(se?d.transform.angle:-d.transform.angle)):Wn=!1}ti.textBox&&ou(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!Wn||Mr,ri.x,ri.y),ti.verticalTextBox&&ou(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!Wn||tn,ri.x,ri.y)}var On=Boolean(!tn&&ti.verticalIconBox);ti.iconBox&&ou(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,On,he?ri.x:0,he?ri.y:0),ti.verticalIconBox&&ou(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,!On,he?ri.x:0,he?ri.y:0)}}},We=0;We<l.symbolInstances.length;We++)Oe(We);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var we=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=we.invProjMatrix,l.placementViewportMatrix=we.viewportMatrix,l.collisionCircleArray=we.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Qa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Qa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Qa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Qa.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},Qa.prototype.setStale=function(){this.stale=!0};var Ic=Math.pow(2,25),ks=Math.pow(2,24),Q=Math.pow(2,17),be=Math.pow(2,16),et=Math.pow(2,9),Dt=Math.pow(2,8),Dr=Math.pow(2,1);function ut(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Ic+h*ks+c*Q+h*be+c*et+h*Dt+c*Dr+h}var St=0,Ja=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ja.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(M,L){return M.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var qi=function(l,h,c,d,E,w,M){this.placement=new Qa(l,E,w,M),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};qi.prototype.isDone=function(){return this._done},qi.prototype.continuePlacement=function(l,h,c){for(var d=this,E=m.browser.now(),w=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Ja(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},qi.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Za=512/m.EXTENT/2,qo=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};qo.prototype.getScaledCoordinates=function(l,h){var c=Za/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*m.EXTENT+l.anchorY)*c)}},qo.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var M=this.indexedSymbolInstances[w.key];if(M)for(var L=this.getScaledCoordinates(w,h),U=0,X=M;U<X.length;U+=1){var se=X[U];if(Math.abs(se.coord.x-L.x)<=d&&Math.abs(se.coord.y-L.y)<=d&&!c[se.crossTileID]){c[se.crossTileID]=!0,w.crossTileID=se.crossTileID;break}}}}};var Yr=function(){this.maxCrossTileID=0};Yr.prototype.generate=function(){return++this.maxCrossTileID};var Vr=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Vr.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var M=d[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},Vr.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var M=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in M){var U=M[L];U.tileID.isChildOf(l)&&U.findMatches(h.symbolInstances,l,E)}else{var X=M[l.scaledTo(Number(w)).key];X&&X.findMatches(h.symbolInstances,l,E)}}for(var se=0;se<h.symbolInstances.length;se++){var he=h.symbolInstances.get(se);he.crossTileID||(he.crossTileID=c.generate(),E[he.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new qo(l,h.symbolInstances,h.bucketInstanceId),!0},Vr.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},Vr.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var It=function(){this.layerIndexes={},this.crossTileIDs=new Yr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};It.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new Vr);var E=!1,w={};d.handleWrapJump(c);for(var M=0,L=h;M<L.length;M+=1){var U=L[M],X=U.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,X,this.crossTileIDs)&&(E=!0),w[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},It.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var ko=function(l,h){return m.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},oe=m.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ys=m.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),su=function(){var l={},h=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),fs=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new $t(Rt(),this),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new Jt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new tt(256,512),this.crossTileSymbolIndex=new It,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(M){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(se){return se}))for(var X in w.sourceCaches)w.sourceCaches[X].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var L=E.sourceCaches[M.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var X in E._layers){var se=E._layers[X];se.source===U.id&&E._validateLayer(se)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(M,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(su,!1)},h.prototype._load=function(c,d){if(!d||!ko(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=jr(this.stylesheet.layers);this._order=w.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var M=0,L=w;M<L.length;M+=1){var U=L[M];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new At(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,M){var L,U,X,se=m.browser.devicePixelRatio>1?"@2x":"",he=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,se,".json"),m.ResourceType.SpriteJSON),function(Oe,We){he=null,X||(X=Oe,L=We,Le())}),pe=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,se,".png"),m.ResourceType.SpriteImage),function(Oe,We){pe=null,X||(X=Oe,U=We,Le())});function Le(){if(X)M(X);else if(L&&U){var Oe=m.browser.getImageData(U),We={};for(var we in L){var Xe=L[we],it=Xe.width,bt=Xe.height,Ht=Xe.x,Wt=Xe.y,Qt=Xe.sdf,mr=Xe.pixelRatio,lr=Xe.stretchX,Mr=Xe.stretchY,tn=Xe.content,Ln=new m.RGBAImage({width:it,height:bt});m.RGBAImage.copy(Oe,Ln,{x:Ht,y:Wt},{x:0,y:0},{width:it,height:bt}),We[we]={data:Ln,pixelRatio:mr,sdf:Qt,stretchX:lr,stretchY:Mr,content:tn}}M(null,We)}}return{cancel:function(){he&&(he.cancel(),he=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var M in w)d.imageManager.addImage(M,w[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var M=this._layers[w[E]];M.type!=="custom"&&d.push(M.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var M in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var se in this.sourceCaches){var he=this.sourceCaches[se];X[se]=he.used,he.used=!1}for(var pe=0,Le=this._order;pe<Le.length;pe+=1){var Oe=this._layers[Le[pe]];Oe.recalculate(c,this._availableImages),!Oe.isHidden(c.zoom)&&Oe.source&&(this.sourceCaches[Oe.source].used=!0)}for(var We in X){var we=this.sourceCaches[We];X[We]!==we.used&&we.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:We}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ko(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=jr(c.layers);var E=function(M,L){if(!M)return[{command:Hr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(M.version,L.version))return[{command:Hr.setStyle,args:[L]}];m.deepEqual(M.center,L.center)||U.push({command:Hr.setCenter,args:[L.center]}),m.deepEqual(M.zoom,L.zoom)||U.push({command:Hr.setZoom,args:[L.zoom]}),m.deepEqual(M.bearing,L.bearing)||U.push({command:Hr.setBearing,args:[L.bearing]}),m.deepEqual(M.pitch,L.pitch)||U.push({command:Hr.setPitch,args:[L.pitch]}),m.deepEqual(M.sprite,L.sprite)||U.push({command:Hr.setSprite,args:[L.sprite]}),m.deepEqual(M.glyphs,L.glyphs)||U.push({command:Hr.setGlyphs,args:[L.glyphs]}),m.deepEqual(M.transition,L.transition)||U.push({command:Hr.setTransition,args:[L.transition]}),m.deepEqual(M.light,L.light)||U.push({command:Hr.setLight,args:[L.light]});var X={},se=[];(function(pe,Le,Oe,We){var we;for(we in Le=Le||{},pe=pe||{})pe.hasOwnProperty(we)&&(Le.hasOwnProperty(we)||rn(we,Oe,We));for(we in Le)Le.hasOwnProperty(we)&&(pe.hasOwnProperty(we)?m.deepEqual(pe[we],Le[we])||(pe[we].type==="geojson"&&Le[we].type==="geojson"&&$i(pe,Le,we)?Oe.push({command:Hr.setGeoJSONSourceData,args:[we,Le[we].data]}):Ci(we,Le,Oe,We)):ai(we,Le,Oe))})(M.sources,L.sources,se,X);var he=[];M.layers&&M.layers.forEach(function(pe){X[pe.source]?U.push({command:Hr.removeLayer,args:[pe.id]}):he.push(pe)}),U=U.concat(se),function(pe,Le,Oe){Le=Le||[];var We,we,Xe,it,bt,Ht,Wt,Qt=(pe=pe||[]).map(Ti),mr=Le.map(Ti),lr=pe.reduce(xi,{}),Mr=Le.reduce(xi,{}),tn=Qt.slice(),Ln=Object.create(null);for(We=0,we=0;We<Qt.length;We++)Mr.hasOwnProperty(Xe=Qt[We])?we++:(Oe.push({command:Hr.removeLayer,args:[Xe]}),tn.splice(tn.indexOf(Xe,we),1));for(We=0,we=0;We<mr.length;We++)tn[tn.length-1-We]!==(Xe=mr[mr.length-1-We])&&(lr.hasOwnProperty(Xe)?(Oe.push({command:Hr.removeLayer,args:[Xe]}),tn.splice(tn.lastIndexOf(Xe,tn.length-we),1)):we++,Oe.push({command:Hr.addLayer,args:[Mr[Xe],Ht=tn[tn.length-We]]}),tn.splice(tn.length-We,0,Xe),Ln[Xe]=!0);for(We=0;We<mr.length;We++)if(it=lr[Xe=mr[We]],bt=Mr[Xe],!Ln[Xe]&&!m.deepEqual(it,bt))if(m.deepEqual(it.source,bt.source)&&m.deepEqual(it["source-layer"],bt["source-layer"])&&m.deepEqual(it.type,bt.type)){for(Wt in yi(it.layout,bt.layout,Oe,Xe,null,Hr.setLayoutProperty),yi(it.paint,bt.paint,Oe,Xe,null,Hr.setPaintProperty),m.deepEqual(it.filter,bt.filter)||Oe.push({command:Hr.setFilter,args:[Xe,bt.filter]}),m.deepEqual(it.minzoom,bt.minzoom)&&m.deepEqual(it.maxzoom,bt.maxzoom)||Oe.push({command:Hr.setLayerZoomRange,args:[Xe,bt.minzoom,bt.maxzoom]}),it)it.hasOwnProperty(Wt)&&Wt!=="layout"&&Wt!=="paint"&&Wt!=="filter"&&Wt!=="metadata"&&Wt!=="minzoom"&&Wt!=="maxzoom"&&(Wt.indexOf("paint.")===0?yi(it[Wt],bt[Wt],Oe,Xe,Wt.slice(6),Hr.setPaintProperty):m.deepEqual(it[Wt],bt[Wt])||Oe.push({command:Hr.setLayerProperty,args:[Xe,Wt,bt[Wt]]}));for(Wt in bt)bt.hasOwnProperty(Wt)&&!it.hasOwnProperty(Wt)&&Wt!=="layout"&&Wt!=="paint"&&Wt!=="filter"&&Wt!=="metadata"&&Wt!=="minzoom"&&Wt!=="maxzoom"&&(Wt.indexOf("paint.")===0?yi(it[Wt],bt[Wt],Oe,Xe,Wt.slice(6),Hr.setPaintProperty):m.deepEqual(it[Wt],bt[Wt])||Oe.push({command:Hr.setLayerProperty,args:[Xe,Wt,bt[Wt]]}))}else Oe.push({command:Hr.removeLayer,args:[Xe]}),Ht=tn[tn.lastIndexOf(Xe)+1],Oe.push({command:Hr.addLayer,args:[bt,Ht]})}(he,L.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Hr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Ys)});if(E.length===0)return!1;var w=E.filter(function(M){return!(M.command in oe)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new Be(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var M;if(c.type==="custom"){if(ko(this,m.validateCustomStyleLayer(c)))return;M=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;M=m.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=M,this._removedLayers[w]&&M.source&&M.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,w),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,w)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var L=M.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var M=w.getSource().type,L=M==="vector"?c.sourceLayer:void 0;M!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(lr){return d._layers[lr].type==="fill-extrusion"},w={},M=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var X=0,se=c;X<se.length;X+=1){var he=se[X][U];if(he)for(var pe=0,Le=he;pe<Le.length;pe+=1)M.push(Le[pe])}}}M.sort(function(lr,Mr){return Mr.intersectionZ-lr.intersectionZ});for(var Oe=[],We=this._order.length-1;We>=0;We--){var we=this._order[We];if(E(we))for(var Xe=M.length-1;Xe>=0;Xe--){var it=M[Xe].feature;if(w[it.layer.id]<We)break;Oe.push(it),M.pop()}else for(var bt=0,Ht=c;bt<Ht.length;bt+=1){var Wt=Ht[bt][we];if(Wt)for(var Qt=0,mr=Wt;Qt<mr.length;Qt+=1)Oe.push(mr[Qt].feature)}}return Oe},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,L=d.layers;M<L.length;M+=1){var U=L[M],X=this._layers[U];if(!X)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[X.source]=!0}}var se=[];for(var he in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[he]||se.push(pn(this.sourceCaches[he],this._layers,this._serializedLayers,c,d,E));return this.placement&&se.push(function(pe,Le,Oe,We,we,Xe,it){for(var bt={},Ht=Xe.queryRenderedSymbols(We),Wt=[],Qt=0,mr=Object.keys(Ht).map(Number);Qt<mr.length;Qt+=1)Wt.push(it[mr[Qt]]);Wt.sort(Wi);for(var lr=function(){var Fn=tn[Mr],Oi=Fn.featureIndex.lookupSymbolFeatures(Ht[Fn.bucketInstanceId],Le,Fn.bucketIndex,Fn.sourceLayerIndex,we.filter,we.layers,we.availableImages,pe);for(var wr in Oi){var Yn=bt[wr]=bt[wr]||[],ti=Oi[wr];ti.sort(function(oi,On){var Sn=Fn.featureSortOrder;if(Sn){var go=Sn.indexOf(oi.featureIndex);return Sn.indexOf(On.featureIndex)-go}return On.featureIndex-oi.featureIndex});for(var ri=0,Wn=ti;ri<Wn.length;ri+=1)Yn.push(Wn[ri])}},Mr=0,tn=Wt;Mr<tn.length;Mr+=1)lr();var Ln=function(Fn){bt[Fn].forEach(function(Oi){var wr=Oi.feature,Yn=Oe[pe[Fn].source].getFeatureState(wr.layer["source-layer"],wr.id);wr.source=wr.layer.source,wr.layer["source-layer"]&&(wr.sourceLayer=wr.layer["source-layer"]),wr.state=Yn})};for(var kn in bt)Ln(kn);return bt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(se)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,M){for(var L=w.getRenderableIds().map(function(Le){return w.getTileByID(Le)}),U=[],X={},se=0;se<L.length;se++){var he=L[se],pe=he.tileID.canonical.key;X[pe]||(X[pe]=!0,he.querySourceFeatures(U,M))}return U}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var M in c)if(!m.deepEqual(c[M],E[M])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&ko(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,M){M===void 0&&(M=!1);for(var L=!1,U=!1,X={},se=0,he=this._order;se<he.length;se+=1){var pe=this._layers[he[se]];if(pe.type==="symbol"){if(!X[pe.source]){var Le=this.sourceCaches[pe.source];X[pe.source]=Le.getRenderableIds(!0).map(function(it){return Le.getTileByID(it)}).sort(function(it,bt){return bt.tileID.overscaledZ-it.tileID.overscaledZ||(it.tileID.isLessThan(bt.tileID)?-1:1)})}var Oe=this.crossTileSymbolIndex.addLayer(pe,X[pe.source],c.center.lng);L=L||Oe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new qi(c,this._order,M,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var We=0,we=this._order;We<we.length;We+=1){var Xe=this._layers[we[We]];Xe.type==="symbol"&&this.placement.updateLayerOpacities(Xe,X[Xe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},h}(m.Evented);fs.getSourceType=function(l){return Er[l]},fs.setSourceType=function(l,h){Er[l]=h},fs.registerForPluginStateChange=m.registerForPluginStateChange;var ta=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),ho=Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ic=Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Oc=Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ku=Zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Rc=Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Rl=Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),$u=Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),uu=Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qu=Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),qe=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),pt=Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),vt=Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cr=Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_r=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Pn=Zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ci=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Jn=Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Hi=Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),sa=Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ca=Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Zi(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,X,se,he,pe){return L[pe]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+se+" "+he+" "+pe+`;
#else
uniform `+se+" "+he+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+se+" "+he+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:h=h.replace(c,function(U,X,se,he,pe){var Le=he==="float"?"vec2":"vec4",Oe=pe.match(/color/)?"color":Le;return L[pe]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+se+" "+Le+" a_"+pe+`;
varying `+se+" "+he+" "+pe+`;
#else
uniform `+se+" "+he+" u_"+pe+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+se+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Oe+"(a_"+pe+", u_"+pe+`_t);
#else
    `+se+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+se+" "+Le+" a_"+pe+`;
#else
uniform `+se+" "+he+" u_"+pe+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+se+" "+he+" "+pe+" = a_"+pe+`;
#else
    `+se+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+se+" "+he+" "+pe+" = unpack_mix_"+Oe+"(a_"+pe+", u_"+pe+`_t);
#else
    `+se+" "+he+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var Co=Object.freeze({__proto__:null,prelude:ho,background:ic,backgroundPattern:Oc,circle:Ku,clippingMask:Rc,heatmap:Rl,heatmapTexture:$u,collisionBox:uu,collisionCircle:Qu,debug:_,fill:T,fillOutline:F,fillOutlinePattern:R,fillPattern:K,fillExtrusion:xe,fillExtrusionPattern:qe,hillshadePrepare:pt,hillshade:vt,line:cr,lineGradient:_r,linePattern:Pn,lineSDF:ci,raster:Jn,symbolIcon:Hi,symbolSDF:sa,symbolTextAndIcon:Ca}),xs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function gl(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}xs.prototype.bind=function(l,h,c,d,E,w,M,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,X=0;!U&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,M,L)},xs.prototype.freshBind=function(l,h,c,d,E,w,M){var L,U=l.numAttributes,X=this.context,se=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M;else{L=X.currentNumAttributes||0;for(var he=U;he<L;he++)se.disableVertexAttribArray(he)}h.enableAttributes(se,l);for(var pe=0,Le=c;pe<Le.length;pe+=1)Le[pe].enableAttributes(se,l);w&&w.enableAttributes(se,l),M&&M.enableAttributes(se,l),h.bind(),h.setVertexAttribPointers(se,l,E);for(var Oe=0,We=c;Oe<We.length;Oe+=1){var we=We[Oe];we.bind(),we.setVertexAttribPointers(se,l,E)}w&&(w.bind(),w.setVertexAttribPointers(se,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(se,l,E)),X.currentNumAttributes=U},xs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var af=function(l,h,c,d,E,w){var M=l.gl;this.program=M.createProgram();for(var L=gl(c.staticAttributes),U=d?d.getBinderAttributes():[],X=L.concat(U),se=c.staticUniforms?gl(c.staticUniforms):[],he=d?d.getBinderUniforms():[],pe=[],Le=0,Oe=se.concat(he);Le<Oe.length;Le+=1){var We=Oe[Le];pe.indexOf(We)<0&&pe.push(We)}var we=d?d.defines():[];w&&we.push("#define OVERDRAW_INSPECTOR;");var Xe=we.concat(ho.fragmentSource,c.fragmentSource).join(`
`),it=we.concat(ho.vertexSource,c.vertexSource).join(`
`),bt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(bt,Xe),M.compileShader(bt),M.attachShader(this.program,bt);var Ht=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Ht,it),M.compileShader(Ht),M.attachShader(this.program,Ht),this.attributes={};var Wt={};this.numAttributes=X.length;for(var Qt=0;Qt<this.numAttributes;Qt++)X[Qt]&&(M.bindAttribLocation(this.program,Qt,X[Qt]),this.attributes[X[Qt]]=Qt);M.linkProgram(this.program),M.deleteShader(Ht),M.deleteShader(bt);for(var mr=0;mr<pe.length;mr++){var lr=pe[mr];if(lr&&!Wt[lr]){var Mr=M.getUniformLocation(this.program,lr);Mr&&(Wt[lr]=Mr)}}this.fixedUniforms=E(l,Wt),this.binderUniforms=d?d.getUniforms(l,Wt):[]}}};function Ju(l,h,c){var d=1/Yi(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,M=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,L>>16],u_pixel_coord_lower:[65535&M,65535&L]}}af.prototype.draw=function(l,h,c,d,E,w,M,L,U,X,se,he,pe,Le,Oe,We){var we,Xe=l.gl;if(!this.failedToCreate){for(var it in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[it].set(M[it]);Le&&Le.setUniforms(l,this.binderUniforms,he,{zoom:pe});for(var bt=(we={},we[Xe.LINES]=2,we[Xe.TRIANGLES]=3,we[Xe.LINE_STRIP]=1,we)[h],Ht=0,Wt=se.get();Ht<Wt.length;Ht+=1){var Qt=Wt[Ht],mr=Qt.vaos||(Qt.vaos={});(mr[L]||(mr[L]=new xs)).bind(l,this,U,Le?Le.getPaintVertexBuffers():[],X,Qt.vertexOffset,Oe,We),Xe.drawElements(h,Qt.primitiveLength*bt,Xe.UNSIGNED_SHORT,Qt.primitiveOffset*bt*2)}}};var Lc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),M=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-h.transform.angle),m.transformMat3(M,M,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Ou=function(l,h,c,d,E,w,M){return m.extend(Lc(l,h,c,d),Ju(w,h,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},yu=function(l){return{u_matrix:l}},vo=function(l,h,c,d){return m.extend(yu(l),Ju(c,h,d))},ua=function(l,h){return{u_matrix:l,u_world:h}},Eh=function(l,h,c,d,E){return m.extend(vo(l,h,c,d),{u_world:E})},Sh=function(l,h,c,d){var E,w,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=Yi(c,1,M.zoom);E=!0,w=[L,L]}else E=!1,w=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},ro=function(l,h,c){var d=Yi(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Xf=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},_u=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},Ds=function(l){return{u_matrix:l}},kc=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:Yi(h,1,c),u_intensity:d}},yl=function(l,h,c){var d=l.transform;return{u_matrix:Yf(l,h,c),u_ratio:1/Yi(h,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},_a=function(l,h,c,d){return m.extend(yl(l,h,c),{u_image:0,u_image_height:d})},Ll=function(l,h,c,d){var E=l.transform,w=ts(h,E);return{u_matrix:Yf(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Yi(h,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},ac=function(l,h,c,d,E){var w=l.lineAtlas,M=ts(h,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),X=w.getDash(d.to,L),se=U.width*E.fromScale,he=X.width*E.toScale;return m.extend(yl(l,h,c),{u_patternscale_a:[M/se,-U.height/2],u_patternscale_b:[M/he,-X.height/2],u_sdfgamma:w.width/(256*Math.min(se,he)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:X.y,u_mix:E.t})};function ts(l,h){return 1/Yi(l,1,h.tileZoom)}function Yf(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Ch=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ah(E.paint.get("raster-hue-rotate"))};var w,M};function Ah(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var of,_l=function(l,h,c,d,E,w,M,L,U,X){var se=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:se.width/se.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},Do=function(l,h,c,d,E,w,M,L,U,X,se){var he=E.transform;return m.extend(_l(l,h,c,d,E,w,M,L,U,X),{u_gamma_scale:d?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+se})},Ru=function(l,h,c,d,E,w,M,L,U,X){return m.extend(Do(l,h,c,d,E,w,M,L,!0,U,!0),{u_texsize_icon:X,u_texture_icon:1})},el=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},Fo=function(l,h,c,d,E,w){return m.extend(function(M,L,U,X){var se=U.imageManager.getPattern(M.from.toString()),he=U.imageManager.getPattern(M.to.toString()),pe=U.imageManager.getPixelSize(),Le=pe.width,Oe=pe.height,We=Math.pow(2,X.tileID.overscaledZ),we=X.tileSize*Math.pow(2,U.transform.tileZoom)/We,Xe=we*(X.tileID.canonical.x+X.tileID.wrap*We),it=we*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:se.tl,u_pattern_br_a:se.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Le,Oe],u_mix:L.t,u_pattern_size_a:se.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Yi(X,1,U.transform.tileZoom),u_pixel_coord_upper:[Xe>>16,it>>16],u_pixel_coord_lower:[65535&Xe,65535&it]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},kl={fillExtrusion:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,h.u_height_factor),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new m.UniformColor(l,h.u_color),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_overlay:new m.Uniform1i(l,h.u_overlay),u_overlay_scale:new m.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new m.Uniform1f(l,h.u_extrude_scale),u_intensity:new m.Uniform1f(l,h.u_intensity),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_color_ramp:new m.Uniform1i(l,h.u_color_ramp),u_opacity:new m.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_latrange:new m.Uniform2f(l,h.u_latrange),u_light:new m.Uniform2f(l,h.u_light),u_shadow:new m.UniformColor(l,h.u_shadow),u_highlight:new m.UniformColor(l,h.u_highlight),u_accent:new m.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_dimension:new m.Uniform2f(l,h.u_dimension),u_zoom:new m.Uniform1f(l,h.u_zoom),u_unpack:new m.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_image:new m.Uniform1i(l,h.u_image),u_image_height:new m.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_texsize:new m.Uniform2f(l,h.u_texsize),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_image:new m.Uniform1i(l,h.u_image),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,h.u_sdfgamma),u_image:new m.Uniform1i(l,h.u_image),u_tex_y_a:new m.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,h.u_tex_y_b),u_mix:new m.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new m.Uniform2f(l,h.u_tl_parent),u_scale_parent:new m.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,h.u_buffer_scale),u_fade_t:new m.Uniform1f(l,h.u_fade_t),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image0:new m.Uniform1i(l,h.u_image0),u_image1:new m.Uniform1i(l,h.u_image1),u_brightness_low:new m.Uniform1f(l,h.u_brightness_low),u_brightness_high:new m.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texsize_icon:new m.Uniform2f(l,h.u_texsize_icon),u_texture:new m.Uniform1i(l,h.u_texture),u_texture_icon:new m.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_color:new m.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image:new m.Uniform1i(l,h.u_image),u_pattern_tl_a:new m.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,h.u_pattern_br_b),u_texsize:new m.Uniform2f(l,h.u_texsize),u_mix:new m.Uniform1f(l,h.u_mix),u_pattern_size_a:new m.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,h.u_scale_a),u_scale_b:new m.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,h.u_tile_units_to_pixels)}}};function tl(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,X=l.useProgram("collisionBox"),se=[],he=0,pe=0,Le=0;Le<d.length;Le++){var Oe=d[Le],We=h.getTile(Oe),we=We.getBucket(c);if(we){var Xe=Oe.posMatrix;E[0]===0&&E[1]===0||(Xe=l.translatePosMatrix(Oe.posMatrix,We,E,w));var it=M?we.textCollisionBox:we.iconCollisionBox,bt=we.collisionCircleArray;if(bt.length>0){var Ht=m.create(),Wt=Xe;m.mul(Ht,we.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Ht,Ht,we.placementViewportMatrix),se.push({circleArray:bt,circleOffset:pe,transform:Wt,invTransform:Ht}),pe=he+=bt.length/4}it&&X.draw(L,U.LINES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),at.disabled,ro(Xe,l.transform,We),c.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,l.transform.zoom,null,null,it.collisionVertexBuffer)}}if(M&&se.length){var Qt=l.useProgram("collisionCircle"),mr=new m.StructArrayLayout2f1f2i16;mr.resize(4*he),mr._trim();for(var lr=0,Mr=0,tn=se;Mr<tn.length;Mr+=1)for(var Ln=tn[Mr],kn=0;kn<Ln.circleArray.length/4;kn++){var Fn=4*kn,Oi=Ln.circleArray[Fn+0],wr=Ln.circleArray[Fn+1],Yn=Ln.circleArray[Fn+2],ti=Ln.circleArray[Fn+3];mr.emplace(lr++,Oi,wr,Yn,ti,0),mr.emplace(lr++,Oi,wr,Yn,ti,1),mr.emplace(lr++,Oi,wr,Yn,ti,2),mr.emplace(lr++,Oi,wr,Yn,ti,3)}(!of||of.length<2*he)&&(of=function(Xn){var Bo=2*Xn,To=new m.StructArrayLayout3ui6;To.resize(Bo),To._trim();for(var Va=0;Va<Bo;Va++){var Ga=6*Va;To.uint16[Ga+0]=4*Va+0,To.uint16[Ga+1]=4*Va+1,To.uint16[Ga+2]=4*Va+2,To.uint16[Ga+3]=4*Va+2,To.uint16[Ga+4]=4*Va+3,To.uint16[Ga+5]=4*Va+0}return To}(he));for(var ri=L.createIndexBuffer(of,!0),Wn=L.createVertexBuffer(mr,m.collisionCircleLayout.members,!0),oi=0,On=se;oi<On.length;oi+=1){var Sn=On[oi],go=Xf(Sn.transform,Sn.invTransform,l.transform);Qt.draw(L,U.TRIANGLES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),at.disabled,go,c.id,Wn,ri,m.SegmentVector.simpleSegment(0,2*Sn.circleOffset,Sn.circleArray.length,Sn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Wn.destroy(),ri.destroy()}}var qs=m.identity(new Float32Array(16));function sf(l,h,c,d,E,w){var M=m.getAnchorAlignment(l),L=-(M.horizontalAlign-.5)*h,U=-(M.verticalAlign-.5)*c,X=m.evaluateVariableOffset(l,d);return new m.Point((L/E+X[0])*w,(U/E+X[1])*w)}function uf(l,h,c,d,E,w,M,L,U,X,se){var he=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Le=l.icon.dynamicLayoutVertexArray,Oe={};pe.clear();for(var We=0;We<he.length;We++){var we=he.get(We),Xe=we.hidden||!we.crossTileID||l.allowVerticalPlacement&&!we.placedOrientation?null:d[we.crossTileID];if(Xe){var it=new m.Point(we.anchorX,we.anchorY),bt=Mi(it,c?L:M),Ht=Ui(w.cameraToCenterDistance,bt.signedDistanceFromCamera),Wt=E.evaluateSizeForFeature(l.textSizeData,X,we)*Ht/m.ONE_EM;c&&(Wt*=l.tilePixelRatio/U);for(var Qt=sf(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale,Wt),mr=c?Mi(it.add(Qt),M).point:bt.point.add(h?Qt.rotate(-w.angle):Qt),lr=l.allowVerticalPlacement&&we.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Mr=0;Mr<we.numGlyphs;Mr++)m.addDynamicAttributes(pe,mr,lr);se&&we.associatedIconIndex>=0&&(Oe[we.associatedIconIndex]={shiftedAnchor:mr,angle:lr})}else co(we.numGlyphs,pe)}if(se){Le.clear();for(var tn=l.icon.placedSymbolArray,Ln=0;Ln<tn.length;Ln++){var kn=tn.get(Ln);if(kn.hidden)co(kn.numGlyphs,Le);else{var Fn=Oe[Ln];if(Fn)for(var Oi=0;Oi<kn.numGlyphs;Oi++)m.addDynamicAttributes(Le,Fn.shiftedAnchor,Fn.angle);else co(kn.numGlyphs,Le)}}l.icon.dynamicLayoutVertexBuffer.updateData(Le)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function lf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function rl(l,h,c,d,E,w,M,L,U,X,se,he){for(var pe=l.context,Le=pe.gl,Oe=l.transform,We=L==="map",we=U==="map",Xe=We&&c.layout.get("symbol-placement")!=="point",it=We&&!we&&!Xe,bt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ht=!1,Wt=l.depthModeForSublayer(0,ge.ReadOnly),Qt=c.layout.get("text-variable-anchor"),mr=[],lr=0,Mr=d;lr<Mr.length;lr+=1){var tn=Mr[lr],Ln=h.getTile(tn),kn=Ln.getBucket(c);if(kn){var Fn=E?kn.text:kn.icon;if(Fn&&Fn.segments.get().length){var Oi=Fn.programConfigurations.get(c.id),wr=E||kn.sdfIcons,Yn=E?kn.textSizeData:kn.iconSizeData,ti=we||Oe.pitch!==0,ri=l.useProgram(lf(wr,E,kn),Oi),Wn=m.evaluateSizeForZoom(Yn,Oe.zoom),oi=void 0,On=[0,0],Sn=void 0,go=void 0,Xn=null,Bo=void 0;if(E)Sn=Ln.glyphAtlasTexture,go=Le.LINEAR,oi=Ln.glyphAtlasTexture.size,kn.iconsInText&&(On=Ln.imageAtlasTexture.size,Xn=Ln.imageAtlasTexture,Bo=ti||l.options.rotating||l.options.zooming||Yn.kind==="composite"||Yn.kind==="camera"?Le.LINEAR:Le.NEAREST);else{var To=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;Sn=Ln.imageAtlasTexture,go=wr||l.options.rotating||l.options.zooming||To||ti?Le.LINEAR:Le.NEAREST,oi=Ln.imageAtlasTexture.size}var Va=Yi(Ln,1,l.transform.zoom),Ga=Ta(tn.posMatrix,we,We,l.transform,Va),Ms=ea(tn.posMatrix,we,We,l.transform,Va),ds=Qt&&kn.hasTextData(),Au=c.layout.get("icon-text-fit")!=="none"&&ds&&kn.hasIconData();Xe&&au(kn,tn.posMatrix,l,E,Ga,Ms,we,X);var $o=l.translatePosMatrix(tn.posMatrix,Ln,w,M),Ps=Xe||E&&Qt||Au?qs:Ga,fu=l.translatePosMatrix(Ms,Ln,w,M,!0),zl=wr&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ul={program:ri,buffers:Fn,uniformValues:wr?kn.iconsInText?Ru(Yn.kind,Wn,it,we,l,$o,Ps,fu,oi,On):Do(Yn.kind,Wn,it,we,l,$o,Ps,fu,E,oi,!0):_l(Yn.kind,Wn,it,we,l,$o,Ps,fu,E,oi),atlasTexture:Sn,atlasTextureIcon:Xn,atlasInterpolation:go,atlasInterpolationIcon:Bo,isSDF:wr,hasHalo:zl};if(bt&&kn.canOverlap){Ht=!0;for(var Bu=0,Zl=Fn.segments.get();Bu<Zl.length;Bu+=1){var jl=Zl[Bu];mr.push({segments:new m.SegmentVector([jl]),sortKey:jl.sortKey,state:Ul})}}else mr.push({segments:Fn.segments,sortKey:0,state:Ul})}}}Ht&&mr.sort(function(Qo,zu){return Qo.sortKey-zu.sortKey});for(var Qs=0,Vl=mr;Qs<Vl.length;Qs+=1){var wu=Vl[Qs],yo=wu.state;if(pe.activeTexture.set(Le.TEXTURE0),yo.atlasTexture.bind(yo.atlasInterpolation,Le.CLAMP_TO_EDGE),yo.atlasTextureIcon&&(pe.activeTexture.set(Le.TEXTURE1),yo.atlasTextureIcon&&yo.atlasTextureIcon.bind(yo.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),yo.isSDF){var Nu=yo.uniformValues;yo.hasHalo&&(Nu.u_is_halo=1,oc(yo.buffers,wu.segments,c,l,yo.program,Wt,se,he,Nu)),Nu.u_is_halo=0}oc(yo.buffers,wu.segments,c,l,yo.program,Wt,se,he,yo.uniformValues)}}function oc(l,h,c,d,E,w,M,L,U){var X=d.context;E.draw(X,X.gl.TRIANGLES,w,M,L,at.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Dc(l,h,c,d,E,w,M){var L,U,X,se,he,pe=l.context.gl,Le=c.paint.get("fill-pattern"),Oe=Le&&Le.constantOr(1),We=c.getCrossfadeParameters();M?(U=Oe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=pe.LINES):(U=Oe?"fillPattern":"fill",L=pe.TRIANGLES);for(var we=0,Xe=d;we<Xe.length;we+=1){var it=Xe[we],bt=h.getTile(it);if(!Oe||bt.patternsLoaded()){var Ht=bt.getBucket(c);if(Ht){var Wt=Ht.programConfigurations.get(c.id),Qt=l.useProgram(U,Wt);Oe&&(l.context.activeTexture.set(pe.TEXTURE0),bt.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Wt.updatePaintBuffers(We));var mr=Le.constantOr(null);if(mr&&bt.imageAtlas){var lr=bt.imageAtlas,Mr=lr.patternPositions[mr.to.toString()],tn=lr.patternPositions[mr.from.toString()];Mr&&tn&&Wt.setConstantPatternPositions(Mr,tn)}var Ln=l.translatePosMatrix(it.posMatrix,bt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){se=Ht.indexBuffer2,he=Ht.segments2;var kn=[pe.drawingBufferWidth,pe.drawingBufferHeight];X=U==="fillOutlinePattern"&&Oe?Eh(Ln,l,We,bt,kn):ua(Ln,kn)}else se=Ht.indexBuffer,he=Ht.segments,X=Oe?vo(Ln,l,We,bt):yu(Ln);Qt.draw(l.context,L,E,l.stencilModeForClipping(it),w,at.disabled,X,c.id,Ht.layoutVertexBuffer,se,he,c.paint,l.transform.zoom,Wt)}}}}function cf(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,X=c.paint.get("fill-extrusion-pattern"),se=X.constantOr(1),he=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Le=0,Oe=d;Le<Oe.length;Le+=1){var We=Oe[Le],we=h.getTile(We),Xe=we.getBucket(c);if(Xe){var it=Xe.programConfigurations.get(c.id),bt=l.useProgram(se?"fillExtrusionPattern":"fillExtrusion",it);se&&(l.context.activeTexture.set(U.TEXTURE0),we.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),it.updatePaintBuffers(he));var Ht=X.constantOr(null);if(Ht&&we.imageAtlas){var Wt=we.imageAtlas,Qt=Wt.patternPositions[Ht.to.toString()],mr=Wt.patternPositions[Ht.from.toString()];Qt&&mr&&it.setConstantPatternPositions(Qt,mr)}var lr=l.translatePosMatrix(We.posMatrix,we,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Mr=c.paint.get("fill-extrusion-vertical-gradient"),tn=se?Ou(lr,l,Mr,pe,We,he,we):Lc(lr,l,Mr,pe);bt.draw(L,L.gl.TRIANGLES,E,w,M,at.backCCW,tn,c.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,c.paint,l.transform.zoom,it)}}}function Fc(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.fbo;if(U){var X=l.useProgram("hillshade");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var se=function(he,pe,Le){var Oe=Le.paint.get("hillshade-shadow-color"),We=Le.paint.get("hillshade-highlight-color"),we=Le.paint.get("hillshade-accent-color"),Xe=Le.paint.get("hillshade-illumination-direction")*(Math.PI/180);Le.paint.get("hillshade-illumination-anchor")==="viewport"&&(Xe-=he.transform.angle);var it,bt,Ht,Wt=!he.options.moving;return{u_matrix:he.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Wt),u_image:0,u_latrange:(it=pe.tileID,bt=Math.pow(2,it.canonical.z),Ht=it.canonical.y,[new m.MercatorCoordinate(0,Ht/bt).toLngLat().lat,new m.MercatorCoordinate(0,(Ht+1)/bt).toLngLat().lat]),u_light:[Le.paint.get("hillshade-exaggeration"),Xe],u_shadow:Oe,u_highlight:We,u_accent:we}}(l,h,c);X.draw(M,L.TRIANGLES,d,E,w,at.disabled,se,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function wh(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.dem;if(U&&U.data){var X=U.dim,se=U.stride,he=U.getPixels();if(M.activeTexture.set(L.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(se),h.demTexture){var pe=h.demTexture;pe.update(he,{premultiply:!1}),pe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new m.Texture(M,he,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);M.activeTexture.set(L.TEXTURE0);var Le=h.fbo;if(!Le){var Oe=new m.Texture(M,{width:X,height:X,data:null},L.RGBA);Oe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Le=h.fbo=M.createFramebuffer(X,X,!0)).colorAttachment.set(Oe.texture)}M.bindFramebuffer.set(Le.framebuffer),M.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,d,E,w,at.disabled,function(We,we){var Xe=we.stride,it=m.create();return m.ortho(it,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(it,it,[0,-m.EXTENT,0]),{u_matrix:it,u_image:1,u_dimension:[Xe,Xe],u_zoom:We.overscaledZ,u_unpack:we.getUnpackVector()}}(h.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Bc(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var M=m.browser.now(),L=(M-l.timeAdded)/w,U=h?(M-h.timeAdded)/w:-1,X=c.getSource(),se=E.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),he=!h||Math.abs(h.tileID.overscaledZ-se)>Math.abs(l.tileID.overscaledZ-se),pe=he&&l.refreshedUponExpiration?1:m.clamp(he?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var xl=new m.Color(1,0,0,1),ff=new m.Color(0,1,0,1),hf=new m.Color(0,0,1,1),Lu=new m.Color(1,0,1,1),pf=new m.Color(0,1,1,1);function qf(l,h,c,d){Dl(l,0,h+c/2,l.transform.width,c,d)}function Th(l,h,c,d){Dl(l,h-c/2,0,c,l.transform.height,d)}function Dl(l,h,c,d,E,w){var M=l.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),M.clear({color:w}),L.disable(L.SCISSOR_TEST)}function sp(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,M=l.useProgram("debug"),L=ge.disabled,U=Ie.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,L,U,X,at.disabled,_u(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var se=h.getTileByID(c.key).latestRawTileData,he=Math.floor((se&&se.byteLength||0)/1024),pe=h.getTile(c).tileSize,Le=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Oe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Oe+=" => "+c.overscaledZ),function(We,we){We.initDebugOverlayCanvas();var Xe=We.debugOverlayCanvas,it=We.context.gl,bt=We.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,Xe.width,Xe.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(we,5,5),bt.strokeText(we,5,5),We.debugOverlayTexture.update(Xe),We.debugOverlayTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE)}(l,Oe+" "+he+"kb"),M.draw(d,E.TRIANGLES,L,U,He.alphaBlended,at.disabled,_u(w,m.Color.transparent,Le),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var rs={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Ie.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,X,se,he,pe,Le){for(var Oe=U.transform,We=he==="map",we=pe==="map",Xe=0,it=L;Xe<it.length;Xe+=1){var bt=it[Xe],Ht=se.getTile(bt),Wt=Ht.getBucket(X);if(Wt&&Wt.text&&Wt.text.segments.get().length){var Qt=m.evaluateSizeForZoom(Wt.textSizeData,Oe.zoom),mr=Yi(Ht,1,U.transform.zoom),lr=Ta(bt.posMatrix,we,We,U.transform,mr),Mr=X.layout.get("icon-text-fit")!=="none"&&Wt.hasIconData();if(Qt){var tn=Math.pow(2,Oe.zoom-Ht.tileID.overscaledZ);uf(Wt,We,we,Le,m.symbolSize,Oe,lr,bt.posMatrix,tn,Qt,Mr)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&rl(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,M),c.paint.get("text-opacity").constantOr(1)!==0&&rl(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,M),h.map.showCollisionBoxes&&(tl(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),tl(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,X=U.gl,se=l.depthModeForSublayer(0,ge.ReadOnly),he=Ie.disabled,pe=l.colorModeForRenderPass(),Le=[],Oe=0;Oe<d.length;Oe++){var We=d[Oe],we=h.getTile(We),Xe=we.getBucket(c);if(Xe){var it=Xe.programConfigurations.get(c.id),bt={programConfiguration:it,program:l.useProgram("circle",it),layoutVertexBuffer:Xe.layoutVertexBuffer,indexBuffer:Xe.indexBuffer,uniformValues:Sh(l,We,we,c)};if(L)for(var Ht=0,Wt=Xe.segments.get();Ht<Wt.length;Ht+=1){var Qt=Wt[Ht];Le.push({segments:new m.SegmentVector([Qt]),sortKey:Qt.sortKey,state:bt})}else Le.push({segments:Xe.segments,sortKey:0,state:bt})}}L&&Le.sort(function(Ln,kn){return Ln.sortKey-kn.sortKey});for(var mr=0,lr=Le;mr<lr.length;mr+=1){var Mr=lr[mr],tn=Mr.state;tn.program.draw(U,X.TRIANGLES,se,he,pe,at.disabled,tn.uniformValues,c.id,tn.layoutVertexBuffer,tn.indexBuffer,Mr.segments,c.paint,l.transform.zoom,tn.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,M=Ie.disabled,L=new He([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Le,Oe,We){var we=Le.gl;Le.activeTexture.set(we.TEXTURE1),Le.viewport.set([0,0,Oe.width/4,Oe.height/4]);var Xe=We.heatmapFbo;if(Xe)we.bindTexture(we.TEXTURE_2D,Xe.colorAttachment.get()),Le.bindFramebuffer.set(Xe.framebuffer);else{var it=we.createTexture();we.bindTexture(we.TEXTURE_2D,it),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MAG_FILTER,we.LINEAR),Xe=We.heatmapFbo=Le.createFramebuffer(Oe.width/4,Oe.height/4,!1),function(bt,Ht,Wt,Qt){var mr=bt.gl;mr.texImage2D(mr.TEXTURE_2D,0,mr.RGBA,Ht.width/4,Ht.height/4,0,mr.RGBA,bt.extRenderToTextureHalfFloat?bt.extTextureHalfFloat.HALF_FLOAT_OES:mr.UNSIGNED_BYTE,null),Qt.colorAttachment.set(Wt)}(Le,Oe,it,Xe)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var X=d[U];if(!h.hasRenderableParent(X)){var se=h.getTile(X),he=se.getBucket(c);if(he){var pe=he.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(E,w.TRIANGLES,ge.disabled,M,L,at.disabled,kc(X.posMatrix,se,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,l.transform.zoom,pe)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Le,Oe){var We=Le.context,we=We.gl,Xe=Oe.heatmapFbo;if(Xe){We.activeTexture.set(we.TEXTURE0),we.bindTexture(we.TEXTURE_2D,Xe.colorAttachment.get()),We.activeTexture.set(we.TEXTURE1);var it=Oe.colorRampTexture;it||(it=Oe.colorRampTexture=new m.Texture(We,Oe.colorRamp,we.RGBA)),it.bind(we.LINEAR,we.CLAMP_TO_EDGE),Le.useProgram("heatmapTexture").draw(We,we.TRIANGLES,ge.disabled,Ie.disabled,Le.colorModeForRenderPass(),at.disabled,function(bt,Ht,Wt,Qt){var mr=m.create();m.ortho(mr,0,bt.width,bt.height,0,0,1);var lr=bt.context.gl;return{u_matrix:mr,u_world:[lr.drawingBufferWidth,lr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ht.paint.get("heatmap-opacity")}}(Le,Oe),Oe.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments,Oe.paint,Le.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),se=X.constantOr(1),he=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Le=se?"linePattern":U?"lineSDF":he?"lineGradient":"line",Oe=l.context,We=Oe.gl,we=!0,Xe=0,it=d;Xe<it.length;Xe+=1){var bt=it[Xe],Ht=h.getTile(bt);if(!se||Ht.patternsLoaded()){var Wt=Ht.getBucket(c);if(Wt){var Qt=Wt.programConfigurations.get(c.id),mr=l.context.program.get(),lr=l.useProgram(Le,Qt),Mr=we||lr.program!==mr,tn=X.constantOr(null);if(tn&&Ht.imageAtlas){var Ln=Ht.imageAtlas,kn=Ln.patternPositions[tn.to.toString()],Fn=Ln.patternPositions[tn.from.toString()];kn&&Fn&&Qt.setConstantPatternPositions(kn,Fn)}var Oi=se?Ll(l,Ht,c,pe):U?ac(l,Ht,c,U,pe):he?_a(l,Ht,c,Wt.lineClipsArray.length):yl(l,Ht,c);if(se)Oe.activeTexture.set(We.TEXTURE0),Ht.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Qt.updatePaintBuffers(pe);else if(U&&(Mr||l.lineAtlas.dirty))Oe.activeTexture.set(We.TEXTURE0),l.lineAtlas.bind(Oe);else if(he){var wr=Wt.gradients[c.id],Yn=wr.texture;if(c.gradientVersion!==wr.version){var ti=256;if(c.stepInterpolant){var ri=h.getSource().maxzoom,Wn=bt.canonical.z===ri?Math.ceil(1<<l.transform.maxZoom-bt.canonical.z):1;ti=m.clamp(m.nextPowerOfTwo(Wt.maxLineLength/m.EXTENT*1024*Wn),256,Oe.maxTextureSize)}wr.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:wr.gradient||void 0,clips:Wt.lineClipsArray}),wr.texture?wr.texture.update(wr.gradient):wr.texture=new m.Texture(Oe,wr.gradient,We.RGBA),wr.version=c.gradientVersion,Yn=wr.texture}Oe.activeTexture.set(We.TEXTURE0),Yn.bind(c.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}lr.draw(Oe,We.TRIANGLES,M,l.stencilModeForClipping(bt),L,at.disabled,Oi,c.id,Wt.layoutVertexBuffer,Wt.indexBuffer,Wt.segments,c.paint,l.transform.zoom,Qt,Wt.layoutVertexBuffer2),we=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var M=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Dc(l,h,c,d,X,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var se=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Dc(l,h,c,d,se,M,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))cf(l,h,c,d,w,Ie.disabled,He.disabled),cf(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();cf(l,h,c,d,w,Ie.disabled,M)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ge.ReadOnly),M=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],X=0,se=L[1];X<se.length;X+=1){var he=se[X],pe=h.getTile(he);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?wh(l,pe,c,w,Ie.disabled,M):l.renderPass==="translucent"&&Fc(l,pe,c,w,U[he.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,M=h.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),X=M instanceof gt?[{},d]:l.stencilConfigForOverlap(d),se=X[0],he=X[1],pe=he[he.length-1].overscaledZ,Le=!l.options.moving,Oe=0,We=he;Oe<We.length;Oe+=1){var we=We[Oe],Xe=l.depthModeForSublayer(we.overscaledZ-pe,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,w.LESS),it=h.getTile(we),bt=l.transform.calculatePosMatrix(we.toUnwrapped(),Le);it.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ht=h.findLoadedParent(we,0),Wt=Bc(it,Ht,h,c,l.transform),Qt=void 0,mr=void 0,lr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),it.texture.bind(lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Ht?(Ht.texture.bind(lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Qt=Math.pow(2,Ht.tileID.overscaledZ-it.tileID.overscaledZ),mr=[it.tileID.canonical.x*Qt%1,it.tileID.canonical.y*Qt%1]):it.texture.bind(lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Mr=Ch(bt,mr||[0,0],Qt||1,Wt,c);M instanceof gt?L.draw(E,w.TRIANGLES,Xe,Ie.disabled,U,at.disabled,Mr,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):L.draw(E,w.TRIANGLES,Xe,se[we.overscaledZ],U,at.disabled,Mr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,M=w.gl,L=l.transform,U=L.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var se=!X&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===se){var he=Ie.disabled,pe=l.depthModeForSublayer(0,se==="opaque"?ge.ReadWrite:ge.ReadOnly),Le=l.colorModeForRenderPass(),Oe=l.useProgram(X?"backgroundPattern":"background"),We=L.coveringTiles({tileSize:U});X&&(w.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var we=c.getCrossfadeParameters(),Xe=0,it=We;Xe<it.length;Xe+=1){var bt=it[Xe],Ht=l.transform.calculatePosMatrix(bt.toUnwrapped()),Wt=X?Fo(Ht,E,l,X,{tileID:bt,tileSize:U},we):el(Ht,E,d);Oe.draw(w,M.TRIANGLES,pe,he,Le,at.disabled,Wt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)sp(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Ie.disabled);var M=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},ja=function(l,h){this.context=new fe(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Be.maxUnderzooming+Be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new It,this.gpuTimers={}};ja.prototype.resize=function(l,h){if(this.width=l*m.browser.devicePixelRatio,this.height=h*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},ja.prototype.setup=function(){var l=this.context,h=new m.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(m.EXTENT,0),h.emplaceBack(0,m.EXTENT),h.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ta.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ta.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Mt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ta.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Ie({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},ja.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,ge.disabled,this.stencilClearMode,He.disabled,at.disabled,Ds(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ja.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(He.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,M=h;w<M.length;w+=1){var L=M[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Ie({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),He.disabled,at.disabled,Ds(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ja.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Ie({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},ja.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Ie({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},ja.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(U,X){return X.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var M={},L=0;L<w;L++)M[L+E]=new Ie({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[M,d]}return[(h={},h[E]=Ie.disabled,h),d]},ja.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new He([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended},ja.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,h,[d,d])},ja.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ja.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var M=E[w];M.used&&M.prepare(this.context)}var L,U,X={},se={},he={};for(var pe in E){var Le=E[pe];X[pe]=Le.getVisibleCoordinates(),se[pe]=X[pe].slice().reverse(),he[pe]=Le.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Oe=0;Oe<d.length;Oe++)if(this.style._layers[d[Oe]].is3D()){this.opaquePassCutoff=Oe;break}this.renderPass="offscreen";for(var We=0,we=d;We<we.length;We+=1){var Xe=this.style._layers[we[We]];if(Xe.hasOffscreenPass()&&!Xe.isHidden(this.transform.zoom)){var it=se[Xe.source];(Xe.type==="custom"||it.length)&&this.renderLayer(this,E[Xe.source],Xe,it)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var bt=this.style._layers[d[this.currentLayer]],Ht=E[bt.source],Wt=X[bt.source];this._renderTileClippingMasks(bt,Wt),this.renderLayer(this,Ht,bt,Wt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Qt=this.style._layers[d[this.currentLayer]],mr=E[Qt.source],lr=(Qt.type==="symbol"?he:se)[Qt.source];this._renderTileClippingMasks(Qt,X[Qt.source]),this.renderLayer(this,mr,Qt,lr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Mr){Mr.source&&!Mr.isHidden(c.transform.zoom)&&(Mr.source!==(U&&U.id)&&(U=c.style.sourceCaches[Mr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&rs.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Mr){var tn=Mr.transform.padding;qf(Mr,Mr.transform.height-(tn.top||0),3,xl),qf(Mr,tn.bottom||0,3,ff),Th(Mr,tn.left||0,3,hf),Th(Mr,Mr.transform.width-(tn.right||0),3,Lu);var Ln=Mr.transform.centerPoint;(function(kn,Fn,Oi,wr){Dl(kn,Fn-1,Oi-10,2,20,wr),Dl(kn,Fn-10,Oi-1,20,2,wr)})(Mr,Ln.x,Mr.transform.height-Ln.y,pf)}(this),this.context.setDefault()},ja.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),rs[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},ja.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},ja.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},ja.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},ja.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},ja.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var M=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*M,c[0]*M+c[1]*L]}var U=[E?c[0]:Yi(h,c[0],this.transform.zoom),E?c[1]:Yi(h,c[1],this.transform.zoom),0],X=new Float32Array(16);return m.translate(X,l,U),X},ja.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},ja.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},ja.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},ja.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new af(this.context,l,Co[l],h,kl[l],this._showOverdrawInspector)),this.cache[c]},ja.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ja.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},ja.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ja.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var sc=function(l,h){this.points=l,this.planes=h};sc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return m.transformMat4([],M,l)}).map(function(M){return m.scale$1([],M,1/M[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var L=m.sub([],E[M[0]],E[M[1]]),U=m.sub([],E[M[2]],E[M[1]]),X=m.normalize([],m.cross([],L,U)),se=-m.dot(X,E[M[1]]);return X.concat(se)});return new sc(E,w)};var Fl=function(l,h){this.min=l,this.max=h,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};Fl.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Fl(c,d)},Fl.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Fl.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Fl.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,M=0;M<h.length;M++)w+=m.dot$1(E,h[M])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,X=-Number.MAX_VALUE,se=0;se<l.points.length;se++){var he=l.points[se][L]-this.min[L];U=Math.min(U,he),X=Math.max(X,he)}if(X<0||U>this.max[L]-this.min[L])return 0}return 1};var lu=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};lu.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=m.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=m.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=m.number(l.right,h.right,c)),this},lu.prototype.getCenter=function(l,h){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+h-this.bottom)/2,0,h);return new m.Point(c,d)},lu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},lu.prototype.clone=function(){return new lu(this.top,this.bottom,this.left,this.right)},lu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Li=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new lu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Li.prototype.clone=function(){var l=new Li(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var h=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var h=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Li.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Li.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},Li.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},Li.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=M-1;U<=L+1;U++)U!==0&&h.push(new m.UnwrappedTileID(U,l));return h},Li.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],M=sc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var U=function(Mr){return{aabb:new Fl([Mr*E,0,0],[(Mr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Mr,fullyVisible:!1}},X=[],se=[],he=h,pe=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var Le=1;Le<=3;Le++)X.push(U(-Le)),X.push(U(Le));for(X.push(U(0));X.length>0;){var Oe=X.pop(),We=Oe.x,we=Oe.y,Xe=Oe.fullyVisible;if(!Xe){var it=Oe.aabb.intersects(M);if(it===0)continue;Xe=it===2}var bt=Oe.aabb.distanceX(w),Ht=Oe.aabb.distanceY(w),Wt=Math.max(Math.abs(bt),Math.abs(Ht));if(Oe.zoom===he||Wt>3+(1<<he-Oe.zoom)-2&&Oe.zoom>=L)se.push({tileID:new m.OverscaledTileID(Oe.zoom===he?pe:Oe.zoom,Oe.wrap,Oe.zoom,We,we),distanceSq:m.sqrLen([w[0]-.5-We,w[1]-.5-we])});else for(var Qt=0;Qt<4;Qt++){var mr=(We<<1)+Qt%2,lr=(we<<1)+(Qt>>1);X.push({aabb:Oe.aabb.quadrant(Qt),zoom:Oe.zoom+1,x:mr,y:lr,wrap:Oe.wrap,fullyVisible:Xe})}}return se.sort(function(Mr,tn){return Mr.distanceSq-tn.distanceSq}).map(function(Mr){return Mr.tileID})},Li.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Li.prototype.zoomScale=function(l){return Math.pow(2,l)},Li.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Li.prototype.project=function(l){var h=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(h)*this.worldSize)},Li.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Li.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Li.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Li.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Li.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Li.prototype.coordinateLocation=function(l){return l.toLngLat()},Li.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(h,h,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,M=c[1]/E,L=h[2]/d,U=c[2]/E,X=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(h[0]/d,c[0]/E,X)/this.worldSize,m.number(w,M,X)/this.worldSize)},Li.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix),new m.Point(h[0]/h[3],h[1]/h[3])},Li.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Li.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Li.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Li.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[M*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Li.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Li.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,M=-180,L=180,U=this.size,X=this._unmodified;if(this.latRange){var se=this.latRange;E=m.mercatorYfromLat(se[1])*this.worldSize,l=(w=m.mercatorYfromLat(se[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var he=this.lngRange;M=m.mercatorXfromLng(he[0])*this.worldSize,h=(L=m.mercatorXfromLng(he[1])*this.worldSize)-M<U.x?U.x/(L-M):0}var pe=this.point,Le=Math.max(h||0,l||0);if(Le)return this.center=this.unproject(new m.Point(h?(L+M)/2:pe.x,l?(w+E)/2:pe.y)),this.zoom+=this.scaleZoom(Le),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Oe=pe.y,We=U.y/2;Oe-We<E&&(d=E+We),Oe+We>w&&(d=w-We)}if(this.lngRange){var we=pe.x,Xe=U.x/2;we-Xe<M&&(c=M+Xe),we+Xe>L&&(c=L-Xe)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:pe.x,d!==void 0?d:pe.y))),this._unmodified=X,this._constraining=!1}},Li.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,M=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,X=new Float64Array(16);m.perspective(X,this._fov,this.width/this.height,U,L),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,m.scale(X,X,[1,-1,1]),m.translate(X,X,[0,0,-this.cameraToCenterDistance]),m.rotateX(X,X,this._pitch),m.rotateZ(X,X,this.angle),m.translate(X,X,[-w,-M,0]),this.mercatorMatrix=m.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),m.scale(X,X,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=m.invert([],this.projMatrix);var se=this.width%2/2,he=this.height%2/2,pe=Math.cos(this.angle),Le=Math.sin(this.angle),Oe=w-Math.round(w)+pe*se+Le*he,We=M-Math.round(M)+pe*he+Le*se,we=new Float64Array(X);if(m.translate(we,we,[Oe>.5?Oe-1:Oe,We>.5?We-1:We,0]),this.alignedProjMatrix=we,X=m.create(),m.scale(X,X,[this.width/2,-this.height/2,1]),m.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=m.create(),m.scale(X,X,[1,-1,1]),m.translate(X,X,[-1,-1,0]),m.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Li.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Li.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Li.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,M=0,L=l;M<L.length;M+=1){var U=L[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Li.prototype,Ma);var Fs=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Fs.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Fs.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Fs.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,M=Math.round(h.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),X="";if(X+=l?"/"+w+"/"+M+"/"+c:c+"/"+M+"/"+w,(L||U)&&(X+="/"+Math.round(10*L)/10),U&&(X+="/"+Math.round(U)),this._hashName){var se=this._hashName,he=!1,pe=m.window.location.hash.slice(1).split("&").map(function(Le){var Oe=Le.split("=")[0];return Oe===se?(he=!0,Oe+"="+X):Le}).filter(function(Le){return Le});return he||pe.push(se+"="+X),"#"+pe.join("&")}return"#"+X},Fs.prototype._getCurrentHash=function(){var l,h=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Fs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Fs.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(h){}};var df={linearity:.3,easing:m.bezier(0,0,.3,1)},bl=m.extend({deceleration:2500,maxSpeed:1400},df),vf=m.extend({deceleration:20,maxSpeed:1400},df),up=m.extend({deceleration:1e3,maxSpeed:360},df),lp=m.extend({deceleration:1e3,maxSpeed:90},df),Nc=function(l){this._map=l,this.clear()};function uc(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function nl(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,M=m.clamp(l*E/(h/1e3),-d,d),L=Math.abs(M)/(w*E);return{easing:c.easing,duration:1e3*L,amount:M*(L/2)}}Nc.prototype.clear=function(){this._inertiaBuffer=[]},Nc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Nc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=m.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},Nc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(h.pan.mag()){var L=nl(h.pan.mag(),w,m.extend({},bl,l||{}));M.offset=h.pan.mult(L.amount/h.pan.mag()),M.center=this._map.transform.center,uc(M,L)}if(h.zoom){var U=nl(h.zoom,w,vf);M.zoom=this._map.transform.zoom+U.amount,uc(M,U)}if(h.bearing){var X=nl(h.bearing,w,up);M.bearing=this._map.transform.bearing+m.clamp(X.amount,-179,179),uc(M,X)}if(h.pitch){var se=nl(h.pitch,w,lp);M.pitch=this._map.transform.pitch+se.amount,uc(M,se)}if(M.zoom||M.bearing){var he=h.pinchAround===void 0?h.around:h.pinchAround;M.around=he?this._map.unproject(he):this._map.getCenter()}return this.clear(),m.extend(M,{noMoveStart:!0})}};var Ao=function(l){function h(d,E,w,M){M===void 0&&(M={});var L=j.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:w},M)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),lc=function(l){function h(d,E,w){var M=d==="touchend"?w.changedTouches:w.touches,L=j.touchPos(E.getCanvasContainer(),M),U=L.map(function(he){return E.unproject(he)}),X=L.reduce(function(he,pe,Le,Oe){return he.add(pe.div(Oe.length))},new m.Point(0,0)),se=E.unproject(X);l.call(this,d,{points:L,point:X,lngLats:U,lngLat:se,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),cc=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),Xa=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};Xa.prototype.reset=function(){delete this._mousedownPos},Xa.prototype.wheel=function(l){return this._firePreventable(new cc(l.type,this._map,l))},Xa.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new Ao(l.type,this._map,l))},Xa.prototype.mouseup=function(l){this._map.fire(new Ao(l.type,this._map,l))},Xa.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Ao(l.type,this._map,l))},Xa.prototype.dblclick=function(l){return this._firePreventable(new Ao(l.type,this._map,l))},Xa.prototype.mouseover=function(l){this._map.fire(new Ao(l.type,this._map,l))},Xa.prototype.mouseout=function(l){this._map.fire(new Ao(l.type,this._map,l))},Xa.prototype.touchstart=function(l){return this._firePreventable(new lc(l.type,this._map,l))},Xa.prototype.touchmove=function(l){this._map.fire(new lc(l.type,this._map,l))},Xa.prototype.touchend=function(l){this._map.fire(new lc(l.type,this._map,l))},Xa.prototype.touchcancel=function(l){this._map.fire(new lc(l.type,this._map,l))},Xa.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Xa.prototype.isEnabled=function(){return!0},Xa.prototype.isActive=function(){return!1},Xa.prototype.enable=function(){},Xa.prototype.disable=function(){};var mn=function(l){this._map=l};mn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},mn.prototype.mousemove=function(l){this._map.fire(new Ao(l.type,this._map,l))},mn.prototype.mousedown=function(){this._delayContextMenu=!0},mn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},mn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Ao(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},mn.prototype.isEnabled=function(){return!0},mn.prototype.isActive=function(){return!1},mn.prototype.enable=function(){},mn.prototype.disable=function(){};var eo=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function il(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}eo.prototype.isEnabled=function(){return!!this._enabled},eo.prototype.isActive=function(){return!!this._active},eo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},eo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},eo.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(j.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},eo.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=j.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),M=Math.min(d.y,c.y),L=Math.max(d.y,c.y);j.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-M+"px"}}},eo.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),j.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},eo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},eo.prototype.blur=function(){this.reset()},eo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos},eo.prototype._fireEvent=function(l,h){return this._map.fire(new m.Event(l,{originalEvent:h}))};var al=function(l){this.reset(),this.numTouches=l.numTouches};al.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},al.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,M=d;w<M.length;w+=1)E._add(M[w]);return E.div(d.length)}(h),this.touches=il(c,h)))},al.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=il(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},al.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var xu=function(l){this.singleTap=new al(l),this.numTaps=l.numTaps,this.reset()};xu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},xu.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},xu.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},xu.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Bs=function(){this._zoomIn=new xu({numTouches:1,numTaps:2}),this._zoomOut=new xu({numTouches:2,numTaps:1}),this.reset()};Bs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Bs.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},Bs.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},Bs.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(w)},{originalEvent:l})}}):void 0},Bs.prototype.touchcancel=function(){this.reset()},Bs.prototype.enable=function(){this._enabled=!0},Bs.prototype.disable=function(){this._enabled=!1,this.reset()},Bs.prototype.isEnabled=function(){return this._enabled},Bs.prototype.isActive=function(){return this._active};var Kf={0:1,2:2},qr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(l,h){return!1},qr.prototype._move=function(l,h){return{}},qr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=j.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},qr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Kf[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},qr.prototype.mouseupWindow=function(l){this._lastPoint&&j.mouseButton(l)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var mf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(qr),$f=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(qr),ku=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(qr),Fa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Fa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Fa.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Fa.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Fa.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Fa.prototype.touchcancel=function(){this.reset()},Fa.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=il(c,h),E=new m.Point(0,0),w=new m.Point(0,0),M=0;for(var L in d){var U=d[L],X=this._touches[L];X&&(E._add(U),w._add(U.sub(X)),M++,d[L]=U)}if(this._touches=d,!(M<this._minTouches)&&w.mag()){var se=w.div(M);if(this._sum._add(se),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:se}}},Fa.prototype.enable=function(){this._enabled=!0},Fa.prototype.disable=function(){this._enabled=!1,this.reset()},Fa.prototype.isEnabled=function(){return this._enabled},Fa.prototype.isActive=function(){return this._active};var Ns=function(){this.reset()};function gf(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function Du(l,h){return Math.log(l/h)/Math.LN2}Ns.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ns.prototype._start=function(l){},Ns.prototype._move=function(l,h,c){return{}},Ns.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},Ns.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=gf(c,h,d[0]),M=gf(c,h,E);if(w&&M){var L=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],L,l)}}},Ns.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=gf(c,h,d[0]),M=gf(c,h,E);w&&M||(this._active&&j.suppressClick(),this.reset())}},Ns.prototype.touchcancel=function(){this.reset()},Ns.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Ns.prototype.disable=function(){this._enabled=!1,this.reset()},Ns.prototype.isEnabled=function(){return this._enabled},Ns.prototype.isActive=function(){return this._active};var ws=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Du(this._distance,E),pinchAround:d}},h}(Ns);function mo(l,h){return 180*l.angleWith(h)/Math.PI}var Mh=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mo(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=mo(c,this._startVector);return Math.abs(E)<d},h}(Ns);function pa(l){return Math.abs(l.y)>Math.abs(l.x)}var Qf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,pa(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+M.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,M=d.mag()>=2;if(w||M){if(!w||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return pa(c)&&pa(d)&&L}},h}(Ns),Ph={panStep:100,bearingStep:15,pitchStep:10},Ks=function(){var l=Ph;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ts(l){return l*(2-l)}Ks.prototype.blur=function(){this.reset()},Ks.prototype.reset=function(){this._active=!1},Ks.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ts,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-M*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},Ks.prototype.enable=function(){this._enabled=!0},Ks.prototype.disable=function(){this._enabled=!1,this.reset()},Ks.prototype.isEnabled=function(){return this._enabled},Ks.prototype.isActive=function(){return this._active},Ks.prototype.disableRotation=function(){this._rotationDisabled=!0},Ks.prototype.enableRotation=function(){this._rotationDisabled=!1};var Pi=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Pi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Pi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Pi.prototype.isEnabled=function(){return!!this._enabled},Pi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Pi.prototype.isZooming=function(){return!!this._zooming},Pi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Pi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Pi.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},Pi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Pi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=j.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Pi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,M=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,U=this._easing,X=!1;if(this._type==="wheel"&&L&&U){var se=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),he=U(se);w=m.number(L,M,he),se<1?this._frameId||(this._frameId=!0):X=!0}else w=M,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Pi.prototype._smoothOutEasing=function(l){var h=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-w*w);h=m.bezier(w,M,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:h},h},Pi.prototype.blur=function(){this.reset()},Pi.prototype.reset=function(){this._active=!1};var bu=function(l,h){this._clickZoom=l,this._tapZoom=h};bu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},bu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},bu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},bu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var la=function(){this.reset()};la.prototype.reset=function(){this._active=!1},la.prototype.blur=function(){this.reset()},la.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},la.prototype.enable=function(){this._enabled=!0},la.prototype.disable=function(){this._enabled=!1,this.reset()},la.prototype.isEnabled=function(){return this._enabled},la.prototype.isActive=function(){return this._active};var no=function(){this._tap=new xu({numTouches:1,numTaps:1}),this.reset()};no.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},no.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},no.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},no.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},no.prototype.touchcancel=function(){this.reset()},no.prototype.enable=function(){this._enabled=!0},no.prototype.disable=function(){this._enabled=!1,this.reset()},no.prototype.isEnabled=function(){return this._enabled},no.prototype.isActive=function(){return this._active};var zs=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};zs.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},zs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},zs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},zs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var cu=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};cu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},cu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},cu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},cu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Us=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Us.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Us.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Us.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Us.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Us.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Us.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var hs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Zs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(m.Event);function In(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var An=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nc(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],M=w[0];j.addEventListener(M,w[1],M===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};An.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];j.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},An.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new Xa(h,l));var d=h.boxZoom=new eo(h,l);this._add("boxZoom",d);var E=new Bs,w=new la;h.doubleClickZoom=new bu(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var M=new no;this._add("tapDragZoom",M);var L=h.touchPitch=new Qf;this._add("touchPitch",L);var U=new $f(l),X=new ku(l);h.dragRotate=new cu(l,U,X),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var se=new mf(l),he=new Fa(l);h.dragPan=new zs(c,se,he),this._add("mousePan",se),this._add("touchPan",he,["touchZoom","touchRotate"]);var pe=new Mh,Le=new ws;h.touchZoomRotate=new Us(c,Le,pe,M),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]);var Oe=h.scrollZoom=new Pi(h,this);this._add("scrollZoom",Oe,["mousePan"]);var We=h.keyboard=new Ks;this._add("keyboard",We),this._add("blockableMapEvent",new mn(h));for(var we=0,Xe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];we<Xe.length;we+=1){var it=Xe[we];l.interactive&&l[it]&&h[it].enable(l[it])}},An.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},An.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},An.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},An.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},An.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},An.prototype.isMoving=function(){return Boolean(hs(this._eventsInProgress))||this.isZooming()},An.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},An.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},An.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},An.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},M=l.touches?this._getMapTouches(l.touches):void 0,L=M?j.touchPos(this._el,M):j.mousePos(this._el,l),U=0,X=this._handlers;U<X.length;U+=1){var se=X[U],he=se.handlerName,pe=se.handler,Le=se.allowed;if(pe.isEnabled()){var Oe=void 0;this._blockedByActive(w,Le,he)?pe.reset():pe[h||l.type]&&(Oe=pe[h||l.type](l,L,M),this.mergeHandlerResult(d,E,Oe,he,c),Oe&&Oe.needsRenderFrame&&this._triggerRenderFrame()),(Oe||pe.isActive())&&(w[he]=pe)}}var We={};for(var we in this._previousActiveHandlers)w[we]||(We[we]=c);this._previousActiveHandlers=w,(Object.keys(We).length||In(d))&&(this._changes.push([d,E,We]),this._triggerRenderFrame()),(Object.keys(w).length||In(d))&&this._map._stop(!0),this._updatingCamera=!1;var Xe=d.cameraAnimation;Xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Xe(this._map))},An.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},An.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],M=w[0],L=w[1],U=w[2];M.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),m.extend(h,L),m.extend(c,U)}this._updateMapTransform(l,h,c),this._changes=[]},An.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!In(l))return this._fireEvents(h,c,!0);var w=l.panDelta,M=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,X=l.around,se=l.pinchAround;se!==void 0&&(X=se),d._stop(!0),X=X||d.transform.centerPoint;var he=E.pointLocation(w?X.sub(w):X);L&&(E.bearing+=L),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(he,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},An.prototype._fireEvents=function(l,h,c){var d=this,E=hs(this._eventsInProgress),w=hs(l),M={};for(var L in l)this._eventsInProgress[L]||(M[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),M)this._fireEvent(U,M[U]);for(var X in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var se,he={};for(var pe in this._eventsInProgress){var Le=this._eventsInProgress[pe],Oe=Le.handlerName,We=Le.originalEvent;this._handlersById[Oe].isActive()||(delete this._eventsInProgress[pe],he[pe+"end"]=se=h[Oe]||We)}for(var we in he)this._fireEvent(we,he[we]);var Xe=hs(this._eventsInProgress);if(c&&(E||w)&&!Xe){this._updatingCamera=!0;var it=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),bt=function(Ht){return Ht!==0&&-d._bearingSnap<Ht&&Ht<d._bearingSnap};it?(bt(it.bearing||this._map.getBearing())&&(it.bearing=0),this._map.easeTo(it,{originalEvent:se})):(this._map.fire(new m.Event("moveend",{originalEvent:se})),bt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},An.prototype._fireEvent=function(l,h){this._map.fire(new m.Event(l,h?{originalEvent:h}:{}))},An.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new Zs("renderFrame",{timeStamp:h})),l._applyChanges()})},An.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var fc=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var M={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(M,w.padding);var U=this.transform,X=U.padding,se=U.project(m.LngLat.convert(c)),he=U.project(m.LngLat.convert(d)),pe=se.rotate(-E*Math.PI/180),Le=he.rotate(-E*Math.PI/180),Oe=new m.Point(Math.max(pe.x,Le.x),Math.max(pe.y,Le.y)),We=new m.Point(Math.min(pe.x,Le.x),Math.min(pe.y,Le.y)),we=Oe.sub(We),Xe=(U.width-(X.left+X.right+w.padding.left+w.padding.right))/we.x,it=(U.height-(X.top+X.bottom+w.padding.top+w.padding.bottom))/we.y;if(!(it<0||Xe<0)){var bt=Math.min(U.scaleZoom(U.scale*Math.min(Xe,it)),w.maxZoom),Ht=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Wt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Qt=Ht.add(Wt).mult(U.scale/U.zoomScale(bt));return{center:U.unproject(se.add(he).div(2).sub(Qt)),zoom:bt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,M)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,M=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),M&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,M=this.getZoom(),L=this.getBearing(),U=this.getPitch(),X=this.getPadding(),se="zoom"in c?+c.zoom:M,he="bearing"in c?this._normalizeBearing(c.bearing,L):L,pe="pitch"in c?+c.pitch:U,Le="padding"in c?c.padding:w.padding,Oe=m.Point.convert(c.offset),We=w.centerPoint.add(Oe),we=w.pointLocation(We),Xe=m.LngLat.convert(c.center||we);this._normalizeCenter(Xe);var it,bt,Ht=w.project(we),Wt=w.project(Xe).sub(Ht),Qt=w.zoomScale(se-M);c.around&&(it=m.LngLat.convert(c.around),bt=w.locationPoint(it));var mr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==M,this._rotating=this._rotating||L!==he,this._pitching=this._pitching||pe!==U,this._padding=!w.isPaddingEqual(Le),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,mr),this._ease(function(lr){if(E._zooming&&(w.zoom=m.number(M,se,lr)),E._rotating&&(w.bearing=m.number(L,he,lr)),E._pitching&&(w.pitch=m.number(U,pe,lr)),E._padding&&(w.interpolatePadding(X,Le,lr),We=w.centerPoint.add(Oe)),it)w.setLocationAtPoint(it,bt);else{var Mr=w.zoomScale(w.zoom-M),tn=se>M?Math.min(2,Qt):Math.max(.5,Qt),Ln=Math.pow(tn,1-lr),kn=w.unproject(Ht.add(Wt.mult(lr*Ln)).mult(Mr));w.setLocationAtPoint(w.renderWorldCopies?kn.wrap():kn,We)}E._fireMoveEvents(d)},function(lr){E._afterEase(d,lr)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),M&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var M=this.transform,L=this.getZoom(),U=this.getBearing(),X=this.getPitch(),se=this.getPadding(),he="zoom"in c?m.clamp(+c.zoom,M.minZoom,M.maxZoom):L,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Le="pitch"in c?+c.pitch:X,Oe="padding"in c?c.padding:M.padding,We=M.zoomScale(he-L),we=m.Point.convert(c.offset),Xe=M.centerPoint.add(we),it=M.pointLocation(Xe),bt=m.LngLat.convert(c.center||it);this._normalizeCenter(bt);var Ht=M.project(it),Wt=M.project(bt).sub(Ht),Qt=c.curve,mr=Math.max(M.width,M.height),lr=mr/We,Mr=Wt.mag();if("minZoom"in c){var tn=m.clamp(Math.min(c.minZoom,L,he),M.minZoom,M.maxZoom),Ln=mr/M.zoomScale(tn-L);Qt=Math.sqrt(Ln/Mr*2)}var kn=Qt*Qt;function Fn(On){var Sn=(lr*lr-mr*mr+(On?-1:1)*kn*kn*Mr*Mr)/(2*(On?lr:mr)*kn*Mr);return Math.log(Math.sqrt(Sn*Sn+1)-Sn)}function Oi(On){return(Math.exp(On)-Math.exp(-On))/2}function wr(On){return(Math.exp(On)+Math.exp(-On))/2}var Yn=Fn(0),ti=function(On){return wr(Yn)/wr(Yn+Qt*On)},ri=function(On){return mr*((wr(Yn)*(Oi(Sn=Yn+Qt*On)/wr(Sn))-Oi(Yn))/kn)/Mr;var Sn},Wn=(Fn(1)-Yn)/Qt;if(Math.abs(Mr)<1e-6||!isFinite(Wn)){if(Math.abs(mr-lr)<1e-6)return this.easeTo(c,d);var oi=lr<mr?-1:1;Wn=Math.abs(Math.log(lr/mr))/Qt,ri=function(){return 0},ti=function(On){return Math.exp(oi*Qt*On)}}return c.duration="duration"in c?+c.duration:1e3*Wn/("screenSpeed"in c?+c.screenSpeed/Qt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Le!==X,this._padding=!M.isPaddingEqual(Oe),this._prepareEase(d,!1),this._ease(function(On){var Sn=On*Wn,go=1/ti(Sn);M.zoom=On===1?he:L+M.scaleZoom(go),E._rotating&&(M.bearing=m.number(U,pe,On)),E._pitching&&(M.pitch=m.number(X,Le,On)),E._padding&&(M.interpolatePadding(se,Oe,On),Xe=M.centerPoint.add(we));var Xn=On===1?bt:M.unproject(Ht.add(Wt.mult(ri(Sn))).mult(go));M.setLocationAtPoint(M.renderWorldCopies?Xn.wrap():Xn,Xe),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(m.Evented),ps=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ps.prototype.getDefaultPosition=function(){return"bottom-right"},ps.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ps.prototype.onRemove=function(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ps.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},ps.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ps.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ps.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ps.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var M=(l=l.filter(function(L,U){for(var X=U+1;X<l.length;X++)if(l[X].indexOf(L)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ps.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Eu=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Eu.prototype.onAdd=function(l){this._map=l,this._container=j.create("div","mapboxgl-ctrl");var h=j.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Eu.prototype.onRemove=function(){j.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Eu.prototype.getDefaultPosition=function(){return"bottom-left"},Eu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Eu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},Eu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Ko=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ko.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},Ko.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Ko.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ko.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var xa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},yf=m.window.HTMLImageElement,zc=m.window.HTMLElement,ia=m.window.ImageBitmap,La={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Jf=function(l){function h(d){var E=this;if((d=m.extend({},La,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Li(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ko,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},xa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof zc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new An(this,d),this._hash=d.hash&&new Fs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ps({customAttribution:d.customAttribution})),this.addControl(new Eu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new m.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new m.Event(M.dataType+"dataloading",M))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(w,M.firstChild):M.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],M=E[1];if(w===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(w,M),this.transform.resize(w,M),this.painter.resize(w,M);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var M,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(se){var he=L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[];he.length?U||(U=!0,w.call(L,new Ao(d,L,se.originalEvent,{features:he}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:E,listener:w,delegates:{mousemove:function(se){(L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[]).length?X=!0:X&&(X=!1,w.call(L,new Ao(d,L,se.originalEvent)))},mouseout:function(se){X&&(X=!1,w.call(L,new Ao(d,L,se.originalEvent)))}}}}return{layer:E,listener:w,delegates:(M={},M[d]=function(se){var he=L.getLayer(E)?L.queryRenderedFeatures(se.point,{layers:[E]}):[];he.length&&(se.features=he,w.call(L,se),delete se.features)},M)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(L,M.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in M.delegates)this.once(L,M.delegates[L]);return this},h.prototype.off=function(d,E,w){var M=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],X=0;X<U.length;X++){var se=U[X];if(se.layer===E&&se.listener===w){for(var he in se.delegates)M.off(he,se.delegates[he]);return U.splice(X,1),M}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var M=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[M,new m.Point(L.x,M.y),L,new m.Point(M.x,L.y),M]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new fs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new fs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(M,m.ResourceType.Style);m.getJSON(L,function(U,X){U?w.fire(new m.ErrorEvent(U)):X&&w._updateDiff(X,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var M in w){var L=w[M];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var M=w.pixelRatio;M===void 0&&(M=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,X=w.stretchY,se=w.content;if(this._lazyInitEmptyStyle(),E instanceof yf||ia&&E instanceof ia){var he=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:he.width,height:he.height},he.data),pixelRatio:M,stretchX:U,stretchY:X,content:se,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:X,content:se,sdf:L,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof yf||ia&&E instanceof ia?m.browser.getImageData(E):E,L=M.width,U=M.height,X=M.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(X,!(E instanceof yf||ia&&E instanceof ia)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,w,M),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,w,M),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=j.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=j.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=j.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var M=this._controlContainer=j.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=j.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=m.extend({},ve.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new ja(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,M=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),M=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,se=m.browser.now();this.style.zoomHistory.update(X,se);var he=new m.EvaluationParameters(X,{now:se,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=he.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(he)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Le=m.browser.now()-M;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var we=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Le,gpuTime:we}))},50)}if(this.listens("gpu-timing-layer")){var Oe=this.painter.collectGpuTimers();setTimeout(function(){var we=w.painter.queryGpuTimers(Oe);w.fire(new m.Event("gpu-timing-layer",{layerTimes:we}))},50)}var We=this._sourcesDirty||this._styleDirty||this._placementDirty;return We||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||We||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),ol(this._canvasContainer),ol(this._controlContainer),ol(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(h.prototype,c),h}(fc);function ol(l){l.parentNode&&l.parentNode.removeChild(l)}var $s={showCompass:!0,showZoom:!0,visualizePitch:!1},Su=function(l){var h=this;this.options=m.extend({},$s,l),this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=j.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Su.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Su.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Su.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wo(this._map,this._compass,this.options.visualizePitch)),this._container},Su.prototype.onRemove=function(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Su.prototype._createButton=function(l,h){var c=j.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},Su.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var wo=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new $f({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ku({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(h,"mousedown",this.mousedown),j.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(h,"touchmove",this.touchmove),j.addEventListener(h,"touchend",this.touchend),j.addEventListener(h,"touchcancel",this.reset)};function sl(l,h,c){if(l=new m.LngLat(l.lng,l.lat),h){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}wo.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),j.disableDrag()},wo.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},wo.prototype.off=function(){var l=this.element;j.removeEventListener(l,"mousedown",this.mousedown),j.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(l,"touchmove",this.touchmove),j.removeEventListener(l,"touchend",this.touchend),j.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},wo.prototype.offTemp=function(){j.enableDrag(),j.removeEventListener(m.window,"mousemove",this.mousemove),j.removeEventListener(m.window,"mouseup",this.mouseup)},wo.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),j.mousePos(this.element,l)),j.addEventListener(m.window,"mousemove",this.mousemove),j.addEventListener(m.window,"mouseup",this.mouseup)},wo.prototype.mousemove=function(l){this.move(l,j.mousePos(this.element,l))},wo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},wo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},wo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},wo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},wo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function El(l,h,c){var d=l.classList;for(var E in Cu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var ul,hc=function(l){function h(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");var E=j.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=j.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var M=j.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var L=j.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<X.length;U+=1){var se=X[U],he=j.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",se.rx),he.setAttributeNS(null,"ry",se.ry),L.appendChild(he)}var pe=j.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Le=j.createNS("http://www.w3.org/2000/svg","path");Le.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Le);var Oe=j.createNS("http://www.w3.org/2000/svg","g");Oe.setAttributeNS(null,"opacity","0.25"),Oe.setAttributeNS(null,"fill","#000000");var We=j.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Oe.appendChild(We);var we=j.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"transform","translate(6.0, 7.0)"),we.setAttributeNS(null,"fill","#FFFFFF");var Xe=j.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var it=j.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#000000"),it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962");var bt=j.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#FFFFFF"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962"),Xe.appendChild(it),Xe.appendChild(bt),M.appendChild(L),M.appendChild(pe),M.appendChild(Oe),M.appendChild(we),M.appendChild(Xe),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ht){Ht.preventDefault()}),this._element.addEventListener("mousedown",function(Ht){Ht.preventDefault()}),El(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,Cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(m.Evented),_f={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Sl=0,Cl=!1,Ih=function(l){function h(c){l.call(this),this.options=m.extend({},_f,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,ul!==void 0?d(ul):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(ul=E.state!=="denied")}):d(ul=!!m.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sl=0,Cl=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),M=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),M=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Cl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=j.create("button","mapboxgl-ctrl-geolocate",this._container),j.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new hc(this._dotElement),this._circleElement=j.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sl--,Cl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Sl>1?(c={maximumAge:6e5,timeout:0},Cl=!0):(c=this.options.positionOptions,Cl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(m.Evented),Al={maxWidth:100,unit:"metric"},Bl=function(l){this.options=m.extend({},Al,l),m.bindAll(["_onMove","setUnit"],this)};function xf(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),M=l.unproject([d,E]),L=w.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?Fu(h,d,U/5280,l._getUIString("ScaleControl.Miles")):Fu(h,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Fu(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Fu(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):Fu(h,d,L,l._getUIString("ScaleControl.Meters"))}function Fu(l,h,c,d){var E,w,M,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/w)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var X=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*X)/X}(M)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Bl.prototype.getDefaultPosition=function(){return"bottom-left"},Bl.prototype._onMove=function(){xf(this._map,this._container,this.options)},Bl.prototype.onAdd=function(l){return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Bl.prototype.onRemove=function(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Bl.prototype.setUnit=function(l){this.options.unit=l,xf(this._map,this._container,this.options)};var bs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};bs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},bs.prototype.onRemove=function(){j.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},bs.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},bs.prototype._setupUI=function(){var l=this._fullscreenButton=j.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},bs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},bs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},bs.prototype._isFullscreen=function(){return this._fullscreen},bs.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},bs.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var bf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Oh=function(l){function h(c){l.call(this),this.options=m.extend(Object.create(bf),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=j.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=j.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(he){return d._container.classList.add(he)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,M=function he(pe){if(pe){if(typeof pe=="number"){var Le=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new m.Point(0,0),top:new m.Point(0,pe),"top-left":new m.Point(Le,Le),"top-right":new m.Point(-Le,Le),bottom:new m.Point(0,-pe),"bottom-left":new m.Point(Le,-Le),"bottom-right":new m.Point(-Le,-Le),left:new m.Point(pe,0),right:new m.Point(-pe,0)}}if(pe instanceof m.Point||Array.isArray(pe)){var Oe=m.Point.convert(pe);return{center:Oe,top:Oe,"top-left":Oe,"top-right":Oe,bottom:Oe,"bottom-left":Oe,"bottom-right":Oe,left:Oe,right:Oe}}return{center:m.Point.convert(pe.center||[0,0]),top:m.Point.convert(pe.top||[0,0]),"top-left":m.Point.convert(pe["top-left"]||[0,0]),"top-right":m.Point.convert(pe["top-right"]||[0,0]),bottom:m.Point.convert(pe.bottom||[0,0]),"bottom-left":m.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(pe["bottom-right"]||[0,0]),left:m.Point.convert(pe.left||[0,0]),right:m.Point.convert(pe.right||[0,0])}}return he(new m.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,X=this._container.offsetHeight;L=E.y+M.bottom.y<X?["top"]:E.y>this._map.transform.height-X?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var se=E.add(M[w]).round();j.setTransform(this._container,Cu[w]+" translate("+se.x+"px,"+se.y+"px)"),El(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(pc);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(m.Evented),Nl={version:m.version,supported:ve,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:Jf,NavigationControl:Su,GeolocateControl:Ih,AttributionControl:ps,ScaleControl:Bl,FullscreenControl:bs,Popup:Oh,Marker:hc,Style:fs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Rt().acquire(zt)},clearPrewarmedResources:function(){var l=bn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(zt),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return gr.workerCount},set workerCount(l){gr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Nl}),le})},28660:function(Ot,J,N){var le=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(m){(function(ve){var j=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ue(m);typeof j.Reflect=="undefined"?j.Reflect=m:ce=ue(j.Reflect,ce),ve(ce);function ue(ze,ae){return function(nt,ke){typeof ze[nt]!="function"&&Object.defineProperty(ze,nt,{configurable:!0,writable:!0,value:ke}),ae&&ae(nt,ke)}}})(function(ve){var j=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ue=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ze=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ae=typeof Object.create=="function",nt={__proto__:[]}instanceof Array,ke=!ae&&!nt,st={create:ae?function(){return us(Object.create(null))}:nt?function(){return us({__proto__:null})}:function(){return us({})},has:ke?function(jt,ir){return j.call(jt,ir)}:function(jt,ir){return ir in jt},get:ke?function(jt,ir){return j.call(jt,ir)?jt[ir]:void 0}:function(jt,ir){return jt[ir]}},Gt=Object.getPrototypeOf(Function),sr=typeof le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Pt=!sr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:de(),er=!sr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Nn(),Lt=!sr&&typeof WeakMap=="function"?WeakMap:Ua(),ht=new Lt;function mt(jt,ir,Tr,I){if(pn(Tr)){if(!Ei(jt))throw new TypeError;if(!na(ir))throw new TypeError;return Fr(jt,ir)}else{if(!Ei(jt))throw new TypeError;if(!Gn(ir))throw new TypeError;if(!Gn(I)&&!pn(I)&&!Wi(I))throw new TypeError;return Wi(I)&&(I=void 0),Tr=Ii(Tr),en(jt,ir,Tr,I)}}ve("decorate",mt);function tr(jt,ir){function Tr(I,nr){if(!Gn(I))throw new TypeError;if(!pn(nr)&&!Si(nr))throw new TypeError;Zt(jt,ir,I,nr)}return Tr}ve("metadata",tr);function q(jt,ir,Tr,I){if(!Gn(Tr))throw new TypeError;return pn(I)||(I=Ii(I)),Zt(jt,ir,Tr,I)}ve("defineMetadata",q);function Jt(jt,ir,Tr){if(!Gn(ir))throw new TypeError;return pn(Tr)||(Tr=Ii(Tr)),Ke(jt,ir,Tr)}ve("hasMetadata",Jt);function _t(jt,ir,Tr){if(!Gn(ir))throw new TypeError;return pn(Tr)||(Tr=Ii(Tr)),Fe(jt,ir,Tr)}ve("hasOwnMetadata",_t);function rt(jt,ir,Tr){if(!Gn(ir))throw new TypeError;return pn(Tr)||(Tr=Ii(Tr)),Mt(jt,ir,Tr)}ve("getMetadata",rt);function At(jt,ir,Tr){if(!Gn(ir))throw new TypeError;return pn(Tr)||(Tr=Ii(Tr)),gt(jt,ir,Tr)}ve("getOwnMetadata",At);function tt(jt,ir){if(!Gn(jt))throw new TypeError;return pn(ir)||(ir=Ii(ir)),qt(jt,ir)}ve("getMetadataKeys",tt);function $t(jt,ir){if(!Gn(jt))throw new TypeError;return pn(ir)||(ir=Ii(ir)),Er(jt,ir)}ve("getOwnMetadataKeys",$t);function br(jt,ir,Tr){if(!Gn(ir))throw new TypeError;pn(Tr)||(Tr=Ii(Tr));var I=Te(ir,Tr,!1);if(pn(I)||!I.delete(jt))return!1;if(I.size>0)return!0;var nr=ht.get(ir);return nr.delete(Tr),nr.size>0||ht.delete(ir),!0}ve("deleteMetadata",br);function Fr(jt,ir){for(var Tr=jt.length-1;Tr>=0;--Tr){var I=jt[Tr],nr=I(ir);if(!pn(nr)&&!Wi(nr)){if(!na(nr))throw new TypeError;ir=nr}}return ir}function en(jt,ir,Tr,I){for(var nr=jt.length-1;nr>=0;--nr){var Dn=jt[nr],li=Dn(ir,Tr,I);if(!pn(li)&&!Wi(li)){if(!Gn(li))throw new TypeError;I=li}}return I}function Te(jt,ir,Tr){var I=ht.get(jt);if(pn(I)){if(!Tr)return;I=new Pt,ht.set(jt,I)}var nr=I.get(ir);if(pn(nr)){if(!Tr)return;nr=new Pt,I.set(ir,nr)}return nr}function Ke(jt,ir,Tr){var I=Fe(jt,ir,Tr);if(I)return!0;var nr=za(ir);return Wi(nr)?!1:Ke(jt,nr,Tr)}function Fe(jt,ir,Tr){var I=Te(ir,Tr,!1);return pn(I)?!1:ui(I.has(jt))}function Mt(jt,ir,Tr){var I=Fe(jt,ir,Tr);if(I)return gt(jt,ir,Tr);var nr=za(ir);if(!Wi(nr))return Mt(jt,nr,Tr)}function gt(jt,ir,Tr){var I=Te(ir,Tr,!1);if(!pn(I))return I.get(jt)}function Zt(jt,ir,Tr,I){var nr=Te(Tr,I,!0);nr.set(jt,ir)}function qt(jt,ir){var Tr=Er(jt,ir),I=za(jt);if(I===null)return Tr;var nr=qt(I,ir);if(nr.length<=0)return Tr;if(Tr.length<=0)return nr;for(var Dn=new er,li=[],Hn=0,an=Tr;Hn<an.length;Hn++){var Ai=an[Hn],wi=Dn.has(Ai);wi||(Dn.add(Ai),li.push(Ai))}for(var Wa=0,ls=nr;Wa<ls.length;Wa++){var Ai=ls[Wa],wi=Dn.has(Ai);wi||(Dn.add(Ai),li.push(Ai))}return li}function Er(jt,ir){var Tr=[],I=Te(jt,ir,!1);if(pn(I))return Tr;for(var nr=I.keys(),Dn=wn(nr),li=0;;){var Hn=ki(Dn);if(!Hn)return Tr.length=li,Tr;var an=_i(Hn);try{Tr[li]=an}catch(Ai){try{Xi(Dn)}finally{throw Ai}}li++}}function Kn(jt){if(jt===null)return 1;switch(typeof jt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return jt===null?1:6;default:return 6}}function pn(jt){return jt===void 0}function Wi(jt){return jt===null}function Zn(jt){return typeof jt=="symbol"}function Gn(jt){return typeof jt=="object"?jt!==null:typeof jt=="function"}function pi(jt,ir){switch(Kn(jt)){case 0:return jt;case 1:return jt;case 2:return jt;case 3:return jt;case 4:return jt;case 5:return jt}var Tr=ir===3?"string":ir===5?"number":"default",I=ya(jt,ue);if(I!==void 0){var nr=I.call(jt,Tr);if(Gn(nr))throw new TypeError;return nr}return $n(jt,Tr==="default"?"number":Tr)}function $n(jt,ir){if(ir==="string"){var Tr=jt.toString;if(zi(Tr)){var I=Tr.call(jt);if(!Gn(I))return I}var nr=jt.valueOf;if(zi(nr)){var I=nr.call(jt);if(!Gn(I))return I}}else{var nr=jt.valueOf;if(zi(nr)){var I=nr.call(jt);if(!Gn(I))return I}var Dn=jt.toString;if(zi(Dn)){var I=Dn.call(jt);if(!Gn(I))return I}}throw new TypeError}function ui(jt){return!!jt}function Ji(jt){return""+jt}function Ii(jt){var ir=pi(jt,3);return Zn(ir)?ir:Ji(ir)}function Ei(jt){return Array.isArray?Array.isArray(jt):jt instanceof Object?jt instanceof Array:Object.prototype.toString.call(jt)==="[object Array]"}function zi(jt){return typeof jt=="function"}function na(jt){return typeof jt=="function"}function Si(jt){switch(Kn(jt)){case 3:return!0;case 4:return!0;default:return!1}}function ya(jt,ir){var Tr=jt[ir];if(Tr!=null){if(!zi(Tr))throw new TypeError;return Tr}}function wn(jt){var ir=ya(jt,ze);if(!zi(ir))throw new TypeError;var Tr=ir.call(jt);if(!Gn(Tr))throw new TypeError;return Tr}function _i(jt){return jt.value}function ki(jt){var ir=jt.next();return ir.done?!1:ir}function Xi(jt){var ir=jt.return;ir&&ir.call(jt)}function za(jt){var ir=Object.getPrototypeOf(jt);if(typeof jt!="function"||jt===Gt||ir!==Gt)return ir;var Tr=jt.prototype,I=Tr&&Object.getPrototypeOf(Tr);if(I==null||I===Object.prototype)return ir;var nr=I.constructor;return typeof nr!="function"||nr===jt?ir:nr}function de(){var jt={},ir=[],Tr=function(){function li(Hn,an,Ai){this._index=0,this._keys=Hn,this._values=an,this._selector=Ai}return li.prototype["@@iterator"]=function(){return this},li.prototype[ze]=function(){return this},li.prototype.next=function(){var Hn=this._index;if(Hn>=0&&Hn<this._keys.length){var an=this._selector(this._keys[Hn],this._values[Hn]);return Hn+1>=this._keys.length?(this._index=-1,this._keys=ir,this._values=ir):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},li.prototype.throw=function(Hn){throw this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),Hn},li.prototype.return=function(Hn){return this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),{value:Hn,done:!0}},li}();return function(){function li(){this._keys=[],this._values=[],this._cacheKey=jt,this._cacheIndex=-2}return Object.defineProperty(li.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),li.prototype.has=function(Hn){return this._find(Hn,!1)>=0},li.prototype.get=function(Hn){var an=this._find(Hn,!1);return an>=0?this._values[an]:void 0},li.prototype.set=function(Hn,an){var Ai=this._find(Hn,!0);return this._values[Ai]=an,this},li.prototype.delete=function(Hn){var an=this._find(Hn,!1);if(an>=0){for(var Ai=this._keys.length,wi=an+1;wi<Ai;wi++)this._keys[wi-1]=this._keys[wi],this._values[wi-1]=this._values[wi];return this._keys.length--,this._values.length--,Hn===this._cacheKey&&(this._cacheKey=jt,this._cacheIndex=-2),!0}return!1},li.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=jt,this._cacheIndex=-2},li.prototype.keys=function(){return new Tr(this._keys,this._values,I)},li.prototype.values=function(){return new Tr(this._keys,this._values,nr)},li.prototype.entries=function(){return new Tr(this._keys,this._values,Dn)},li.prototype["@@iterator"]=function(){return this.entries()},li.prototype[ze]=function(){return this.entries()},li.prototype._find=function(Hn,an){return this._cacheKey!==Hn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Hn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(Hn),this._values.push(void 0)),this._cacheIndex},li}();function I(li,Hn){return li}function nr(li,Hn){return Hn}function Dn(li,Hn){return[li,Hn]}}function Nn(){return function(){function jt(){this._map=new Pt}return Object.defineProperty(jt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),jt.prototype.has=function(ir){return this._map.has(ir)},jt.prototype.add=function(ir){return this._map.set(ir,ir),this},jt.prototype.delete=function(ir){return this._map.delete(ir)},jt.prototype.clear=function(){this._map.clear()},jt.prototype.keys=function(){return this._map.keys()},jt.prototype.values=function(){return this._map.values()},jt.prototype.entries=function(){return this._map.entries()},jt.prototype["@@iterator"]=function(){return this.keys()},jt.prototype[ze]=function(){return this.keys()},jt}()}function Ua(){var jt=16,ir=st.create(),Tr=I();return function(){function an(){this._key=I()}return an.prototype.has=function(Ai){var wi=nr(Ai,!1);return wi!==void 0?st.has(wi,this._key):!1},an.prototype.get=function(Ai){var wi=nr(Ai,!1);return wi!==void 0?st.get(wi,this._key):void 0},an.prototype.set=function(Ai,wi){var Wa=nr(Ai,!0);return Wa[this._key]=wi,this},an.prototype.delete=function(Ai){var wi=nr(Ai,!1);return wi!==void 0?delete wi[this._key]:!1},an.prototype.clear=function(){this._key=I()},an}();function I(){var an;do an="@@WeakMap@@"+Hn();while(st.has(ir,an));return ir[an]=!0,an}function nr(an,Ai){if(!j.call(an,Tr)){if(!Ai)return;Object.defineProperty(an,Tr,{value:st.create()})}return an[Tr]}function Dn(an,Ai){for(var wi=0;wi<Ai;++wi)an[wi]=Math.random()*255|0;return an}function li(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):Dn(new Uint8Array(an),an):Dn(new Array(an),an)}function Hn(){var an=li(jt);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var Ai="",wi=0;wi<jt;++wi){var Wa=an[wi];(wi===4||wi===6||wi===8)&&(Ai+="-"),Wa<16&&(Ai+="0"),Ai+=Wa.toString(16).toLowerCase()}return Ai}}function us(jt){return jt.__=void 0,delete jt.__,jt}})})(ye||(ye={}))},69848:function(Ot){(function(J,N){Ot.exports=N()})(this,function(){"use strict";function J(_t,rt,At,tt,$t,br){if(!($t-tt<=At)){var Fr=tt+$t>>1;N(_t,rt,Fr,tt,$t,br%2),J(_t,rt,At,tt,Fr-1,br+1),J(_t,rt,At,Fr+1,$t,br+1)}}function N(_t,rt,At,tt,$t,br){for(;$t>tt;){if($t-tt>600){var Fr=$t-tt+1,en=At-tt+1,Te=Math.log(Fr),Ke=.5*Math.exp(2*Te/3),Fe=.5*Math.sqrt(Te*Ke*(Fr-Ke)/Fr)*(en-Fr/2<0?-1:1),Mt=Math.max(tt,Math.floor(At-en*Ke/Fr+Fe)),gt=Math.min($t,Math.floor(At+(Fr-en)*Ke/Fr+Fe));N(_t,rt,At,Mt,gt,br)}var Zt=rt[2*At+br],qt=tt,Er=$t;for(le(_t,rt,tt,At),rt[2*$t+br]>Zt&&le(_t,rt,tt,$t);qt<Er;){for(le(_t,rt,qt,Er),qt++,Er--;rt[2*qt+br]<Zt;)qt++;for(;rt[2*Er+br]>Zt;)Er--}rt[2*tt+br]===Zt?le(_t,rt,tt,Er):(Er++,le(_t,rt,Er,$t)),Er<=At&&(tt=Er+1),At<=Er&&($t=Er-1)}}function le(_t,rt,At,tt){ye(_t,At,tt),ye(rt,2*At,2*tt),ye(rt,2*At+1,2*tt+1)}function ye(_t,rt,At){var tt=_t[rt];_t[rt]=_t[At],_t[At]=tt}function m(_t,rt,At,tt,$t,br,Fr){for(var en=[0,_t.length-1,0],Te=[],Ke,Fe;en.length;){var Mt=en.pop(),gt=en.pop(),Zt=en.pop();if(gt-Zt<=Fr){for(var qt=Zt;qt<=gt;qt++)Ke=rt[2*qt],Fe=rt[2*qt+1],Ke>=At&&Ke<=$t&&Fe>=tt&&Fe<=br&&Te.push(_t[qt]);continue}var Er=Math.floor((Zt+gt)/2);Ke=rt[2*Er],Fe=rt[2*Er+1],Ke>=At&&Ke<=$t&&Fe>=tt&&Fe<=br&&Te.push(_t[Er]);var Kn=(Mt+1)%2;(Mt===0?At<=Ke:tt<=Fe)&&(en.push(Zt),en.push(Er-1),en.push(Kn)),(Mt===0?$t>=Ke:br>=Fe)&&(en.push(Er+1),en.push(gt),en.push(Kn))}return Te}function ve(_t,rt,At,tt,$t,br){for(var Fr=[0,_t.length-1,0],en=[],Te=$t*$t;Fr.length;){var Ke=Fr.pop(),Fe=Fr.pop(),Mt=Fr.pop();if(Fe-Mt<=br){for(var gt=Mt;gt<=Fe;gt++)j(rt[2*gt],rt[2*gt+1],At,tt)<=Te&&en.push(_t[gt]);continue}var Zt=Math.floor((Mt+Fe)/2),qt=rt[2*Zt],Er=rt[2*Zt+1];j(qt,Er,At,tt)<=Te&&en.push(_t[Zt]);var Kn=(Ke+1)%2;(Ke===0?At-$t<=qt:tt-$t<=Er)&&(Fr.push(Mt),Fr.push(Zt-1),Fr.push(Kn)),(Ke===0?At+$t>=qt:tt+$t>=Er)&&(Fr.push(Zt+1),Fr.push(Fe),Fr.push(Kn))}return en}function j(_t,rt,At,tt){var $t=_t-At,br=rt-tt;return $t*$t+br*br}var ce=function(_t){return _t[0]},ue=function(_t){return _t[1]},ze=function(rt,At,tt,$t,br){At===void 0&&(At=ce),tt===void 0&&(tt=ue),$t===void 0&&($t=64),br===void 0&&(br=Float64Array),this.nodeSize=$t,this.points=rt;for(var Fr=rt.length<65536?Uint16Array:Uint32Array,en=this.ids=new Fr(rt.length),Te=this.coords=new br(rt.length*2),Ke=0;Ke<rt.length;Ke++)en[Ke]=Ke,Te[2*Ke]=At(rt[Ke]),Te[2*Ke+1]=tt(rt[Ke]);J(en,Te,$t,0,en.length-1,0)};ze.prototype.range=function(rt,At,tt,$t){return m(this.ids,this.coords,rt,At,tt,$t,this.nodeSize)},ze.prototype.within=function(rt,At,tt){return ve(this.ids,this.coords,rt,At,tt,this.nodeSize)};var ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(_t){return _t}},nt=Math.fround||function(_t){return function(rt){return _t[0]=+rt,_t[0]}}(new Float32Array(1)),ke=function(rt){this.options=tr(Object.create(ae),rt),this.trees=new Array(this.options.maxZoom+1)};ke.prototype.load=function(rt){var At=this.options,tt=At.log,$t=At.minZoom,br=At.maxZoom,Fr=At.nodeSize;tt&&console.time("total time");var en="prepare "+rt.length+" points";tt&&console.time(en),this.points=rt;for(var Te=[],Ke=0;Ke<rt.length;Ke++)!rt[Ke].geometry||Te.push(Gt(rt[Ke],Ke));this.trees[br+1]=new ze(Te,q,Jt,Fr,Float32Array),tt&&console.timeEnd(en);for(var Fe=br;Fe>=$t;Fe--){var Mt=+Date.now();Te=this._cluster(Te,Fe),this.trees[Fe]=new ze(Te,q,Jt,Fr,Float32Array),tt&&console.log("z%d: %d clusters in %dms",Fe,Te.length,+Date.now()-Mt)}return tt&&console.timeEnd("total time"),this},ke.prototype.getClusters=function(rt,At){var tt=((rt[0]+180)%360+360)%360-180,$t=Math.max(-90,Math.min(90,rt[1])),br=rt[2]===180?180:((rt[2]+180)%360+360)%360-180,Fr=Math.max(-90,Math.min(90,rt[3]));if(rt[2]-rt[0]>=360)tt=-180,br=180;else if(tt>br){var en=this.getClusters([tt,$t,180,Fr],At),Te=this.getClusters([-180,$t,br,Fr],At);return en.concat(Te)}for(var Ke=this.trees[this._limitZoom(At)],Fe=Ke.range(er(tt),Lt(Fr),er(br),Lt($t)),Mt=[],gt=0,Zt=Fe;gt<Zt.length;gt+=1){var qt=Zt[gt],Er=Ke.points[qt];Mt.push(Er.numPoints?sr(Er):this.points[Er.index])}return Mt},ke.prototype.getChildren=function(rt){var At=this._getOriginId(rt),tt=this._getOriginZoom(rt),$t="No cluster with the specified id.",br=this.trees[tt];if(!br)throw new Error($t);var Fr=br.points[At];if(!Fr)throw new Error($t);for(var en=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),Te=br.within(Fr.x,Fr.y,en),Ke=[],Fe=0,Mt=Te;Fe<Mt.length;Fe+=1){var gt=Mt[Fe],Zt=br.points[gt];Zt.parentId===rt&&Ke.push(Zt.numPoints?sr(Zt):this.points[Zt.index])}if(Ke.length===0)throw new Error($t);return Ke},ke.prototype.getLeaves=function(rt,At,tt){At=At||10,tt=tt||0;var $t=[];return this._appendLeaves($t,rt,At,tt,0),$t},ke.prototype.getTile=function(rt,At,tt){var $t=this.trees[this._limitZoom(rt)],br=Math.pow(2,rt),Fr=this.options,en=Fr.extent,Te=Fr.radius,Ke=Te/en,Fe=(tt-Ke)/br,Mt=(tt+1+Ke)/br,gt={features:[]};return this._addTileFeatures($t.range((At-Ke)/br,Fe,(At+1+Ke)/br,Mt),$t.points,At,tt,br,gt),At===0&&this._addTileFeatures($t.range(1-Ke/br,Fe,1,Mt),$t.points,br,tt,br,gt),At===br-1&&this._addTileFeatures($t.range(0,Fe,Ke/br,Mt),$t.points,-1,tt,br,gt),gt.features.length?gt:null},ke.prototype.getClusterExpansionZoom=function(rt){for(var At=this._getOriginZoom(rt)-1;At<=this.options.maxZoom;){var tt=this.getChildren(rt);if(At++,tt.length!==1)break;rt=tt[0].properties.cluster_id}return At},ke.prototype._appendLeaves=function(rt,At,tt,$t,br){for(var Fr=this.getChildren(At),en=0,Te=Fr;en<Te.length;en+=1){var Ke=Te[en],Fe=Ke.properties;if(Fe&&Fe.cluster?br+Fe.point_count<=$t?br+=Fe.point_count:br=this._appendLeaves(rt,Fe.cluster_id,tt,$t,br):br<$t?br++:rt.push(Ke),rt.length===tt)break}return br},ke.prototype._addTileFeatures=function(rt,At,tt,$t,br,Fr){for(var en=0,Te=rt;en<Te.length;en+=1){var Ke=Te[en],Fe=At[Ke],Mt=Fe.numPoints,gt=void 0,Zt=void 0,qt=void 0;if(Mt)gt=Pt(Fe),Zt=Fe.x,qt=Fe.y;else{var Er=this.points[Fe.index];gt=Er.properties,Zt=er(Er.geometry.coordinates[0]),qt=Lt(Er.geometry.coordinates[1])}var Kn={type:1,geometry:[[Math.round(this.options.extent*(Zt*br-tt)),Math.round(this.options.extent*(qt*br-$t))]],tags:gt},pn=void 0;Mt?pn=Fe.id:this.options.generateId?pn=Fe.index:this.points[Fe.index].id&&(pn=this.points[Fe.index].id),pn!==void 0&&(Kn.id=pn),Fr.features.push(Kn)}},ke.prototype._limitZoom=function(rt){return Math.max(this.options.minZoom,Math.min(Math.floor(+rt),this.options.maxZoom+1))},ke.prototype._cluster=function(rt,At){for(var tt=[],$t=this.options,br=$t.radius,Fr=$t.extent,en=$t.reduce,Te=$t.minPoints,Ke=br/(Fr*Math.pow(2,At)),Fe=0;Fe<rt.length;Fe++){var Mt=rt[Fe];if(!(Mt.zoom<=At)){Mt.zoom=At;for(var gt=this.trees[At+1],Zt=gt.within(Mt.x,Mt.y,Ke),qt=Mt.numPoints||1,Er=qt,Kn=0,pn=Zt;Kn<pn.length;Kn+=1){var Wi=pn[Kn],Zn=gt.points[Wi];Zn.zoom>At&&(Er+=Zn.numPoints||1)}if(Er>qt&&Er>=Te){for(var Gn=Mt.x*qt,pi=Mt.y*qt,$n=en&&qt>1?this._map(Mt,!0):null,ui=(Fe<<5)+(At+1)+this.points.length,Ji=0,Ii=Zt;Ji<Ii.length;Ji+=1){var Ei=Ii[Ji],zi=gt.points[Ei];if(!(zi.zoom<=At)){zi.zoom=At;var na=zi.numPoints||1;Gn+=zi.x*na,pi+=zi.y*na,zi.parentId=ui,en&&($n||($n=this._map(Mt,!0)),en($n,this._map(zi)))}}Mt.parentId=ui,tt.push(st(Gn/Er,pi/Er,ui,Er,$n))}else if(tt.push(Mt),Er>1)for(var Si=0,ya=Zt;Si<ya.length;Si+=1){var wn=ya[Si],_i=gt.points[wn];_i.zoom<=At||(_i.zoom=At,tt.push(_i))}}}return tt},ke.prototype._getOriginId=function(rt){return rt-this.points.length>>5},ke.prototype._getOriginZoom=function(rt){return(rt-this.points.length)%32},ke.prototype._map=function(rt,At){if(rt.numPoints)return At?tr({},rt.properties):rt.properties;var tt=this.points[rt.index].properties,$t=this.options.map(tt);return At&&$t===tt?tr({},$t):$t};function st(_t,rt,At,tt,$t){return{x:nt(_t),y:nt(rt),zoom:Infinity,id:At,parentId:-1,numPoints:tt,properties:$t}}function Gt(_t,rt){var At=_t.geometry.coordinates,tt=At[0],$t=At[1];return{x:nt(er(tt)),y:nt(Lt($t)),zoom:Infinity,index:rt,parentId:-1}}function sr(_t){return{type:"Feature",id:_t.id,properties:Pt(_t),geometry:{type:"Point",coordinates:[ht(_t.x),mt(_t.y)]}}}function Pt(_t){var rt=_t.numPoints,At=rt>=1e4?Math.round(rt/1e3)+"k":rt>=1e3?Math.round(rt/100)/10+"k":rt;return tr(tr({},_t.properties),{cluster:!0,cluster_id:_t.id,point_count:rt,point_count_abbreviated:At})}function er(_t){return _t/360+.5}function Lt(_t){var rt=Math.sin(_t*Math.PI/180),At=.5-.25*Math.log((1+rt)/(1-rt))/Math.PI;return At<0?0:At>1?1:At}function ht(_t){return(_t-.5)*360}function mt(_t){var rt=(180-_t*360)*Math.PI/180;return 360*Math.atan(Math.exp(rt))/Math.PI-90}function tr(_t,rt){for(var At in rt)_t[At]=rt[At];return _t}function q(_t){return _t.x}function Jt(_t){return _t.y}return ke})},75752:function(Ot){Ot.exports.RADIUS=6378137,Ot.exports.FLATTENING=1/298.257223563,Ot.exports.POLAR_RADIUS=63567523142e-4}}]);
